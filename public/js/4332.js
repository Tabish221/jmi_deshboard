/*! For license information please see 4332.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4332],{6658:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"#newLogin{align-items:center;display:flex}#newLogin h2{color:#0059b2;font-family:Roboto-Bold;margin:0 10px}input:-webkit-autofill,input:-webkit-autofill:active,input:-webkit-autofill:focus,input:-webkit-autofill:hover{-webkit-box-shadow:inset 0 0 0 30px #fff!important}#capatcha-quest *{color:#777;font-weight:700}#email_send_code,#register,#send_code{background-color:#fdbe01!important;border:1px solid #bfbfbf!important;border-radius:4px;color:#fff!important;display:flex;padding:6px 10px!important;width:auto!important}#open,#open2{display:none}#close,#close2,#open,#open2{font-size:15px;padding-right:5px}.btnEye{background-color:#fff;border:none;border-radius:inherit;padding:0}.input-container{background-color:#fff;border:1px solid #bfbfbf;border-radius:4px;display:flex;margin-bottom:10px;max-width:270px!important}#confirmpassword,#password{border:none;margin-bottom:0!important;width:calc(100% - 19px)}.container{width:100%!important}@media only screen and (max-width:768px){div.col-sm-3.padding-left-0,div.col-sm-6.padding-left-0,div.col-sm-8{padding:0!important}.myFlex{display:flex;justify-content:center}div.form-group{margin-bottom:5px}.input-container{max-width:100%!important}#RegisterForm{width:100%}div.col-xs-12.text-left{padding:0}.container{max-width:390px}}@media only screen and (max-width:402px){#newLogin h2{font-size:25px}}",""]);const s=i},4332:(e,t,n)=>{n.r(t),n.d(t,{default:()=>FT});var r={};n.r(r),n.d(r,{FirebaseError:()=>be,SDK_VERSION:()=>Tt,_DEFAULT_ENTRY_NAME:()=>ht,_addComponent:()=>mt,_addOrOverwriteComponent:()=>gt,_apps:()=>ft,_clearComponents:()=>bt,_components:()=>pt,_getProvider:()=>vt,_registerComponent:()=>yt,_removeServiceInstance:()=>wt,deleteApp:()=>kt,getApp:()=>Ct,getApps:()=>St,initializeApp:()=>Et,onLog:()=>Nt,registerVersion:()=>At,setLogLevel:()=>Dt});var i=n(821);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}var o={class:"opendemoaccount openliveaccount",style:{"background-image":"url('/assets/img/demoaccountbg.jpg')"}},a={class:"container"},c={class:"row pdtb40"},u=(0,i._)("div",{id:"recaptcha-container"},null,-1),l={class:"myFlex"},h={class:"col-lg-4 col-md-5 col-sm-6 col-xs-12 col-xxs text-left"},d=(0,i._)("div",{id:"newLogin"},[(0,i._)("img",{src:"/assets/m/img/icon.png"}),(0,i._)("h2",null," Registration")],-1),f={key:0,class:"alert alert-danger"},p=(0,i._)("div",{id:"recaptcha-container"},null,-1),m={class:"control-group"},g={class:"col-sm-3 padding-left-0"},y={class:"controls"},v=["value"],w={class:"col-sm-9 padding-right-0"},b={class:"controls"},I={class:"form-group"},_=(0,i._)("div",{class:"alert alert-danger col-sm-12",id:"emailerror",style:{display:"none"}},null,-1),T=(0,i._)("div",{class:"alert alert-success col-sm-12",id:"emailsentSuccess",style:{display:"none"}},null,-1),E={class:"col-sm-8"},C={class:"col-sm-4"},S={class:"form-group"},k={class:"col-sm-8"},A={class:"col-sm-4"},N=(0,i._)("div",{class:"alert alert-success col-sm-12",id:"emailsuccessRegsiter",style:{display:"none"}},null,-1),D={class:"form-group"},x={class:"form-group"},R=(0,i._)("div",{class:"alert alert-danger col-sm-12",id:"SMSError",style:{display:"none"}},[(0,i._)("span")],-1),P=(0,i._)("div",{class:"alert alert-success col-sm-12",id:"SMSSuccess",style:{display:"none"}},[(0,i._)("span")],-1),O={class:"col-sm-3"},L=[(0,i.uE)('<option value="" id="myCode" disabled selected>Code</option><option data-countryCode="DZ" value="213">+213</option><option data-countryCode="AD" value="376"> +376</option><option data-countryCode="AO" value="244"> +244</option><option data-countryCode="AI" value="1264"> +1264</option><option data-countryCode="AG" value="1268">+1268</option><option data-countryCode="AR" value="54"> +54</option><option data-countryCode="AM" value="374"> +374</option><option data-countryCode="AW" value="297"> +297</option><option data-countryCode="AU" value="61"> +61</option><option data-countryCode="AT" value="43"> +43</option><option data-countryCode="AZ" value="994"> +994</option><option data-countryCode="BS" value="1242"> +1242</option><option data-countryCode="BH" value="973"> +973</option><option data-countryCode="BD" value="880"> +880</option><option data-countryCode="BB" value="1246"> +1246</option><option data-countryCode="BY" value="375"> +375</option><option data-countryCode="BE" value="32"> +32</option><option data-countryCode="BZ" value="501"> +501</option><option data-countryCode="BJ" value="229"> +229</option><option data-countryCode="BM" value="1441"> +1441</option><option data-countryCode="BT" value="975"> +975</option><option data-countryCode="BO" value="591"> +591</option><option data-countryCode="BA" value="387"> +387</option><option data-countryCode="BW" value="267"> +267</option><option data-countryCode="BR" value="55"> +55</option><option data-countryCode="BN" value="673"> +673</option><option data-countryCode="BG" value="359"> +359</option><option data-countryCode="BF" value="226"> Faso +226</option><option data-countryCode="BI" value="257"> +257</option><option data-countryCode="KH" value="855"> +855</option><option data-countryCode="CM" value="237"> +237</option><option data-countryCode="CA" value="1"> +1</option><option data-countryCode="CV" value="238"> +238</option><option data-countryCode="KY" value="1345"> +1345</option><option data-countryCode="CF" value="236"> +236</option><option data-countryCode="CL" value="56"> +56</option><option data-countryCode="CN" value="86"> +86</option><option data-countryCode="CO" value="57"> +57</option><option data-countryCode="KM" value="269"> +269</option><option data-countryCode="CG" value="242"> +242</option><option data-countryCode="CK" value="682"> +682</option><option data-countryCode="CR" value="506"> +506</option><option data-countryCode="HR" value="385"> +385</option><option data-countryCode="CU" value="53"> +53</option><option data-countryCode="CY" value="90392"> +90392</option><option data-countryCode="CY" value="357"> +357</option><option data-countryCode="CZ" value="42"> +42</option><option data-countryCode="DK" value="45"> +45</option><option data-countryCode="DJ" value="253"> +253</option><option data-countryCode="DM" value="1809"> +1809</option><option data-countryCode="DO" value="1809"> +1809</option><option data-countryCode="EC" value="593"> +593</option><option data-countryCode="EG" value="20"> +20</option><option data-countryCode="SV" value="503"> +503</option><option data-countryCode="GQ" value="240"> +240</option><option data-countryCode="ER" value="291"> +291</option><option data-countryCode="EE" value="372"> +372</option><option data-countryCode="PAK" value="92">+92</option><option data-countryCode="ET" value="251"> +251</option><option data-countryCode="FK" value="500"> +500</option><option data-countryCode="FO" value="298"> +298</option><option data-countryCode="FJ" value="679"> +679</option><option data-countryCode="FI" value="358"> +358</option><option data-countryCode="FR" value="33"> +33</option><option data-countryCode="GF" value="594"> +594</option><option data-countryCode="PF" value="689"> +689</option><option data-countryCode="GA" value="241"> +241</option><option data-countryCode="GM" value="220"> +220</option><option data-countryCode="GE" value="995"> +995</option><option data-countryCode="DE" value="49"> +49</option><option data-countryCode="GH" value="233"> +233</option><option data-countryCode="GI" value="350"> +350</option><option data-countryCode="GR" value="30"> +30</option><option data-countryCode="GL" value="299"> +299</option><option data-countryCode="GD" value="1473"> +1473</option><option data-countryCode="GP" value="590"> +590</option><option data-countryCode="GU" value="671"> +671</option><option data-countryCode="GT" value="502"> +502</option><option data-countryCode="GN" value="224"> +224</option><option data-countryCode="GW" value="245"> +245</option><option data-countryCode="GY" value="592"> +592</option><option data-countryCode="HT" value="509"> +509</option><option data-countryCode="HN" value="504"> +504</option><option data-countryCode="HK" value="852"> +852</option><option data-countryCode="HU" value="36"> +36</option><option data-countryCode="IS" value="354"> +354</option><option data-countryCode="IN" value="91"> +91</option><option data-countryCode="ID" value="62"> +62</option><option data-countryCode="IR" value="98"> +98</option><option data-countryCode="IQ" value="964"> +964</option><option data-countryCode="IE" value="353"> +353</option><option data-countryCode="IL" value="972"> +972</option><option data-countryCode="IT" value="39"> +39</option><option data-countryCode="JM" value="1876"> +1876</option><option data-countryCode="JP" value="81"> +81</option><option data-countryCode="JO" value="962"> +962</option><option data-countryCode="KZ" value="7"> +7</option><option data-countryCode="KE" value="254"> +254</option><option data-countryCode="KI" value="686"> +686</option><option data-countryCode="KP" value="850"> +850</option><option data-countryCode="KR" value="82"> +82</option><option data-countryCode="KW" value="965"> +965</option><option data-countryCode="KG" value="996"> +996</option><option data-countryCode="LA" value="856"> +856</option><option data-countryCode="LV" value="371"> +371</option><option data-countryCode="LB" value="961"> +961</option><option data-countryCode="LS" value="266"> +266</option><option data-countryCode="LR" value="231"> +231</option><option data-countryCode="LY" value="218"> +218</option><option data-countryCode="LI" value="417"> +417</option><option data-countryCode="LT" value="370"> +370</option><option data-countryCode="LU" value="352"> +352</option><option data-countryCode="MO" value="853"> +853</option><option data-countryCode="MK" value="389"> +389</option><option data-countryCode="MG" value="261"> +261</option><option data-countryCode="MW" value="265"> +265</option><option data-countryCode="MY" value="60"> +60</option><option data-countryCode="MV" value="960"> +960</option><option data-countryCode="ML" value="223"> +223</option><option data-countryCode="MT" value="356"> +356</option><option data-countryCode="MH" value="692"> +692</option><option data-countryCode="MQ" value="596"> +596</option><option data-countryCode="MR" value="222"> +222</option><option data-countryCode="YT" value="269"> +269</option><option data-countryCode="MX" value="52"> +52</option><option data-countryCode="FM" value="691"> +691</option><option data-countryCode="MD" value="373"> +373</option><option data-countryCode="MC" value="377"> +377</option><option data-countryCode="MN" value="976"> +976</option><option data-countryCode="MS" value="1664"> +1664</option><option data-countryCode="MA" value="212"> +212</option><option data-countryCode="MZ" value="258"> +258</option><option data-countryCode="MN" value="95"> +95</option><option data-countryCode="NA" value="264"> +264</option><option data-countryCode="NR" value="674"> +674</option><option data-countryCode="NP" value="977"> +977</option><option data-countryCode="NL" value="31"> +31</option><option data-countryCode="NC" value="687"> +687</option><option data-countryCode="NZ" value="64"> +64</option><option data-countryCode="NI" value="505"> +505</option><option data-countryCode="NE" value="227"> +227</option><option data-countryCode="NG" value="234"> +234</option><option data-countryCode="NU" value="683"> +683</option><option data-countryCode="NF" value="672"> +672</option><option data-countryCode="NP" value="670"> +670</option><option data-countryCode="NO" value="47"> +47</option><option data-countryCode="OM" value="968"> +968</option><option data-countryCode="PW" value="680"> +680</option><option data-countryCode="PA" value="507"> +507</option><option data-countryCode="PG" value="675"> +675</option><option data-countryCode="PY" value="595"> +595</option><option data-countryCode="PE" value="51"> +51</option><option data-countryCode="PH" value="63"> +63</option><option data-countryCode="PL" value="48"> +48</option><option data-countryCode="PT" value="351"> +351</option><option data-countryCode="PR" value="1787"> +1787</option><option data-countryCode="QA" value="974"> +974</option><option data-countryCode="RE" value="262"> +262</option><option data-countryCode="RO" value="40"> +40</option><option data-countryCode="RU" value="7"> +7</option><option data-countryCode="RW" value="250"> +250</option><option data-countryCode="SM" value="378"> +378</option><option data-countryCode="ST" value="239"> +239</option><option data-countryCode="SA" value="966"> +966</option><option data-countryCode="SN" value="221"> +221</option><option data-countryCode="CS" value="381"> +381</option><option data-countryCode="SC" value="248"> +248</option><option data-countryCode="SL" value="232"> +232</option><option data-countryCode="SG" value="65"> +65</option><option data-countryCode="SK" value="421"> +421</option><option data-countryCode="SI" value="386"> +386</option><option data-countryCode="SB" value="677"> +677</option><option data-countryCode="SO" value="252"> +252</option><option data-countryCode="ZA" value="27"> +27</option><option data-countryCode="ES" value="34"> +34</option><option data-countryCode="LK" value="94"> +94</option><option data-countryCode="SH" value="290"> +290</option><option data-countryCode="KN" value="1869">+1869</option><option data-countryCode="SC" value="1758"> +1758</option><option data-countryCode="SD" value="249"> +249</option><option data-countryCode="SR" value="597"> +597</option><option data-countryCode="SZ" value="268"> +268</option><option data-countryCode="SE" value="46"> +46</option><option data-countryCode="CH" value="41"> +41</option><option data-countryCode="SI" value="963"> +963</option><option data-countryCode="TW" value="886"> +886</option><option data-countryCode="TJ" value="7"> +7</option><option data-countryCode="TH" value="66"> +66</option><option data-countryCode="TG" value="228"> +228</option><option data-countryCode="TO" value="676"> +676</option><option data-countryCode="TT" value="1868"> +1868</option><option data-countryCode="TN" value="216"> +216</option><option data-countryCode="TR" value="90"> +90</option><option data-countryCode="TM" value="993"> +993</option><option data-countryCode="TC" value="1649"> +1649</option><option data-countryCode="TV" value="688"> +688</option><option data-countryCode="UG" value="256"> +256</option><option data-countryCode="GB" value="44">+44</option><option data-countryCode="UA" value="380"> +380</option><option data-countryCode="AE" value="971">+971</option><option data-countryCode="UY" value="598"> +598</option><option data-countryCode="US" value="1"> +1</option><option data-countryCode="UZ" value="7"> +7</option><option data-countryCode="VU" value="678"> +678</option><option data-countryCode="VA" value="379"> +379</option><option data-countryCode="VE" value="58"> +58</option><option data-countryCode="VN" value="84"> +84</option><option data-countryCode="VG" value="84"> +1284</option><option data-countryCode="VI" value="84"> +1340</option><option data-countryCode="WF" value="681"> +681</option><option data-countryCode="YE" value="969">+969</option><option data-countryCode="YE" value="967">+967</option><option data-countryCode="ZM" value="260">+260</option><option data-countryCode="ZW" value="263"> +263</option>',215)],M={class:"col-sm-5"},F={class:"col-sm-4"},V={class:"form-group"},U=(0,i._)("div",{class:"col-sm-8"},[(0,i._)("input",{type:"number",id:"verificationCode",class:"form-control",placeholder:"Enter verification code",style:{display:"none"},required:""})],-1),B={class:"col-sm-4"},q=(0,i._)("div",{class:"alert alert-success col-sm-12",id:"SuccessVerify",style:{display:"none"}},null,-1),j=(0,i._)("div",{class:"alert error col-sm-12",id:"ErrorVerify",style:{display:"none"}},null,-1),z={class:"control-group"},G={class:"col-sm-6 padding-left-0"},K={class:"controls input-container"},$=[(0,i._)("i",{id:"open",class:"fas fa-eye"},null,-1),(0,i.Uk)(),(0,i._)("i",{id:"close",class:"fas fa-eye-slash"},null,-1)],H={class:"col-sm-6 padding-right-0"},W={class:"controls input-container"},Q=[(0,i._)("i",{id:"open2",class:"fas fa-eye"},null,-1),(0,i.Uk)(),(0,i._)("i",{id:"close2",class:"fas fa-eye-slash"},null,-1)],Y=(0,i._)("button",{type:"submit",class:"btn btn-success submit",id:"register",disabled:""},"Register Now",-1);var J=n(7215),X=n(9669),Z=n.n(X),ee=n(2201),te=n(9755),ne=n.n(te),re=n(4155);const ie=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},se={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(ie(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new oe;const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class oe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ae=function(e){return function(e){const t=ie(e);return se.encodeByteArray(t,!0)}(e).replace(/\./g,"")},ce=function(e){try{return se.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ue(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=ue(e[n],t[n]));return e}const le=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,he=()=>{try{return le()||(()=>{if(void 0===re||void 0===re.env)return;const e=re.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&ce(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},de=()=>{var e;return null===(e=he())||void 0===e?void 0:e.config};class fe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function pe(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function me(){var e;const t=null===(e=he())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function ge(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ye(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ve(){const e=pe();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function we(){try{return"object"==typeof indexedDB}catch(e){return!1}}class be extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,be.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ie.prototype.create)}}class Ie{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(_e,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new be(r,o,n)}}const _e=/\{\$([^}]+)}/g;function Te(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ee(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(Ce(n)&&Ce(s)){if(!Ee(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function Ce(e){return null!==e&&"object"==typeof e}function Se(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ke(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function Ae(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function Ne(e,t){const n=new De(e,t);return n.subscribe.bind(n)}class De{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=xe),void 0===r.error&&(r.error=xe),void 0===r.complete&&(r.complete=xe);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function xe(){}function Re(e){return e&&e._delegate?e._delegate:e}class Pe{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Oe="[DEFAULT]";class Le{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new fe;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Oe})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=Oe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=Oe){return this.instances.has(e)}getOptions(e=Oe){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===Oe?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Oe){return this.component?this.component.multipleInstances?e:Oe:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Me{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Le(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Fe=[];var Ve;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Ve||(Ve={}));const Ue={debug:Ve.DEBUG,verbose:Ve.VERBOSE,info:Ve.INFO,warn:Ve.WARN,error:Ve.ERROR,silent:Ve.SILENT},Be=Ve.INFO,qe={[Ve.DEBUG]:"log",[Ve.VERBOSE]:"log",[Ve.INFO]:"info",[Ve.WARN]:"warn",[Ve.ERROR]:"error"},je=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=qe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class ze{constructor(e){this.name=e,this._logLevel=Be,this._logHandler=je,this._userLogHandler=null,Fe.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ve))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Ue[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ve.DEBUG,...e),this._logHandler(this,Ve.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ve.VERBOSE,...e),this._logHandler(this,Ve.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ve.INFO,...e),this._logHandler(this,Ve.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ve.WARN,...e),this._logHandler(this,Ve.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ve.ERROR,...e),this._logHandler(this,Ve.ERROR,...e)}}const Ge=(e,t)=>t.some((t=>e instanceof t));let Ke,$e;const He=new WeakMap,We=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,Je=new WeakMap;let Xe={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return We.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Qe.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return tt(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ze(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?($e||($e=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(nt(this),t),tt(He.get(this))}:function(...t){return tt(e.apply(nt(this),t))}:function(t,...n){const r=e.call(nt(this),t,...n);return Qe.set(r,t.sort?t.sort():[t]),tt(r)}}function et(e){return"function"==typeof e?Ze(e):(e instanceof IDBTransaction&&function(e){if(We.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));We.set(e,t)}(e),Ge(e,Ke||(Ke=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Xe):e)}function tt(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(tt(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&He.set(t,e)})).catch((()=>{})),Je.set(t,e),t}(e);if(Ye.has(e))return Ye.get(e);const t=et(e);return t!==e&&(Ye.set(e,t),Je.set(t,e)),t}const nt=e=>Je.get(e);const rt=["get","getKey","getAll","getAllKeys","count"],it=["put","add","delete","clear"],st=new Map;function ot(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(st.get(t))return st.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=it.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!rt.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return st.set(t,s),s}Xe=(e=>({...e,get:(t,n,r)=>ot(t,n)||e.get(t,n,r),has:(t,n)=>!!ot(t,n)||e.has(t,n)}))(Xe);class at{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ct="@firebase/app",ut="0.9.12",lt=new ze("@firebase/app"),ht="[DEFAULT]",dt={[ct]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ft=new Map,pt=new Map;function mt(e,t){try{e.container.addComponent(t)}catch(n){lt.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function gt(e,t){e.container.addOrOverwriteComponent(t)}function yt(e){const t=e.name;if(pt.has(t))return lt.debug(`There were multiple attempts to register component ${t}.`),!1;pt.set(t,e);for(const t of ft.values())mt(t,e);return!0}function vt(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function wt(e,t,n=ht){vt(e,t).clearInstance(n)}function bt(){pt.clear()}const It=new Ie("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class _t{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Pe("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}}const Tt="9.22.2";function Et(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:ht,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw It.create("bad-app-name",{appName:String(i)});if(n||(n=de()),!n)throw It.create("no-options");const s=ft.get(i);if(s){if(Ee(n,s.options)&&Ee(r,s.config))return s;throw It.create("duplicate-app",{appName:i})}const o=new Me(i);for(const e of pt.values())o.addComponent(e);const a=new _t(n,r,o);return ft.set(i,a),a}function Ct(e=ht){const t=ft.get(e);if(!t&&e===ht&&de())return Et();if(!t)throw It.create("no-app",{appName:e});return t}function St(){return Array.from(ft.values())}async function kt(e){const t=e.name;ft.has(t)&&(ft.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function At(e,t,n){var r;let i=null!==(r=dt[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void lt.warn(e.join(" "))}yt(new Pe(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}function Nt(e,t){if(null!==e&&"function"!=typeof e)throw It.create("invalid-log-argument");!function(e,t){for(const n of Fe){let r=null;t&&t.level&&(r=Ue[t.level]),n.userLogHandler=null===e?null:(t,n,...i)=>{const s=i.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:Ve[n].toLowerCase(),message:s,args:i,type:t.name})}}}(e,t)}function Dt(e){var t;t=e,Fe.forEach((e=>{e.setLogLevel(t)}))}const xt="firebase-heartbeat-database",Rt=1,Pt="firebase-heartbeat-store";let Ot=null;function Lt(){return Ot||(Ot=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=tt(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(tt(o.result),e.oldVersion,e.newVersion,tt(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(xt,Rt,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Pt)}}).catch((e=>{throw It.create("idb-open",{originalErrorMessage:e.message})}))),Ot}async function Mt(e,t){try{const n=(await Lt()).transaction(Pt,"readwrite"),r=n.objectStore(Pt);await r.put(t,Ft(e)),await n.done}catch(e){if(e instanceof be)lt.warn(e.message);else{const t=It.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});lt.warn(t.message)}}}function Ft(e){return`${e.name}!${e.options.appId}`}class Vt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Bt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Ut();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ut(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),qt(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),qt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=ae(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Ut(){return(new Date).toISOString().substring(0,10)}class Bt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!we()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await Lt();return await t.transaction(Pt).objectStore(Pt).get(Ft(e))}catch(e){if(e instanceof be)lt.warn(e.message);else{const t=It.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});lt.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Mt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Mt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function qt(e){return ae(JSON.stringify({version:2,heartbeats:e})).length}var jt;jt="",yt(new Pe("platform-logger",(e=>new at(e)),"PRIVATE")),yt(new Pe("heartbeat",(e=>new Vt(e)),"PRIVATE")),At(ct,ut,jt),At(ct,ut,"esm2017"),At("fire-js","");class zt{constructor(e,t){this._delegate=e,this.firebase=t,mt(e,new Pe("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),kt(this._delegate))))}_getService(e,t=ht){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=ht){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){mt(this._delegate,e)}_addOrOverwriteComponent(e){gt(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Gt=new Ie("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});const Kt=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(r,i={}){const s=Et(r,i);if(Te(t,s.name))return t[s.name];const o=new e(s,n);return t[s.name]=o,o},app:i,registerVersion:At,setLogLevel:Dt,onLog:Nt,apps:null,SDK_VERSION:Tt,INTERNAL:{registerComponent:function(t){const r=t.name,s=r.replace("-compat","");if(yt(t)&&"PUBLIC"===t.type){const o=(e=i())=>{if("function"!=typeof e[s])throw Gt.create("invalid-app-argument",{appName:r});return e[s]()};void 0!==t.serviceProps&&ue(o,t.serviceProps),n[s]=o,e.prototype[s]=function(...e){return this._getService.bind(this,r).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[s]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:r}};function i(e){if(!Te(t,e=e||ht))throw Gt.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(zt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){ue(t,e)},createSubscribe:Ne,ErrorFactory:Ie,deepExtend:ue}),t}(),$t=new ze("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){$t.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&$t.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Ht=Kt;!function(e){At("@firebase/app-compat","0.2.12",e)}();Ht.registerVersion("firebase","9.22.2","app-compat");function Wt(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;const Qt={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Yt="EMAIL_SIGNIN",Jt="PASSWORD_RESET",Xt="RECOVER_EMAIL",Zt="REVERT_SECOND_FACTOR_ADDITION",en="VERIFY_AND_CHANGE_EMAIL",tn="VERIFY_EMAIL";function nn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const rn=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},sn=nn,on=new Ie("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),an=new ze("@firebase/auth");function cn(e,...t){an.logLevel<=Ve.ERROR&&an.error(`Auth (${Tt}): ${e}`,...t)}function un(e,...t){throw fn(e,...t)}function ln(e,...t){return fn(e,...t)}function hn(e,t,n){const r=Object.assign(Object.assign({},sn()),{[t]:n});return new Ie("auth","Firebase",r).create(t,{appName:e.name})}function dn(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&un(e,"argument-error"),hn(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fn(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return on.create(e,...t)}function pn(e,t,...n){if(!e)throw fn(t,...n)}function mn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw cn(t),new Error(t)}function gn(e,t){e||mn(t)}function yn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function vn(){return"http:"===wn()||"https:"===wn()}function wn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class bn{constructor(e,t){this.shortDelay=e,this.longDelay=t,gn(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pe())||ye()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(vn()||ge()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function In(e,t){gn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class _n{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void mn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void mn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void mn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Tn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},En=new bn(3e4,6e4);function Cn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Sn(e,t,n,r,i={}){return kn(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=Se(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),_n.fetch()(Nn(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function kn(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Tn),t);try{const t=new Dn(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw xn(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw xn(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw xn(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw xn(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw hn(e,a,o);un(e,a)}}catch(t){if(t instanceof be)throw t;un(e,"network-request-failed",{message:String(t)})}}async function An(e,t,n,r,i={}){const s=await Sn(e,t,n,r,i);return"mfaPendingCredential"in s&&un(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Nn(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?In(e.config,i):`${e.config.apiScheme}://${i}`}class Dn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(ln(this.auth,"network-request-failed"))),En.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function xn(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=ln(e,t,r);return i.customData._tokenResponse=n,i}function Rn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Pn(e){return 1e3*Number(e)}function On(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return cn("JWT malformed, contained fewer than 3 sections"),null;try{const e=ce(n);return e?JSON.parse(e):(cn("Failed to decode base64 JWT payload"),null)}catch(e){return cn("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Ln(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof be&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Mn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Fn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Rn(this.lastLoginAt),this.creationTime=Rn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Vn(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Ln(e,async function(e,t){return Sn(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));pn(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Wt(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Fn(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class Un{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pn(e.idToken,"internal-error"),pn(void 0!==e.idToken,"internal-error"),pn(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=On(e);return pn(t,"internal-error"),pn(void 0!==t.exp,"internal-error"),pn(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return pn(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await kn(e,{},(async()=>{const n=Se({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=Nn(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",_n.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Un;return n&&(pn("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(pn("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(pn("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Un,this.toJSON())}_performRefresh(){return mn("not implemented")}}function Bn(e,t){pn("string"==typeof e||void 0===e,"internal-error",{appName:t})}class qn{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Wt(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Mn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Fn(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Ln(this,this.stsTokenManager.getToken(this.auth,e));return pn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Re(e),r=await n.getIdToken(t),i=On(r);pn(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Rn(Pn(i.auth_time)),issuedAtTime:Rn(Pn(i.iat)),expirationTime:Rn(Pn(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Re(e);await Vn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(pn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new qn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){pn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Vn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Ln(this,async function(e,t){return Sn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:I,stsTokenManager:_}=t;pn(v&&_,e,"internal-error");const T=Un.fromJSON(this.name,_);pn("string"==typeof v,e,"internal-error"),Bn(l,e.name),Bn(h,e.name),pn("boolean"==typeof w,e,"internal-error"),pn("boolean"==typeof b,e,"internal-error"),Bn(d,e.name),Bn(f,e.name),Bn(p,e.name),Bn(m,e.name),Bn(g,e.name),Bn(y,e.name);const E=new qn({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(E.providerData=I.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new Un;r.updateFromServerResponse(t);const i=new qn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Vn(i),i}}const jn=new Map;function zn(e){gn(e instanceof Function,"Expected a class definition");let t=jn.get(e);return t?(gn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,jn.set(e,t),t)}class Gn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Gn.type="NONE";const Kn=Gn;function $n(e,t,n){return`firebase:${e}:${t}:${n}`}class Hn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=$n(this.userKey,r.apiKey,i),this.fullPersistenceKey=$n("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?qn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Hn(zn(Kn),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||zn(Kn);const s=$n(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=qn._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Hn(i,e,n)):new Hn(i,e,n)}}function Wn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Xn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Qn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(er(t))return"Blackberry";if(tr(t))return"Webos";if(Yn(t))return"Safari";if((t.includes("chrome/")||Jn(t))&&!t.includes("edge/"))return"Chrome";if(Zn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Qn(e=pe()){return/firefox\//i.test(e)}function Yn(e=pe()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Jn(e=pe()){return/crios\//i.test(e)}function Xn(e=pe()){return/iemobile/i.test(e)}function Zn(e=pe()){return/android/i.test(e)}function er(e=pe()){return/blackberry/i.test(e)}function tr(e=pe()){return/webos/i.test(e)}function nr(e=pe()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function rr(e=pe()){return nr(e)||Zn(e)||tr(e)||er(e)||/windows phone/i.test(e)||Xn(e)}function ir(e,t=[]){let n;switch(e){case"Browser":n=Wn(pe());break;case"Worker":n=`${Wn(pe())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Tt}/${r}`}async function sr(e,t){return Sn(e,"GET","/v2/recaptchaConfig",Cn(e,t))}function or(e){return void 0!==e&&void 0!==e.getResponse}function ar(e){return void 0!==e&&void 0!==e.enterprise}class cr{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function ur(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=ln("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function lr(e){return`__${e}${Math.floor(1e6*Math.random())}`}class hr{constructor(e){this.type="recaptcha-enterprise",this.auth=mr(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;ar(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{sr(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new cr(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&ar(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));ur("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function dr(e,t,n,r=!1){const i=new hr(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class fr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class pr{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gr(this),this.idTokenSubscription=new gr(this),this.beforeStateQueue=new fr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=on,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=zn(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Hn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return pn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vn(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Re(e):null;return t&&pn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&pn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(zn(e))}))}async initializeRecaptchaConfig(){const e=await sr(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new cr(e);if(null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled){new hr(this).verify()}}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ie("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&zn(e)||this._popupRedirectResolver;pn(t,this,"argument-error"),this.redirectPersistenceManager=await Hn.create(this,[zn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return pn(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ir(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){an.logLevel<=Ve.WARN&&an.warn(`Auth (${Tt}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function mr(e){return Re(e)}class gr{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ne((e=>this.observer=e))}get next(){return pn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function yr(e,t,n){const r=mr(e);pn(r._canInitEmulator,r,"emulator-config-failed"),pn(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=vr(t),{host:o,port:a}=function(e){const t=vr(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:wr(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:wr(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function vr(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function wr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class br{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return mn("not implemented")}_getIdTokenResponse(e){return mn("not implemented")}_linkToIdToken(e,t){return mn("not implemented")}_getReauthenticationResolver(e){return mn("not implemented")}}async function Ir(e,t){return Sn(e,"POST","/v1/accounts:resetPassword",Cn(e,t))}async function _r(e,t){return Sn(e,"POST","/v1/accounts:update",t)}async function Tr(e,t){return An(e,"POST","/v1/accounts:signInWithPassword",Cn(e,t))}async function Er(e,t){return Sn(e,"POST","/v1/accounts:sendOobCode",Cn(e,t))}async function Cr(e,t){return Er(e,t)}async function Sr(e,t){return Er(e,t)}class kr extends br{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new kr(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new kr(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await dr(e,n,"signInWithPassword");return Tr(e,t)}return Tr(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await dr(e,n,"signInWithPassword");return Tr(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return An(e,"POST","/v1/accounts:signInWithEmailLink",Cn(e,t))}(e,{email:this._email,oobCode:this._password});default:un(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return _r(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return An(e,"POST","/v1/accounts:signInWithEmailLink",Cn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:un(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ar(e,t){return An(e,"POST","/v1/accounts:signInWithIdp",Cn(e,t))}class Nr extends br{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Nr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):un("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Wt(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Nr(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Ar(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ar(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ar(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Se(t)}return e}}const Dr={USER_NOT_FOUND:"user-not-found"};class xr extends br{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new xr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new xr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return An(e,"POST","/v1/accounts:signInWithPhoneNumber",Cn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await An(e,"POST","/v1/accounts:signInWithPhoneNumber",Cn(e,t));if(n.temporaryProof)throw xn(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return An(e,"POST","/v1/accounts:signInWithPhoneNumber",Cn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Dr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new xr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Rr{constructor(e){var t,n,r,i,s,o;const a=ke(Ae(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);pn(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=ke(Ae(e)).link,n=t?ke(Ae(t)).deep_link_id:null,r=ke(Ae(e)).deep_link_id;return(r?ke(Ae(r)).link:null)||r||n||t||e}(e);try{return new Rr(t)}catch(e){return null}}}class Pr{constructor(){this.providerId=Pr.PROVIDER_ID}static credential(e,t){return kr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Rr.parseLink(t);return pn(n,"argument-error"),kr._fromEmailAndCode(e,n.code,n.tenantId)}}Pr.PROVIDER_ID="password",Pr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Pr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Or{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Lr extends Or{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Mr extends Lr{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return pn("providerId"in t&&"signInMethod"in t,"argument-error"),Nr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return pn(e.idToken||e.accessToken,"argument-error"),Nr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Mr.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Mr.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new Mr(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Fr extends Lr{constructor(){super("facebook.com")}static credential(e){return Nr._fromParams({providerId:Fr.PROVIDER_ID,signInMethod:Fr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fr.credentialFromTaggedObject(e)}static credentialFromError(e){return Fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Fr.credential(e.oauthAccessToken)}catch(e){return null}}}Fr.FACEBOOK_SIGN_IN_METHOD="facebook.com",Fr.PROVIDER_ID="facebook.com";class Vr extends Lr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Nr._fromParams({providerId:Vr.PROVIDER_ID,signInMethod:Vr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Vr.credentialFromTaggedObject(e)}static credentialFromError(e){return Vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Vr.credential(t,n)}catch(e){return null}}}Vr.GOOGLE_SIGN_IN_METHOD="google.com",Vr.PROVIDER_ID="google.com";class Ur extends Lr{constructor(){super("github.com")}static credential(e){return Nr._fromParams({providerId:Ur.PROVIDER_ID,signInMethod:Ur.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ur.credentialFromTaggedObject(e)}static credentialFromError(e){return Ur.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ur.credential(e.oauthAccessToken)}catch(e){return null}}}Ur.GITHUB_SIGN_IN_METHOD="github.com",Ur.PROVIDER_ID="github.com";class Br extends br{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Ar(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ar(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ar(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Br(n,i):null}static _create(e,t){return new Br(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class qr extends Or{constructor(e){pn(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return qr.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return qr.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Br.fromJSON(e);return pn(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Br._create(n,t)}catch(e){return null}}}class jr extends Lr{constructor(){super("twitter.com")}static credential(e,t){return Nr._fromParams({providerId:jr.PROVIDER_ID,signInMethod:jr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return jr.credentialFromTaggedObject(e)}static credentialFromError(e){return jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return jr.credential(t,n)}catch(e){return null}}}async function zr(e,t){return An(e,"POST","/v1/accounts:signUp",Cn(e,t))}jr.TWITTER_SIGN_IN_METHOD="twitter.com",jr.PROVIDER_ID="twitter.com";class Gr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await qn._fromIdTokenResponse(e,n,r),s=Kr(n);return new Gr({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Kr(n);return new Gr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Kr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class $r extends be{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,$r.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new $r(e,t,n,r)}}function Hr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw $r._fromErrorAndOperation(e,n,t,r);throw n}))}function Wr(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Qr(e,t){const n=Re(e);await Jr(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return Sn(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=Wr(r||[]);return n.providerData=n.providerData.filter((e=>i.has(e.providerId))),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Yr(e,t,n=!1){const r=await Ln(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Gr._forOperation(e,"link",r)}async function Jr(e,t,n){await Vn(t);const r=!1===e?"provider-already-linked":"no-such-provider";pn(Wr(t.providerData).has(n)===e,t.auth,r)}async function Xr(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await Ln(e,Hr(r,i,t,e),n);pn(s.idToken,r,"internal-error");const o=On(s.idToken);pn(o,r,"internal-error");const{sub:a}=o;return pn(e.uid===a,r,"user-mismatch"),Gr._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&un(r,"user-mismatch"),e}}async function Zr(e,t,n=!1){const r="signIn",i=await Hr(e,r,t),s=await Gr._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function ei(e,t){return Zr(mr(e),t)}async function ti(e,t){const n=Re(e);return await Jr(!1,n,t.providerId),Yr(n,t)}async function ni(e,t){return Xr(Re(e),t)}async function ri(e,t){const n=mr(e),r=await async function(e,t){return An(e,"POST","/v1/accounts:signInWithCustomToken",Cn(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Gr._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class ii{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?si._fromServerResponse(e,t):"totpInfo"in t?oi._fromServerResponse(e,t):un(e,"internal-error")}}class si extends ii{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new si(t)}}class oi extends ii{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new oi(t)}}function ai(e,t,n){var r;pn((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),pn(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(pn(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(pn(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function ci(e,t){await async function(e,t){return Sn(e,"POST","/v1/accounts:update",Cn(e,t))}(Re(e),{oobCode:t})}async function ui(e,t){const n=Re(e),r=await Ir(n,{oobCode:t}),i=r.requestType;switch(pn(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":pn(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":pn(r.mfaInfo,n,"internal-error");default:pn(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=ii._fromServerResponse(mr(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function li(e,t){const n={identifier:t,continueUri:vn()?yn():"http://localhost"},{signinMethods:r}=await async function(e,t){return Sn(e,"POST","/v1/accounts:createAuthUri",Cn(e,t))}(Re(e),n);return r||[]}async function hi(e,t){const n=Re(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&ai(n.auth,r,t);const{email:i}=await async function(e,t){return Er(e,t)}(n.auth,r);i!==e.email&&await e.reload()}async function di(e,t,n){const r=Re(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&ai(r.auth,i,n);const{email:s}=await async function(e,t){return Er(e,t)}(r.auth,i);s!==e.email&&await e.reload()}async function fi(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=Re(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await Ln(r,async function(e,t){return Sn(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}async function pi(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await Ln(e,_r(r,i));await e._updateTokensIfNecessary(s,!0)}class mi{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class gi extends mi{constructor(e,t,n,r){super(e,t,n),this.username=r}}class yi extends mi{constructor(e,t){super(e,"facebook.com",t)}}class vi extends gi{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class wi extends mi{constructor(e,t){super(e,"google.com",t)}}class bi extends gi{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Ii(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=On(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new mi(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new yi(s,i);case"github.com":return new vi(s,i);case"google.com":return new wi(s,i);case"twitter.com":return new bi(s,i,e.screenName||null);case"custom":case"anonymous":return new mi(s,null);default:return new mi(s,r,i)}}(n)}class _i{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new _i("enroll",e,t)}static _fromMfaPendingCredential(e){return new _i("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return _i._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return _i._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Ti{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=mr(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>ii._fromServerResponse(n,e)));pn(r.mfaPendingCredential,n,"internal-error");const s=_i._fromMfaPendingCredential(r.mfaPendingCredential);return new Ti(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Gr._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return pn(t.user,n,"internal-error"),Gr._forOperation(t.user,t.operationType,o);default:un(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Ei{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>ii._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Ei(e)}async getSession(){return _i._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await Ln(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await Ln(this.user,function(e,t){return Sn(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Cn(e,t))}(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}const Ci=new WeakMap;const Si="__sak";class ki{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Si,"1"),this.storage.removeItem(Si),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ai extends ki{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=pe();return Yn(e)||nr(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=rr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);ve()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ai.type="LOCAL";const Ni=Ai;class Di extends ki{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Di.type="SESSION";const xi=Di;class Ri{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ri(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Pi(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Ri.receivers=[];class Oi{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Pi("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Li(){return window}function Mi(){return void 0!==Li().WorkerGlobalScope&&"function"==typeof Li().importScripts}const Fi="firebaseLocalStorageDb",Vi="firebaseLocalStorage",Ui="fbase_key";class Bi{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function qi(e,t){return e.transaction([Vi],t?"readwrite":"readonly").objectStore(Vi)}function ji(){const e=indexedDB.open(Fi,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Vi,{keyPath:Ui})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Vi)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Fi);return new Bi(e).toPromise()}(),t(await ji()))}))}))}async function zi(e,t,n){const r=qi(e,!0).put({[Ui]:t,value:n});return new Bi(r).toPromise()}function Gi(e,t){const n=qi(e,!0).delete(t);return new Bi(n).toPromise()}class Ki{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await ji()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mi()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ri._getInstance(Mi()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Oi(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ji();return await zi(e,Si,"1"),await Gi(e,Si),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>zi(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=qi(e,!1).get(t),r=await new Bi(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Gi(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=qi(e,!1).getAll();return new Bi(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ki.type="LOCAL";const $i=Ki;const Hi=1e12;class Wi{constructor(e){this.auth=e,this.counter=Hi,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Qi(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Hi;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Hi;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Hi;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Qi{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;pn(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Yi=lr("rcb"),Ji=new bn(3e4,6e4);class Xi{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=Li().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return pn(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&or(Li().grecaptcha)?Promise.resolve(Li().grecaptcha):new Promise(((n,r)=>{const i=Li().setTimeout((()=>{r(ln(e,"network-request-failed"))}),Ji.get());Li()[Yi]=()=>{Li().clearTimeout(i),delete Li()[Yi];const s=Li().grecaptcha;if(!s||!or(s))return void r(ln(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)};ur(`https://www.google.com/recaptcha/api.js??${Se({onload:Yi,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(i),r(ln(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=Li().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Zi{async load(e){return new Wi(e)}clearedOneInstance(){}}const es="recaptcha",ts={theme:"light",type:"image"};class ns{constructor(e,t=Object.assign({},ts),n){this.parameters=t,this.type=es,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=mr(n),this.isInvisible="invisible"===this.parameters.size,pn("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;pn(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Zi:new Xi,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){pn(!this.parameters.sitekey,this.auth,"argument-error"),pn(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),pn("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=Li()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){pn(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){pn(vn()&&!Mi(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Sn(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);pn(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return pn(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class rs{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=xr._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function is(e,t,n){var r;const i=await n.verify();try{let s;if(pn("string"==typeof i,e,"argument-error"),pn(n.type===es,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){pn("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Sn(e,"POST","/v2/accounts/mfaEnrollment:start",Cn(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{pn("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;pn(n,e,"missing-multi-factor-info");const o=await function(e,t){return Sn(e,"POST","/v2/accounts/mfaSignIn:start",Cn(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Sn(e,"POST","/v1/accounts:sendVerificationCode",Cn(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class ss{constructor(e){this.providerId=ss.PROVIDER_ID,this.auth=mr(e)}verifyPhoneNumber(e,t){return is(this.auth,e,Re(t))}static credential(e,t){return xr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ss.credentialFromTaggedObject(t)}static credentialFromError(e){return ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?xr._fromTokenResponse(t,n):null}}function os(e,t){return t?zn(t):(pn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}ss.PROVIDER_ID="phone",ss.PHONE_SIGN_IN_METHOD="phone";class as extends br{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ar(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ar(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ar(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cs(e){return Zr(e.auth,new as(e),e.bypassAuthState)}function us(e){const{auth:t,user:n}=e;return pn(n,t,"internal-error"),Xr(n,new as(e),e.bypassAuthState)}async function ls(e){const{auth:t,user:n}=e;return pn(n,t,"internal-error"),Yr(n,new as(e),e.bypassAuthState)}class hs{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cs;case"linkViaPopup":case"linkViaRedirect":return ls;case"reauthViaPopup":case"reauthViaRedirect":return us;default:un(this.auth,"internal-error")}}resolve(e){gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ds=new bn(2e3,1e4);class fs extends hs{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,fs.currentPopupAction&&fs.currentPopupAction.cancel(),fs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pn(e,this.auth,"internal-error"),e}async onExecution(){gn(1===this.filter.length,"Popup operations only handle one event");const e=Pi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(ln(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ln(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(ln(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,ds.get())};e()}}fs.currentPopupAction=null;const ps="pendingRedirect",ms=new Map;class gs extends hs{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ms.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=bs(t),r=ws(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ms.set(this.auth._key(),e)}return this.bypassAuthState||ms.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function ys(e,t){return ws(e)._set(bs(t),"true")}function vs(e,t){ms.set(e._key(),t)}function ws(e){return zn(e._redirectPersistence)}function bs(e){return $n(ps,e.config.apiKey,e.name)}function Is(e,t,n){return async function(e,t,n){const r=mr(e);dn(e,t,Or),await r._initializationPromise;const i=os(r,n);return await ys(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function _s(e,t,n){return async function(e,t,n){const r=Re(e);dn(r.auth,t,Or),await r.auth._initializationPromise;const i=os(r.auth,n);await ys(i,r.auth);const s=await Cs(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function Ts(e,t,n){return async function(e,t,n){const r=Re(e);dn(r.auth,t,Or),await r.auth._initializationPromise;const i=os(r.auth,n);await Jr(!1,r,t.providerId),await ys(i,r.auth);const s=await Cs(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function Es(e,t,n=!1){const r=mr(e),i=os(r,t),s=new gs(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Cs(e){const t=Pi(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Ss{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return As(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!As(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(ln(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ks(e))}saveEventToCache(e){this.cachedEventUids.add(ks(e)),this.lastProcessedEventTime=Date.now()}}function ks(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function As({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Ns(e,t={}){return Sn(e,"GET","/v1/projects",t)}const Ds=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xs=/^https?/;function Rs(e){const t=yn(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!xs.test(n))return!1;if(Ds.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Ps=new bn(3e4,6e4);function Os(){const e=Li().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Ls=null;function Ms(e){return Ls=Ls||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){Os(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Os(),n(ln(e,"network-request-failed"))},timeout:Ps.get()})}if(null===(i=null===(r=Li().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Li().gapi)||void 0===s?void 0:s.load)){const t=lr("iframefcb");return Li()[t]=()=>{gapi.load?o():n(ln(e,"network-request-failed"))},ur(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Ls=null,e}))}(e),Ls}const Fs=new bn(5e3,15e3),Vs="__/auth/iframe",Us="emulator/auth/iframe",Bs={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function js(e){const t=e.config;pn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?In(t,Us):`https://${e.config.authDomain}/${Vs}`,r={apiKey:t.apiKey,appName:e.name,v:Tt},i=qs.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Se(r).slice(1)}`}const zs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Gs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ks(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},zs),{width:r.toString(),height:i.toString(),top:s,left:o}),u=pe().toLowerCase();n&&(a=Jn(u)?"_blank":n),Qn(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=pe()){var t;return nr(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Gs(null);const h=window.open(t||"",a,l);pn(h,e,"popup-blocked");try{h.focus()}catch(e){}return new Gs(h)}const $s="__/auth/handler",Hs="emulator/auth/handler",Ws=encodeURIComponent("fac");async function Qs(e,t,n,r,i,s){pn(e.config.authDomain,e,"auth-domain-config-required"),pn(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Tt,eventId:i};if(t instanceof Or){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Lr){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${Ws}=${encodeURIComponent(c)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${$s}`;return In(e,Hs)}(e)}?${Se(a).slice(1)}${u}`}const Ys="webStorageSupport";const Js=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xi,this._completeRedirectFn=Es,this._overrideRedirectResult=vs}async _openPopup(e,t,n,r){var i;gn(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Ks(e,await Qs(e,t,n,yn(),r),Pi())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Li().location.href=e}(await Qs(e,t,n,yn(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(gn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Ms(e),n=Li().gapi;return pn(n,e,"internal-error"),t.open({where:document.body,url:js(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Bs,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=ln(e,"network-request-failed"),s=Li().setTimeout((()=>{r(i)}),Fs.get());function o(){Li().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Ss(e);return t.register("authEvent",(t=>{pn(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ys,{type:Ys},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Ys];void 0!==i&&t(!!i),un(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Ns(e);for(const e of t)try{if(Rs(e))return}catch(e){}un(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return rr()||Yn()||nr()}};class Xs{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return mn("unexpected MultiFactorSessionType")}}}class Zs extends Xs{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Zs(e)}_finalizeEnroll(e,t,n){return function(e,t){return Sn(e,"POST","/v2/accounts/mfaEnrollment:finalize",Cn(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return Sn(e,"POST","/v2/accounts/mfaSignIn:finalize",Cn(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class eo{constructor(){}static assertion(e){return Zs._fromCredential(e)}}eo.FACTOR_ID="phone";var to="@firebase/auth",no="0.23.2";class ro{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){pn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(e=>{var t;null===(t=he())||void 0===t||t[`_${e}`]})("authIdTokenMaxAge");var io;function so(){return window}io="Browser",yt(new Pe("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;pn(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:io,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ir(io)},c=new pr(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(zn);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),yt(new Pe("auth-internal",(e=>(e=>new ro(e))(mr(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),At(to,no,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(io)),At(to,no,"esm2017");async function oo(e,t,n){var r;const{BuildInfo:i}=so();gn(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(gn(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return nr()?o.ibi=i.packageName:Zn()?o.apn=i.packageName:un(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,Qs(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}function ao(e){const{cordova:t}=so();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(e=pe()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)}))}))}const co=20;class uo extends Ss{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function lo(e){const t=await po()._get(mo(e));return t&&await po()._remove(mo(e)),t}function ho(e,t){var n,r;const i=function(e){const t=go(e),n=t.link?decodeURIComponent(t.link):void 0,r=go(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return go(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=go(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?ln(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function fo(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<co;n++){const n=Math.floor(62*Math.random());e.push(t.charAt(n))}return e.join("")}function po(){return zn(Ni)}function mo(e){return $n("authEvent",e.config.apiKey,e.name)}function go(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return ke(n.join("?"))}const yo=class{constructor(){this._redirectPersistence=xi,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Es,this._overrideRedirectResult=vs}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new uo(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){un(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=so();pn("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),pn(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),pn("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),pn("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),pn("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),ms.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:fo(),postBody:null,tenantId:e.tenantId,error:ln(e,"no-auth-event")}}(e,n,r);await function(e,t){return po()._set(mo(e),t)}(e,s);const o=await oo(e,s,t);return async function(e,t,n){const{cordova:r}=so();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(ln(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Zn()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await ao(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=so(),n={};nr()?n.iosBundleId=t.packageName:Zn()?n.androidPackageName=t.packageName:un(e,"operation-not-supported-in-this-environment"),await Ns(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=so(),s=setTimeout((async()=>{await lo(e),t.onEvent(vo())}),500),o=async n=>{clearTimeout(s);const r=await lo(e);let i=null;r&&(null==n?void 0:n.url)&&(i=ho(r,n.url)),t.onEvent(i||vo())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;so().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function vo(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ln("no-auth-event")}}function wo(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function bo(e=pe()){return!("file:"!==wo()&&"ionic:"!==wo()&&"capacitor:"!==wo()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Io(e=pe()){return ve()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=pe()){return/Edge\/\d+/.test(e)}(e)}function _o(){try{const e=self.localStorage,t=Pi();if(e)return e.setItem(t,"1"),e.removeItem(t),!Io()||we()}catch(e){return To()&&we()}return!1}function To(){return void 0!==n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function Eo(){return("http:"===wo()||"https:"===wo()||ge()||bo())&&!(ye()||me())&&_o()&&!To()}function Co(){return bo()&&"undefined"!=typeof document}const So={LOCAL:"local",NONE:"none",SESSION:"session"},ko=pn,Ao="persistence";async function No(e){await e._initializationPromise;const t=Do(),n=$n(Ao,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function Do(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const xo=pn;class Ro{constructor(){this.browserResolver=zn(Js),this.cordovaResolver=zn(yo),this.underlyingResolver=null,this._redirectPersistence=xi,this._completeRedirectFn=Es,this._overrideRedirectResult=vs}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Co()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return xo(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Co()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Po(e){return e.unwrap()}function Oo(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){t.resolver=new Vo(e,function(e,t){var n;const r=Re(e),i=t;return pn(t.customData.operationType,r,"argument-error"),pn(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Ti._fromError(r,i)}(e,t))}else if(r){const e=Lo(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function Lo(e){const{_tokenResponse:t}=e instanceof be?e.customData:e;if(!t)return null;if(!(e instanceof be)&&"temporaryProof"in t&&"phoneNumber"in t)return ss.credentialFromResult(e);const n=t.providerId;if(!n||n===Qt.PASSWORD)return null;let r;switch(n){case Qt.GOOGLE:r=Vr;break;case Qt.FACEBOOK:r=Fr;break;case Qt.GITHUB:r=Ur;break;case Qt.TWITTER:r=jr;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Br._create(n,o):Nr._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new Mr(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof be?r.credentialFromError(e):r.credentialFromResult(e)}function Mo(e,t){return t.catch((t=>{throw t instanceof be&&Oo(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,Lo(r)),additionalUserInfo:Ii(e),user:Uo.getOrCreate(n)};var r}))}async function Fo(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Mo(e,n.confirm(t))}}class Vo{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Mo(Po(this.auth),this.resolver.resolveSignIn(e))}}class Uo{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=Re(e);return Ci.has(t)||Ci.set(t,Ei._fromUser(t)),Ci.get(t)}(e)}static getOrCreate(e){return Uo.USER_MAP.has(e)||Uo.USER_MAP.set(e,new Uo(e)),Uo.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Mo(this.auth,ti(this._delegate,e))}async linkWithPhoneNumber(e,t){return Fo(this.auth,async function(e,t,n){const r=Re(e);await Jr(!1,r,"phone");const i=await is(r.auth,t,Re(n));return new rs(i,(e=>ti(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return Mo(this.auth,async function(e,t,n){const r=Re(e);dn(r.auth,t,Or);const i=os(r.auth,n);return new fs(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Ro))}async linkWithRedirect(e){return await No(mr(this.auth)),Ts(this._delegate,e,Ro)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Mo(this.auth,ni(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Fo(this.auth,async function(e,t,n){const r=Re(e),i=await is(r.auth,t,Re(n));return new rs(i,(e=>ni(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Mo(this.auth,async function(e,t,n){const r=Re(e);dn(r.auth,t,Or);const i=os(r.auth,n);return new fs(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Ro))}async reauthenticateWithRedirect(e){return await No(mr(this.auth)),_s(this._delegate,e,Ro)}sendEmailVerification(e){return hi(this._delegate,e)}async unlink(e){return await Qr(this._delegate,e),this}updateEmail(e){return function(e,t){return pi(Re(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return pi(Re(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Yr(Re(e),t)}(this._delegate,e)}updateProfile(e){return fi(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return di(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Uo.USER_MAP=new WeakMap;const Bo=pn;class qo{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;Bo(n,"invalid-api-key",{appName:e.name}),Bo(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?Ro:void 0;this._delegate=t.initialize({options:{persistence:zo(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(rn),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Uo.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){yr(this._delegate,e,t)}applyActionCode(e){return ci(this._delegate,e)}checkActionCode(e){return ui(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Ir(Re(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Mo(this._delegate,async function(e,t,n){var r;const i=mr(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await dr(i,s,"signUpPassword");o=zr(i,e)}else o=zr(i,s).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await dr(i,s,"signUpPassword");return zr(i,e)}return Promise.reject(e)}));const a=await o.catch((e=>Promise.reject(e))),c=await Gr._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(c.user),c}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return li(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=Rr.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){Bo(Eo(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await mr(e)._initializationPromise,Es(e,t,!1)}(this._delegate,Ro);return e?Mo(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){mr(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=jo(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=jo(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){var r;const i=mr(e),s={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};function o(e,t){pn(t.handleCodeInApp,i,"argument-error"),t&&ai(i,e,t)}if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await dr(i,s,"getOobCode",!0);o(e,n),await Sr(i,e)}else o(s,n),await Sr(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await dr(i,s,"getOobCode",!0);o(e,n),await Sr(i,e)}}))}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){var r;const i=mr(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await dr(i,s,"getOobCode",!0);n&&ai(i,e,n),await Cr(i,e)}else n&&ai(i,s,n),await Cr(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await dr(i,s,"getOobCode",!0);n&&ai(i,e,n),await Cr(i,e)}}))}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){ko(Object.values(So).includes(t),e,"invalid-persistence-type"),ye()?ko(t!==So.SESSION,e,"unsupported-persistence-type"):me()?ko(t===So.NONE,e,"unsupported-persistence-type"):To()?ko(t===So.NONE||t===So.LOCAL&&we(),e,"unsupported-persistence-type"):ko(t===So.NONE||_o(),e,"unsupported-persistence-type")}(this._delegate,e),e){case So.SESSION:t=xi;break;case So.LOCAL:t=await zn($i)._isAvailable()?$i:Ni;break;case So.NONE:t=Kn;break;default:return un("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Mo(this._delegate,async function(e){var t;const n=mr(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Gr({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await zr(n,{returnSecureToken:!0}),i=await Gr._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Mo(this._delegate,ei(this._delegate,e))}signInWithCustomToken(e){return Mo(this._delegate,ri(this._delegate,e))}signInWithEmailAndPassword(e,t){return Mo(this._delegate,function(e,t,n){return ei(Re(e),Pr.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Mo(this._delegate,async function(e,t,n){const r=Re(e),i=Pr.credentialWithLink(t,n||yn());return pn(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),ei(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Fo(this._delegate,async function(e,t,n){const r=mr(e),i=await is(r,t,Re(n));return new rs(i,(e=>ei(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return Bo(Eo(),this._delegate,"operation-not-supported-in-this-environment"),Mo(this._delegate,async function(e,t,n){const r=mr(e);dn(e,t,Or);const i=os(r,n);return new fs(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Ro))}async signInWithRedirect(e){return Bo(Eo(),this._delegate,"operation-not-supported-in-this-environment"),await No(this._delegate),Is(this._delegate,e,Ro)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await ui(Re(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function jo(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Uo.getOrCreate(e)),error:t,complete:n}}function zo(e,t){const n=function(e,t){const n=Do();if(!n)return[];const r=$n(Ao,e,t);switch(n.getItem(r)){case So.NONE:return[Kn];case So.LOCAL:return[$i,xi];case So.SESSION:return[xi];default:return[]}}(e,t);if("undefined"==typeof self||n.includes($i)||n.push($i),"undefined"!=typeof window)for(const e of[Ni,xi])n.includes(e)||n.push(e);return n.includes(Kn)||n.push(Kn),n}qo.Persistence=So;class Go{constructor(){this.providerId="phone",this._delegate=new ss(Po(Ht.auth()))}static credential(e,t){return ss.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Go.PHONE_SIGN_IN_METHOD=ss.PHONE_SIGN_IN_METHOD,Go.PROVIDER_ID=ss.PROVIDER_ID;const Ko=pn;class $o{constructor(e,t,n=Ht.app()){var r;Ko(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new ns(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var Ho;(Ho=Ht).INTERNAL.registerComponent(new Pe("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new qo(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Yt,PASSWORD_RESET:Jt,RECOVER_EMAIL:Xt,REVERT_SECOND_FACTOR_ADDITION:Zt,VERIFY_AND_CHANGE_EMAIL:en,VERIFY_EMAIL:tn}},EmailAuthProvider:Pr,FacebookAuthProvider:Fr,GithubAuthProvider:Ur,GoogleAuthProvider:Vr,OAuthProvider:Mr,SAMLAuthProvider:qr,PhoneAuthProvider:Go,PhoneMultiFactorGenerator:eo,RecaptchaVerifier:$o,TwitterAuthProvider:jr,Auth:qo,AuthCredential:br,Error:be}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Ho.registerVersion("@firebase/auth-compat","0.4.2");var Wo,Qo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Yo={},Jo=Jo||{},Xo=Qo||self;function Zo(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function ea(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ta="closure_uid_"+(1e9*Math.random()>>>0),na=0;function ra(e,t,n){return e.call.apply(e.bind,arguments)}function ia(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function sa(e,t,n){return(sa=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ra:ia).apply(null,arguments)}function oa(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function aa(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function ca(){this.s=this.s,this.o=this.o}ca.prototype.s=!1,ca.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,ta)&&e[ta]||(e[ta]=++na))},ca.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ua=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function la(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function ha(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Zo(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function da(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}da.prototype.h=function(){this.defaultPrevented=!0};var fa=function(){if(!Xo.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Xo.addEventListener("test",(()=>{}),t),Xo.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function pa(e){return/^[\s\xa0]*$/.test(e)}function ma(){var e=Xo.navigator;return e&&(e=e.userAgent)?e:""}function ga(e){return-1!=ma().indexOf(e)}function ya(e){return ya[" "](e),e}ya[" "]=function(){};var va,wa,ba,Ia=ga("Opera"),_a=ga("Trident")||ga("MSIE"),Ta=ga("Edge"),Ea=Ta||_a,Ca=ga("Gecko")&&!(-1!=ma().toLowerCase().indexOf("webkit")&&!ga("Edge"))&&!(ga("Trident")||ga("MSIE"))&&!ga("Edge"),Sa=-1!=ma().toLowerCase().indexOf("webkit")&&!ga("Edge");function ka(){var e=Xo.document;return e?e.documentMode:void 0}e:{var Aa="",Na=(wa=ma(),Ca?/rv:([^\);]+)(\)|;)/.exec(wa):Ta?/Edge\/([\d\.]+)/.exec(wa):_a?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(wa):Sa?/WebKit\/(\S+)/.exec(wa):Ia?/(?:Version)[ \/]?(\S+)/.exec(wa):void 0);if(Na&&(Aa=Na?Na[1]:""),_a){var Da=ka();if(null!=Da&&Da>parseFloat(Aa)){va=String(Da);break e}}va=Aa}if(Xo.document&&_a){var xa=ka();ba=xa||(parseInt(va,10)||void 0)}else ba=void 0;var Ra=ba;function Pa(e,t){if(da.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ca){e:{try{ya(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Oa[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Pa.$.h.call(this)}}aa(Pa,da);var Oa={2:"touch",3:"pen",4:"mouse"};Pa.prototype.h=function(){Pa.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var La="closure_listenable_"+(1e6*Math.random()|0),Ma=0;function Fa(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Ma,this.fa=this.ia=!1}function Va(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Ua(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Ba(e){const t={};for(const n in e)t[n]=e[n];return t}const qa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ja(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<qa.length;t++)n=qa[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function za(e){this.src=e,this.g={},this.h=0}function Ga(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=ua(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Va(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ka(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}za.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Ka(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new Fa(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var $a="closure_lm_"+(1e6*Math.random()|0),Ha={};function Wa(e,t,n,r,i){if(r&&r.once)return Ya(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Wa(e,t[s],n,r,i);return null}return n=rc(n),e&&e[La]?e.O(t,n,ea(r)?!!r.capture:!!r,i):Qa(e,t,n,!1,r,i)}function Qa(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=ea(i)?!!i.capture:!!i,a=tc(e);if(a||(e[$a]=a=new za(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=ec;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)fa||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Za(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ya(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ya(e,t[s],n,r,i);return null}return n=rc(n),e&&e[La]?e.P(t,n,ea(r)?!!r.capture:!!r,i):Qa(e,t,n,!0,r,i)}function Ja(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Ja(e,t[s],n,r,i);else r=ea(r)?!!r.capture:!!r,n=rc(n),e&&e[La]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Ka(s=e.g[t],n,r,i))&&(Va(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=tc(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ka(t,n,r,i)),(n=-1<e?t[e]:null)&&Xa(n))}function Xa(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[La])Ga(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Za(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=tc(t))?(Ga(n,e),0==n.h&&(n.src=null,t[$a]=null)):Va(e)}}}function Za(e){return e in Ha?Ha[e]:Ha[e]="on"+e}function ec(e,t){if(e.fa)e=!0;else{t=new Pa(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Xa(e),e=n.call(r,t)}return e}function tc(e){return(e=e[$a])instanceof za?e:null}var nc="__closure_events_fn_"+(1e9*Math.random()>>>0);function rc(e){return"function"==typeof e?e:(e[nc]||(e[nc]=function(t){return e.handleEvent(t)}),e[nc])}function ic(){ca.call(this),this.i=new za(this),this.S=this,this.J=null}function sc(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new da(t,e);else if(t instanceof da)t.target=t.target||e;else{var i=t;ja(t=new da(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=oc(o,r,!0,t)&&i}if(i=oc(o=t.g=e,r,!0,t)&&i,i=oc(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=oc(o=t.g=n[s],r,!1,t)&&i}function oc(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Ga(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}aa(ic,ca),ic.prototype[La]=!0,ic.prototype.removeEventListener=function(e,t,n,r){Ja(this,e,t,n,r)},ic.prototype.N=function(){if(ic.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Va(n[r]);delete t.g[e],t.h--}}this.J=null},ic.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ic.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ac=Xo.JSON.stringify;function cc(){var e=mc;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var uc=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new lc),(e=>e.reset()));class lc{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function hc(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function dc(e){Xo.setTimeout((()=>{throw e}),0)}let fc,pc=!1,mc=new class{constructor(){this.h=this.g=null}add(e,t){const n=uc.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},gc=()=>{const e=Xo.Promise.resolve(void 0);fc=()=>{e.then(yc)}};var yc=()=>{for(var e;e=cc();){try{e.h.call(e.g)}catch(e){dc(e)}var t=uc;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}pc=!1};function vc(e,t){ic.call(this),this.h=e||1,this.g=t||Xo,this.j=sa(this.qb,this),this.l=Date.now()}function wc(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function bc(e,t,n){if("function"==typeof e)n&&(e=sa(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=sa(e.handleEvent,e)}return 2147483647<Number(t)?-1:Xo.setTimeout(e,t||0)}function Ic(e){e.g=bc((()=>{e.g=null,e.i&&(e.i=!1,Ic(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}aa(vc,ic),(Wo=vc.prototype).ga=!1,Wo.T=null,Wo.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),sc(this,"tick"),this.ga&&(wc(this),this.start()))}},Wo.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Wo.N=function(){vc.$.N.call(this),wc(this),delete this.g};class _c extends ca{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ic(this)}N(){super.N(),this.g&&(Xo.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Tc(e){ca.call(this),this.h=e,this.g={}}aa(Tc,ca);var Ec=[];function Cc(e,t,n,r){Array.isArray(n)||(n&&(Ec[0]=n.toString()),n=Ec);for(var i=0;i<n.length;i++){var s=Wa(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Sc(e){Ua(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Xa(e)}),e),e.g={}}function kc(){this.g=!0}function Ac(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ac(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Tc.prototype.N=function(){Tc.$.N.call(this),Sc(this)},Tc.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},kc.prototype.Ea=function(){this.g=!1},kc.prototype.info=function(){};var Nc={},Dc=null;function xc(){return Dc=Dc||new ic}function Rc(e){da.call(this,Nc.Ta,e)}function Pc(e){const t=xc();sc(t,new Rc(t))}function Oc(e,t){da.call(this,Nc.STAT_EVENT,e),this.stat=t}function Lc(e){const t=xc();sc(t,new Oc(t,e))}function Mc(e,t){da.call(this,Nc.Ua,e),this.size=t}function Fc(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Xo.setTimeout((function(){e()}),t)}Nc.Ta="serverreachability",aa(Rc,da),Nc.STAT_EVENT="statevent",aa(Oc,da),Nc.Ua="timingevent",aa(Mc,da);var Vc={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Uc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Bc(){}function qc(e){return e.h||(e.h=e.i())}function jc(){}Bc.prototype.h=null;var zc,Gc={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Kc(){da.call(this,"d")}function $c(){da.call(this,"c")}function Hc(){}function Wc(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Tc(this),this.P=Yc,e=Ea?125:void 0,this.V=new vc(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Qc}function Qc(){this.i=null,this.g="",this.h=!1}aa(Kc,da),aa($c,da),aa(Hc,Bc),Hc.prototype.g=function(){return new XMLHttpRequest},Hc.prototype.i=function(){return{}},zc=new Hc;var Yc=45e3,Jc={},Xc={};function Zc(e,t,n){e.L=1,e.v=vu(fu(t)),e.s=n,e.S=!0,eu(e,null)}function eu(e,t){e.G=Date.now(),iu(e),e.A=fu(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),xu(n.i,"t",r),e.C=0,n=e.l.J,e.h=new Qc,e.g=Dl(e.l,n?t:null,!e.s),0<e.O&&(e.M=new _c(sa(e.Pa,e,e.g),e.O)),Cc(e.U,e.g,"readystatechange",e.nb),t=e.I?Ba(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),Pc(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function tu(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function nu(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=ru(e,n),r==Xc){4==t&&(e.o=4,Lc(14),i=!1),Ac(e.j,e.m,null,"[Incomplete Response]");break}if(r==Jc){e.o=4,Lc(15),Ac(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ac(e.j,e.m,r,null),uu(e,r)}tu(e)&&r!=Xc&&r!=Jc&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Lc(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),_l(t),t.M=!0,Lc(11))):(Ac(e.j,e.m,n,"[Invalid Chunked Response]"),cu(e),au(e))}function ru(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Xc:(n=Number(t.substring(n,r)),isNaN(n)?Jc:(r+=1)+n>t.length?Xc:(t=t.slice(r,r+n),e.C=r+n,t))}function iu(e){e.Y=Date.now()+e.P,su(e,e.P)}function su(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Fc(sa(e.lb,e),t)}function ou(e){e.B&&(Xo.clearTimeout(e.B),e.B=null)}function au(e){0==e.l.H||e.J||Cl(e.l,e)}function cu(e){ou(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,wc(e.V),Sc(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function uu(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Fu(n.i,e)))if(!e.K&&Fu(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;El(n),pl(n)}Il(n),Lc(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Fc(sa(n.ib,n),6e3));if(1>=Mu(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else kl(n,11)}else if((e.K||n.g==e)&&El(n),!pa(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Vu(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,yu(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Nl(r,r.J?r.pa:null,r.Y),o.K){Uu(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(ou(a),iu(a)),r.g=o}else bl(r);0<n.j.length&&gl(n)}else"stop"!=u[0]&&"close"!=u[0]||kl(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?kl(n,7):fl(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Pc()}catch(e){}}function lu(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Zo(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Zo(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Zo(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(Wo=Wc.prototype).setTimeout=function(e){this.P=e},Wo.nb=function(e){e=e.target;const t=this.M;t&&3==al(e)?t.l():this.Pa(e)},Wo.Pa=function(e){try{if(e==this.g)e:{const l=al(this.g);var t=this.g.Ia();this.g.da();if(!(3>l)&&(3!=l||Ea||this.g&&(this.h.h||this.g.ja()||cl(this.g)))){this.J||4!=l||7==t||Pc(),ou(this);var n=this.g.da();this.ca=n;t:if(tu(this)){var r=cl(this.g);e="";var i=r.length,s=4==al(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){cu(this),au(this);var o="";break t}this.h.i=new Xo.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!pa(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,Lc(12),cu(this),au(this);break e}Ac(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,uu(this,n)}this.S?(nu(this,l,o),Ea&&this.i&&3==l&&(Cc(this.U,this.V,"tick",this.mb),this.V.start())):(Ac(this.j,this.m,o,null),uu(this,o)),4==l&&cu(this),this.i&&!this.J&&(4==l?Cl(this.l,this):(this.i=!1,iu(this)))}else(function(e){const t={};e=(e.g&&2<=al(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(pa(e[r]))continue;var n=hc(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Lc(12)):(this.o=0,Lc(13)),cu(this),au(this)}}}catch(e){}},Wo.mb=function(){if(this.g){var e=al(this.g),t=this.g.ja();this.C<t.length&&(ou(this),nu(this,e,t),this.i&&4!=e&&iu(this))}},Wo.cancel=function(){this.J=!0,cu(this)},Wo.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(Pc(),Lc(17)),cu(this),this.o=2,au(this)):su(this,this.Y-e)};var hu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function du(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof du){this.h=e.h,pu(this,e.j),this.s=e.s,this.g=e.g,mu(this,e.m),this.l=e.l;var t=e.i,n=new ku;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),gu(this,n),this.o=e.o}else e&&(t=String(e).match(hu))?(this.h=!1,pu(this,t[1]||"",!0),this.s=wu(t[2]||""),this.g=wu(t[3]||"",!0),mu(this,t[4]),this.l=wu(t[5]||"",!0),gu(this,t[6]||"",!0),this.o=wu(t[7]||"")):(this.h=!1,this.i=new ku(null,this.h))}function fu(e){return new du(e)}function pu(e,t,n){e.j=n?wu(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function mu(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function gu(e,t,n){t instanceof ku?(e.i=t,function(e,t){t&&!e.j&&(Au(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Nu(this,t),xu(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=bu(t,Cu)),e.i=new ku(t,e.h))}function yu(e,t,n){e.i.set(t,n)}function vu(e){return yu(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function wu(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function bu(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Iu),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Iu(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}du.prototype.toString=function(){var e=[],t=this.j;t&&e.push(bu(t,_u,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(bu(t,_u,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(bu(n,"/"==n.charAt(0)?Eu:Tu,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",bu(n,Su)),e.join("")};var _u=/[#\/\?@]/g,Tu=/[#\?:]/g,Eu=/[#\?]/g,Cu=/[#\?@]/g,Su=/#/g;function ku(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Au(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Nu(e,t){Au(e),t=Ru(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Du(e,t){return Au(e),t=Ru(e,t),e.g.has(t)}function xu(e,t,n){Nu(e,t),0<n.length&&(e.i=null,e.g.set(Ru(e,t),la(n)),e.h+=n.length)}function Ru(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Wo=ku.prototype).add=function(e,t){Au(this),this.i=null,e=Ru(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Wo.forEach=function(e,t){Au(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Wo.ta=function(){Au(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},Wo.Z=function(e){Au(this);let t=[];if("string"==typeof e)Du(this,e)&&(t=t.concat(this.g.get(Ru(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Wo.set=function(e,t){return Au(this),this.i=null,Du(this,e=Ru(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Wo.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Wo.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};function Pu(e){this.l=e||Ou,Xo.PerformanceNavigationTiming?e=0<(e=Xo.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(Xo.g&&Xo.g.Ka&&Xo.g.Ka()&&Xo.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ou=10;function Lu(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Mu(e){return e.h?1:e.g?e.g.size:0}function Fu(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Vu(e,t){e.g?e.g.add(t):e.h=t}function Uu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Bu(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return la(e.i)}Pu.prototype.cancel=function(){if(this.i=Bu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var qu=class{stringify(e){return Xo.JSON.stringify(e,void 0)}parse(e){return Xo.JSON.parse(e,void 0)}};function ju(){this.g=new qu}function zu(e,t,n){const r=n||"";try{lu(e,(function(e,n){let i=e;ea(e)&&(i=ac(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Gu(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Ku(e){this.l=e.fc||null,this.j=e.ob||!1}function $u(e,t){ic.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Hu,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}aa(Ku,Bc),Ku.prototype.g=function(){return new $u(this.l,this.j)},Ku.prototype.i=function(e){return function(){return e}}({}),aa($u,ic);var Hu=0;function Wu(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Qu(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Yu(e)}function Yu(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Wo=$u.prototype).open=function(e,t){if(this.readyState!=Hu)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Yu(this)},Wo.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Xo).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Wo.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Qu(this)),this.readyState=Hu},Wo.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Yu(this)),this.g&&(this.readyState=3,Yu(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Xo.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Wu(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Wo.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Qu(this):Yu(this),3==this.readyState&&Wu(this)}},Wo.Za=function(e){this.g&&(this.response=this.responseText=e,Qu(this))},Wo.Ya=function(e){this.g&&(this.response=e,Qu(this))},Wo.ka=function(){this.g&&Qu(this)},Wo.setRequestHeader=function(e,t){this.v.append(e,t)},Wo.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Wo.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty($u.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Ju=Xo.JSON.parse;function Xu(e){ic.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Zu,this.L=this.M=!1}aa(Xu,ic);var Zu="",el=/^https?$/i,tl=["POST","PUT"];function nl(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,rl(e),sl(e)}function rl(e){e.F||(e.F=!0,sc(e,"complete"),sc(e,"error"))}function il(e){if(e.h&&void 0!==Jo&&(!e.C[1]||4!=al(e)||2!=e.da()))if(e.v&&4==al(e))bc(e.La,0,e);else if(sc(e,"readystatechange"),4==al(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(hu)[1]||null;!i&&Xo.self&&Xo.self.location&&(i=Xo.self.location.protocol.slice(0,-1)),r=!el.test(i?i.toLowerCase():"")}n=r}if(n)sc(e,"complete"),sc(e,"success");else{e.m=6;try{var s=2<al(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",rl(e)}}finally{sl(e)}}}function sl(e,t){if(e.g){ol(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||sc(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function ol(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Xo.clearTimeout(e.A),e.A=null)}function al(e){return e.g?e.g.readyState:0}function cl(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Zu:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ul(e){let t="";return Ua(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function ll(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=ul(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):yu(e,t,n))}function hl(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function dl(e){this.Ga=0,this.j=[],this.l=new kc,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=hl("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=hl("baseRetryDelayMs",5e3,e),this.hb=hl("retryDelaySeedMs",1e4,e),this.eb=hl("forwardChannelMaxRetries",2,e),this.xa=hl("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Pu(e&&e.concurrentRequestLimit),this.Ja=new ju,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function fl(e){if(ml(e),3==e.H){var t=e.W++,n=fu(e.I);if(yu(n,"SID",e.K),yu(n,"RID",t),yu(n,"TYPE","terminate"),vl(e,n),(t=new Wc(e,e.l,t)).L=2,t.v=vu(fu(n)),n=!1,Xo.navigator&&Xo.navigator.sendBeacon)try{n=Xo.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&Xo.Image&&((new Image).src=t.v,n=!0),n||(t.g=Dl(t.l,null),t.g.ha(t.v)),t.G=Date.now(),iu(t)}Al(e)}function pl(e){e.g&&(_l(e),e.g.cancel(),e.g=null)}function ml(e){pl(e),e.u&&(Xo.clearTimeout(e.u),e.u=null),El(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Xo.clearTimeout(e.m),e.m=null)}function gl(e){if(!Lu(e.i)&&!e.m){e.m=!0;var t=e.Na;fc||gc(),pc||(fc(),pc=!0),mc.add(t,e),e.C=0}}function yl(e,t){var n;n=t?t.m:e.W++;const r=fu(e.I);yu(r,"SID",e.K),yu(r,"RID",n),yu(r,"AID",e.V),vl(e,r),e.o&&e.s&&ll(r,e.o,e.s),n=new Wc(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=wl(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Vu(e.i,n),Zc(n,r,t)}function vl(e,t){e.na&&Ua(e.na,(function(e,n){yu(t,n,e)})),e.h&&lu({},(function(e,n){yu(t,n,e)}))}function wl(e,t,n){n=Math.min(e.j.length,n);var r=e.h?sa(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{zu(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function bl(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;fc||gc(),pc||(fc(),pc=!0),mc.add(t,e),e.A=0}}function Il(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=Fc(sa(e.Ma,e),Sl(e,e.A)),e.A++,!0)}function _l(e){null!=e.B&&(Xo.clearTimeout(e.B),e.B=null)}function Tl(e){e.g=new Wc(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=fu(e.wa);yu(t,"RID","rpc"),yu(t,"SID",e.K),yu(t,"AID",e.V),yu(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&yu(t,"TO",e.qa),yu(t,"TYPE","xmlhttp"),vl(e,t),e.o&&e.s&&ll(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=vu(fu(t)),n.s=null,n.S=!0,eu(n,e)}function El(e){null!=e.v&&(Xo.clearTimeout(e.v),e.v=null)}function Cl(e,t){var n=null;if(e.g==t){El(e),_l(e),e.g=null;var r=2}else{if(!Fu(e.i,t))return;n=t.F,Uu(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;sc(r=xc(),new Mc(r,n)),gl(e)}else bl(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(Mu(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Fc(sa(e.Na,e,t),Sl(e,e.C)),e.C++,0)))}(e,t)||2==r&&Il(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:kl(e,5);break;case 4:kl(e,10);break;case 3:kl(e,6);break;default:kl(e,2)}}function Sl(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function kl(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=sa(e.pb,e);n||(n=new du("//www.google.com/images/cleardot.gif"),Xo.location&&"http"==Xo.location.protocol||pu(n,"https"),vu(n)),function(e,t){const n=new kc;if(Xo.Image){const r=new Image;r.onload=oa(Gu,n,r,"TestLoadImage: loaded",!0,t),r.onerror=oa(Gu,n,r,"TestLoadImage: error",!1,t),r.onabort=oa(Gu,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=oa(Gu,n,r,"TestLoadImage: timeout",!1,t),Xo.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Lc(2);e.H=0,e.h&&e.h.za(t),Al(e),ml(e)}function Al(e){if(e.H=0,e.ma=[],e.h){const t=Bu(e.i);0==t.length&&0==e.j.length||(ha(e.ma,t),ha(e.ma,e.j),e.i.i.length=0,la(e.j),e.j.length=0),e.h.ya()}}function Nl(e,t,n){var r=n instanceof du?fu(n):new du(n);if(""!=r.g)t&&(r.g=t+"."+r.g),mu(r,r.m);else{var i=Xo.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new du(null);r&&pu(s,r),t&&(s.g=t),i&&mu(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&yu(r,n,t),yu(r,"VER",e.ra),vl(e,r),r}function Dl(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new Xu(new Ku({ob:!0})):new Xu(e.va)).Oa(e.J),t}function xl(){}function Rl(){if(_a&&!(10<=Number(Ra)))throw Error("Environmental error: no available transport.")}function Pl(e,t){ic.call(this),this.g=new dl(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!pa(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!pa(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Ml(this)}function Ol(e){Kc.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Ll(){$c.call(this),this.status=1}function Ml(e){this.g=e}function Fl(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Vl(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function Ul(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(Wo=Xu.prototype).Oa=function(e){this.M=e},Wo.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():zc.g(),this.C=this.u?qc(this.u):qc(zc),this.g.onreadystatechange=sa(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void nl(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Xo.FormData&&e instanceof Xo.FormData,!(0<=ua(tl,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ol(this),0<this.B&&((this.L=function(e){return _a&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=sa(this.ua,this)):this.A=bc(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){nl(this,e)}},Wo.ua=function(){void 0!==Jo&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,sc(this,"timeout"),this.abort(8))},Wo.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,sc(this,"complete"),sc(this,"abort"),sl(this))},Wo.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),sl(this,!0)),Xu.$.N.call(this)},Wo.La=function(){this.s||(this.G||this.v||this.l?il(this):this.kb())},Wo.kb=function(){il(this)},Wo.isActive=function(){return!!this.g},Wo.da=function(){try{return 2<al(this)?this.g.status:-1}catch(e){return-1}},Wo.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Wo.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Ju(t)}},Wo.Ia=function(){return this.m},Wo.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Wo=dl.prototype).ra=8,Wo.H=1,Wo.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new Wc(this,this.l,e);let s=this.s;if(this.U&&(s?(s=Ba(s),ja(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=wl(this,i,t),yu(n=fu(this.I),"RID",e),yu(n,"CVER",22),this.F&&yu(n,"X-HTTP-Session-Id",this.F),vl(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(ul(s)))+"&"+t:this.o&&ll(n,this.o,s)),Vu(this.i,i),this.bb&&yu(n,"TYPE","init"),this.P?(yu(n,"$req",t),yu(n,"SID","null"),i.aa=!0,Zc(i,n,null)):Zc(i,n,t),this.H=2}}else 3==this.H&&(e?yl(this,e):0==this.j.length||Lu(this.i)||yl(this))},Wo.Ma=function(){if(this.u=null,Tl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Fc(sa(this.jb,this),e)}},Wo.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Lc(10),pl(this),Tl(this))},Wo.ib=function(){null!=this.v&&(this.v=null,pl(this),Il(this),Lc(19))},Wo.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Lc(2)):(this.l.info("Failed to ping google.com"),Lc(1))},Wo.isActive=function(){return!!this.h&&this.h.isActive(this)},(Wo=xl.prototype).Ba=function(){},Wo.Aa=function(){},Wo.za=function(){},Wo.ya=function(){},Wo.isActive=function(){return!0},Wo.Va=function(){},Rl.prototype.g=function(e,t){return new Pl(e,t)},aa(Pl,ic),Pl.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Lc(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Nl(e,null,e.Y),gl(e)},Pl.prototype.close=function(){fl(this.g)},Pl.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ac(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&gl(t)},Pl.prototype.N=function(){this.g.h=null,delete this.j,fl(this.g),delete this.g,Pl.$.N.call(this)},aa(Ol,Kc),aa(Ll,$c),aa(Ml,xl),Ml.prototype.Ba=function(){sc(this.g,"a")},Ml.prototype.Aa=function(e){sc(this.g,new Ol(e))},Ml.prototype.za=function(e){sc(this.g,new Ll)},Ml.prototype.ya=function(){sc(this.g,"b")},aa(Fl,(function(){this.blockSize=-1})),Fl.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Fl.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Vl(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Vl(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Vl(this,r),i=0;break}}this.h=i,this.i+=t},Fl.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var Bl={};function ql(e){return-128<=e&&128>e?function(e,t){var n=Bl;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new Ul([0|e],0>e?-1:0)})):new Ul([0|e],0>e?-1:0)}function jl(e){if(isNaN(e)||!isFinite(e))return Gl;if(0>e)return Ql(jl(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=zl;return new Ul(t,0)}var zl=4294967296,Gl=ql(0),Kl=ql(1),$l=ql(16777216);function Hl(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Wl(e){return-1==e.h}function Ql(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Ul(n,~e.h).add(Kl)}function Yl(e,t){return e.add(Ql(t))}function Jl(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Xl(e,t){this.g=e,this.h=t}function Zl(e,t){if(Hl(t))throw Error("division by zero");if(Hl(e))return new Xl(Gl,Gl);if(Wl(e))return t=Zl(Ql(e),t),new Xl(Ql(t.g),Ql(t.h));if(Wl(t))return t=Zl(e,Ql(t)),new Xl(Ql(t.g),t.h);if(30<e.g.length){if(Wl(e)||Wl(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Kl,r=t;0>=r.X(e);)n=eh(n),r=eh(r);var i=th(n,1),s=th(r,1);for(r=th(r,2),n=th(n,2);!Hl(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=th(r,1),n=th(n,1)}return t=Yl(e,i.R(t)),new Xl(i,t)}for(i=Gl;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=jl(n)).R(t);Wl(o)||0<o.X(e);)o=(s=jl(n-=r)).R(t);Hl(s)&&(s=Kl),i=i.add(s),e=Yl(e,o)}return new Xl(i,e)}function eh(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Ul(n,e.h)}function th(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Ul(i,e.h)}(Wo=Ul.prototype).ea=function(){if(Wl(this))return-Ql(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:zl+r)*t,t*=zl}return e},Wo.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Hl(this))return"0";if(Wl(this))return"-"+Ql(this).toString(e);for(var t=jl(Math.pow(e,6)),n=this,r="";;){var i=Zl(n,t).g,s=((0<(n=Yl(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Hl(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},Wo.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Wo.X=function(e){return Wl(e=Yl(this,e))?-1:Hl(e)?0:1},Wo.abs=function(){return Wl(this)?Ql(this):this},Wo.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Ul(n,-2147483648&n[n.length-1]?-1:0)},Wo.R=function(e){if(Hl(this)||Hl(e))return Gl;if(Wl(this))return Wl(e)?Ql(this).R(Ql(e)):Ql(Ql(this).R(e));if(Wl(e))return Ql(this.R(Ql(e)));if(0>this.X($l)&&0>e.X($l))return jl(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,Jl(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Jl(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Jl(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Jl(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Ul(n,0)},Wo.gb=function(e){return Zl(this,e).h},Wo.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Ul(n,this.h&e.h)},Wo.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Ul(n,this.h|e.h)},Wo.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Ul(n,this.h^e.h)},Rl.prototype.createWebChannel=Rl.prototype.g,Pl.prototype.send=Pl.prototype.u,Pl.prototype.open=Pl.prototype.m,Pl.prototype.close=Pl.prototype.close,Vc.NO_ERROR=0,Vc.TIMEOUT=8,Vc.HTTP_ERROR=6,Uc.COMPLETE="complete",jc.EventType=Gc,Gc.OPEN="a",Gc.CLOSE="b",Gc.ERROR="c",Gc.MESSAGE="d",ic.prototype.listen=ic.prototype.O,Xu.prototype.listenOnce=Xu.prototype.P,Xu.prototype.getLastError=Xu.prototype.Sa,Xu.prototype.getLastErrorCode=Xu.prototype.Ia,Xu.prototype.getStatus=Xu.prototype.da,Xu.prototype.getResponseJson=Xu.prototype.Wa,Xu.prototype.getResponseText=Xu.prototype.ja,Xu.prototype.send=Xu.prototype.ha,Xu.prototype.setWithCredentials=Xu.prototype.Oa,Fl.prototype.digest=Fl.prototype.l,Fl.prototype.reset=Fl.prototype.reset,Fl.prototype.update=Fl.prototype.j,Ul.prototype.add=Ul.prototype.add,Ul.prototype.multiply=Ul.prototype.R,Ul.prototype.modulo=Ul.prototype.gb,Ul.prototype.compare=Ul.prototype.X,Ul.prototype.toNumber=Ul.prototype.ea,Ul.prototype.toString=Ul.prototype.toString,Ul.prototype.getBits=Ul.prototype.D,Ul.fromNumber=jl,Ul.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Ql(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=jl(Math.pow(n,8)),i=Gl,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=jl(Math.pow(n,o)),i=i.R(o).add(jl(a))):i=(i=i.R(r)).add(jl(a))}return i};var nh=Yo.createWebChannelTransport=function(){return new Rl},rh=Yo.getStatEventTarget=function(){return xc()},ih=Yo.ErrorCode=Vc,sh=Yo.EventType=Uc,oh=Yo.Event=Nc,ah=Yo.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ch=Yo.FetchXmlHttpFactory=Ku,uh=Yo.WebChannel=jc,lh=Yo.XhrIo=Xu,hh=Yo.Md5=Fl,dh=Yo.Integer=Ul,fh=n(4155);const ph="@firebase/firestore";class mh{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}mh.UNAUTHENTICATED=new mh(null),mh.GOOGLE_CREDENTIALS=new mh("google-credentials-uid"),mh.FIRST_PARTY=new mh("first-party-uid"),mh.MOCK_USER=new mh("mock-user");let gh="9.22.2";const yh=new ze("@firebase/firestore");function vh(){return yh.logLevel}function wh(e,...t){if(yh.logLevel<=Ve.DEBUG){const n=t.map(_h);yh.debug(`Firestore (${gh}): ${e}`,...n)}}function bh(e,...t){if(yh.logLevel<=Ve.ERROR){const n=t.map(_h);yh.error(`Firestore (${gh}): ${e}`,...n)}}function Ih(e,...t){if(yh.logLevel<=Ve.WARN){const n=t.map(_h);yh.warn(`Firestore (${gh}): ${e}`,...n)}}function _h(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Th(e="Unexpected state"){const t=`FIRESTORE (${gh}) INTERNAL ASSERTION FAILED: `+e;throw bh(t),new Error(t)}function Eh(e,t){e||Th()}function Ch(e,t){return e}const Sh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class kh extends be{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ah{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Nh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Dh{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(mh.UNAUTHENTICATED)))}shutdown(){}}class xh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Rh{constructor(e){this.t=e,this.currentUser=mh.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ah;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ah,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{wh("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(wh("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ah)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(wh("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Eh("string"==typeof t.accessToken),new Nh(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Eh(null===e||"string"==typeof e),new mh(e)}}class Ph{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=mh.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Oh{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Ph(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(mh.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Lh{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Mh{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&wh("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,wh("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{wh("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?r(e):wh("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Eh("string"==typeof e.token),this.T=e.token,new Lh(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Fh(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Vh{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Fh(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function Uh(e,t){return e<t?-1:e>t?1:0}function Bh(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function qh(e){return e+"\0"}class jh{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new kh(Sh.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new kh(Sh.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new kh(Sh.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new kh(Sh.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return jh.fromMillis(Date.now())}static fromDate(e){return jh.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new jh(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Uh(this.nanoseconds,e.nanoseconds):Uh(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class zh{constructor(e){this.timestamp=e}static fromTimestamp(e){return new zh(e)}static min(){return new zh(new jh(0,0))}static max(){return new zh(new jh(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Gh{constructor(e,t,n){void 0===t?t=0:t>e.length&&Th(),void 0===n?n=e.length-t:n>e.length-t&&Th(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Gh.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Gh?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Kh extends Gh{construct(e,t,n){return new Kh(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new kh(Sh.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Kh(t)}static emptyPath(){return new Kh([])}}const $h=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Hh extends Gh{construct(e,t,n){return new Hh(e,t,n)}static isValidIdentifier(e){return $h.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Hh.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Hh(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new kh(Sh.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new kh(Sh.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new kh(Sh.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new kh(Sh.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Hh(t)}static emptyPath(){return new Hh([])}}class Wh{constructor(e){this.path=e}static fromPath(e){return new Wh(Kh.fromString(e))}static fromName(e){return new Wh(Kh.fromString(e).popFirst(5))}static empty(){return new Wh(Kh.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Kh.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Kh.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Wh(new Kh(e.slice()))}}class Qh{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Yh(e){return e.fields.find((e=>2===e.kind))}function Jh(e){return e.fields.filter((e=>2!==e.kind))}Qh.UNKNOWN_ID=-1;class Xh{constructor(e,t){this.fieldPath=e,this.kind=t}}class Zh{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Zh(0,nd.min())}}function ed(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=zh.fromTimestamp(1e9===r?new jh(n+1,0):new jh(n,r));return new nd(i,Wh.empty(),t)}function td(e){return new nd(e.readTime,e.key,-1)}class nd{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new nd(zh.min(),Wh.empty(),-1)}static max(){return new nd(zh.max(),Wh.empty(),-1)}}function rd(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Wh.comparator(e.documentKey,t.documentKey),0!==n?n:Uh(e.largestBatchId,t.largestBatchId))}const id="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sd{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function od(e){if(e.code!==Sh.FAILED_PRECONDITION||e.message!==id)throw e;wh("LocalStore","Unexpectedly lost primary lease")}class ad{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Th(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ad(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ad?t:ad.resolve(t)}catch(e){return ad.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ad.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ad.reject(t)}static resolve(e){return new ad(((t,n)=>{t(e)}))}static reject(e){return new ad(((t,n)=>{n(e)}))}static waitFor(e){return new ad(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=ad.resolve(!1);for(const n of e)t=t.next((e=>e?ad.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new ad(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new ad(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class cd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new Ah,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new hd(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=gd(t.target.error);this.v.reject(new hd(e,n))}}static open(e,t,n,r){try{return new cd(t,e.transaction(r,n))}catch(e){throw new hd(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(wh("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new fd(t)}}class ud{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===ud.S(pe())&&bh("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return wh("SimpleDb","Removing database:",e),pd(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!we())return!1;if(ud.C())return!0;const e=pe(),t=ud.S(e),n=0<t&&t<10,r=ud.N(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return void 0!==fh&&"YES"===(null===(e=fh.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(wh("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new hd(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new kh(Sh.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new kh(Sh.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new hd(e,r))},r.onupgradeneeded=e=>{wh("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next((()=>{wh("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=cd.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),ad.reject(e)))).toPromise();return s.catch((()=>{})),await t.R,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(wh("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ld{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return pd(this.L.delete())}}class hd extends kh{constructor(e,t){super(Sh.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function dd(e){return"IndexedDbTransactionError"===e.name}class fd{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(wh("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(wh("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),pd(n)}add(e){return wh("SimpleDb","ADD",this.store.name,e,e),pd(this.store.add(e))}get(e){return pd(this.store.get(e)).next((t=>(void 0===t&&(t=null),wh("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return wh("SimpleDb","DELETE",this.store.name,e),pd(this.store.delete(e))}count(){return wh("SimpleDb","COUNT",this.store.name),pd(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new ad(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new ad(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){wh("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Z(e){const t=this.cursor({});return new ad(((n,r)=>{t.onerror=e=>{const t=gd(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new ad(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new ld(i),o=t(i.primaryKey,i.value,s);if(o instanceof ad){const e=o.catch((e=>(s.done(),ad.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>ad.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function pd(e){return new ad(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=gd(e.target.error);n(t)}}))}let md=!1;function gd(e){const t=ud.S(pe());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new kh("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return md||(md=!0,setTimeout((()=>{throw e}),0)),e}}return e}class yd{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){wh("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{wh("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){dd(e)?wh("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await od(e)}await this.et(6e4)}))}}class vd{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let r=t,i=!0;return ad.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return wh("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(r,n))).next((n=>(wh("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=td(t);rd(r,n)>0&&(n=r)})),new nd(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class wd{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function bd(e){return null==e}function Id(e){return 0===e&&1/e==-1/0}function _d(e){return"number"==typeof e&&Number.isInteger(e)&&!Id(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Td(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Cd(t)),t=Ed(e.get(n),t);return Cd(t)}function Ed(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Cd(e){return e+""}function Sd(e){const t=e.length;if(Eh(t>=2),2===t)return Eh(""===e.charAt(0)&&""===e.charAt(1)),Kh.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Th(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Th()}s=t+2}return new Kh(r)}wd.ct=-1;const kd=["userId","batchId"];function Ad(e,t){return[e,Td(t)]}function Nd(e,t,n){return[e,Td(t),n]}const Dd={},xd=["prefixPath","collectionGroup","readTime","documentId"],Rd=["prefixPath","collectionGroup","documentId"],Pd=["collectionGroup","readTime","prefixPath","documentId"],Od=["canonicalId","targetId"],Ld=["targetId","path"],Md=["path","targetId"],Fd=["collectionId","parent"],Vd=["indexId","uid"],Ud=["uid","sequenceNumber"],Bd=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],qd=["indexId","uid","orderedDocumentKey"],jd=["userId","collectionPath","documentId"],zd=["userId","collectionPath","largestBatchId"],Gd=["userId","collectionGroup","largestBatchId"],Kd=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$d=[...Kd,"documentOverlays"],Hd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Wd=Hd,Qd=[...Wd,"indexConfiguration","indexState","indexEntries"];class Yd extends sd{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function Jd(e,t){const n=Ch(e);return ud.M(n.ht,t)}function Xd(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Zd(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ef(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tf{constructor(e,t){this.comparator=e,this.root=t||rf.EMPTY}insert(e,t){return new tf(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rf.BLACK,null,null))}remove(e){return new tf(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rf.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nf(this.root,e,this.comparator,!1)}getReverseIterator(){return new nf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nf(this.root,e,this.comparator,!0)}}class nf{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rf{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:rf.RED,this.left=null!=r?r:rf.EMPTY,this.right=null!=i?i:rf.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new rf(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return rf.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return rf.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,rf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,rf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Th();if(this.right.isRed())throw Th();const e=this.left.check();if(e!==this.right.check())throw Th();return e+(this.isRed()?0:1)}}rf.EMPTY=null,rf.RED=!0,rf.BLACK=!1,rf.EMPTY=new class{constructor(){this.size=0}get key(){throw Th()}get value(){throw Th()}get color(){throw Th()}get left(){throw Th()}get right(){throw Th()}copy(e,t,n,r,i){return this}insert(e,t,n){return new rf(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sf{constructor(e){this.comparator=e,this.data=new tf(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new of(this.data.getIterator())}getIteratorFrom(e){return new of(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof sf))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new sf(this.comparator);return t.data=e,t}}class of{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function af(e){return e.hasNext()?e.getNext():void 0}class cf{constructor(e){this.fields=e,e.sort(Hh.comparator)}static empty(){return new cf([])}unionWith(e){let t=new sf(Hh.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new cf(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Bh(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class uf extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class lf{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new uf("Invalid base64 string: "+e):e}}(e);return new lf(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new lf(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Uh(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}lf.EMPTY_BYTE_STRING=new lf("");const hf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function df(e){if(Eh(!!e),"string"==typeof e){let t=0;const n=hf.exec(e);if(Eh(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ff(e.seconds),nanos:ff(e.nanos)}}function ff(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function pf(e){return"string"==typeof e?lf.fromBase64String(e):lf.fromUint8Array(e)}function mf(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function gf(e){const t=e.mapValue.fields.__previous_value__;return mf(t)?gf(t):t}function yf(e){const t=df(e.mapValue.fields.__local_write_time__.timestampValue);return new jh(t.seconds,t.nanos)}class vf{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class wf{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new wf("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof wf&&e.projectId===this.projectId&&e.database===this.database}}const bf={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},If={nullValue:"NULL_VALUE"};function _f(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?mf(e)?4:Mf(e)?9007199254740991:10:Th()}function Tf(e,t){if(e===t)return!0;const n=_f(e);if(n!==_f(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return yf(e).isEqual(yf(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=df(e.timestampValue),r=df(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return pf(e.bytesValue).isEqual(pf(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ff(e.geoPointValue.latitude)===ff(t.geoPointValue.latitude)&&ff(e.geoPointValue.longitude)===ff(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ff(e.integerValue)===ff(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ff(e.doubleValue),r=ff(t.doubleValue);return n===r?Id(n)===Id(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Bh(e.arrayValue.values||[],t.arrayValue.values||[],Tf);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Xd(n)!==Xd(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Tf(n[e],r[e])))return!1;return!0}(e,t);default:return Th()}}function Ef(e,t){return void 0!==(e.values||[]).find((e=>Tf(e,t)))}function Cf(e,t){if(e===t)return 0;const n=_f(e),r=_f(t);if(n!==r)return Uh(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Uh(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ff(e.integerValue||e.doubleValue),r=ff(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Sf(e.timestampValue,t.timestampValue);case 4:return Sf(yf(e),yf(t));case 5:return Uh(e.stringValue,t.stringValue);case 6:return function(e,t){const n=pf(e),r=pf(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Uh(n[e],r[e]);if(0!==t)return t}return Uh(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Uh(ff(e.latitude),ff(t.latitude));return 0!==n?n:Uh(ff(e.longitude),ff(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Cf(n[e],r[e]);if(t)return t}return Uh(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===bf.mapValue&&t===bf.mapValue)return 0;if(e===bf.mapValue)return 1;if(t===bf.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Uh(r[e],s[e]);if(0!==t)return t;const o=Cf(n[r[e]],i[s[e]]);if(0!==o)return o}return Uh(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Th()}}function Sf(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Uh(e,t);const n=df(e),r=df(t),i=Uh(n.seconds,r.seconds);return 0!==i?i:Uh(n.nanos,r.nanos)}function kf(e){return Af(e)}function Af(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=df(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?pf(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Wh.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Af(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Af(e.fields[i])}`;return n+"}"}(e.mapValue):Th();var t,n}function Nf(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Df(e){return!!e&&"integerValue"in e}function xf(e){return!!e&&"arrayValue"in e}function Rf(e){return!!e&&"nullValue"in e}function Pf(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Of(e){return!!e&&"mapValue"in e}function Lf(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Zd(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Lf(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Lf(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Mf(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ff(e){return"nullValue"in e?If:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Nf(wf.empty(),Wh.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Th()}function Vf(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Nf(wf.empty(),Wh.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?bf:Th()}function Uf(e,t){const n=Cf(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Bf(e,t){const n=Cf(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class qf{constructor(e){this.value=e}static empty(){return new qf({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Of(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lf(t)}setAll(e){let t=Hh.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Lf(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Of(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tf(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Of(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Zd(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new qf(Lf(this.value))}}function jf(e){const t=[];return Zd(e.fields,((e,n)=>{const r=new Hh([e]);if(Of(n)){const e=jf(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new cf(t)}class zf{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new zf(e,0,zh.min(),zh.min(),zh.min(),qf.empty(),0)}static newFoundDocument(e,t,n,r){return new zf(e,1,t,zh.min(),n,r,0)}static newNoDocument(e,t){return new zf(e,2,t,zh.min(),zh.min(),qf.empty(),0)}static newUnknownDocument(e,t){return new zf(e,3,t,zh.min(),zh.min(),qf.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(zh.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qf.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qf.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=zh.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof zf&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new zf(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gf{constructor(e,t){this.position=e,this.inclusive=t}}function Kf(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Wh.comparator(Wh.fromName(o.referenceValue),n.key):Cf(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function $f(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Tf(e.position[n],t.position[n]))return!1;return!0}class Hf{constructor(e,t="asc"){this.field=e,this.dir=t}}function Wf(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Qf{}class Yf extends Qf{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new op(e,t,n):"array-contains"===t?new lp(e,n):"in"===t?new hp(e,n):"not-in"===t?new dp(e,n):"array-contains-any"===t?new fp(e,n):new Yf(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ap(e,n):new cp(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Cf(t,this.value)):null!==t&&_f(this.value)===_f(t)&&this.matchesComparison(Cf(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Th()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Jf extends Qf{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new Jf(e,t)}matches(e){return Xf(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Xf(e){return"and"===e.op}function Zf(e){return"or"===e.op}function ep(e){return tp(e)&&Xf(e)}function tp(e){for(const t of e.filters)if(t instanceof Jf)return!1;return!0}function np(e){if(e instanceof Yf)return e.field.canonicalString()+e.op.toString()+kf(e.value);if(ep(e))return e.filters.map((e=>np(e))).join(",");{const t=e.filters.map((e=>np(e))).join(",");return`${e.op}(${t})`}}function rp(e,t){return e instanceof Yf?function(e,t){return t instanceof Yf&&e.op===t.op&&e.field.isEqual(t.field)&&Tf(e.value,t.value)}(e,t):e instanceof Jf?function(e,t){return t instanceof Jf&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&rp(n,t.filters[r])),!0)}(e,t):void Th()}function ip(e,t){const n=e.filters.concat(t);return Jf.create(n,e.op)}function sp(e){return e instanceof Yf?function(e){return`${e.field.canonicalString()} ${e.op} ${kf(e.value)}`}(e):e instanceof Jf?function(e){return e.op.toString()+" {"+e.getFilters().map(sp).join(" ,")+"}"}(e):"Filter"}class op extends Yf{constructor(e,t,n){super(e,t,n),this.key=Wh.fromName(n.referenceValue)}matches(e){const t=Wh.comparator(e.key,this.key);return this.matchesComparison(t)}}class ap extends Yf{constructor(e,t){super(e,"in",t),this.keys=up("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class cp extends Yf{constructor(e,t){super(e,"not-in",t),this.keys=up("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function up(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Wh.fromName(e.referenceValue)))}class lp extends Yf{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xf(t)&&Ef(t.arrayValue,this.value)}}class hp extends Yf{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ef(this.value.arrayValue,t)}}class dp extends Yf{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ef(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ef(this.value.arrayValue,t)}}class fp extends Yf{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xf(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Ef(this.value.arrayValue,e)))}}class pp{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function mp(e,t=null,n=[],r=[],i=null,s=null,o=null){return new pp(e,t,n,r,i,s,o)}function gp(e){const t=Ch(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>np(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),bd(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>kf(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>kf(e))).join(",")),t.dt=e}return t.dt}function yp(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Wf(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!rp(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!$f(e.startAt,t.startAt)&&$f(e.endAt,t.endAt)}function vp(e){return Wh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function wp(e,t){return e.filters.filter((e=>e instanceof Yf&&e.field.isEqual(t)))}function bp(e,t,n){let r=If,i=!0;for(const n of wp(e,t)){let e=If,t=!0;switch(n.op){case"<":case"<=":e=Ff(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=If}Uf({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Uf({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Ip(e,t,n){let r=bf,i=!0;for(const n of wp(e,t)){let e=bf,t=!0;switch(n.op){case">=":case">":e=Vf(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=bf}Bf({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Bf({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class _p{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Tp(e,t,n,r,i,s,o,a){return new _p(e,t,n,r,i,s,o,a)}function Ep(e){return new _p(e)}function Cp(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Sp(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function kp(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Ap(e){return null!==e.collectionGroup}function Np(e){const t=Ch(e);if(null===t.wt){t.wt=[];const e=kp(t),n=Sp(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new Hf(e)),t.wt.push(new Hf(Hh.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Hf(Hh.keyField(),e))}}}return t.wt}function Dp(e){const t=Ch(e);if(!t._t)if("F"===t.limitType)t._t=mp(t.path,t.collectionGroup,Np(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Np(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Hf(n.field,t))}const n=t.endAt?new Gf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Gf(t.startAt.position,t.startAt.inclusive):null;t._t=mp(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function xp(e,t){t.getFirstInequalityField(),kp(e);const n=e.filters.concat([t]);return new _p(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Rp(e,t,n){return new _p(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Pp(e,t){return yp(Dp(e),Dp(t))&&e.limitType===t.limitType}function Op(e){return`${gp(Dp(e))}|lt:${e.limitType}`}function Lp(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>sp(e))).join(", ")}]`),bd(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>kf(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>kf(e))).join(",")),`Target(${t})`}(Dp(e))}; limitType=${e.limitType})`}function Mp(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Wh.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Np(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Kf(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Np(e),t))&&!(e.endAt&&!function(e,t,n){const r=Kf(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Np(e),t))}(e,t)}function Fp(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Vp(e){return(t,n)=>{let r=!1;for(const i of Np(e)){const e=Up(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Up(e,t,n){const r=e.field.isKeyField()?Wh.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Cf(r,i):Th()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Th()}}class Bp{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Zd(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return ef(this.inner)}size(){return this.innerSize}}const qp=new tf(Wh.comparator);function jp(){return qp}const zp=new tf(Wh.comparator);function Gp(...e){let t=zp;for(const n of e)t=t.insert(n.key,n);return t}function Kp(e){let t=zp;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function $p(){return Wp()}function Hp(){return Wp()}function Wp(){return new Bp((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Qp=new tf(Wh.comparator),Yp=new sf(Wh.comparator);function Jp(...e){let t=Yp;for(const n of e)t=t.add(n);return t}const Xp=new sf(Uh);function Zp(){return Xp}function em(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Id(t)?"-0":t}}function tm(e){return{integerValue:""+e}}function nm(e,t){return _d(t)?tm(t):em(e,t)}class rm{constructor(){this._=void 0}}function im(e,t,n){return e instanceof am?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&mf(t)&&(t=gf(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof cm?um(e,t):e instanceof lm?hm(e,t):function(e,t){const n=om(e,t),r=fm(n)+fm(e.gt);return Df(n)&&Df(e.gt)?tm(r):em(e.serializer,r)}(e,t)}function sm(e,t,n){return e instanceof cm?um(e,t):e instanceof lm?hm(e,t):n}function om(e,t){return e instanceof dm?Df(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class am extends rm{}class cm extends rm{constructor(e){super(),this.elements=e}}function um(e,t){const n=pm(t);for(const t of e.elements)n.some((e=>Tf(e,t)))||n.push(t);return{arrayValue:{values:n}}}class lm extends rm{constructor(e){super(),this.elements=e}}function hm(e,t){let n=pm(t);for(const t of e.elements)n=n.filter((e=>!Tf(e,t)));return{arrayValue:{values:n}}}class dm extends rm{constructor(e,t){super(),this.serializer=e,this.gt=t}}function fm(e){return ff(e.integerValue||e.doubleValue)}function pm(e){return xf(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class mm{constructor(e,t){this.field=e,this.transform=t}}class gm{constructor(e,t){this.version=e,this.transformResults=t}}class ym{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ym}static exists(e){return new ym(void 0,e)}static updateTime(e){return new ym(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vm(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class wm{}function bm(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Dm(e.key,ym.none()):new Cm(e.key,e.data,ym.none());{const n=e.data,r=qf.empty();let i=new sf(Hh.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Sm(e.key,r,new cf(i.toArray()),ym.none())}}function Im(e,t,n){e instanceof Cm?function(e,t,n){const r=e.value.clone(),i=Am(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Sm?function(e,t,n){if(!vm(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Am(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(km(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function _m(e,t,n,r){return e instanceof Cm?function(e,t,n,r){if(!vm(e.precondition,t))return n;const i=e.value.clone(),s=Nm(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Sm?function(e,t,n,r){if(!vm(e.precondition,t))return n;const i=Nm(e.fieldTransforms,r,t),s=t.data;return s.setAll(km(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return vm(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Tm(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=om(r.transform,e||null);null!=i&&(null===n&&(n=qf.empty()),n.set(r.field,i))}return n||null}function Em(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Bh(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof cm&&t instanceof cm||e instanceof lm&&t instanceof lm?Bh(e.elements,t.elements,Tf):e instanceof dm&&t instanceof dm?Tf(e.gt,t.gt):e instanceof am&&t instanceof am}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Cm extends wm{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Sm extends wm{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function km(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Am(e,t,n){const r=new Map;Eh(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,sm(o,a,n[i]))}return r}function Nm(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,im(e,s,t))}return r}class Dm extends wm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xm extends wm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Rm{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Im(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=_m(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=_m(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Hp();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=bm(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(zh.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Jp())}isEqual(e){return this.batchId===e.batchId&&Bh(this.mutations,e.mutations,((e,t)=>Em(e,t)))&&Bh(this.baseMutations,e.baseMutations,((e,t)=>Em(e,t)))}}class Pm{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Eh(e.mutations.length===n.length);let r=Qp;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Pm(e,t,n,r)}}class Om{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Lm{constructor(e,t){this.count=e,this.unchangedNames=t}}var Mm,Fm;function Vm(e){switch(e){default:return Th();case Sh.CANCELLED:case Sh.UNKNOWN:case Sh.DEADLINE_EXCEEDED:case Sh.RESOURCE_EXHAUSTED:case Sh.INTERNAL:case Sh.UNAVAILABLE:case Sh.UNAUTHENTICATED:return!1;case Sh.INVALID_ARGUMENT:case Sh.NOT_FOUND:case Sh.ALREADY_EXISTS:case Sh.PERMISSION_DENIED:case Sh.FAILED_PRECONDITION:case Sh.ABORTED:case Sh.OUT_OF_RANGE:case Sh.UNIMPLEMENTED:case Sh.DATA_LOSS:return!0}}function Um(e){if(void 0===e)return bh("GRPC error has no .code"),Sh.UNKNOWN;switch(e){case Mm.OK:return Sh.OK;case Mm.CANCELLED:return Sh.CANCELLED;case Mm.UNKNOWN:return Sh.UNKNOWN;case Mm.DEADLINE_EXCEEDED:return Sh.DEADLINE_EXCEEDED;case Mm.RESOURCE_EXHAUSTED:return Sh.RESOURCE_EXHAUSTED;case Mm.INTERNAL:return Sh.INTERNAL;case Mm.UNAVAILABLE:return Sh.UNAVAILABLE;case Mm.UNAUTHENTICATED:return Sh.UNAUTHENTICATED;case Mm.INVALID_ARGUMENT:return Sh.INVALID_ARGUMENT;case Mm.NOT_FOUND:return Sh.NOT_FOUND;case Mm.ALREADY_EXISTS:return Sh.ALREADY_EXISTS;case Mm.PERMISSION_DENIED:return Sh.PERMISSION_DENIED;case Mm.FAILED_PRECONDITION:return Sh.FAILED_PRECONDITION;case Mm.ABORTED:return Sh.ABORTED;case Mm.OUT_OF_RANGE:return Sh.OUT_OF_RANGE;case Mm.UNIMPLEMENTED:return Sh.UNIMPLEMENTED;case Mm.DATA_LOSS:return Sh.DATA_LOSS;default:return Th()}}(Fm=Mm||(Mm={}))[Fm.OK=0]="OK",Fm[Fm.CANCELLED=1]="CANCELLED",Fm[Fm.UNKNOWN=2]="UNKNOWN",Fm[Fm.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fm[Fm.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fm[Fm.NOT_FOUND=5]="NOT_FOUND",Fm[Fm.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fm[Fm.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fm[Fm.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fm[Fm.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fm[Fm.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fm[Fm.ABORTED=10]="ABORTED",Fm[Fm.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fm[Fm.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fm[Fm.INTERNAL=13]="INTERNAL",Fm[Fm.UNAVAILABLE=14]="UNAVAILABLE",Fm[Fm.DATA_LOSS=15]="DATA_LOSS";class Bm{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return qm}static getOrCreateInstance(){return null===qm&&(qm=new Bm),qm}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let qm=null;function jm(){return new TextEncoder}const zm=new dh([4294967295,4294967295],0);function Gm(e){const t=jm().encode(e),n=new hh;return n.update(t),new Uint8Array(n.digest())}function Km(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new dh([n,r],0),new dh([i,s],0)]}class $m{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Hm(`Invalid padding: ${t}`);if(n<0)throw new Hm(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Hm(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Hm(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=dh.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(dh.fromNumber(n)));return 1===r.compare(zm)&&(r=new dh([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=Gm(e),[n,r]=Km(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new $m(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=Gm(e),[n,r]=Km(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Hm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Wm{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Qm.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Wm(zh.min(),r,new tf(Uh),jp(),Jp())}}class Qm{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Qm(n,t,Jp(),Jp(),Jp())}}class Ym{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class Jm{constructor(e,t){this.targetId=e,this.Vt=t}}class Xm{constructor(e,t,n=lf.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Zm{constructor(){this.St=0,this.Dt=ng(),this.Ct=lf.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=Jp(),t=Jp(),n=Jp();return this.Dt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Th()}})),new Qm(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=ng()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class eg{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=jp(),this.zt=tg(),this.Wt=new tf(Uh)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:Th()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){const s=i.target;if(vp(s))if(0===r){const e=new Wh(s.path);this.Yt(n,e,zf.newNoDocument(e,zh.min()))}else Eh(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(e,i);if(0!==r){this.ee(n);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=Bm.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:r}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=pf(i).toUint8Array()}catch(e){if(e instanceof uf)return Ih("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new $m(a,s,o)}catch(e){return Ih(e instanceof Hm?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)})),r}ce(e){const t=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&vp(i.target)){const t=new Wh(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,zf.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}}));let n=Jp();this.zt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const r=new Wm(e,t,this.Wt,this.jt,n);return this.jt=jp(),this.zt=tg(),this.Wt=new tf(Uh),r}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new Zm,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new sf(Uh),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||wh("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new Zm),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function tg(){return new tf(Wh.comparator)}function ng(){return new tf(Wh.comparator)}const rg={asc:"ASCENDING",desc:"DESCENDING"},ig={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sg={and:"AND",or:"OR"};class og{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ag(e,t){return e.useProto3Json||bd(t)?t:{value:t}}function cg(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ug(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function lg(e,t){return cg(e,t.toTimestamp())}function hg(e){return Eh(!!e),zh.fromTimestamp(function(e){const t=df(e);return new jh(t.seconds,t.nanos)}(e))}function dg(e,t){return function(e){return new Kh(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function fg(e){const t=Kh.fromString(e);return Eh(Lg(t)),t}function pg(e,t){return dg(e.databaseId,t.path)}function mg(e,t){const n=fg(t);if(n.get(1)!==e.databaseId.projectId)throw new kh(Sh.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new kh(Sh.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Wh(wg(n))}function gg(e,t){return dg(e.databaseId,t)}function yg(e){const t=fg(e);return 4===t.length?Kh.emptyPath():wg(t)}function vg(e){return new Kh(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function wg(e){return Eh(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function bg(e,t,n){return{name:pg(e,t),fields:n.value.mapValue.fields}}function Ig(e,t,n){const r=mg(e,t.name),i=hg(t.updateTime),s=t.createTime?hg(t.createTime):zh.min(),o=new qf({mapValue:{fields:t.fields}}),a=zf.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function _g(e,t){let n;if(t instanceof Cm)n={update:bg(e,t.key,t.value)};else if(t instanceof Dm)n={delete:pg(e,t.key)};else if(t instanceof Sm)n={update:bg(e,t.key,t.data),updateMask:Og(t.fieldMask)};else{if(!(t instanceof xm))return Th();n={verify:pg(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof am)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof cm)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof lm)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof dm)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Th()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:lg(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Th()}(e,t.precondition)),n}function Tg(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?ym.updateTime(hg(e.updateTime)):void 0!==e.exists?ym.exists(e.exists):ym.none()}(t.currentDocument):ym.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Eh("REQUEST_TIME"===t.setToServerValue),n=new am;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new cm(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new lm(e)}else"increment"in t?n=new dm(e,t.increment):Th();const r=Hh.fromServerFormat(t.fieldPath);return new mm(r,n)}(e,t))):[];if(t.update){t.update.name;const i=mg(e,t.update.name),s=new qf({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new cf(t.map((e=>Hh.fromServerFormat(e))))}(t.updateMask);return new Sm(i,s,e,n,r)}return new Cm(i,s,n,r)}if(t.delete){const r=mg(e,t.delete);return new Dm(r,n)}if(t.verify){const r=mg(e,t.verify);return new xm(r,n)}return Th()}function Eg(e,t){return{documents:[gg(e,t.path)]}}function Cg(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=gg(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=gg(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Pg(Jf.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:xg(e.field),direction:Ag(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=ag(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Sg(e){let t=yg(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Eh(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=kg(e);return t instanceof Jf&&ep(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Hf(Rg(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,bd(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Gf(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Gf(n,t)}(n.endAt)),Tp(t,i,o,s,a,"F",c,u)}function kg(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Rg(e.unaryFilter.field);return Yf.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Rg(e.unaryFilter.field);return Yf.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Rg(e.unaryFilter.field);return Yf.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Rg(e.unaryFilter.field);return Yf.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Th()}}(e):void 0!==e.fieldFilter?function(e){return Yf.create(Rg(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Th()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Jf.create(e.compositeFilter.filters.map((e=>kg(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Th()}}(e.compositeFilter.op))}(e):Th()}function Ag(e){return rg[e]}function Ng(e){return ig[e]}function Dg(e){return sg[e]}function xg(e){return{fieldPath:e.canonicalString()}}function Rg(e){return Hh.fromServerFormat(e.fieldPath)}function Pg(e){return e instanceof Yf?function(e){if("=="===e.op){if(Pf(e.value))return{unaryFilter:{field:xg(e.field),op:"IS_NAN"}};if(Rf(e.value))return{unaryFilter:{field:xg(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Pf(e.value))return{unaryFilter:{field:xg(e.field),op:"IS_NOT_NAN"}};if(Rf(e.value))return{unaryFilter:{field:xg(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xg(e.field),op:Ng(e.op),value:e.value}}}(e):e instanceof Jf?function(e){const t=e.getFilters().map((e=>Pg(e)));return 1===t.length?t[0]:{compositeFilter:{op:Dg(e.op),filters:t}}}(e):Th()}function Og(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Lg(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Mg{constructor(e,t,n,r,i=zh.min(),s=zh.min(),o=lf.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Mg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Mg(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Mg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Mg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Fg{constructor(e){this.fe=e}}function Vg(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ug(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:pg(e,t.key),fields:t.data.value.mapValue.fields,updateTime:cg(e,t.version.toTimestamp()),createTime:cg(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Bg(t.version)};else{if(!t.isUnknownDocument())return Th();r.unknownDocument={path:n.path.toArray(),version:Bg(t.version)}}return r}function Ug(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Bg(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function qg(e){const t=new jh(e.seconds,e.nanoseconds);return zh.fromTimestamp(t)}function jg(e,t){const n=(t.baseMutations||[]).map((t=>Tg(e.fe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Tg(e.fe,t))),i=jh.fromMillis(t.localWriteTimeMs);return new Rm(t.batchId,i,n,r)}function zg(e){const t=qg(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?qg(e.lastLimboFreeSnapshotVersion):zh.min();let r;var i;return void 0!==e.query.documents?(Eh(1===(i=e.query).documents.length),r=Dp(Ep(yg(i.documents[0])))):r=function(e){return Dp(Sg(e))}(e.query),new Mg(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,lf.fromBase64String(e.resumeToken))}function Gg(e,t){const n=Bg(t.snapshotVersion),r=Bg(t.lastLimboFreeSnapshotVersion);let i;i=vp(t.target)?Eg(e.fe,t.target):Cg(e.fe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:gp(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Kg(e){const t=Sg({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Rp(t,t.limit,"L"):t}function $g(e,t){return new Om(t.largestBatchId,Tg(e.fe,t.overlayMutation))}function Hg(e,t){const n=t.path.lastSegment();return[e,Td(t.path.popLast()),n]}function Wg(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Bg(r.readTime),documentKey:Td(r.documentKey.path),largestBatchId:r.largestBatchId}}class Qg{getBundleMetadata(e,t){return Yg(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:qg(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Yg(e).put({bundleId:(n=t).id,createTime:Bg(hg(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Jg(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Kg(t.bundledQuery),readTime:qg(t.readTime)};var t}))}saveNamedQuery(e,t){return Jg(e).put(function(e){return{name:e.name,readTime:Bg(hg(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Yg(e){return Jd(e,"bundles")}function Jg(e){return Jd(e,"namedQueries")}class Xg{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){const n=t.uid||"";return new Xg(e,n)}getOverlay(e,t){return Zg(e).get(Hg(this.userId,t)).next((e=>e?$g(this.serializer,e):null))}getOverlays(e,t){const n=$p();return ad.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new Om(t,i);r.push(this.we(e,s))})),ad.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Td(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Zg(e).J("collectionPathOverlayIndex",r))})),ad.waitFor(i)}getOverlaysForCollection(e,t,n){const r=$p(),i=Td(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Zg(e).j("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=$g(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=$p();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Zg(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=$g(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}we(e,t){return Zg(e).put(function(e,t,n){const[r,i,s]=Hg(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:_g(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function Zg(e){return Jd(e,"documentOverlays")}class ey{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(ff(e.integerValue));else if("doubleValue"in e){const n=ff(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Id(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(pf(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?Mf(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):Th()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),Wh.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function ty(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function ny(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=ty(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}ey.Ve=new ey;class ry{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{const e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{const e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){const t=this.Fe(e),n=ny(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){const t=this.Fe(e),n=ny(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class iy{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class sy{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class oy{constructor(){this.je=new ry,this.ze=new iy(this.je),this.We=new sy(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class ay{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new ay(this.indexId,this.documentKey,this.arrayValue,n)}}function cy(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=uy(e.arrayValue,t.arrayValue),0!==n?n:(n=uy(e.directionalValue,t.directionalValue),0!==n?n:Wh.comparator(e.documentKey,t.documentKey)))}function uy(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class ly{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ze=e:this.Xe.push(e)}}tn(e){Eh(e.collectionGroup===this.collectionId);const t=Yh(e);if(void 0!==t&&!this.en(t))return!1;const n=Jh(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function hy(e){var t,n;if(Eh(e instanceof Yf||e instanceof Jf),e instanceof Yf){if(e instanceof hp){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>Yf.create(e.field,"==",t))))||[];return Jf.create(r,"or")}return e}const r=e.filters.map((e=>hy(e)));return Jf.create(r,e.op)}function dy(e){if(0===e.getFilters().length)return[];const t=gy(hy(e));return Eh(my(t)),fy(t)||py(t)?[t]:t.getFilters()}function fy(e){return e instanceof Yf}function py(e){return e instanceof Jf&&ep(e)}function my(e){return fy(e)||py(e)||function(e){if(e instanceof Jf&&Zf(e)){for(const t of e.getFilters())if(!fy(t)&&!py(t))return!1;return!0}return!1}(e)}function gy(e){if(Eh(e instanceof Yf||e instanceof Jf),e instanceof Yf)return e;if(1===e.filters.length)return gy(e.filters[0]);const t=e.filters.map((e=>gy(e)));let n=Jf.create(t,e.op);return n=wy(n),my(n)?n:(Eh(n instanceof Jf),Eh(Xf(n)),Eh(n.filters.length>1),n.filters.reduce(((e,t)=>yy(e,t))))}function yy(e,t){let n;return Eh(e instanceof Yf||e instanceof Jf),Eh(t instanceof Yf||t instanceof Jf),n=e instanceof Yf?t instanceof Yf?function(e,t){return Jf.create([e,t],"and")}(e,t):vy(e,t):t instanceof Yf?vy(t,e):function(e,t){if(Eh(e.filters.length>0&&t.filters.length>0),Xf(e)&&Xf(t))return ip(e,t.getFilters());const n=Zf(e)?e:t,r=Zf(e)?t:e,i=n.filters.map((e=>yy(e,r)));return Jf.create(i,"or")}(e,t),wy(n)}function vy(e,t){if(Xf(t))return ip(t,e.getFilters());{const n=t.filters.map((t=>yy(e,t)));return Jf.create(n,"or")}}function wy(e){if(Eh(e instanceof Yf||e instanceof Jf),e instanceof Yf)return e;const t=e.getFilters();if(1===t.length)return wy(t[0]);if(tp(e))return e;const n=t.map((e=>wy(e))),r=[];return n.forEach((t=>{t instanceof Yf?r.push(t):t instanceof Jf&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:Jf.create(r,e.op)}class by{constructor(){this.rn=new Iy}addToCollectionParentIndex(e,t){return this.rn.add(t),ad.resolve()}getCollectionParents(e,t){return ad.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return ad.resolve()}deleteFieldIndex(e,t){return ad.resolve()}getDocumentsMatchingTarget(e,t){return ad.resolve(null)}getIndexType(e,t){return ad.resolve(0)}getFieldIndexes(e,t){return ad.resolve([])}getNextCollectionGroupToUpdate(e){return ad.resolve(null)}getMinOffset(e,t){return ad.resolve(nd.min())}getMinOffsetFromCollectionGroup(e,t){return ad.resolve(nd.min())}updateCollectionGroup(e,t,n){return ad.resolve()}updateIndexEntries(e,t){return ad.resolve()}}class Iy{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new sf(Kh.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new sf(Kh.comparator)).toArray()}}const _y=new Uint8Array(0);class Ty{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Iy,this.un=new Bp((e=>gp(e)),((e,t)=>yp(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.on.add(t)}));const i={collectionId:n,parent:Td(r)};return Ey(e).put(i)}return ad.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[qh(t),""],!1,!0);return Ey(e).j(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Sd(r.parent))}return n}))}addFieldIndex(e,t){const n=Sy(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=ky(e);return i.next((e=>{n.put(Wg(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Sy(e),r=ky(e),i=Cy(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Cy(e);let r=!0;const i=new Map;return ad.forEach(this.cn(t),(t=>this.an(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=Jp();const r=[];return ad.forEach(i,((i,s)=>{var o;wh("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${gp(t)}`);const a=function(e,t){const n=Yh(t);if(void 0===n)return null;for(const t of wp(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of Jh(t))for(const t of wp(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of Jh(t)){const t=0===i.kind?bp(e,i.fieldPath,e.startAt):Ip(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Gf(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of Jh(t)){const t=0===i.kind?Ip(e,i.fieldPath,e.endAt):bp(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Gf(n,r)}(s,i),h=this.hn(i,s,u),d=this.hn(i,s,l),f=this.ln(i,s,c),p=this.fn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return ad.forEach(p,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=Wh.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return ad.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:dy(Jf.create(e.filters,"and")).map((t=>mp(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/c]):_y,h=this.wn(e,a,n[l%c],r),d=this._n(e,a,i[l%c],s),f=o.map((t=>this.wn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}wn(e,t,n,r){const i=new ay(e,Wh.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){const i=new ay(e,Wh.empty(),t,n);return r?i.Je():i}an(e,t){const n=new ly(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return ad.forEach(r,(t=>this.an(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new sf(Hh.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}mn(e,t){const n=new oy;for(const r of Jh(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.He(r.kind);ey.Ve._e(e,i)}return n.Qe()}dn(e){const t=new oy;return ey.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const n=new oy;return ey.Ve._e(Nf(this.databaseId,t),n.He(function(e){const t=Jh(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new oy);let i=0;for(const s of Jh(e)){const e=n[i++];for(const n of r)if(this.yn(t,s.fieldPath)&&xf(e))r=this.pn(r,s,e);else{const t=n.He(s.kind);ey.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new oy;r.seed(n.Qe()),ey.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find((e=>e instanceof Yf&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Sy(e),r=ky(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return ad.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Zh(t.sequenceNumber,new nd(qg(t.readTime),new Wh(Sd(t.documentKey)),t.largestBatchId)):Zh.empty(),r=e.fields.map((([e,t])=>new Xh(Hh.fromServerFormat(e),t)));return new Qh(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Uh(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Sy(e),i=ky(e);return this.Tn(e).next((e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>ad.forEach(t,(t=>i.put(Wg(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return ad.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?ad.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),ad.forEach(i,(n=>this.En(e,t,n).next((t=>{const i=this.An(r,n);return t.isEqual(i)?ad.resolve():this.vn(e,r,n,t,i)})))))))}))}Rn(e,t,n,r){return Cy(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return Cy(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){const r=Cy(e);let i=new sf(cy);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},((e,r)=>{i=i.add(new ay(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}An(e,t){let n=new sf(cy);const r=this.mn(t,e);if(null==r)return n;const i=Yh(t);if(null!=i){const s=e.data.field(i.fieldPath);if(xf(s))for(const i of s.arrayValue.values||[])n=n.add(new ay(t.indexId,e.key,this.dn(i),r))}else n=n.add(new ay(t.indexId,e.key,_y,r));return n}vn(e,t,n,r,i){wh("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=af(s),c=af(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=af(o)):t?(i(a),a=af(s)):(a=af(s),c=af(o))}}(r,i,cy,(r=>{s.push(this.Rn(e,t,n,r))}),(r=>{s.push(this.Pn(e,t,n,r))})),ad.waitFor(s)}Tn(e){let t=1;return ky(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>cy(e,t))).filter(((e,t,n)=>!t||0!==cy(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=cy(i,e),s=cy(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,_y,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,_y,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return cy(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ay)}getMinOffset(e,t){return ad.mapArray(this.cn(t),(t=>this.an(e,t).next((e=>e||Th())))).next(Ay)}}function Ey(e){return Jd(e,"collectionParents")}function Cy(e){return Jd(e,"indexEntries")}function Sy(e){return Jd(e,"indexConfiguration")}function ky(e){return Jd(e,"indexState")}function Ay(e){Eh(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;rd(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new nd(t.readTime,t.documentKey,n)}const Ny={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Dy{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Dy(e,Dy.DEFAULT_COLLECTION_PERCENTILE,Dy.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function xy(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Eh(1===a)})));const u=[];for(const e of n.mutations){const r=Nd(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ad.waitFor(s).next((()=>u))}function Ry(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Th();t=e.noDocument}return JSON.stringify(t).length}Dy.DEFAULT_COLLECTION_PERCENTILE=10,Dy.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Dy.DEFAULT=new Dy(41943040,Dy.DEFAULT_COLLECTION_PERCENTILE,Dy.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Dy.DISABLED=new Dy(-1,0,0);class Py{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){Eh(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Py(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ly(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=My(e),s=Ly(e);return s.add({}).next((o=>{Eh("number"==typeof o);const a=new Rm(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>_g(e.fe,t))),i=n.mutations.map((t=>_g(e.fe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new sf(((e,t)=>Uh(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Nd(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Dd))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),ad.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Ly(e).get(t).next((e=>e?(Eh(e.userId===this.userId),jg(this.serializer,e)):null))}Sn(e,t){return this.Vn[t]?ad.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ly(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Eh(t.batchId>=n),i=jg(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ly(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ly(e).j("userMutationsIndex",t).next((e=>e.map((e=>jg(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ad(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return My(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=Sd(a);if(o===this.userId&&t.path.isEqual(u))return Ly(e).get(c).next((e=>{if(!e)throw Th();Eh(e.userId===this.userId),i.push(jg(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sf(Uh);const r=[];return t.forEach((t=>{const i=Ad(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=My(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=Sd(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),ad.waitFor(r).next((()=>this.Dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Ad(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new sf(Uh);return My(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=Sd(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Dn(e,o)))}Dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Ly(e).get(t).next((e=>{if(null===e)throw Th();Eh(e.userId===this.userId),n.push(jg(this.serializer,e))})))})),ad.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return xy(e.ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Cn(t.batchId)})),ad.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ad.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return My(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Sd(e[1]);r.push(t)}else n.done()})).next((()=>{Eh(0===r.length)}))}))}containsKey(e,t){return Oy(e,this.userId,t)}xn(e){return Fy(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Oy(e,t,n){const r=Ad(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return My(e).X({range:s,Y:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Ly(e){return Jd(e,"mutations")}function My(e){return Jd(e,"documentMutations")}function Fy(e){return Jd(e,"mutationQueues")}class Vy{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Vy(0)}static Mn(){return new Vy(-1)}}class Uy{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next((t=>{const n=new Vy(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.$n(e).next((e=>zh.fromTimestamp(new jh(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.$n(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.$n(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r))))}addTargetData(e,t){return this.Fn(e,t).next((()=>this.$n(e).next((n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>By(e).delete(t.targetId))).next((()=>this.$n(e))).next((t=>(Eh(t.targetCount>0),t.targetCount-=1,this.On(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return By(e).X(((s,o)=>{const a=zg(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>ad.waitFor(i))).next((()=>r))}forEachTarget(e,t){return By(e).X(((e,n)=>{const r=zg(n);t(r)}))}$n(e){return qy(e).get("targetGlobalKey").next((e=>(Eh(null!==e),e)))}On(e,t){return qy(e).put("targetGlobalKey",t)}Fn(e,t){return By(e).put(Gg(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next((e=>e.targetCount))}getTargetData(e,t){const n=gp(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return By(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=zg(n);yp(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=jy(e);return t.forEach((t=>{const s=Td(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),ad.waitFor(r)}removeMatchingKeys(e,t,n){const r=jy(e);return ad.forEach(t,(t=>{const i=Td(t.path);return ad.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=jy(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=jy(e);let i=Jp();return r.X({range:n,Y:!0},((e,t,n)=>{const r=Sd(e[1]),s=new Wh(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Td(t.path),r=IDBKeyRange.bound([n],[qh(n)],!1,!0);let i=0;return jy(e).X({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}le(e,t){return By(e).get(t).next((e=>e?zg(e):null))}}function By(e){return Jd(e,"targets")}function qy(e){return Jd(e,"targetGlobal")}function jy(e){return Jd(e,"targetDocuments")}function zy([e,t],[n,r]){const i=Uh(e,n);return 0===i?Uh(t,r):i}class Gy{constructor(e){this.Ln=e,this.buffer=new sf(zy),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();zy(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ky{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){wh("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){dd(e)?wh("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await od(e)}await this.Qn(3e5)}))}}class $y{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ad.resolve(wd.ct);const n=new Gy(t);return this.jn.forEachTarget(e,(e=>n.Kn(e.sequenceNumber))).next((()=>this.jn.Wn(e,(e=>n.Kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(wh("LruGarbageCollector","Garbage collection skipped; disabled"),ad.resolve(Ny)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(wh("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ny):this.Hn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(wh("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),vh()<=Ve.DEBUG&&wh("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),ad.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function Hy(e,t){return new $y(e,t)}class Wy{constructor(e,t){this.db=e,this.garbageCollector=Hy(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Jn(e){let t=0;return this.Wn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,((e,n)=>t(n)))}addReference(e,t,n){return Qy(e,n)}removeReference(e,t,n){return Qy(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Qy(e,t)}Xn(e,t){return function(e,t){let n=!1;return Fy(e).Z((r=>Oy(e,r,t).next((e=>(e&&(n=!0),ad.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Yn(e,((s,o)=>{if(o<=t){const t=this.Xn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,zh.min()),jy(e).delete([0,Td(s.path)]))))}));r.push(t)}})).next((()=>ad.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Qy(e,t)}Yn(e,t){const n=jy(e);let r,i=wd.ct;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==wd.ct&&t(new Wh(Sd(r)),i),i=o,r=s):i=wd.ct})).next((()=>{i!==wd.ct&&t(new Wh(Sd(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Qy(e,t){return jy(e).put(function(e,t){return{targetId:0,path:Td(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Yy{constructor(){this.changes=new Bp((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,zf.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ad.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Jy{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return tv(e).put(n)}removeEntry(e,t,n){return tv(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Ug(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Zn(e,n))))}getEntry(e,t){let n=zf.newInvalidDocument(t);return tv(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(nv(t))},((e,r)=>{n=this.ts(t,r)})).next((()=>n))}es(e,t){let n={size:0,document:zf.newInvalidDocument(t)};return tv(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(nv(t))},((e,r)=>{n={document:this.ts(t,r),size:Ry(r)}})).next((()=>n))}getEntries(e,t){let n=jp();return this.ns(e,t,((e,t)=>{const r=this.ts(e,t);n=n.insert(e,r)})).next((()=>n))}ss(e,t){let n=jp(),r=new tf(Wh.comparator);return this.ns(e,t,((e,t)=>{const i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,Ry(t))})).next((()=>({documents:n,rs:r})))}ns(e,t,n){if(t.isEmpty())return ad.resolve();let r=new sf(iv);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(nv(r.first()),nv(r.last())),s=r.getIterator();let o=s.getNext();return tv(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=Wh.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&iv(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(nv(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),Ug(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tv(e).j(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=jp();for(const i of e){const e=this.ts(Wh.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Mp(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=jp();const s=rv(t,n),o=rv(t,nd.max());return tv(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.ts(Wh.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Zy(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return ev(e).get("remoteDocumentGlobalKey").next((e=>(Eh(!!e),e)))}Zn(e,t){return ev(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ig(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Wh.fromSegments(t.noDocument.path),r=qg(t.noDocument.readTime);n=zf.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Th();{const e=Wh.fromSegments(t.unknownDocument.path),r=qg(t.unknownDocument.version);n=zf.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new jh(e[0],e[1]);return zh.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(zh.min()))return e}return zf.newInvalidDocument(e)}}function Xy(e){return new Jy(e)}class Zy extends Yy{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new Bp((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new sf(((e,t)=>Uh(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Vg(this.os.serializer,s);r=r.add(i.path.popLast());const c=Ry(a);n+=c-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Vg(this.os.serializer,s.convertToNoDocument(zh.min()));t.push(this.os.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.os.updateMetadata(e,n)),ad.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next((e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.os.ss(e,t).next((({documents:e,rs:t})=>(t.forEach(((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function ev(e){return Jd(e,"remoteDocumentGlobal")}function tv(e){return Jd(e,"remoteDocumentsV14")}function nv(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function rv(e,t){const n=t.documentKey.path.toArray();return[e,Ug(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function iv(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Uh(n[e],r[e]),i)return i;return i=Uh(n.length,r.length),i||(i=Uh(n[n.length-2],r[r.length-2]),i||Uh(n[n.length-1],r[r.length-1]))}class sv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ov{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&_m(n.mutation,e,cf.empty(),jh.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Jp()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Jp()){const r=$p();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Gp();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=$p();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Jp())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=jp();const s=Wp(),o=Wp();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Sm)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),_m(o.mutation,t,o.mutation.getFieldMask(),jh.now())):s.set(t.key,cf.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new sv(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Wp();let r=new tf(((e,t)=>e-t)),i=Jp();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||cf.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Jp()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Hp();c.forEach((e=>{if(!i.has(e)){const r=bm(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return ad.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return Wh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ap(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ad.resolve($p());let o=-1,a=i;return s.next((t=>ad.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ad.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Jp()))).next((e=>({batchId:o,changes:Kp(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Wh(t)).next((e=>{let t=Gp();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=Gp();return this.indexManager.getCollectionParents(e,r).next((s=>ad.forEach(s,(s=>{const o=function(e,t){return new _p(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,zf.newInvalidDocument(r)))}));let n=Gp();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&_m(s.mutation,i,cf.empty(),jh.now()),Mp(t,i)&&(n=n.insert(e,i))})),n}))}}class av{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return ad.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:hg(n.createTime)}),ad.resolve()}getNamedQuery(e,t){return ad.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Kg(e.bundledQuery),readTime:hg(e.readTime)}}(t)),ad.resolve()}}class cv{constructor(){this.overlays=new tf(Wh.comparator),this.ls=new Map}getOverlay(e,t){return ad.resolve(this.overlays.get(t))}getOverlays(e,t){const n=$p();return ad.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.we(e,t,r)})),ad.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),ad.resolve()}getOverlaysForCollection(e,t,n){const r=$p(),i=t.length+1,s=new Wh(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ad.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new tf(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=$p(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=$p(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return ad.resolve(o)}we(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Om(t,n));let i=this.ls.get(t);void 0===i&&(i=Jp(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class uv{constructor(){this.fs=new sf(lv.ds),this.ws=new sf(lv._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new lv(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new lv(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new Wh(new Kh([])),n=new lv(t,e),r=new lv(t,e+1),i=[];return this.ws.forEachInRange([n,r],(e=>{this.ys(e),i.push(e.key)})),i}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new Wh(new Kh([])),n=new lv(t,e),r=new lv(t,e+1);let i=Jp();return this.ws.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new lv(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class lv{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return Wh.comparator(e.key,t.key)||Uh(e.As,t.As)}static _s(e,t){return Uh(e.As,t.As)||Wh.comparator(e.key,t.key)}}class hv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new sf(lv.ds)}checkEmpty(e){return ad.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Rm(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new lv(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ad.resolve(s)}lookupMutationBatch(e,t){return ad.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.bs(n),i=r<0?0:r;return ad.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ad.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return ad.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new lv(t,0),r=new lv(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(e=>{const t=this.Ps(e.As);i.push(t)})),ad.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sf(Uh);return t.forEach((e=>{const t=new lv(e,0),r=new lv(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],(e=>{n=n.add(e.As)}))})),ad.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Wh.isDocumentKey(i)||(i=i.child(""));const s=new lv(new Wh(i),0);let o=new sf(Uh);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)}),s),ad.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Eh(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return ad.forEach(t.mutations,(r=>{const i=new lv(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new lv(t,0),r=this.Rs.firstAfterOrEqual(n);return ad.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ad.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class dv{constructor(e){this.Ds=e,this.docs=new tf(Wh.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ad.resolve(n?n.document.mutableCopy():zf.newInvalidDocument(t))}getEntries(e,t){let n=jp();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():zf.newInvalidDocument(e))})),ad.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=jp();const s=t.path,o=new Wh(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||rd(td(o),n)<=0||(r.has(o.key)||Mp(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ad.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Th()}Cs(e,t){return ad.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new fv(this)}getSize(e){return ad.resolve(this.size)}}class fv extends Yy{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)})),ad.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class pv{constructor(e){this.persistence=e,this.xs=new Bp((e=>gp(e)),yp),this.lastRemoteSnapshotVersion=zh.min(),this.highestTargetId=0,this.Ns=0,this.ks=new uv,this.targetCount=0,this.Ms=Vy.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),ad.resolve()}getLastRemoteSnapshotVersion(e){return ad.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ad.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),ad.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),ad.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Vy(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,ad.resolve()}updateTargetData(e,t){return this.Fn(t),ad.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,ad.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),ad.waitFor(i).next((()=>r))}getTargetCount(e){return ad.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return ad.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),ad.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),ad.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),ad.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return ad.resolve(n)}containsKey(e,t){return ad.resolve(this.ks.containsKey(t))}}class mv{constructor(e,t){this.$s={},this.overlays={},this.Os=new wd(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new pv(this),this.indexManager=new by,this.remoteDocumentCache=function(e){return new dv(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Fg(t),this.qs=new av(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new hv(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){wh("MemoryPersistence","Starting transaction:",e);const r=new gv(this.Os.next());return this.referenceDelegate.Us(),n(r).next((e=>this.referenceDelegate.Ks(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gs(e,t){return ad.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class gv extends sd{constructor(e){super(),this.currentSequenceNumber=e}}class yv{constructor(e){this.persistence=e,this.Qs=new uv,this.js=null}static zs(e){return new yv(e)}get Ws(){if(this.js)return this.js;throw Th()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),ad.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),ad.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),ad.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ad.forEach(this.Ws,(n=>{const r=Wh.fromPath(n);return this.Hs(e,r).next((e=>{e||t.removeEntry(r,zh.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return ad.or([()=>ad.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class vv{constructor(e){this.serializer=e}O(e,t,n,r){const i=new cd("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kd,{unique:!0}),e.createObjectStore("documentMutations")}(e),wv(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=ad.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),wv(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:zh.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kd,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return ad.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ys(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i))))),n<7&&r>=7&&(s=s.next((()=>this.Zs(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ei(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:jd});t.createIndex("collectionPathOverlayIndex",zd,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Gd,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:xd});t.createIndex("documentKeyIndex",Rd),t.createIndex("collectionGroupIndex",Pd)}(e))).next((()=>this.ni(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Vd}).createIndex("sequenceNumberIndex",Ud,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Bd}).createIndex("documentKeyIndex",qd,{unique:!1})}(e)))),s}Xs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=Ry(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>ad.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>ad.forEach(n,(n=>{Eh(n.userId===t.userId);const r=jg(this.serializer,n);return xy(e,t.userId,r).next((()=>{}))}))))}))))}Zs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new Kh(n),o=function(e){return[0,Td(e)]}(s);r.push(t.get(o).next((n=>n?ad.resolve():(n=>t.put({targetId:0,path:Td(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>ad.waitFor(r)))}))}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Fd});const n=t.store("collectionParents"),r=new Iy,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Td(r)})}};return t.store("remoteDocuments").X({Y:!0},((e,t)=>{const n=new Kh(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Y:!0},(([e,t,n],r)=>{const s=Sd(t);return i(s.popLast())}))))}ei(e){const t=e.store("targets");return t.X(((e,n)=>{const r=zg(n),i=Gg(this.serializer,r);return t.put(i)}))}ni(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new Wh(Kh.fromString(o.document.name).popFirst(5)):o.noDocument?Wh.fromSegments(o.noDocument.path):o.unknownDocument?Wh.fromSegments(o.unknownDocument.path):Th()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>ad.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=Xy(this.serializer),i=new mv(yv.zs,this.serializer.fe);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:Jp();jg(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),ad.forEach(n,((e,n)=>{const s=new mh(n),o=Xg.de(this.serializer,s),a=i.getIndexManager(s),c=Py.de(s,this.serializer,a,i.referenceDelegate);return new ov(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new Yd(t,wd.ct),e).next()}))}))}}function wv(e){e.createObjectStore("targetDocuments",{keyPath:Ld}).createIndex("documentTargetsIndex",Md,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Od,{unique:!0}),e.createObjectStore("targetGlobal")}const bv="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Iv{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=c,this.oi=u,this.ui=l,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!Iv.D())throw new kh(Sh.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wy(this,r),this.di=t+"main",this.serializer=new Fg(a),this.wi=new ud(this.di,this.ui,new vv(this.serializer)),this.Bs=new Uy(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Xy(this.serializer),this.qs=new Qg,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&bh("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new kh(Sh.FAILED_PRECONDITION,bv);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Bs.getHighestSequenceNumber(e)))})).then((e=>{this.Os=new wd(e,this.ri)})).then((()=>{this.Fs=!0})).catch((e=>(this.wi&&this.wi.close(),Promise.reject(e))))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Tv(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(e).next((e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(e))).next((t=>this.isPrimary&&!t?this.Ai(e).next((()=>!1)):!!t&&this.vi(e).next((()=>!0)))))).catch((e=>{if(dd(e))return wh("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return wh("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ii.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Ti(e){return _v(e).get("owner").next((e=>ad.resolve(this.Ri(e))))}Pi(e){return Tv(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Jd(e,"clientMetadata");return t.j().next((e=>{const n=this.Si(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return ad.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?ad.resolve(!0):_v(e).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new kh(Sh.FAILED_PRECONDITION,bv);return!1}}return!(!this.networkEnabled||!this.inForeground)||Tv(e).j().next((e=>void 0===this.Si(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&wh("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Yd(e,wd.ct);return this.Ai(t).next((()=>this.Pi(t)))})),this.wi.close(),this.Mi()}Si(e,t){return e.filter((e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(e=>Tv(e).j().next((e=>this.Si(e,18e5).map((e=>e.clientId))))))}get started(){return this.Fs}getMutationQueue(e,t){return Py.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ty(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return Xg.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){wh("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ui)?Qd:14===s?Wd:13===s?Hd:12===s?$d:11===s?Kd:void Th();var s;let o;return this.wi.runTransaction(e,r,i,(r=>(o=new Yd(r,this.Os?this.Os.next():wd.ct),"readwrite-primary"===t?this.Ti(o).next((e=>!!e||this.Ei(o))).next((t=>{if(!t)throw bh(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new kh(Sh.FAILED_PRECONDITION,id);return n(o)})).next((e=>this.vi(o).next((()=>e)))):this.Oi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Oi(e){return _v(e).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new kh(Sh.FAILED_PRECONDITION,bv)}))}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _v(e).put("owner",t)}static D(){return ud.D()}Ai(e){const t=_v(e);return t.get("owner").next((e=>this.Ri(e)?(wh("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ad.resolve()))}Vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(bh(`Detected an update time that is in the future: ${e} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;!me()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return wh("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return bh("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){bh("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function _v(e){return Jd(e,"owner")}function Tv(e){return Jd(e,"clientMetadata")}function Ev(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Cv{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=Jp(),r=Jp();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Cv(e,t.fromCache,n,r)}}class Sv{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next((i=>i||this.Gi(e,t,r,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Cp(t))return ad.resolve(null);let n=Dp(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Rp(t,null,"F"),n=Dp(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Jp(...r);return this.Ui.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,Rp(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,r){return Cp(t)||r.isEqual(zh.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((i=>{const s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(vh()<=Ve.DEBUG&&wh("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Lp(t)),this.Wi(e,s,t,ed(r,-1)))}))}ji(e,t){let n=new sf(Vp(e));return t.forEach(((t,r)=>{Mp(e,r)&&(n=n.add(r))})),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return vh()<=Ve.DEBUG&&wh("QueryEngine","Using full collection scan to execute query:",Lp(t)),this.Ui.getDocumentsMatchingQuery(e,t,nd.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class kv{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new tf(Uh),this.Yi=new Bp((e=>gp(e)),yp),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ov(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function Av(e,t,n,r){return new kv(e,t,n,r)}async function Nv(e,t){const n=Ch(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Jp();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Dv(e){const t=Ch(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function xv(e,t,n){let r=Jp(),i=Jp();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=jp();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(zh.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):wh("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}function Rv(e,t){const n=Ch(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Pv(e,t){const n=Ch(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Bs.getTargetData(e,t).next((i=>i?(r=i,ad.resolve(r)):n.Bs.allocateTargetId(e).next((i=>(r=new Mg(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}async function Ov(e,t,n){const r=Ch(e),i=r.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!dd(e))throw e;wh("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ji=r.Ji.remove(t),r.Yi.delete(i.target)}function Lv(e,t,n){const r=Ch(e);let i=zh.min(),s=Jp();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Ch(e),i=r.Yi.get(n);return void 0!==i?ad.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,Dp(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Hi.getDocumentsMatchingQuery(e,t,n?i:zh.min(),n?s:Jp()))).next((e=>(Vv(r,Fp(t),e),{documents:e,ir:s})))))}function Mv(e,t){const n=Ch(e),r=Ch(n.Bs),i=n.Ji.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.le(e,t).next((e=>e?e.target:null))))}function Fv(e,t){const n=Ch(e),r=n.Xi.get(t)||zh.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Zi.getAllFromCollectionGroup(e,t,ed(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Vv(n,t,e),e)))}function Vv(e,t,n){let r=e.Xi.get(t)||zh.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Xi.set(t,r)}async function Uv(e,t,n=Jp()){const r=await Pv(e,Dp(Kg(t.bundledQuery))),i=Ch(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=hg(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.qs.saveNamedQuery(e,t);const o=r.withResumeToken(lf.EMPTY_BYTE_STRING,s);return i.Ji=i.Ji.insert(o.targetId,o),i.Bs.updateTargetData(e,o).next((()=>i.Bs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Bs.addMatchingKeys(e,n,r.targetId))).next((()=>i.qs.saveNamedQuery(e,t)))}))}function Bv(e,t){return`firestore_clients_${e}_${t}`}function qv(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function jv(e,t){return`firestore_targets_${e}_${t}`}class zv{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static ar(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new kh(r.error.code,r.error.message))),s?new zv(e,t,r.state,i):(bh("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Gv{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static ar(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new kh(n.error.code,n.error.message))),i?new Gv(e,n.state,r):(bh("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kv{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Zp();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=_d(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new Kv(e,i):(bh("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class $v{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new $v(t.clientId,t.onlineState):(bh("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Hv{constructor(){this.activeTargetIds=Zp()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Wv{constructor(e,t,n,r,i){this.window=e,this.ii=t,this.persistenceKey=n,this.wr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new tf(Uh),this.started=!1,this.yr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pr=Bv(this.persistenceKey,this.wr),this.Ir=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.gr=this.gr.insert(this.wr,new Hv),this.Tr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Rr=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.$i();for(const t of e){if(t===this.wr)continue;const e=this.getItem(Bv(this.persistenceKey,t));if(e){const n=Kv.ar(t,e);n&&(this.gr=this.gr.insert(n.clientId,n))}}this.Pr();const t=this.storage.getItem(this.vr);if(t){const e=this.br(t);e&&this.Vr(e)}for(const e of this.yr)this.mr(e);this.yr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,n){this.Dr(e,t,n),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(jv(this.persistenceKey,e));if(n){const r=Gv.ar(e,n);r&&(t=r.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(jv(this.persistenceKey,e))}updateQueryState(e,t,n){this.kr(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Cr(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return wh("SharedClientState","READ",e,t),t}setItem(e,t){wh("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){wh("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){const t=e;if(t.storageArea===this.storage){if(wh("SharedClientState","EVENT",t.key,t.newValue),t.key===this.pr)return void bh("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Tr.test(t.key)){if(null==t.newValue){const e=this.Or(t.key);return this.Fr(e,null)}{const e=this.Br(t.key,t.newValue);if(e)return this.Fr(e.clientId,e)}}else if(this.Er.test(t.key)){if(null!==t.newValue){const e=this.Lr(t.key,t.newValue);if(e)return this.qr(e)}}else if(this.Ar.test(t.key)){if(null!==t.newValue){const e=this.Ur(t.key,t.newValue);if(e)return this.Kr(e)}}else if(t.key===this.vr){if(null!==t.newValue){const e=this.br(t.newValue);if(e)return this.Vr(e)}}else if(t.key===this.Ir){const e=function(e){let t=wd.ct;if(null!=e)try{const n=JSON.parse(e);Eh("number"==typeof n),t=n}catch(e){bh("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==wd.ct&&this.sequenceNumberHandler(e)}else if(t.key===this.Rr){const e=this.Gr(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Qr(e))))}}else this.yr.push(t)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,n){const r=new zv(this.currentUser,e,t,n),i=qv(this.persistenceKey,this.currentUser,e);this.setItem(i,r.hr())}Cr(e){const t=qv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){const t={clientId:this.wr,onlineState:e};this.storage.setItem(this.vr,JSON.stringify(t))}kr(e,t,n){const r=jv(this.persistenceKey,e),i=new Gv(e,t,n);this.setItem(r,i.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const n=this.Or(e);return Kv.ar(n,t)}Lr(e,t){const n=this.Er.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return zv.ar(new mh(i),r,t)}Ur(e,t){const n=this.Ar.exec(e),r=Number(n[1]);return Gv.ar(r,t)}br(e){return $v.ar(e)}Gr(e){return JSON.parse(e)}async qr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.jr(e.batchId,e.state,e.error);wh("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const n=t?this.gr.insert(e,t):this.gr.remove(e),r=this.Sr(this.gr),i=this.Sr(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Wr(s,o).then((()=>{this.gr=n}))}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=Zp();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Qv{constructor(){this.Hr=new Hv,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Hv,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Yv{Yr(e){}shutdown(){}}class Jv{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){wh("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){wh("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Xv=null;function Zv(){return null===Xv?Xv=268435456+Math.round(2147483648*Math.random()):Xv++,"0x"+Xv.toString(16)}const ew={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class tw{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const nw="WebChannelConnection";class rw extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){const s=Zv(),o=this.To(e,t);wh("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then((t=>(wh("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Ih("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+gh,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=ew[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){const i=Zv();return new Promise(((s,o)=>{const a=new lh;a.setWithCredentials(!0),a.listenOnce(sh.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case ih.NO_ERROR:const t=a.getResponseJson();wh(nw,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case ih.TIMEOUT:wh(nw,`RPC '${e}' ${i} timed out`),o(new kh(Sh.DEADLINE_EXCEEDED,"Request time out"));break;case ih.HTTP_ERROR:const n=a.getStatus();if(wh(nw,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Sh).indexOf(t)>=0?t:Sh.UNKNOWN}(t.status);o(new kh(e,t.message))}else o(new kh(Sh.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new kh(Sh.UNAVAILABLE,"Connection failed."));break;default:Th()}}finally{wh(nw,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);wh(nw,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const r=Zv(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=nh(),o=rh(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new ch({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");wh(nw,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new tw({ro:t=>{d?wh(nw,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(wh(nw,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),wh(nw,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},oo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,uh.EventType.OPEN,(()=>{d||wh(nw,`RPC '${e}' stream ${r} transport opened.`)})),p(l,uh.EventType.CLOSE,(()=>{d||(d=!0,wh(nw,`RPC '${e}' stream ${r} transport closed`),f.wo())})),p(l,uh.EventType.ERROR,(t=>{d||(d=!0,Ih(nw,`RPC '${e}' stream ${r} transport errored:`,t),f.wo(new kh(Sh.UNAVAILABLE,"The operation could not be completed")))})),p(l,uh.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Eh(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){wh(nw,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Mm[e];if(void 0!==t)return Um(t)}(t),i=o.message;void 0===n&&(n=Sh.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.wo(new kh(n,i)),l.close()}else wh(nw,`RPC '${e}' stream ${r} received:`,i),f._o(i)}})),p(o,oh.STAT_EVENT,(t=>{t.stat===ah.PROXY?wh(nw,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===ah.NOPROXY&&wh(nw,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function iw(){return"undefined"!=typeof window?window:null}function sw(){return"undefined"!=typeof document?document:null}function ow(e){return new og(e,!0)}class aw{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&wh("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class cw{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new aw(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===Sh.RESOURCE_EXHAUSTED?(bh(t.toString()),bh("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===Sh.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new kh(Sh.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return wh("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(wh("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class uw extends cw{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Th()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Eh(void 0===t||"string"==typeof t),lf.fromBase64String(t||"")):(Eh(void 0===t||t instanceof Uint8Array),lf.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Sh.UNKNOWN:Um(e.code);return new kh(t,e.message||"")}(o);n=new Xm(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=mg(e,r.document.name),s=hg(r.document.updateTime),o=r.document.createTime?hg(r.document.createTime):zh.min(),a=new qf({mapValue:{fields:r.document.fields}}),c=zf.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Ym(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=mg(e,r.document),s=r.readTime?hg(r.readTime):zh.min(),o=zf.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Ym([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=mg(e,r.document),s=r.removedTargetIds||[];n=new Ym([],s,i,null)}else{if(!("filter"in t))return Th();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Lm(r,i),o=e.targetId;n=new Jm(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return zh.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?zh.min():t.readTime?hg(t.readTime):zh.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=vg(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=vp(r)?{documents:Eg(e,r)}:{query:Cg(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ug(e,t.resumeToken);const r=ag(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(zh.min())>0){n.readTime=cg(e,t.snapshotVersion.toTimestamp());const r=ag(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Th()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=vg(this.serializer),t.removeTarget=e,this.Wo(t)}}class lw extends cw{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Eh(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(Eh(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?hg(e.updateTime):hg(t);return n.isEqual(zh.min())&&(n=hg(t)),new gm(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=hg(e.commitTime);return this.listener.cu(n,t)}return Eh(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=vg(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>_g(this.serializer,e)))};this.Wo(t)}}class hw extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new kh(Sh.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Sh.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new kh(Sh.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Sh.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new kh(Sh.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class dw{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(bh(t),this.mu=!1):wh("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class fw{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{_w(this)&&(wh("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Ch(e);t.vu.add(4),await mw(t),t.bu.set("Unknown"),t.vu.delete(4),await pw(t)}(this))}))})),this.bu=new dw(n,r)}}async function pw(e){if(_w(e))for(const t of e.Ru)await t(!0)}async function mw(e){for(const t of e.Ru)await t(!1)}function gw(e,t){const n=Ch(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),Iw(n)?bw(n):Bw(n).Ko()&&vw(n,t))}function yw(e,t){const n=Ch(e),r=Bw(n);n.Au.delete(t),r.Ko()&&ww(n,t),0===n.Au.size&&(r.Ko()?r.jo():_w(n)&&n.bu.set("Unknown"))}function vw(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(zh.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Bw(e).su(t)}function ww(e,t){e.Vu.qt(t),Bw(e).iu(t)}function bw(e){e.Vu=new eg({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),Bw(e).start(),e.bu.gu()}function Iw(e){return _w(e)&&!Bw(e).Uo()&&e.Au.size>0}function _w(e){return 0===Ch(e).vu.size}function Tw(e){e.Vu=void 0}async function Ew(e){e.Au.forEach(((t,n)=>{vw(e,t)}))}async function Cw(e,t){Tw(e),Iw(e)?(e.bu.Iu(t),bw(e)):e.bu.set("Unknown")}async function Sw(e,t,n){if(e.bu.set("Online"),t instanceof Xm&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){wh("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await kw(e,n)}else if(t instanceof Ym?e.Vu.Ht(t):t instanceof Jm?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(zh.min()))try{const t=await Dv(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(lf.EMPTY_BYTE_STRING,r.snapshotVersion)),ww(e,t);const i=new Mg(r.target,t,n,r.sequenceNumber);vw(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){wh("RemoteStore","Failed to raise snapshot:",t),await kw(e,t)}}async function kw(e,t,n){if(!dd(t))throw t;e.vu.add(1),await mw(e),e.bu.set("Offline"),n||(n=()=>Dv(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{wh("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await pw(e)}))}function Aw(e,t){return t().catch((n=>kw(e,n,t)))}async function Nw(e){const t=Ch(e),n=qw(t);let r=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;Dw(t);)try{const e=await Rv(t.localStore,r);if(null===e){0===t.Eu.length&&n.jo();break}r=e.batchId,xw(t,e)}catch(e){await kw(t,e)}Rw(t)&&Pw(t)}function Dw(e){return _w(e)&&e.Eu.length<10}function xw(e,t){e.Eu.push(t);const n=qw(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function Rw(e){return _w(e)&&!qw(e).Uo()&&e.Eu.length>0}function Pw(e){qw(e).start()}async function Ow(e){qw(e).hu()}async function Lw(e){const t=qw(e);for(const n of e.Eu)t.uu(n.mutations)}async function Mw(e,t,n){const r=e.Eu.shift(),i=Pm.from(r,t,n);await Aw(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Nw(e)}async function Fw(e,t){t&&qw(e).ou&&await async function(e,t){if(Vm(n=t.code)&&n!==Sh.ABORTED){const n=e.Eu.shift();qw(e).Qo(),await Aw(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Nw(e)}var n}(e,t),Rw(e)&&Pw(e)}async function Vw(e,t){const n=Ch(e);n.asyncQueue.verifyOperationInProgress(),wh("RemoteStore","RemoteStore received new credentials");const r=_w(n);n.vu.add(3),await mw(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await pw(n)}async function Uw(e,t){const n=Ch(e);t?(n.vu.delete(2),await pw(n)):t||(n.vu.add(2),await mw(n),n.bu.set("Unknown"))}function Bw(e){return e.Su||(e.Su=function(e,t,n){const r=Ch(e);return r.fu(),new uw(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Ew.bind(null,e),ao:Cw.bind(null,e),nu:Sw.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),Iw(e)?bw(e):e.bu.set("Unknown")):(await e.Su.stop(),Tw(e))}))),e.Su}function qw(e){return e.Du||(e.Du=function(e,t,n){const r=Ch(e);return r.fu(),new lw(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Ow.bind(null,e),ao:Fw.bind(null,e),au:Lw.bind(null,e),cu:Mw.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await Nw(e)):(await e.Du.stop(),e.Eu.length>0&&(wh("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class jw{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ah,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new jw(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new kh(Sh.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zw(e,t){if(bh("AsyncQueue",`${t}: ${e}`),dd(e))return new kh(Sh.UNAVAILABLE,`${t}: ${e}`);throw e}class Gw{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Wh.comparator(t.key,n.key):(e,t)=>Wh.comparator(e.key,t.key),this.keyedMap=Gp(),this.sortedSet=new tf(this.comparator)}static emptySet(e){return new Gw(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Gw))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Gw;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Kw{constructor(){this.Cu=new tf(Wh.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):Th():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class $w{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new $w(e,t,Gw.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Pp(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Hw{constructor(){this.Nu=void 0,this.listeners=[]}}class Ww{constructor(){this.queries=new Bp((e=>Op(e)),Pp),this.onlineState="Unknown",this.ku=new Set}}async function Qw(e,t){const n=Ch(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Hw),i)try{s.Nu=await n.onListen(r)}catch(e){const n=zw(e,`Initialization of query '${Lp(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&Zw(n)}async function Yw(e,t){const n=Ch(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Jw(e,t){const n=Ch(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.$u(e)&&(r=!0);i.Nu=e}}r&&Zw(n)}function Xw(e,t,n){const r=Ch(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Zw(e){e.ku.forEach((e=>{e.next()}))}class eb{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new $w(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=$w.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class tb{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class nb{constructor(e){this.serializer=e}rr(e){return mg(this.serializer,e)}ur(e){return e.metadata.exists?Ig(this.serializer,e.document,!1):zf.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return hg(e)}}class rb{constructor(e,t,n){this.ju=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ib(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const n=Kh.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,n=new nb(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.rr(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Jp()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Ch(e);let s=Jp(),o=jp();for(const e of n){const n=t.rr(e.metadata.name);e.document&&(s=s.add(n));const r=t.ur(e);r.setReadTime(t.cr(e.metadata.readTime)),o=o.insert(n,r)}const a=i.Zi.newChangeBuffer({trackRemovals:!0}),c=await Pv(i,function(e){return Dp(Ep(Kh.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>xv(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Bs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Bs.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.nr,t.sr))).next((()=>t.nr))))))}(this.localStore,new nb(this.serializer),this.documents,this.ju.id),t=this.Wu(this.documents);for(const e of this.queries)await Uv(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Hu:this.collectionGroups,Ju:e}}}function ib(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class sb{constructor(e){this.key=e}}class ob{constructor(e){this.key=e}}class ab{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Jp(),this.mutatedKeys=Jp(),this.tc=Vp(e),this.ec=new Gw(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new Kw,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Mp(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Th()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new $w(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Kw,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=Jp(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new ob(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new sb(n))})),t}hc(e){this.Yu=e.ir,this.Zu=Jp();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return $w.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class cb{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ub{constructor(e){this.key=e,this.fc=!1}}class lb{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new Bp((e=>Op(e)),Pp),this._c=new Map,this.mc=new Set,this.gc=new tf(Wh.comparator),this.yc=new Map,this.Ic=new uv,this.Tc={},this.Ec=new Map,this.Ac=Vy.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function hb(e,t){const n=Fb(e);let r,i;const s=n.wc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const e=await Pv(n.localStore,Dp(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await db(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&gw(n.remoteStore,e)}return i}async function db(e,t,n,r,i){e.Rc=(t,n,r)=>async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await Lv(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Tb(e,t.targetId,o.cc),o.snapshot}(e,t,n,r);const s=await Lv(e.localStore,t,!0),o=new ab(t,s.ir),a=o.sc(s.documents),c=Qm.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Tb(e,n,u.cc);const l=new cb(t,n,o);return e.wc.set(t,l),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}async function fb(e,t){const n=Ch(e),r=n.wc.get(t),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((e=>!Pp(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Ov(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),yw(n.remoteStore,r.targetId),Ib(n,r.targetId)})).catch(od)):(Ib(n,r.targetId),await Ov(n.localStore,r.targetId,!0))}async function pb(e,t){const n=Ch(e);try{const e=await function(e,t){const n=Ch(e),r=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(lf.EMPTY_BYTE_STRING,zh.min()).withLastLimboFreeSnapshotVersion(zh.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=jp(),c=Jp();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(xv(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!r.isEqual(zh.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return ad.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.yc.get(t);r&&(Eh(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.fc=!0:e.modifiedDocuments.size>0?Eh(r.fc):e.removedDocuments.size>0&&(Eh(r.fc),r.fc=!1))})),await Sb(n,e,t)}catch(e){await od(e)}}function mb(e,t,n){const r=Ch(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Ch(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(r=!0)})),r&&Zw(n)}(r.eventManager,t),e.length&&r.dc.nu(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function gb(e,t,n){const r=Ch(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.yc.get(t),s=i&&i.key;if(s){let e=new tf(Wh.comparator);e=e.insert(s,zf.newNoDocument(s,zh.min()));const n=Jp().add(s),i=new Wm(zh.min(),new Map,new tf(Uh),e,n);await pb(r,i),r.gc=r.gc.remove(s),r.yc.delete(t),Cb(r)}else await Ov(r.localStore,t,!1).then((()=>Ib(r,t,n))).catch(od)}async function yb(e,t){const n=Ch(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Ch(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ad.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Eh(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Jp();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);bb(n,r,null),wb(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Sb(n,e)}catch(e){await od(e)}}async function vb(e,t,n){const r=Ch(e);try{const e=await function(e,t){const n=Ch(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Eh(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);bb(r,t,n),wb(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Sb(r,e)}catch(n){await od(n)}}function wb(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function bb(e,t,n){const r=Ch(e);let i=r.Tc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function Ib(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e._c.get(t))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||_b(e,t)}))}function _b(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(yw(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),Cb(e))}function Tb(e,t,n){for(const r of n)r instanceof sb?(e.Ic.addReference(r.key,t),Eb(e,r)):r instanceof ob?(wh("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||_b(e,r.key)):Th()}function Eb(e,t){const n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(wh("SyncEngine","New document in limbo: "+n),e.mc.add(r),Cb(e))}function Cb(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new Wh(Kh.fromString(t)),r=e.Ac.next();e.yc.set(r,new ub(n)),e.gc=e.gc.insert(n,r),gw(e.remoteStore,new Mg(Dp(Ep(n.path)),r,"TargetPurposeLimboResolution",wd.ct))}}async function Sb(e,t,n){const r=Ch(e),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((e,a)=>{o.push(r.Rc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Cv.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.dc.nu(i),await async function(e,t){const n=Ch(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ad.forEach(t,(t=>ad.forEach(t.Fi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>ad.forEach(t.Bi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!dd(e))throw e;wh("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(t,i)}}}(r.localStore,s))}async function kb(e,t){const n=Ch(e);if(!n.currentUser.isEqual(t)){wh("SyncEngine","User change. New user:",t.toKey());const e=await Nv(n.localStore,t);n.currentUser=t,function(e,t){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new kh(Sh.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Sb(n,e.er)}}function Ab(e,t){const n=Ch(e),r=n.yc.get(t);if(r&&r.fc)return Jp().add(r.key);{let e=Jp();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.wc.get(t);e=e.unionWith(r.view.nc)}return e}}async function Nb(e,t){const n=Ch(e),r=await Lv(n.localStore,t.query,!0),i=t.view.hc(r);return n.isPrimaryClient&&Tb(n,t.targetId,i.cc),i}async function Db(e,t){const n=Ch(e);return Fv(n.localStore,t).then((e=>Sb(n,e)))}async function xb(e,t,n,r){const i=Ch(e),s=await function(e,t){const n=Ch(e),r=Ch(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Sn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):ad.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Nw(i.remoteStore):"acknowledged"===n||"rejected"===n?(bb(i,t,r||null),wb(i,t),function(e,t){Ch(Ch(e).mutationQueue).Cn(t)}(i.localStore,t)):Th(),await Sb(i,s)):wh("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Rb(e,t,n){const r=Ch(e),i=[],s=[];for(const e of t){let t;const n=r._c.get(e);if(n&&0!==n.length){t=await Pv(r.localStore,Dp(n[0]));for(const e of n){const t=r.wc.get(e),n=await Nb(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Mv(r.localStore,e);t=await Pv(r.localStore,n),await db(r,Pb(n),e,!1,t.resumeToken)}i.push(t)}return r.dc.nu(s),i}function Pb(e){return Tp(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Ob(e){const t=Ch(e);return Ch(Ch(t.localStore).persistence).$i()}async function Lb(e,t,n,r){const i=Ch(e);if(i.vc)return void wh("SyncEngine","Ignoring unexpected query state notification.");const s=i._c.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await Fv(i.localStore,Fp(s[0])),r=Wm.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,lf.EMPTY_BYTE_STRING);await Sb(i,e,r);break}case"rejected":await Ov(i.localStore,t,!0),Ib(i,t,r);break;default:Th()}}async function Mb(e,t,n){const r=Fb(e);if(r.vc){for(const e of t){if(r._c.has(e)){wh("SyncEngine","Adding an already active target "+e);continue}const t=await Mv(r.localStore,e),n=await Pv(r.localStore,t);await db(r,Pb(t),n.targetId,!1,n.resumeToken),gw(r.remoteStore,n)}for(const e of n)r._c.has(e)&&await Ov(r.localStore,e,!1).then((()=>{yw(r.remoteStore,e),Ib(r,e)})).catch(od)}}function Fb(e){const t=Ch(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=pb.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ab.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=gb.bind(null,t),t.dc.nu=Jw.bind(null,t.eventManager),t.dc.Pc=Xw.bind(null,t.eventManager),t}function Vb(e){const t=Ch(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=yb.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=vb.bind(null,t),t}class Ub{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ow(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Av(this.persistence,new Sv,e.initialUser,this.serializer)}createPersistence(e){return new mv(yv.zs,this.serializer)}createSharedClientState(e){return new Qv}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Bb extends Ub{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await Vb(this.Vc.syncEngine),await Nw(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Av(this.persistence,new Sv,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Ky(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new vd(t,this.persistence);return new yd(e.asyncQueue,n)}createPersistence(e){const t=Ev(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Dy.withCacheSize(this.cacheSizeBytes):Dy.DEFAULT;return new Iv(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,iw(),sw(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Qv}}class qb extends Bb{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Vc.syncEngine;this.sharedClientState instanceof Wv&&(this.sharedClientState.syncEngine={jr:xb.bind(null,t),zr:Lb.bind(null,t),Wr:Mb.bind(null,t),$i:Ob.bind(null,t),Qr:Db.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ii((async e=>{await async function(e,t){const n=Ch(e);if(Fb(n),Vb(n),!0===t&&!0!==n.vc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Rb(n,e.toArray());n.vc=!0,await Uw(n.remoteStore,!0);for(const e of t)gw(n.remoteStore,e)}else if(!1===t&&!1!==n.vc){const e=[];let t=Promise.resolve();n._c.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Ib(n,i),Ov(n.localStore,i,!0)))),yw(n.remoteStore,i)})),await t,await Rb(n,e),function(e){const t=Ch(e);t.yc.forEach(((e,n)=>{yw(t.remoteStore,n)})),t.Ic.Ts(),t.yc=new Map,t.gc=new tf(Wh.comparator)}(n),n.vc=!1,await Uw(n.remoteStore,!1)}}(this.Vc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=iw();if(!Wv.D(t))throw new kh(Sh.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ev(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Wv(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class jb{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mb(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=kb.bind(null,this.syncEngine),await Uw(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ww}createDatastore(e){const t=ow(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new rw(r));var r;return function(e,t,n,r){return new hw(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>mb(this.syncEngine,e,0),s=Jv.D()?new Jv:new Yv,new fw(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new lb(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Ch(e);wh("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await mw(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}function zb(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Gb{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):bh("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Kb{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new Ah,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then((e=>{e&&e.Qu()?this.metadata.resolve(e.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Gu)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Cc.cancel()}async getMetadata(){return this.metadata.promise}async bc(){return await this.getMetadata(),this.Nc()}async Nc(){const e=await this.kc();if(null===e)return null;const t=this.xc.decode(e),n=Number(t);isNaN(n)&&this.Mc(`length string (${t}) is not valid number`);const r=await this.$c(n);return new tb(JSON.parse(r),e.length+n)}Oc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async kc(){for(;this.Oc()<0&&!await this.Fc(););if(0===this.buffer.length)return null;const e=this.Oc();e<0&&this.Mc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $c(e){for(;this.buffer.length<e;)await this.Fc()&&this.Mc("Reached the end of bundle when more is expected.");const t=this.xc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Fc(){const e=await this.Cc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class $b{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new kh(Sh.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Ch(e),r=vg(n.serializer)+"/documents",i={documents:t.map((e=>pg(n.serializer,e)))},s=await n.vo("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Eh(!!t.found),t.found.name,t.found.updateTime;const n=mg(e,t.found.name),r=hg(t.found.updateTime),i=t.found.createTime?hg(t.found.createTime):zh.min(),s=new qf({mapValue:{fields:t.found.fields}});return zf.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){Eh(!!t.missing),Eh(!!t.readTime);const n=mg(e,t.missing),r=hg(t.readTime);return zf.newNoDocument(n,r)}(e,t):Th()}(n.serializer,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Eh(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Dm(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=Wh.fromPath(t);this.mutations.push(new xm(n,this.precondition(n)))})),await async function(e,t){const n=Ch(e),r=vg(n.serializer)+"/documents",i={writes:t.map((e=>_g(n.serializer,e)))};await n.Io("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Th();t=zh.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new kh(Sh.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(zh.min())?ym.exists(!1):ym.updateTime(t):ym.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(zh.min()))throw new kh(Sh.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ym.updateTime(t)}return ym.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Hb{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Bc=n.maxAttempts,this.qo=new aw(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No((async()=>{const e=new $b(this.datastore),t=this.qc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Uc(e)}))))})).catch((e=>{this.Uc(e)}))}))}qc(e){try{const t=this.updateFunction(e);return!bd(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Lc(),Promise.resolve())))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Vm(t)}return!1}}class Wb{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=mh.UNAUTHENTICATED,this.clientId=Vh.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{wh("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(wh("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new kh(Sh.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ah;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=zw(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Qb(e,t){e.asyncQueue.verifyOperationInProgress(),wh("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Nv(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Yb(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Xb(e);wh("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Vw(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Vw(t.remoteStore,n))),e._onlineComponents=t}function Jb(e){return"FirebaseError"===e.name?e.code===Sh.FAILED_PRECONDITION||e.code===Sh.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function Xb(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){wh("FirestoreClient","Using user provided OfflineComponentProvider");try{await Qb(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!Jb(n))throw n;Ih("Error using user provided cache. Falling back to memory cache: "+n),await Qb(e,new Ub)}}else wh("FirestoreClient","Using default OfflineComponentProvider"),await Qb(e,new Ub);return e._offlineComponents}async function Zb(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(wh("FirestoreClient","Using user provided OnlineComponentProvider"),await Yb(e,e._uninitializedComponentsProvider._online)):(wh("FirestoreClient","Using default OnlineComponentProvider"),await Yb(e,new jb))),e._onlineComponents}function eI(e){return Xb(e).then((e=>e.persistence))}function tI(e){return Xb(e).then((e=>e.localStore))}function nI(e){return Zb(e).then((e=>e.remoteStore))}function rI(e){return Zb(e).then((e=>e.syncEngine))}function iI(e){return Zb(e).then((e=>e.datastore))}async function sI(e){const t=await Zb(e),n=t.eventManager;return n.onListen=hb.bind(null,t.syncEngine),n.onUnlisten=fb.bind(null,t.syncEngine),n}function oI(e,t,n={}){const r=new Ah;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Gb({next:s=>{t.enqueueAndForget((()=>Yw(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new kh(Sh.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new kh(Sh.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new eb(Ep(n.path),s,{includeMetadataChanges:!0,Ku:!0});return Qw(e,o)}(await sI(e),e.asyncQueue,t,n,r))),r.promise}function aI(e,t,n={}){const r=new Ah;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Gb({next:n=>{t.enqueueAndForget((()=>Yw(e,o))),n.fromCache&&"server"===r.source?i.reject(new kh(Sh.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new eb(n,s,{includeMetadataChanges:!0,Ku:!0});return Qw(e,o)}(await sI(e),e.asyncQueue,t,n,r))),r.promise}function cI(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?jm().encode(e):e,function(e,t){return new Kb(e,t)}(function(e,t){if(e instanceof Uint8Array)return zb(e,t);if(e instanceof ArrayBuffer)return zb(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,ow(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Ch(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Ch(e),r=hg(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.qs.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(ib(r));const i=new rb(r,e.localStore,t.serializer);let s=await t.bc();for(;s;){const e=await i.zu(s);e&&n._updateProgress(e),s=await t.bc()}const o=await i.complete();return await Sb(e,o.Ju,void 0),await function(e,t){const n=Ch(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.qs.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Hu)}catch(e){return Ih("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await rI(e),i,r)}))}function uI(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const lI=new Map;function hI(e,t,n){if(!n)throw new kh(Sh.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function dI(e,t,n,r){if(!0===t&&!0===r)throw new kh(Sh.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function fI(e){if(!Wh.isDocumentKey(e))throw new kh(Sh.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function pI(e){if(Wh.isDocumentKey(e))throw new kh(Sh.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function mI(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Th()}function gI(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new kh(Sh.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=mI(e);throw new kh(Sh.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function yI(e,t){if(t<=0)throw new kh(Sh.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class vI{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new kh(Sh.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new kh(Sh.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uI(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new kh(Sh.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new kh(Sh.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new kh(Sh.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class wI{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vI({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new kh(Sh.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new kh(Sh.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vI(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Dh;switch(e.type){case"firstParty":return new Oh(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new kh(Sh.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=lI.get(e);t&&(wh("ComponentProvider","Removing Datastore"),lI.delete(e),t.terminate())}(this),Promise.resolve()}}function bI(e,t,n,r={}){var i;const s=(e=gI(e,wI))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ih("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=mh.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[ae(JSON.stringify({alg:"none",type:"JWT"})),ae(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new kh(Sh.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new mh(s)}e._authCredentials=new xh(new Nh(t,n))}}class II{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new TI(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new II(this.firestore,e,this._key)}}class _I{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new _I(this.firestore,e,this._query)}}class TI extends _I{constructor(e,t,n){super(e,t,Ep(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new II(this.firestore,null,new Wh(e))}withConverter(e){return new TI(this.firestore,e,this._path)}}function EI(e,t,...n){if(e=Re(e),hI("collection","path",t),e instanceof wI){const r=Kh.fromString(t,...n);return pI(r),new TI(e,null,r)}{if(!(e instanceof II||e instanceof TI))throw new kh(Sh.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Kh.fromString(t,...n));return pI(r),new TI(e.firestore,null,r)}}function CI(e,t,...n){if(e=Re(e),1===arguments.length&&(t=Vh.A()),hI("doc","path",t),e instanceof wI){const r=Kh.fromString(t,...n);return fI(r),new II(e,null,new Wh(r))}{if(!(e instanceof II||e instanceof TI))throw new kh(Sh.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Kh.fromString(t,...n));return fI(r),new II(e.firestore,e instanceof TI?e.converter:null,new Wh(r))}}function SI(e,t){return e=Re(e),t=Re(t),(e instanceof II||e instanceof TI)&&(t instanceof II||t instanceof TI)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function kI(e,t){return e=Re(e),t=Re(t),e instanceof _I&&t instanceof _I&&e.firestore===t.firestore&&Pp(e._query,t._query)&&e.converter===t.converter}class AI{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new aw(this,"async_queue_retry"),this.Xc=()=>{const e=sw();e&&wh("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=sw();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=sw();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new Ah;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!dd(e))throw e;wh("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw bh("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=jw.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(r),r}Zc(){this.Wc&&Th()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function NI(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class DI{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ah,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class xI extends wI{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new AI,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||PI(this),this._firestoreClient.terminate()}}function RI(e){return e._firestoreClient||PI(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function PI(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new vf(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,uI(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Wb(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function OI(e,t,n){const r=new Ah;return e.asyncQueue.enqueue((async()=>{try{await Qb(e,n),await Yb(e,t),r.resolve()}catch(e){const t=e;if(!Jb(t))throw t;Ih("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function LI(e){return function(e){const t=new Ah;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Ch(e);_w(n.remoteStore)||wh("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Ch(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Ec.get(e)||[];r.push(t),n.Ec.set(e,r)}catch(e){const n=zw(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await rI(e),t))),t.promise}(RI(e=gI(e,xI)))}function MI(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await eI(e),n=await nI(e);return t.setNetworkEnabled(!0),function(e){const t=Ch(e);return t.vu.delete(0),pw(t)}(n)}))}(RI(e=gI(e,xI)))}function FI(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await eI(e),n=await nI(e);return t.setNetworkEnabled(!1),async function(e){const t=Ch(e);t.vu.add(0),await mw(t),t.bu.set("Offline")}(n)}))}(RI(e=gI(e,xI)))}function VI(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Ch(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.qs.getNamedQuery(e,t)))}(await tI(e),t)))}(RI(e=gI(e,xI)),t).then((t=>t?new _I(e,null,t.query):null))}function UI(e){if(e._initialized||e._terminated)throw new kh(Sh.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class BI{constructor(e){this._byteString=e}static fromBase64String(e){try{return new BI(lf.fromBase64String(e))}catch(e){throw new kh(Sh.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new BI(lf.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class qI{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new kh(Sh.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Hh(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class jI{constructor(e){this._methodName=e}}class zI{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new kh(Sh.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new kh(Sh.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Uh(this._lat,e._lat)||Uh(this._long,e._long)}}const GI=/^__.*__$/;class KI{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Sm(e,this.data,this.fieldMask,t,this.fieldTransforms):new Cm(e,this.data,t,this.fieldTransforms)}}class $I{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Sm(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function HI(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Th()}}class WI{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new WI(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return p_(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(HI(this.ca)&&GI.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class QI{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ow(e)}ya(e,t,n,r=!1){return new WI({ca:e,methodName:t,ga:n,path:Hh.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function YI(e){const t=e._freezeSettings(),n=ow(e._databaseId);return new QI(e._databaseId,!!t.ignoreUndefinedProperties,n)}function JI(e,t,n,r,i,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,i);l_("Data must be an object, but it was:",o,r);const a=c_(r,o);let c,u;if(s.merge)c=new cf(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=h_(t,r,n);if(!o.contains(i))throw new kh(Sh.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);m_(e,i)||e.push(i)}c=new cf(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new KI(new qf(a),c,u)}class XI extends jI{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof XI}}function ZI(e,t,n){return new WI({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class e_ extends jI{_toFieldTransform(e){return new mm(e.path,new am)}isEqual(e){return e instanceof e_}}class t_ extends jI{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=ZI(this,e,!0),n=this.pa.map((e=>a_(e,t))),r=new cm(n);return new mm(e.path,r)}isEqual(e){return this===e}}class n_ extends jI{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=ZI(this,e,!0),n=this.pa.map((e=>a_(e,t))),r=new lm(n);return new mm(e.path,r)}isEqual(e){return this===e}}class r_ extends jI{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new dm(e.serializer,nm(e.serializer,this.Ia));return new mm(e.path,t)}isEqual(e){return this===e}}function i_(e,t,n,r){const i=e.ya(1,t,n);l_("Data must be an object, but it was:",i,r);const s=[],o=qf.empty();Zd(r,((e,r)=>{const a=f_(t,e,n);r=Re(r);const c=i.da(a);if(r instanceof XI)s.push(a);else{const e=a_(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new cf(s);return new $I(o,a,i.fieldTransforms)}function s_(e,t,n,r,i,s){const o=e.ya(1,t,n),a=[h_(t,r,n)],c=[i];if(s.length%2!=0)throw new kh(Sh.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(h_(t,s[e])),c.push(s[e+1]);const u=[],l=qf.empty();for(let e=a.length-1;e>=0;--e)if(!m_(u,a[e])){const t=a[e];let n=c[e];n=Re(n);const r=o.da(t);if(n instanceof XI)u.push(t);else{const e=a_(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new cf(u);return new $I(l,h,o.fieldTransforms)}function o_(e,t,n,r=!1){return a_(n,e.ya(r?4:3,t))}function a_(e,t){if(u_(e=Re(e)))return l_("Unsupported field value:",t,e),c_(e,t);if(e instanceof jI)return function(e,t){if(!HI(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=a_(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Re(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return nm(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=jh.fromDate(e);return{timestampValue:cg(t.serializer,n)}}if(e instanceof jh){const n=new jh(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:cg(t.serializer,n)}}if(e instanceof zI)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof BI)return{bytesValue:ug(t.serializer,e._byteString)};if(e instanceof II){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:dg(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${mI(e)}`)}(e,t)}function c_(e,t){const n={};return ef(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Zd(e,((e,r)=>{const i=a_(r,t.ha(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function u_(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof jh||e instanceof zI||e instanceof BI||e instanceof II||e instanceof jI)}function l_(e,t,n){if(!u_(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=mI(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function h_(e,t,n){if((t=Re(t))instanceof qI)return t._internalPath;if("string"==typeof t)return f_(e,t);throw p_("Field path arguments must be of type string or ",e,!1,void 0,n)}const d_=new RegExp("[~\\*/\\[\\]]");function f_(e,t,n){if(t.search(d_)>=0)throw p_(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new qI(...t.split("."))._internalPath}catch(r){throw p_(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function p_(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new kh(Sh.INVALID_ARGUMENT,a+e+c)}function m_(e,t){return e.some((e=>e.isEqual(t)))}class g_{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new II(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new y_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(v_("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class y_ extends g_{data(){return super.data()}}function v_(e,t){return"string"==typeof t?f_(e,t):t instanceof qI?t._internalPath:t._delegate._internalPath}function w_(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new kh(Sh.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class b_{}class I_ extends b_{}function __(e,t,...n){let r=[];t instanceof b_&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof E_)).length,n=e.filter((e=>e instanceof T_)).length;if(t>1||t>0&&n>0)throw new kh(Sh.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class T_ extends I_{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new T_(e,t,n)}_apply(e){const t=this._parse(e);return R_(e._query,t),new _I(e.firestore,e.converter,xp(e._query,t))}_parse(e){const t=YI(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new kh(Sh.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){x_(o,s);const t=[];for(const n of o)t.push(D_(r,e,n));a={arrayValue:{values:t}}}else a=D_(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||x_(o,s),a=o_(n,"where",o,"in"===s||"not-in"===s);return Yf.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class E_ extends b_{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new E_(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Jf.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)R_(n,e),n=xp(n,e)}(e._query,t),new _I(e.firestore,e.converter,xp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class C_ extends I_{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new C_(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new kh(Sh.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new kh(Sh.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Hf(t,n);return function(e,t){if(null===Sp(e)){const n=kp(e);null!==n&&P_(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new _I(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new _p(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class S_ extends I_{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new S_(e,t,n)}_apply(e){return new _I(e.firestore,e.converter,Rp(e._query,this._limit,this._limitType))}}class k_ extends I_{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new k_(e,t,n)}_apply(e){const t=N_(e,this.type,this._docOrFields,this._inclusive);return new _I(e.firestore,e.converter,function(e,t){return new _p(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class A_ extends I_{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new A_(e,t,n)}_apply(e){const t=N_(e,this.type,this._docOrFields,this._inclusive);return new _I(e.firestore,e.converter,function(e,t){return new _p(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function N_(e,t,n,r){if(n[0]=Re(n[0]),n[0]instanceof g_)return function(e,t,n,r,i){if(!r)throw new kh(Sh.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Np(e))if(n.field.isKeyField())s.push(Nf(t,r.key));else{const e=r.data.field(n.field);if(mf(e))throw new kh(Sh.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Gf(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=YI(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new kh(Sh.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Ap(e)&&-1!==c.indexOf("/"))throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(Kh.fromString(c));if(!Wh.isDocumentKey(n))throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Wh(n);a.push(Nf(t,i))}else{const e=o_(n,r,c);a.push(e)}}return new Gf(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function D_(e,t,n){if("string"==typeof(n=Re(n))){if(""===n)throw new kh(Sh.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ap(t)&&-1!==n.indexOf("/"))throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Kh.fromString(n));if(!Wh.isDocumentKey(r))throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Nf(e,new Wh(r))}if(n instanceof II)return Nf(e,n._key);throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mI(n)}.`)}function x_(e,t){if(!Array.isArray(e)||0===e.length)throw new kh(Sh.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function R_(e,t){if(t.isInequality()){const n=kp(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=Sp(e);null!==i&&P_(e,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new kh(Sh.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new kh(Sh.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function P_(e,t,n){if(!n.isEqual(t))throw new kh(Sh.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class O_{convertValue(e,t="none"){switch(_f(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ff(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pf(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Th()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Zd(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new zI(ff(e.latitude),ff(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=gf(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(yf(e));default:return null}}convertTimestamp(e){const t=df(e);return new jh(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Kh.fromString(e);Eh(Lg(n));const r=new wf(n.get(1),n.get(3)),i=new Wh(n.popFirst(5));return r.isEqual(t)||bh(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function L_(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class M_ extends O_{constructor(e){super(),this.firestore=e}convertBytes(e){return new BI(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new II(this.firestore,null,t)}}class F_{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class V_ extends g_{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new U_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(v_("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class U_ extends V_{data(e={}){return super.data(e)}}class B_{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new F_(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new U_(this._firestore,this._userDataWriter,n.key,n,new F_(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new kh(Sh.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new U_(e._firestore,e._userDataWriter,n.doc.key,n.doc,new F_(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new U_(e._firestore,e._userDataWriter,t.doc.key,t.doc,new F_(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:q_(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function q_(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Th()}}function j_(e,t){return e instanceof V_&&t instanceof V_?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof B_&&t instanceof B_&&e._firestore===t._firestore&&kI(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class z_ extends O_{constructor(e){super(),this.firestore=e}convertBytes(e){return new BI(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new II(this.firestore,null,t)}}function G_(e){e=gI(e,II);const t=gI(e.firestore,xI),n=RI(t),r=new z_(t);return function(e,t){const n=new Ah;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Ch(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new kh(Sh.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=zw(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await tI(e),t,n))),n.promise}(n,e._key).then((n=>new V_(t,r,e._key,n,new F_(null!==n&&n.hasLocalMutations,!0),e.converter)))}function K_(e){e=gI(e,_I);const t=gI(e.firestore,xI),n=RI(t),r=new z_(t);return function(e,t){const n=new Ah;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Lv(e,t,!0),i=new ab(t,r.ir),s=i.sc(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=zw(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await tI(e),t,n))),n.promise}(n,e._query).then((n=>new B_(t,r,e,n)))}function $_(e,t,n){e=gI(e,II);const r=gI(e.firestore,xI),i=L_(e.converter,t,n);return Y_(r,[JI(YI(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,ym.none())])}function H_(e,t,n,...r){e=gI(e,II);const i=gI(e.firestore,xI),s=YI(i);let o;return o="string"==typeof(t=Re(t))||t instanceof qI?s_(s,"updateDoc",e._key,t,n,r):i_(s,"updateDoc",e._key,t),Y_(i,[o.toMutation(e._key,ym.exists(!0))])}function W_(e,...t){var n,r,i;e=Re(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||NI(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(NI(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof II)u=gI(e.firestore,xI),l=Ep(e._key.path),c={next:n=>{t[o]&&t[o](J_(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=gI(e,_I);u=gI(n.firestore,xI),l=n._query;const r=new z_(u);c={next:e=>{t[o]&&t[o](new B_(u,r,n,e))},error:t[o+1],complete:t[o+2]},w_(e._query)}return function(e,t,n,r){const i=new Gb(r),s=new eb(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Qw(await sI(e),s))),()=>{i.Dc(),e.asyncQueue.enqueueAndForget((async()=>Yw(await sI(e),s)))}}(RI(u),l,a,c)}function Q_(e,t){return function(e,t){const n=new Gb(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Ch(e).ku.add(t),t.next()}(await sI(e),n))),()=>{n.Dc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Ch(e).ku.delete(t)}(await sI(e),n)))}}(RI(e=gI(e,xI)),NI(t)?t:{next:t})}function Y_(e,t){return function(e,t){const n=new Ah;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Vb(e);try{const e=await function(e,t){const n=Ch(e),r=jh.now(),i=t.reduce(((e,t)=>e.add(t.key)),Jp());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=jp(),c=Jp();return n.Zi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Tm(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Sm(e.key,t,jf(t.value.mapValue),ym.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Kp(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Tc[e.currentUser.toKey()];r||(r=new tf(Uh)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(r,e.batchId,n),await Sb(r,e.changes),await Nw(r.remoteStore)}catch(e){const t=zw(e,"Failed to persist write");n.reject(t)}}(await rI(e),t,n))),n.promise}(RI(e),t)}function J_(e,t,n){const r=n.docs.get(t._key),i=new z_(e);return new V_(e,i,t._key,r,new F_(n.hasPendingWrites,n.fromCache),t.converter)}const X_={maxAttempts:5};class Z_{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=YI(e)}set(e,t,n){this._verifyNotCommitted();const r=eT(e,this._firestore),i=L_(r.converter,t,n),s=JI(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,ym.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=eT(e,this._firestore);let s;return s="string"==typeof(t=Re(t))||t instanceof qI?s_(this._dataReader,"WriteBatch.update",i._key,t,n,r):i_(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,ym.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=eT(e,this._firestore);return this._mutations=this._mutations.concat(new Dm(t._key,ym.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new kh(Sh.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function eT(e,t){if((e=Re(e)).firestore!==t)throw new kh(Sh.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class tT extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=YI(e)}get(e){const t=eT(e,this._firestore),n=new M_(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Th();const r=e[0];if(r.isFoundDocument())return new g_(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new g_(this._firestore,n,t._key,null,t.converter);throw Th()}))}set(e,t,n){const r=eT(e,this._firestore),i=L_(r.converter,t,n),s=JI(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=eT(e,this._firestore);let s;return s="string"==typeof(t=Re(t))||t instanceof qI?s_(this._dataReader,"Transaction.update",i._key,t,n,r):i_(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=eT(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=eT(e,this._firestore),n=new z_(this._firestore);return super.get(e).then((e=>new V_(this._firestore,n,t._key,e._document,new F_(!1,!1),t.converter)))}}!function(e,t=!0){!function(e){gh=e}(Tt),yt(new Pe("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new xI(new Rh(e.getProvider("auth-internal")),new Mh(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new kh(Sh.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wf(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),At(ph,"3.12.2",e),At(ph,"3.12.2","esm2017")}();function nT(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new kh("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function rT(){if("undefined"==typeof Uint8Array)throw new kh("unimplemented","Uint8Arrays are not available in this environment.")}function iT(){if("undefined"==typeof atob)throw new kh("unimplemented","Blobs are unavailable in Firestore in this environment.")}class sT{constructor(e){this._delegate=e}static fromBase64String(e){return iT(),new sT(BI.fromBase64String(e))}static fromUint8Array(e){return rT(),new sT(BI.fromUint8Array(e))}toBase64(){return iT(),this._delegate.toBase64()}toUint8Array(){return rT(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function oT(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class aT{enableIndexedDbPersistence(e,t){return function(e,t){UI(e=gI(e,xI));const n=RI(e);if(n._uninitializedComponentsProvider)throw new kh(Sh.FAILED_PRECONDITION,"SDK cache is already specified.");Ih("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new jb;return OI(n,i,new Bb(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){UI(e=gI(e,xI));const t=RI(e);if(t._uninitializedComponentsProvider)throw new kh(Sh.FAILED_PRECONDITION,"SDK cache is already specified.");Ih("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new jb;return OI(t,r,new qb(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new kh(Sh.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Ah;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!ud.D())return Promise.resolve();const t=e+"main";await ud.delete(t)}(Ev(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class cT{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof wf||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Ih("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){bI(this._delegate,e,t,n)}enableNetwork(){return MI(this._delegate)}disableNetwork(){return FI(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,dI("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return LI(this._delegate)}onSnapshotsInSync(e){return Q_(this._delegate,e)}get app(){if(!this._appCompat)throw new kh("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new _T(this,EI(this._delegate,e))}catch(e){throw pT(e,"collection()","Firestore.collection()")}}doc(e){try{return new fT(this,CI(this._delegate,e))}catch(e){throw pT(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new wT(this,function(e,t){if(e=gI(e,wI),hI("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new kh(Sh.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new _I(e,null,function(e){return new _p(Kh.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw pT(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=gI(e,xI);const r=Object.assign(Object.assign({},X_),n);return function(e){if(e.maxAttempts<1)throw new kh(Sh.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Ah;return e.asyncQueue.enqueueAndForget((async()=>{const i=await iI(e);new Hb(e.asyncQueue,i,n,t,r).run()})),r.promise}(RI(e),(n=>t(new tT(e,n))),r)}(this._delegate,(t=>e(new lT(this,t))))}batch(){return RI(this._delegate),new hT(new Z_(this._delegate,(e=>Y_(this._delegate,e))))}loadBundle(e){return function(e,t){const n=RI(e=gI(e,xI)),r=new DI;return cI(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return VI(this._delegate,e).then((e=>e?new wT(this,e):null))}}class uT extends O_{constructor(e){super(),this.firestore=e}convertBytes(e){return new sT(new BI(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return fT.forKey(t,this.firestore,null)}}class lT{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new uT(e)}get(e){const t=TT(e);return this._delegate.get(t).then((e=>new yT(this._firestore,new V_(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=TT(e);return n?(nT("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=TT(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=TT(e);return this._delegate.delete(t),this}}class hT{constructor(e){this._delegate=e}set(e,t,n){const r=TT(e);return n?(nT("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=TT(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=TT(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class dT{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new U_(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new vT(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=dT.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new dT(e,new uT(e),t),r.set(t,i)),i}}dT.INSTANCES=new WeakMap;class fT{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new uT(e)}static forPath(e,t,n){if(e.length%2!=0)throw new kh("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new fT(t,new II(t._delegate,n,new Wh(e)))}static forKey(e,t,n){return new fT(t,new II(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new _T(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _T(this.firestore,EI(this._delegate,e))}catch(e){throw pT(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Re(e))instanceof II&&SI(this._delegate,e)}set(e,t){t=nT("DocumentReference.set",t);try{return t?$_(this._delegate,e,t):$_(this._delegate,e)}catch(e){throw pT(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?H_(this._delegate,e):H_(this._delegate,e,t,...n)}catch(e){throw pT(e,"updateDoc()","DocumentReference.update()")}}delete(){return Y_(gI((e=this._delegate).firestore,xI),[new Dm(e._key,ym.none())]);var e}onSnapshot(...e){const t=mT(e),n=gT(e,(e=>new yT(this.firestore,new V_(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return W_(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?G_(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=gI(e,II);const t=gI(e.firestore,xI);return oI(RI(t),e._key,{source:"server"}).then((n=>J_(t,e,n)))}(this._delegate):function(e){e=gI(e,II);const t=gI(e.firestore,xI);return oI(RI(t),e._key).then((n=>J_(t,e,n)))}(this._delegate),t.then((e=>new yT(this.firestore,new V_(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new fT(this.firestore,e?this._delegate.withConverter(dT.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function pT(e,t,n){return e.message=e.message.replace(t,n),e}function mT(e){for(const t of e)if("object"==typeof t&&!oT(t))return t;return{}}function gT(e,t){var n,r;let i;return i=oT(e[0])?e[0]:oT(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class yT{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new fT(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return j_(this._delegate,e._delegate)}}class vT extends yT{data(e){const t=this._delegate.data(e);return void 0!==t||Th(),t}}class wT{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new uT(e)}where(e,t,n){try{return new wT(this.firestore,__(this._delegate,function(e,t,n){const r=t,i=v_("where",e);return T_._create(i,r,n)}(e,t,n)))}catch(e){throw pT(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new wT(this.firestore,__(this._delegate,function(e,t="asc"){const n=t,r=v_("orderBy",e);return C_._create(r,n)}(e,t)))}catch(e){throw pT(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new wT(this.firestore,__(this._delegate,(yI("limit",t=e),S_._create("limit",t,"F"))))}catch(e){throw pT(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new wT(this.firestore,__(this._delegate,(yI("limitToLast",t=e),S_._create("limitToLast",t,"L"))))}catch(e){throw pT(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new wT(this.firestore,__(this._delegate,function(...e){return k_._create("startAt",e,!0)}(...e)))}catch(e){throw pT(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new wT(this.firestore,__(this._delegate,function(...e){return k_._create("startAfter",e,!1)}(...e)))}catch(e){throw pT(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new wT(this.firestore,__(this._delegate,function(...e){return A_._create("endBefore",e,!1)}(...e)))}catch(e){throw pT(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new wT(this.firestore,__(this._delegate,function(...e){return A_._create("endAt",e,!0)}(...e)))}catch(e){throw pT(e,"endAt()","Query.endAt()")}}isEqual(e){return kI(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?K_(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=gI(e,_I);const t=gI(e.firestore,xI),n=RI(t),r=new z_(t);return aI(n,e._query,{source:"server"}).then((n=>new B_(t,r,e,n)))}(this._delegate):function(e){e=gI(e,_I);const t=gI(e.firestore,xI),n=RI(t),r=new z_(t);return w_(e._query),aI(n,e._query).then((n=>new B_(t,r,e,n)))}(this._delegate),t.then((e=>new IT(this.firestore,new B_(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=mT(e),n=gT(e,(e=>new IT(this.firestore,new B_(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return W_(this._delegate,t,n)}withConverter(e){return new wT(this.firestore,e?this._delegate.withConverter(dT.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class bT{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new vT(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class IT{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new wT(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new vT(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new bT(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new vT(this._firestore,n))}))}isEqual(e){return j_(this._delegate,e._delegate)}}class _T extends wT{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new fT(this.firestore,e):null}doc(e){try{return new fT(this.firestore,void 0===e?CI(this._delegate):CI(this._delegate,e))}catch(e){throw pT(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=gI(e.firestore,xI),r=CI(e),i=L_(e.converter,t);return Y_(n,[JI(YI(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,ym.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new fT(this.firestore,e)))}isEqual(e){return SI(this._delegate,e._delegate)}withConverter(e){return new _T(this.firestore,e?this._delegate.withConverter(dT.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function TT(e){return gI(e,II)}class ET{constructor(...e){this._delegate=new qI(...e)}static documentId(){return new ET(Hh.keyField().canonicalString())}isEqual(e){return(e=Re(e))instanceof qI&&this._delegate._internalPath.isEqual(e._internalPath)}}class CT{constructor(e){this._delegate=e}static serverTimestamp(){const e=new e_("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new CT(e)}static delete(){const e=new XI("deleteField");return e._methodName="FieldValue.delete",new CT(e)}static arrayUnion(...e){const t=function(...e){return new t_("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new CT(t)}static arrayRemove(...e){const t=function(...e){return new n_("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new CT(t)}static increment(e){const t=new r_("increment",e);return t._methodName="FieldValue.increment",new CT(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const ST={Firestore:cT,GeoPoint:zI,Timestamp:jh,Blob:sT,Transaction:lT,WriteBatch:hT,DocumentReference:fT,DocumentSnapshot:yT,Query:wT,QueryDocumentSnapshot:vT,QuerySnapshot:IT,CollectionReference:_T,FieldPath:ET,FieldValue:CT,setLogLevel:function(e){var t;t=e,yh.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new Pe("firestore-compat",(e=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},ST)))}(e,((e,t)=>new cT(e,t,new aT))),e.registerVersion("@firebase/firestore-compat","0.3.11")}(Ht);Boolean,Boolean;function kT(e){return kT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kT(e)}function AT(){AT=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var s=t&&t.prototype instanceof d?t:d,o=Object.create(s.prototype),a=new C(i||[]);return r(o,"_invoke",{value:I(e,n,a)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h={};function d(){}function f(){}function p(){}var m={};c(m,s,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(S([])));y&&y!==t&&n.call(y,s)&&(m=y);var v=p.prototype=d.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(r,s,o,a){var c=l(e[r],e,s);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==kT(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,o,a)}),(function(e){i("throw",e,o,a)})):t.resolve(h).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,a)}))}a(c.arg)}var s;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return s=s?s.then(r,r):r()}})}function I(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return k()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=_(o,n);if(a){if(a===h)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function _(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,r(v,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:f,configurable:!0}),f.displayName=c(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},w(b.prototype),c(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new b(u(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(v),c(v,a,"Generator"),c(v,s,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var a=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(a&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function NT(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}(0,i.iH)(),(0,ee.tv)();var DT=Ht.initializeApp({apiKey:"AIzaSyCFVvsn6dt0WsVQljltQiW-ed-NOLRN9J8",authDomain:"jmibrokers.com",projectId:"jmi-brokers",storageBucket:"jmibrokers.com",messagingSenderId:"698047998267",appId:"1:698047998267:web:3f68d50ce3c78ef29e2f1e",measurementId:"G-FTZC0TXY4K"}),xT=(DT.firestore(),DT.auth());const RT={data:function(){return{site_title:"JMI Brokers | Client Register",site_description:"JMI Brokers | Client Register",site_keywords:"JMI Brokers | Client Register",coderesult:"",_val:"",_attVal:"",firebaseConfig:{},title_list:[{text:"Mr",value:"0"},{text:"Mrs",value:"1"},{text:"Miss",value:"2"}],captchaCode:null,isValid:!1}},mounted:function(){var e=this;this.render(),this.form.title=this.title_list[0].value,(0,J.u)({title:(0,i.Fl)((function(){return e.site_title})),meta:[{name:"description",content:(0,i.Fl)((function(){return e.site_description}))},{name:"keywords",content:(0,i.Fl)((function(){return e.site_keywords}))}]});var t=document.createElement("script");t.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"),t.async=!0,document.head.appendChild(t);var n=document.createElement("script");n.setAttribute("src","https://www.gstatic.com/firebasejs/6.0.2/firebase.js"),n.async=!0,document.head.appendChild(n),ne()("#capatcha-quest input").prop("required",!0),ne()("select#countryCode option").each((function(){this._val=ne()(this).val(),this._attVal=ne()(this).attr("data-countryCode"),ne()(this).text(this._attVal+"("+this._val+")")})),ne()((function(){var e=ne()("select#countryCode");e.html(e.find("option").sort((function(e,t){return ne()(e).text()>ne()(t).text()?1:-1})))}))},methods:{toggleEye:function(e){var t=document.getElementById(e),n=document.getElementById("open"),r=document.getElementById("close");"password"===t.type?(t.type="text",n.style.display="block",r.style.display="none"):(t.type="password",n.style.display="none",r.style.display="block")},codeverify:function(){var e=ne()("#verificationCode").val();this.coderesult.confirm(e).then((function(e){e.user;ne()("#SuccessVerify").text("Code Verified, you can register now."),ne()("#SuccessVerify").show(),ne()("#Success").hide(),ne()("#verify_code").prop("disabled",!0),ne()("#verificationCode").prop("readonly",!0),ne()("button#register").prop("disabled",!1)})).catch((function(e){ne()("#ErrorVerify").text(e.message),ne()("#ErrorVerify").show()}))},emailSendAuth:function(){var e=ne()("#email").val();ne().ajax({type:"get",url:"/api/sendverificationmailCode/"+e+"/",success:function(e){1==e?(ne()("#emailsentSuccess").text("Email Sent Successfully."),ne()("#emailsentSuccess").show(),ne()("#emailsuccessRegsiter").hide(),ne()("#emailverificationCode").show(),ne()("#email_verify_code").show(),ne()("#emailerror").hide()):0==e&&(ne()("#emailerror").text("Invalid Code"),ne()("#emailerror").show())},error:function(e){ne()("#emailerror").text("An error has occured"),ne()("#emailerror").show()}})},emailcodeverify:function(){var e=ne()("#emailverificationCode").val(),t=ne()("#email").val();ne().ajax({type:"get",url:"/api/verificationmailCode/"+t+"/"+e,success:function(e){1==e?(ne()("#emailsuccessRegsiter").text("Code Verified, you can resume now."),ne()("#emailsuccessRegsiter").show(),ne()("#emailsentSuccess").hide()):0==e&&(ne()("#emailerror").text("Invalid Code"),ne()("#emailerror").show())},error:function(e){ne()("#emailerror").text("An error has occured"),ne()("#emailerror").show()}})},render:function(){window.recaptchaVerifier=new Ht.auth.RecaptchaVerifier("recaptcha-container"),recaptchaVerifier.render()},phoneSendAuth:function(){var e=this,t="+"+ne()("#countryCode").val()+ne()("#number").val();xT.signInWithPhoneNumber(t,window.recaptchaVerifier).then((function(t){window.confirmationResult=t,e.coderesult=t,ne()("#SMSSuccess").text("Message Sent Successfully."),ne()("#SMSSuccess").show(),ne()("#successRegsiter").hide(),ne()("#number").prop("readonly",!0),ne()("#countryCode").prop("readonly",!0),ne()("#send_code").prop("disabled",!0),ne()("#verificationCode").show(),ne()("#verify_code").show(),ne()("#SMSError").hide()})).catch((function(e){ne()("#SMSError").text(e.message),ne()("#SMSError").show()}))}},setup:function(){var e=(0,i.iH)(),t=(0,ee.tv)(),n=(0,i.qj)({title:"",fullname:"",username:"",email:"",password:"",confirmpassword:"",phone_number:"",_token:"{{ csrf_token() }}"}),r=function(){var r=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){NT(s,r,i,o,a,"next",e)}function a(e){NT(s,r,i,o,a,"throw",e)}o(void 0)}))}}(AT().mark((function r(){var i;return AT().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Z().post("/api/user/signup",n);case 3:if(200!==(i=r.sent).status||1!=i.data){r.next=8;break}return localStorage.setItem("JMI_User",n.username),r.next=8,t.push("/en/cpanel/home");case 8:r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),r.t0.response&&401===r.t0.response.status?e.value=r.t0.response.data.errors.en||"":r.t0&&r.t0.response.data&&r.t0.response.data.errors?e.value=Object.values(r.t0.response.data.errors):e.value=r.t0.response.data.errors||"";case 13:case"end":return r.stop()}}),r,null,[[0,10]])})));return function(){return r.apply(this,arguments)}}();return{form:n,errors:e,handleSignup:r}},create:function(){}};var PT=n(3379),OT=n.n(PT),LT=n(6658),MT={insert:"head",singleton:!1};OT()(LT.Z,MT);LT.Z.locals;const FT=(0,n(3744).Z)(RT,[["render",function(e,t,n,r,J,X){return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",a,[(0,i._)("div",c,[u,(0,i._)("div",l,[(0,i._)("div",h,[d,"string"==typeof r.errors?((0,i.wg)(),(0,i.iD)("div",f,(0,i.zw)(r.errors),1)):(0,i.kq)("",!0),"object"===s(r.errors)?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:1},(0,i.Ko)(r.errors,(function(e,t){return(0,i.wg)(),(0,i.iD)("div",{class:"alert alert-danger",key:t},(0,i.zw)(r.errors[0]),1)})),128)):(0,i.kq)("",!0),(0,i._)("form",{id:"RegisterForm",method:"post",onSubmit:t[15]||(t[15]=(0,i.iM)((function(){return r.handleSignup&&r.handleSignup.apply(r,arguments)}),["prevent"])),class:"registration-form"},[p,(0,i._)("div",m,[(0,i._)("div",g,[(0,i._)("div",y,[(0,i.wy)((0,i._)("select",{class:"form-control",name:"title","onUpdate:modelValue":t[0]||(t[0]=function(e){return r.form.title=e}),id:"title"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(J.title_list,(function(e){return(0,i.wg)(),(0,i.iD)("option",{value:e.value},(0,i.zw)(e.text),9,v)})),256))],512),[[i.bM,r.form.title]])])]),(0,i._)("div",w,[(0,i._)("div",b,[(0,i.wy)((0,i._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=function(e){return r.form.fullname=e}),id:"fullname",name:"fullname",placeholder:"Full Name *",required:""},null,512),[[i.nr,r.form.fullname]])])])]),(0,i._)("div",I,[_,T,(0,i._)("div",E,[(0,i.wy)((0,i._)("input",{type:"email",name:"email",placeholder:"Email :","onUpdate:modelValue":t[2]||(t[2]=function(e){return r.form.email=e}),class:"form-email form-control",id:"email",required:""},null,512),[[i.nr,r.form.email]])]),(0,i._)("div",C,[(0,i._)("button",{type:"button",id:"email_send_code",class:"btn btn-success",onClick:t[3]||(t[3]=function(e){return X.emailSendAuth()})},"Send Code")])]),(0,i._)("div",S,[(0,i._)("div",k,[(0,i.wy)((0,i._)("input",{type:"number",id:"emailverificationCode","onUpdate:modelValue":t[4]||(t[4]=function(e){return r.form.emailverificationCode=e}),name:"emailverificationCode",class:"form-control",placeholder:"Enter Email verification code",style:{display:"none"},required:""},null,512),[[i.nr,r.form.emailverificationCode]])]),(0,i._)("div",A,[(0,i._)("button",{type:"button",id:"email_verify_code",class:"btn btn-success",onClick:t[5]||(t[5]=function(e){return X.emailcodeverify()}),style:{display:"none"}},"Verify code")]),N]),(0,i._)("div",D,[(0,i.wy)((0,i._)("input",{type:"text",name:"username","onUpdate:modelValue":t[6]||(t[6]=function(e){return r.form.username=e}),placeholder:"Username : No Spaces",class:"form-email form-control",id:"username",required:""},null,512),[[i.nr,r.form.username]])]),(0,i._)("div",x,[R,P,(0,i._)("div",O,[(0,i.wy)((0,i._)("select",{name:"countryCode",id:"countryCode","onUpdate:modelValue":t[7]||(t[7]=function(e){return r.form.countryCode=e}),class:"form-control",required:""},L,512),[[i.bM,r.form.countryCode]])]),(0,i._)("div",M,[(0,i.wy)((0,i._)("input",{type:"number",id:"number","onUpdate:modelValue":t[8]||(t[8]=function(e){return r.form.phone_number=e}),class:"form-control",name:"phone_number",placeholder:"Mobile Number",required:""},null,512),[[i.nr,r.form.phone_number]])]),(0,i._)("div",F,[(0,i._)("button",{type:"button",id:"send_code",class:"btn btn-success",onClick:t[9]||(t[9]=function(e){return X.phoneSendAuth()})},"Send Code")])]),(0,i._)("div",V,[U,(0,i._)("div",B,[(0,i._)("button",{type:"button",id:"verify_code",class:"btn btn-success",onClick:t[10]||(t[10]=function(e){X.codeverify()}),style:{display:"none"}},"Verify code")]),q,j]),(0,i._)("div",z,[(0,i._)("div",G,[(0,i._)("div",K,[(0,i.wy)((0,i._)("input",{id:"password",type:"password",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=function(e){return r.form.password=e}),placeholder:" Password *",name:"password",required:""},null,512),[[i.nr,r.form.password]]),(0,i._)("button",{class:"btnEye",onClick:t[12]||(t[12]=function(e){return X.toggleEye("password")}),type:"button"},$)])]),(0,i._)("div",H,[(0,i._)("div",W,[(0,i.wy)((0,i._)("input",{type:"password",class:"form-control",placeholder:"Confirm Password *","onUpdate:modelValue":t[13]||(t[13]=function(e){return r.form.confirmpassword=e}),id:"confirmpassword",name:"confirmpassword",required:""},null,512),[[i.nr,r.form.confirmpassword]]),(0,i._)("button",{class:"btnEye",onClick:t[14]||(t[14]=function(e){return X.toggleEye("confirmpassword")}),type:"button"},Q)])])]),Y],32)])])])])])}]])}}]);