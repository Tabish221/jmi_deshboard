/*! For license information please see 8961.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8961],{4444:(e,t,n)=>{n.d(t,{BH:()=>p,G6:()=>T,L:()=>a,LL:()=>k,Pz:()=>f,Sg:()=>m,UG:()=>v,ZB:()=>u,ZR:()=>S,aH:()=>d,b$:()=>_,eu:()=>C,hl:()=>E,jU:()=>w,m9:()=>U,ne:()=>M,pd:()=>L,r3:()=>N,ru:()=>b,tV:()=>c,uI:()=>y,vZ:()=>x,w1:()=>I,xO:()=>P,xb:()=>D,z$:()=>g,zd:()=>O});var r=n(4155);const i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==c)throw new o;const u=i<<2|s>>4;if(r.push(u),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},c=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=u(e[n],t[n]));return e}const l=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,h=()=>{try{return l()||(()=>{if(void 0===r||void 0===r.env)return;const e=r.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},d=()=>{var e;return null===(e=h())||void 0===e?void 0:e.config},f=e=>{var t;return null===(t=h())||void 0===t?void 0:t[`_${e}`]};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function m(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}function g(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())}function v(){var e;const t=null===(e=h())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function w(){return"object"==typeof self&&self.self===self}function b(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function I(){const e=g();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function T(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E(){try{return"object"==typeof indexedDB}catch(e){return!1}}function C(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(A,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new S(r,o,n)}}const A=/\{\$([^}]+)}/g;function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function D(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function x(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(R(n)&&R(s)){if(!x(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function R(e){return null!==e&&"object"==typeof e}function P(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function O(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function L(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function M(e,t){const n=new F(e,t);return n.subscribe.bind(n)}class F{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=V),void 0===r.error&&(r.error=V),void 0===r.complete&&(r.complete=V);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function V(){}function U(e){return e&&e._delegate?e._delegate:e}},9889:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"#newLogin{align-items:center;display:flex}#newLogin h2{color:#0059b2;font-family:Roboto-Bold;margin:0 10px}input:-webkit-autofill,input:-webkit-autofill:active,input:-webkit-autofill:focus,input:-webkit-autofill:hover{-webkit-box-shadow:inset 0 0 0 30px #fff!important}#capatcha-quest *{color:#777;font-weight:700}#email_send_code,#register,#send_code{background-color:#fdbe01!important;border:1px solid #bfbfbf!important;border-radius:4px;color:#fff!important;display:flex;padding:6px 10px!important;width:auto!important}#open,#open2{display:none}#close,#close2,#open,#open2{font-size:15px;padding-right:5px}.btnEye{background-color:#fff;border:none;border-radius:inherit;padding:0}.input-container{background-color:#fff;border:1px solid #bfbfbf;border-radius:4px;display:flex;margin-bottom:10px;max-width:270px!important}#confirmpassword,#password{border:none;margin-bottom:0!important;width:calc(100% - 19px)}.container{width:100%!important}@media only screen and (max-width:768px){div.col-sm-3.padding-left-0,div.col-sm-6.padding-left-0,div.col-sm-8{padding:0!important}.myFlex{display:flex;justify-content:center}div.form-group{margin-bottom:5px}.input-container{max-width:100%!important}#RegisterForm{width:100%}div.col-xs-12.text-left{padding:0}.container{max-width:390px}}@media only screen and (max-width:402px){#newLogin h2{font-size:25px}}",""]);const s=i},8961:(e,t,n)=>{n.r(t),n.d(t,{default:()=>pe});var r=n(821);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var s={class:"opendemoaccount openliveaccount",style:{"background-image":"url('/assets/img/demoaccountbg.jpg')"}},o={class:"container"},a={class:"row pdtb40"},c=(0,r._)("div",{id:"recaptcha-container"},null,-1),u={class:"myFlex"},l={class:"col-lg-4 col-md-5 col-sm-6 col-xs-12 col-xxs text-left"},h=(0,r._)("div",{id:"newLogin"},[(0,r._)("img",{src:"/assets/m/img/icon.png"}),(0,r._)("h2",null," Registration")],-1),d={key:0,class:"alert alert-danger"},f=(0,r._)("div",{id:"recaptcha-container"},null,-1),p={class:"control-group"},m={class:"col-sm-3 padding-left-0"},g={class:"controls"},y=["value"],v={class:"col-sm-9 padding-right-0"},w={class:"controls"},b={class:"form-group"},_=(0,r._)("div",{class:"alert alert-danger col-sm-12",id:"emailerror",style:{display:"none"}},null,-1),I=(0,r._)("div",{class:"alert alert-success col-sm-12",id:"emailsentSuccess",style:{display:"none"}},null,-1),T={class:"col-sm-8"},E={class:"col-sm-4"},C={class:"form-group"},S={class:"col-sm-8"},k={class:"col-sm-4"},A=(0,r._)("div",{class:"alert alert-success col-sm-12",id:"emailsuccessRegsiter",style:{display:"none"}},null,-1),N={class:"form-group"},D={class:"form-group"},x=(0,r._)("div",{class:"alert alert-danger col-sm-12",id:"SMSError",style:{display:"none"}},[(0,r._)("span")],-1),R=(0,r._)("div",{class:"alert alert-success col-sm-12",id:"SMSSuccess",style:{display:"none"}},[(0,r._)("span")],-1),P={class:"col-sm-3"},O=[(0,r.uE)('<option value="" id="myCode" disabled selected>Code</option><option data-countryCode="DZ" value="213">+213</option><option data-countryCode="AD" value="376"> +376</option><option data-countryCode="AO" value="244"> +244</option><option data-countryCode="AI" value="1264"> +1264</option><option data-countryCode="AG" value="1268">+1268</option><option data-countryCode="AR" value="54"> +54</option><option data-countryCode="AM" value="374"> +374</option><option data-countryCode="AW" value="297"> +297</option><option data-countryCode="AU" value="61"> +61</option><option data-countryCode="AT" value="43"> +43</option><option data-countryCode="AZ" value="994"> +994</option><option data-countryCode="BS" value="1242"> +1242</option><option data-countryCode="BH" value="973"> +973</option><option data-countryCode="BD" value="880"> +880</option><option data-countryCode="BB" value="1246"> +1246</option><option data-countryCode="BY" value="375"> +375</option><option data-countryCode="BE" value="32"> +32</option><option data-countryCode="BZ" value="501"> +501</option><option data-countryCode="BJ" value="229"> +229</option><option data-countryCode="BM" value="1441"> +1441</option><option data-countryCode="BT" value="975"> +975</option><option data-countryCode="BO" value="591"> +591</option><option data-countryCode="BA" value="387"> +387</option><option data-countryCode="BW" value="267"> +267</option><option data-countryCode="BR" value="55"> +55</option><option data-countryCode="BN" value="673"> +673</option><option data-countryCode="BG" value="359"> +359</option><option data-countryCode="BF" value="226"> Faso +226</option><option data-countryCode="BI" value="257"> +257</option><option data-countryCode="KH" value="855"> +855</option><option data-countryCode="CM" value="237"> +237</option><option data-countryCode="CA" value="1"> +1</option><option data-countryCode="CV" value="238"> +238</option><option data-countryCode="KY" value="1345"> +1345</option><option data-countryCode="CF" value="236"> +236</option><option data-countryCode="CL" value="56"> +56</option><option data-countryCode="CN" value="86"> +86</option><option data-countryCode="CO" value="57"> +57</option><option data-countryCode="KM" value="269"> +269</option><option data-countryCode="CG" value="242"> +242</option><option data-countryCode="CK" value="682"> +682</option><option data-countryCode="CR" value="506"> +506</option><option data-countryCode="HR" value="385"> +385</option><option data-countryCode="CU" value="53"> +53</option><option data-countryCode="CY" value="90392"> +90392</option><option data-countryCode="CY" value="357"> +357</option><option data-countryCode="CZ" value="42"> +42</option><option data-countryCode="DK" value="45"> +45</option><option data-countryCode="DJ" value="253"> +253</option><option data-countryCode="DM" value="1809"> +1809</option><option data-countryCode="DO" value="1809"> +1809</option><option data-countryCode="EC" value="593"> +593</option><option data-countryCode="EG" value="20"> +20</option><option data-countryCode="SV" value="503"> +503</option><option data-countryCode="GQ" value="240"> +240</option><option data-countryCode="ER" value="291"> +291</option><option data-countryCode="EE" value="372"> +372</option><option data-countryCode="PAK" value="92">+92</option><option data-countryCode="ET" value="251"> +251</option><option data-countryCode="FK" value="500"> +500</option><option data-countryCode="FO" value="298"> +298</option><option data-countryCode="FJ" value="679"> +679</option><option data-countryCode="FI" value="358"> +358</option><option data-countryCode="FR" value="33"> +33</option><option data-countryCode="GF" value="594"> +594</option><option data-countryCode="PF" value="689"> +689</option><option data-countryCode="GA" value="241"> +241</option><option data-countryCode="GM" value="220"> +220</option><option data-countryCode="GE" value="995"> +995</option><option data-countryCode="DE" value="49"> +49</option><option data-countryCode="GH" value="233"> +233</option><option data-countryCode="GI" value="350"> +350</option><option data-countryCode="GR" value="30"> +30</option><option data-countryCode="GL" value="299"> +299</option><option data-countryCode="GD" value="1473"> +1473</option><option data-countryCode="GP" value="590"> +590</option><option data-countryCode="GU" value="671"> +671</option><option data-countryCode="GT" value="502"> +502</option><option data-countryCode="GN" value="224"> +224</option><option data-countryCode="GW" value="245"> +245</option><option data-countryCode="GY" value="592"> +592</option><option data-countryCode="HT" value="509"> +509</option><option data-countryCode="HN" value="504"> +504</option><option data-countryCode="HK" value="852"> +852</option><option data-countryCode="HU" value="36"> +36</option><option data-countryCode="IS" value="354"> +354</option><option data-countryCode="IN" value="91"> +91</option><option data-countryCode="ID" value="62"> +62</option><option data-countryCode="IR" value="98"> +98</option><option data-countryCode="IQ" value="964"> +964</option><option data-countryCode="IE" value="353"> +353</option><option data-countryCode="IL" value="972"> +972</option><option data-countryCode="IT" value="39"> +39</option><option data-countryCode="JM" value="1876"> +1876</option><option data-countryCode="JP" value="81"> +81</option><option data-countryCode="JO" value="962"> +962</option><option data-countryCode="KZ" value="7"> +7</option><option data-countryCode="KE" value="254"> +254</option><option data-countryCode="KI" value="686"> +686</option><option data-countryCode="KP" value="850"> +850</option><option data-countryCode="KR" value="82"> +82</option><option data-countryCode="KW" value="965"> +965</option><option data-countryCode="KG" value="996"> +996</option><option data-countryCode="LA" value="856"> +856</option><option data-countryCode="LV" value="371"> +371</option><option data-countryCode="LB" value="961"> +961</option><option data-countryCode="LS" value="266"> +266</option><option data-countryCode="LR" value="231"> +231</option><option data-countryCode="LY" value="218"> +218</option><option data-countryCode="LI" value="417"> +417</option><option data-countryCode="LT" value="370"> +370</option><option data-countryCode="LU" value="352"> +352</option><option data-countryCode="MO" value="853"> +853</option><option data-countryCode="MK" value="389"> +389</option><option data-countryCode="MG" value="261"> +261</option><option data-countryCode="MW" value="265"> +265</option><option data-countryCode="MY" value="60"> +60</option><option data-countryCode="MV" value="960"> +960</option><option data-countryCode="ML" value="223"> +223</option><option data-countryCode="MT" value="356"> +356</option><option data-countryCode="MH" value="692"> +692</option><option data-countryCode="MQ" value="596"> +596</option><option data-countryCode="MR" value="222"> +222</option><option data-countryCode="YT" value="269"> +269</option><option data-countryCode="MX" value="52"> +52</option><option data-countryCode="FM" value="691"> +691</option><option data-countryCode="MD" value="373"> +373</option><option data-countryCode="MC" value="377"> +377</option><option data-countryCode="MN" value="976"> +976</option><option data-countryCode="MS" value="1664"> +1664</option><option data-countryCode="MA" value="212"> +212</option><option data-countryCode="MZ" value="258"> +258</option><option data-countryCode="MN" value="95"> +95</option><option data-countryCode="NA" value="264"> +264</option><option data-countryCode="NR" value="674"> +674</option><option data-countryCode="NP" value="977"> +977</option><option data-countryCode="NL" value="31"> +31</option><option data-countryCode="NC" value="687"> +687</option><option data-countryCode="NZ" value="64"> +64</option><option data-countryCode="NI" value="505"> +505</option><option data-countryCode="NE" value="227"> +227</option><option data-countryCode="NG" value="234"> +234</option><option data-countryCode="NU" value="683"> +683</option><option data-countryCode="NF" value="672"> +672</option><option data-countryCode="NP" value="670"> +670</option><option data-countryCode="NO" value="47"> +47</option><option data-countryCode="OM" value="968"> +968</option><option data-countryCode="PW" value="680"> +680</option><option data-countryCode="PA" value="507"> +507</option><option data-countryCode="PG" value="675"> +675</option><option data-countryCode="PY" value="595"> +595</option><option data-countryCode="PE" value="51"> +51</option><option data-countryCode="PH" value="63"> +63</option><option data-countryCode="PL" value="48"> +48</option><option data-countryCode="PT" value="351"> +351</option><option data-countryCode="PR" value="1787"> +1787</option><option data-countryCode="QA" value="974"> +974</option><option data-countryCode="RE" value="262"> +262</option><option data-countryCode="RO" value="40"> +40</option><option data-countryCode="RU" value="7"> +7</option><option data-countryCode="RW" value="250"> +250</option><option data-countryCode="SM" value="378"> +378</option><option data-countryCode="ST" value="239"> +239</option><option data-countryCode="SA" value="966"> +966</option><option data-countryCode="SN" value="221"> +221</option><option data-countryCode="CS" value="381"> +381</option><option data-countryCode="SC" value="248"> +248</option><option data-countryCode="SL" value="232"> +232</option><option data-countryCode="SG" value="65"> +65</option><option data-countryCode="SK" value="421"> +421</option><option data-countryCode="SI" value="386"> +386</option><option data-countryCode="SB" value="677"> +677</option><option data-countryCode="SO" value="252"> +252</option><option data-countryCode="ZA" value="27"> +27</option><option data-countryCode="ES" value="34"> +34</option><option data-countryCode="LK" value="94"> +94</option><option data-countryCode="SH" value="290"> +290</option><option data-countryCode="KN" value="1869">+1869</option><option data-countryCode="SC" value="1758"> +1758</option><option data-countryCode="SD" value="249"> +249</option><option data-countryCode="SR" value="597"> +597</option><option data-countryCode="SZ" value="268"> +268</option><option data-countryCode="SE" value="46"> +46</option><option data-countryCode="CH" value="41"> +41</option><option data-countryCode="SI" value="963"> +963</option><option data-countryCode="TW" value="886"> +886</option><option data-countryCode="TJ" value="7"> +7</option><option data-countryCode="TH" value="66"> +66</option><option data-countryCode="TG" value="228"> +228</option><option data-countryCode="TO" value="676"> +676</option><option data-countryCode="TT" value="1868"> +1868</option><option data-countryCode="TN" value="216"> +216</option><option data-countryCode="TR" value="90"> +90</option><option data-countryCode="TM" value="993"> +993</option><option data-countryCode="TC" value="1649"> +1649</option><option data-countryCode="TV" value="688"> +688</option><option data-countryCode="UG" value="256"> +256</option><option data-countryCode="GB" value="44">+44</option><option data-countryCode="UA" value="380"> +380</option><option data-countryCode="AE" value="971">+971</option><option data-countryCode="UY" value="598"> +598</option><option data-countryCode="US" value="1"> +1</option><option data-countryCode="UZ" value="7"> +7</option><option data-countryCode="VU" value="678"> +678</option><option data-countryCode="VA" value="379"> +379</option><option data-countryCode="VE" value="58"> +58</option><option data-countryCode="VN" value="84"> +84</option><option data-countryCode="VG" value="84"> +1284</option><option data-countryCode="VI" value="84"> +1340</option><option data-countryCode="WF" value="681"> +681</option><option data-countryCode="YE" value="969">+969</option><option data-countryCode="YE" value="967">+967</option><option data-countryCode="ZM" value="260">+260</option><option data-countryCode="ZW" value="263"> +263</option>',215)],L={class:"col-sm-5"},M={class:"col-sm-4"},F={class:"form-group"},V=(0,r._)("div",{class:"col-sm-8"},[(0,r._)("input",{type:"number",id:"verificationCode",class:"form-control",placeholder:"Enter verification code",style:{display:"none"},required:""})],-1),U={class:"col-sm-4"},B=(0,r._)("div",{class:"alert alert-success col-sm-12",id:"SuccessVerify",style:{display:"none"}},null,-1),q=(0,r._)("div",{class:"alert error col-sm-12",id:"ErrorVerify",style:{display:"none"}},null,-1),j={class:"control-group"},z={class:"col-sm-6 padding-left-0"},G={class:"controls input-container"},$=[(0,r._)("i",{id:"open",class:"fas fa-eye"},null,-1),(0,r.Uk)(),(0,r._)("i",{id:"close",class:"fas fa-eye-slash"},null,-1)],K={class:"col-sm-6 padding-right-0"},H={class:"controls input-container"},W=[(0,r._)("i",{id:"open2",class:"fas fa-eye"},null,-1),(0,r.Uk)(),(0,r._)("i",{id:"close2",class:"fas fa-eye-slash"},null,-1)],Q=(0,r._)("button",{type:"submit",class:"btn btn-success submit",id:"register",disabled:""},"Register Now",-1);var Y=n(7215),J=n(9669),X=n.n(J),Z=n(2201),ee=n(9755),te=n.n(ee),ne=n(4866),re=(n(938),n(4673),n(397));function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function se(){se=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var s=t&&t.prototype instanceof d?t:d,o=Object.create(s.prototype),a=new C(i||[]);return r(o,"_invoke",{value:_(e,n,a)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h={};function d(){}function f(){}function p(){}var m={};c(m,s,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(S([])));y&&y!==t&&n.call(y,s)&&(m=y);var v=p.prototype=d.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(r,s,o,a){var c=l(e[r],e,s);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ie(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,o,a)}),(function(e){i("throw",e,o,a)})):t.resolve(h).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,a)}))}a(c.arg)}var s;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return s=s?s.then(r,r):r()}})}function _(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return k()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=I(o,n);if(a){if(a===h)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function I(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,r(v,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:f,configurable:!0}),f.displayName=c(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},w(b.prototype),c(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new b(u(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(v),c(v,a,"Generator"),c(v,s,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var a=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(a&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function oe(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}(0,r.iH)(),(0,Z.tv)();var ae=ne.Z.initializeApp({apiKey:"AIzaSyCFVvsn6dt0WsVQljltQiW-ed-NOLRN9J8",authDomain:"jmibrokers.com",projectId:"jmi-brokers",storageBucket:"jmibrokers.com",messagingSenderId:"698047998267",appId:"1:698047998267:web:3f68d50ce3c78ef29e2f1e",measurementId:"G-FTZC0TXY4K"}),ce=(ae.firestore(),ae.auth());const ue={data:function(){return{site_title:"JMI Brokers | Client Register",site_description:"JMI Brokers | Client Register",site_keywords:"JMI Brokers | Client Register",coderesult:"",_val:"",_attVal:"",firebaseConfig:{},title_list:[{text:"Mr",value:"0"},{text:"Mrs",value:"1"},{text:"Miss",value:"2"}],captchaCode:null,isValid:!1}},mounted:function(){var e=this;re.Z,this.render(),this.form.title=this.title_list[0].value,(0,Y.u)({title:(0,r.Fl)((function(){return e.site_title})),meta:[{name:"description",content:(0,r.Fl)((function(){return e.site_description}))},{name:"keywords",content:(0,r.Fl)((function(){return e.site_keywords}))}]});var t=document.createElement("script");t.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"),t.async=!0,document.head.appendChild(t);var n=document.createElement("script");n.setAttribute("src","https://www.gstatic.com/firebasejs/6.0.2/firebase.js"),n.async=!0,document.head.appendChild(n),te()("#capatcha-quest input").prop("required",!0),te()("select#countryCode option").each((function(){this._val=te()(this).val(),this._attVal=te()(this).attr("data-countryCode"),te()(this).text(this._attVal+"("+this._val+")")})),te()((function(){var e=te()("select#countryCode");e.html(e.find("option").sort((function(e,t){return te()(e).text()>te()(t).text()?1:-1})))}))},methods:{toggleEye:function(e){var t=document.getElementById(e),n=document.getElementById("open"),r=document.getElementById("close");"password"===t.type?(t.type="text",n.style.display="block",r.style.display="none"):(t.type="password",n.style.display="none",r.style.display="block")},codeverify:function(){var e=te()("#verificationCode").val();this.coderesult.confirm(e).then((function(e){e.user;te()("#SuccessVerify").text("Code Verified, you can register now."),te()("#SuccessVerify").show(),te()("#Success").hide(),te()("#verify_code").prop("disabled",!0),te()("#verificationCode").prop("readonly",!0),te()("button#register").prop("disabled",!1)})).catch((function(e){te()("#ErrorVerify").text(e.message),te()("#ErrorVerify").show()}))},emailSendAuth:function(){var e=te()("#email").val();te().ajax({type:"get",url:"/api/sendverificationmailCode/"+e+"/",success:function(e){1==e?(te()("#emailsentSuccess").text("Email Sent Successfully."),te()("#emailsentSuccess").show(),te()("#emailsuccessRegsiter").hide(),te()("#emailverificationCode").show(),te()("#email_verify_code").show(),te()("#emailerror").hide()):0==e&&(te()("#emailerror").text("Invalid Code"),te()("#emailerror").show())},error:function(e){te()("#emailerror").text("An error has occured"),te()("#emailerror").show()}})},emailcodeverify:function(){var e=te()("#emailverificationCode").val(),t=te()("#email").val();te().ajax({type:"get",url:"/api/verificationmailCode/"+t+"/"+e,success:function(e){1==e?(te()("#emailsuccessRegsiter").text("Code Verified, you can resume now."),te()("#emailsuccessRegsiter").show(),te()("#emailsentSuccess").hide()):0==e&&(te()("#emailerror").text("Invalid Code"),te()("#emailerror").show())},error:function(e){te()("#emailerror").text("An error has occured"),te()("#emailerror").show()}})},render:function(){window.recaptchaVerifier=new ne.Z.auth.RecaptchaVerifier("recaptcha-container"),recaptchaVerifier.render()},phoneSendAuth:function(){var e=this,t="+"+te()("#countryCode").val()+te()("#number").val();ce.signInWithPhoneNumber(t,window.recaptchaVerifier).then((function(t){window.confirmationResult=t,e.coderesult=t,te()("#SMSSuccess").text("Message Sent Successfully."),te()("#SMSSuccess").show(),te()("#successRegsiter").hide(),te()("#number").prop("readonly",!0),te()("#countryCode").prop("readonly",!0),te()("#send_code").prop("disabled",!0),te()("#verificationCode").show(),te()("#verify_code").show(),te()("#SMSError").hide()})).catch((function(e){te()("#SMSError").text(e.message),te()("#SMSError").show()}))}},setup:function(){var e=(0,r.iH)(),t=(0,Z.tv)(),n=(0,r.qj)({title:"",fullname:"",username:"",email:"",password:"",confirmpassword:"",phone_number:"",_token:"{{ csrf_token() }}"}),i=function(){var r,i=(r=se().mark((function r(){var i;return se().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,X().post("/api/user/signup",n);case 3:if(200!==(i=r.sent).status||1!=i.data){r.next=8;break}return localStorage.setItem("JMI_User",n.username),r.next=8,t.push("/ar/cpanel/home");case 8:r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),r.t0.response&&401===r.t0.response.status?e.value=r.t0.response.data.errors.ar||"":r.t0&&r.t0.response.data&&r.t0.response.data.errors?e.value=Object.values(r.t0.response.data.errors):e.value=r.t0.response.data.errors||"";case 13:case"end":return r.stop()}}),r,null,[[0,10]])})),function(){var e=this,t=arguments;return new Promise((function(n,i){var s=r.apply(e,t);function o(e){oe(s,n,i,o,a,"next",e)}function a(e){oe(s,n,i,o,a,"throw",e)}o(void 0)}))});return function(){return i.apply(this,arguments)}}();return{form:n,errors:e,handleSignup:i}},create:function(){}};var le=n(3379),he=n.n(le),de=n(9889),fe={insert:"head",singleton:!1};he()(de.Z,fe);de.Z.locals;const pe=(0,n(3744).Z)(ue,[["render",function(e,t,n,Y,J,X){return(0,r.wg)(),(0,r.iD)("div",s,[(0,r._)("div",o,[(0,r._)("div",a,[c,(0,r._)("div",u,[(0,r._)("div",l,[h,"string"==typeof Y.errors?((0,r.wg)(),(0,r.iD)("div",d,(0,r.zw)(Y.errors),1)):(0,r.kq)("",!0),"object"===i(Y.errors)?((0,r.wg)(!0),(0,r.iD)(r.HY,{key:1},(0,r.Ko)(Y.errors,(function(e,t){return(0,r.wg)(),(0,r.iD)("div",{class:"alert alert-danger",key:t},(0,r.zw)(Y.errors[0]),1)})),128)):(0,r.kq)("",!0),(0,r._)("form",{id:"RegisterForm",method:"post",onSubmit:t[15]||(t[15]=(0,r.iM)((function(){return Y.handleSignup&&Y.handleSignup.apply(Y,arguments)}),["prevent"])),class:"registration-form"},[f,(0,r._)("div",p,[(0,r._)("div",m,[(0,r._)("div",g,[(0,r.wy)((0,r._)("select",{class:"form-control",name:"title","onUpdate:modelValue":t[0]||(t[0]=function(e){return Y.form.title=e}),id:"title"},[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(J.title_list,(function(e){return(0,r.wg)(),(0,r.iD)("option",{value:e.value},(0,r.zw)(e.text),9,y)})),256))],512),[[r.bM,Y.form.title]])])]),(0,r._)("div",v,[(0,r._)("div",w,[(0,r.wy)((0,r._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=function(e){return Y.form.fullname=e}),id:"fullname",name:"fullname",placeholder:"Full Name *",required:""},null,512),[[r.nr,Y.form.fullname]])])])]),(0,r._)("div",b,[_,I,(0,r._)("div",T,[(0,r.wy)((0,r._)("input",{type:"email",name:"email",placeholder:"Email :","onUpdate:modelValue":t[2]||(t[2]=function(e){return Y.form.email=e}),class:"form-email form-control",id:"email",required:""},null,512),[[r.nr,Y.form.email]])]),(0,r._)("div",E,[(0,r._)("button",{type:"button",id:"email_send_code",class:"btn btn-success",onClick:t[3]||(t[3]=function(e){return X.emailSendAuth()})},"Send Code")])]),(0,r._)("div",C,[(0,r._)("div",S,[(0,r.wy)((0,r._)("input",{type:"number",id:"emailverificationCode","onUpdate:modelValue":t[4]||(t[4]=function(e){return Y.form.emailverificationCode=e}),name:"emailverificationCode",class:"form-control",placeholder:"Enter Email verification code",style:{display:"none"},required:""},null,512),[[r.nr,Y.form.emailverificationCode]])]),(0,r._)("div",k,[(0,r._)("button",{type:"button",id:"email_verify_code",class:"btn btn-success",onClick:t[5]||(t[5]=function(e){return X.emailcodeverify()}),style:{display:"none"}},"Verify code")]),A]),(0,r._)("div",N,[(0,r.wy)((0,r._)("input",{type:"text",name:"username","onUpdate:modelValue":t[6]||(t[6]=function(e){return Y.form.username=e}),placeholder:"Username : No Spaces",class:"form-email form-control",id:"username",required:""},null,512),[[r.nr,Y.form.username]])]),(0,r._)("div",D,[x,R,(0,r._)("div",P,[(0,r.wy)((0,r._)("select",{name:"countryCode",id:"countryCode","onUpdate:modelValue":t[7]||(t[7]=function(e){return Y.form.countryCode=e}),class:"form-control",required:""},O,512),[[r.bM,Y.form.countryCode]])]),(0,r._)("div",L,[(0,r.wy)((0,r._)("input",{type:"number",id:"number","onUpdate:modelValue":t[8]||(t[8]=function(e){return Y.form.phone_number=e}),class:"form-control",name:"phone_number",placeholder:"Mobile Number",required:""},null,512),[[r.nr,Y.form.phone_number]])]),(0,r._)("div",M,[(0,r._)("button",{type:"button",id:"send_code",class:"btn btn-success",onClick:t[9]||(t[9]=function(e){return X.phoneSendAuth()})},"Send Code")])]),(0,r._)("div",F,[V,(0,r._)("div",U,[(0,r._)("button",{type:"button",id:"verify_code",class:"btn btn-success",onClick:t[10]||(t[10]=function(e){X.codeverify()}),style:{display:"none"}},"Verify code")]),B,q]),(0,r._)("div",j,[(0,r._)("div",z,[(0,r._)("div",G,[(0,r.wy)((0,r._)("input",{id:"password",type:"password",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=function(e){return Y.form.password=e}),placeholder:" Password *",name:"password",required:""},null,512),[[r.nr,Y.form.password]]),(0,r._)("button",{class:"btnEye",onClick:t[12]||(t[12]=function(e){return X.toggleEye("password")}),type:"button"},$)])]),(0,r._)("div",K,[(0,r._)("div",H,[(0,r.wy)((0,r._)("input",{type:"password",class:"form-control",placeholder:"Confirm Password *","onUpdate:modelValue":t[13]||(t[13]=function(e){return Y.form.confirmpassword=e}),id:"confirmpassword",name:"confirmpassword",required:""},null,512),[[r.nr,Y.form.confirmpassword]]),(0,r._)("button",{class:"btnEye",onClick:t[14]||(t[14]=function(e){return X.toggleEye("confirmpassword")}),type:"button"},W)])])]),Q],32)])])])])])}]])},8180:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(4444),i=n(8463),s=n(5816),o=n(3333);class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.wA("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate))))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r.LL("app-compat","Firebase",c);const l=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(i,o={}){const a=s.initializeApp(i,o);if((0,r.r3)(t,a.name))return t[a.name];const c=new e(a,n);return t[a.name]=c,c},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=(e=i())=>{if("function"!=typeof e[a])throw u.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,r.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,o).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.r3)(t,e))throw u.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,r.ZB)(t,e)},createSubscribe:r.ne,ErrorFactory:r.LL,deepExtend:r.ZB}),t}(),h=new o.Yd("@firebase/app-compat");if((0,r.jU)()&&void 0!==self.firebase){h.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&h.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const d=l;var f;(0,s.registerVersion)("@firebase/app-compat","0.2.12",f)},5816:(e,t,n)=>{n.r(t),n.d(t,{FirebaseError:()=>s.ZR,SDK_VERSION:()=>B,_DEFAULT_ENTRY_NAME:()=>k,_addComponent:()=>x,_addOrOverwriteComponent:()=>R,_apps:()=>N,_clearComponents:()=>M,_components:()=>D,_getProvider:()=>O,_registerComponent:()=>P,_removeServiceInstance:()=>L,deleteApp:()=>G,getApp:()=>j,getApps:()=>z,initializeApp:()=>q,onLog:()=>K,registerVersion:()=>$,setLogLevel:()=>H});var r=n(8463),i=n(3333),s=n(4444);const o=(e,t)=>t.some((t=>e instanceof t));let a,c;const u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap;let p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(v(this),t),y(u.get(this))}:function(...t){return y(e.apply(v(this),t))}:function(t,...n){const r=e.call(v(this),t,...n);return h.set(r,t.sort?t.sort():[t]),y(r)}}function g(e){return"function"==typeof e?m(e):(e instanceof IDBTransaction&&function(e){if(l.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));l.set(e,t)}(e),o(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function y(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(y(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&u.set(t,e)})).catch((()=>{})),f.set(t,e),t}(e);if(d.has(e))return d.get(e);const t=g(e);return t!==e&&(d.set(e,t),f.set(t,e)),t}const v=e=>f.get(e);const w=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],_=new Map;function I(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(_.get(t))return _.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=b.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!w.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return _.set(t,s),s}p=(e=>({...e,get:(t,n,r)=>I(t,n)||e.get(t,n,r),has:(t,n)=>!!I(t,n)||e.has(t,n)}))(p);class T{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",C="0.9.12",S=new i.Yd("@firebase/app"),k="[DEFAULT]",A={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},N=new Map,D=new Map;function x(e,t){try{e.container.addComponent(t)}catch(n){S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function R(e,t){e.container.addOrOverwriteComponent(t)}function P(e){const t=e.name;if(D.has(t))return S.debug(`There were multiple attempts to register component ${t}.`),!1;D.set(t,e);for(const t of N.values())x(t,e);return!0}function O(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function L(e,t,n=k){O(e,t).clearInstance(n)}function M(){D.clear()}const F={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},V=new s.LL("app","Firebase",F);class U{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw V.create("app-deleted",{appName:this._name})}}const B="9.22.2";function q(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const i=Object.assign({name:k,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!=typeof o||!o)throw V.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.aH)()),!n)throw V.create("no-options");const a=N.get(o);if(a){if((0,s.vZ)(n,a.options)&&(0,s.vZ)(i,a.config))return a;throw V.create("duplicate-app",{appName:o})}const c=new r.H0(o);for(const e of D.values())c.addComponent(e);const u=new U(n,i,c);return N.set(o,u),u}function j(e=k){const t=N.get(e);if(!t&&e===k&&(0,s.aH)())return q();if(!t)throw V.create("no-app",{appName:e});return t}function z(){return Array.from(N.values())}async function G(e){const t=e.name;N.has(t)&&(N.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function $(e,t,n){var i;let s=null!==(i=A[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void S.warn(e.join(" "))}P(new r.wA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}function K(e,t){if(null!==e&&"function"!=typeof e)throw V.create("invalid-log-argument");(0,i.Am)(e,t)}function H(e){(0,i.Ub)(e)}const W="firebase-heartbeat-database",Q=1,Y="firebase-heartbeat-store";let J=null;function X(){return J||(J=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=y(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(y(o.result),e.oldVersion,e.newVersion,y(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(W,Q,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Y)}}).catch((e=>{throw V.create("idb-open",{originalErrorMessage:e.message})}))),J}async function Z(e,t){try{const n=(await X()).transaction(Y,"readwrite"),r=n.objectStore(Y);await r.put(t,ee(e)),await n.done}catch(e){if(e instanceof s.ZR)S.warn(e.message);else{const t=V.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});S.warn(t.message)}}}function ee(e){return`${e.name}!${e.options.appId}`}class te{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new re(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=ne();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=ne(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),ie(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ie(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,s.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function ne(){return(new Date).toISOString().substring(0,10)}class re{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){try{const t=await X();return await t.transaction(Y).objectStore(Y).get(ee(e))}catch(e){if(e instanceof s.ZR)S.warn(e.message);else{const t=V.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});S.warn(t.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Z(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Z(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ie(e){return(0,s.L)(JSON.stringify({version:2,heartbeats:e})).length}var se;se="",P(new r.wA("platform-logger",(e=>new T(e)),"PRIVATE")),P(new r.wA("heartbeat",(e=>new te(e)),"PRIVATE")),$(E,C,se),$(E,C,"esm2017"),$("fire-js","")},8463:(e,t,n)=>{n.d(t,{H0:()=>a,wA:()=>i});var r=n(4444);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3333:(e,t,n)=>{n.d(t,{Am:()=>h,Ub:()=>l,Yd:()=>u,in:()=>i});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function l(e){r.forEach((t=>{t.setLogLevel(e)}))}function h(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const o=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:o,args:s,type:t.name})}}}},4866:(e,t,n)=>{n.d(t,{Z:()=>r.Z});var r=n(8180);r.Z.registerVersion("firebase","9.22.2","app-compat")},938:(e,t,n)=>{var r=n(8180),i=n(4444),s=n(5816);function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;var a=n(3333),c=n(8463);const u={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},l="EMAIL_SIGNIN",h="PASSWORD_RESET",d="RECOVER_EMAIL",f="REVERT_SECOND_FACTOR_ADDITION",p="VERIFY_AND_CHANGE_EMAIL",m="VERIFY_EMAIL";function g(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const y=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},v=g,w=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),b=new a.Yd("@firebase/auth");function _(e,...t){b.logLevel<=a.in.ERROR&&b.error(`Auth (${s.SDK_VERSION}): ${e}`,...t)}function I(e,...t){throw S(e,...t)}function T(e,...t){return S(e,...t)}function E(e,t,n){const r=Object.assign(Object.assign({},v()),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function C(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&I(e,"argument-error"),E(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function S(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return w.create(e,...t)}function k(e,t,...n){if(!e)throw S(t,...n)}function A(e){const t="INTERNAL ASSERTION FAILED: "+e;throw _(t),new Error(t)}function N(e,t){e||A(t)}function D(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function x(){return"http:"===R()||"https:"===R()}function R(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class P{constructor(e,t){this.shortDelay=e,this.longDelay=t,N(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(x()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function O(e,t){N(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class L{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void A("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void A("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void A("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const M={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},F=new P(3e4,6e4);function V(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function U(e,t,n,r,s={}){return B(e,s,(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),L.fetch()(j(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function B(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},M),t);try{const t=new z(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw G(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw G(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw G(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw G(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw E(e,a,o);I(e,a)}}catch(t){if(t instanceof i.ZR)throw t;I(e,"network-request-failed",{message:String(t)})}}async function q(e,t,n,r,i={}){const s=await U(e,t,n,r,i);return"mfaPendingCredential"in s&&I(e,"multi-factor-auth-required",{_serverResponse:s}),s}function j(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?O(e.config,i):`${e.config.apiScheme}://${i}`}class z{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(T(this.auth,"network-request-failed"))),F.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function G(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=T(e,t,r);return i.customData._tokenResponse=n,i}function $(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function K(e){return 1e3*Number(e)}function H(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return _("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(_("Failed to decode base64 JWT payload"),null)}catch(e){return _("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function W(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Q{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Y{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$(this.lastLoginAt),this.creationTime=$(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function J(e){var t;const n=e.auth,r=await e.getIdToken(),i=await W(e,async function(e,t){return U(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));k(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=o(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const c=(u=e.providerData,l=a,[...u.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var u,l;const h=e.isAnonymous,d=!(e.email&&s.passwordHash||(null==c?void 0:c.length)),f=!!h&&d,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Y(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class X{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){k(e.idToken,"internal-error"),k(void 0!==e.idToken,"internal-error"),k(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=H(e);return k(t,"internal-error"),k(void 0!==t.exp,"internal-error"),k(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return k(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await B(e,{},(async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=j(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",L.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new X;return n&&(k("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(k("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(k("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new X,this.toJSON())}_performRefresh(){return A("not implemented")}}function Z(e,t){k("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ee{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=o(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Q(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Y(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await W(this,this.stsTokenManager.getToken(this.auth,e));return k(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=H(r);k(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:$(K(s.auth_time)),issuedAtTime:$(K(s.iat)),expirationTime:$(K(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await J(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(k(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ee(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){k(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await J(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await W(this,async function(e,t){return U(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:_,stsTokenManager:I}=t;k(v&&I,e,"internal-error");const T=X.fromJSON(this.name,I);k("string"==typeof v,e,"internal-error"),Z(l,e.name),Z(h,e.name),k("boolean"==typeof w,e,"internal-error"),k("boolean"==typeof b,e,"internal-error"),Z(d,e.name),Z(f,e.name),Z(p,e.name),Z(m,e.name),Z(g,e.name),Z(y,e.name);const E=new ee({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(E.providerData=_.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new X;r.updateFromServerResponse(t);const i=new ee({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await J(i),i}}const te=new Map;function ne(e){N(e instanceof Function,"Expected a class definition");let t=te.get(e);return t?(N(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,te.set(e,t),t)}class re{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}re.type="NONE";const ie=re;function se(e,t,n){return`firebase:${e}:${t}:${n}`}class oe{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=se(this.userKey,r.apiKey,i),this.fullPersistenceKey=se("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ee._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new oe(ne(ie),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||ne(ie);const s=se(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=ee._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new oe(i,e,n)):new oe(i,e,n)}}function ae(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(he(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ce(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(fe(t))return"Blackberry";if(pe(t))return"Webos";if(ue(t))return"Safari";if((t.includes("chrome/")||le(t))&&!t.includes("edge/"))return"Chrome";if(de(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ce(e=(0,i.z$)()){return/firefox\//i.test(e)}function ue(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function le(e=(0,i.z$)()){return/crios\//i.test(e)}function he(e=(0,i.z$)()){return/iemobile/i.test(e)}function de(e=(0,i.z$)()){return/android/i.test(e)}function fe(e=(0,i.z$)()){return/blackberry/i.test(e)}function pe(e=(0,i.z$)()){return/webos/i.test(e)}function me(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ge(e=(0,i.z$)()){return me(e)||de(e)||pe(e)||fe(e)||/windows phone/i.test(e)||he(e)}function ye(e,t=[]){let n;switch(e){case"Browser":n=ae((0,i.z$)());break;case"Worker":n=`${ae((0,i.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.SDK_VERSION}/${r}`}async function ve(e,t){return U(e,"GET","/v2/recaptchaConfig",V(e,t))}function we(e){return void 0!==e&&void 0!==e.getResponse}function be(e){return void 0!==e&&void 0!==e.enterprise}class _e{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function Ie(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=T("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function Te(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ee{constructor(e){this.type="recaptcha-enterprise",this.auth=Ae(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;be(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{ve(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new _e(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&be(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));Ie("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Ce(e,t,n,r=!1){const i=new Ee(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class Se{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class ke{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ne(this),this.idTokenSubscription=new Ne(this),this.beforeStateQueue=new Se(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=w,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ne(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await oe.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return k(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await J(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&k(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&k(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(ne(e))}))}async initializeRecaptchaConfig(){const e=await ve(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new _e(e);if(null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled){new Ee(this).verify()}}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ne(e)||this._popupRedirectResolver;k(t,this,"argument-error"),this.redirectPersistenceManager=await oe.create(this,[ne(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return k(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return k(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ye(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){b.logLevel<=a.in.WARN&&b.warn(`Auth (${s.SDK_VERSION}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Ae(e){return(0,i.m9)(e)}class Ne{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)((e=>this.observer=e))}get next(){return k(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function De(e,t,n){const r=Ae(e);k(r._canInitEmulator,r,"emulator-config-failed"),k(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=xe(t),{host:o,port:a}=function(e){const t=xe(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Re(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Re(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function xe(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Re(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Pe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return A("not implemented")}_getIdTokenResponse(e){return A("not implemented")}_linkToIdToken(e,t){return A("not implemented")}_getReauthenticationResolver(e){return A("not implemented")}}async function Oe(e,t){return U(e,"POST","/v1/accounts:resetPassword",V(e,t))}async function Le(e,t){return U(e,"POST","/v1/accounts:update",t)}async function Me(e,t){return q(e,"POST","/v1/accounts:signInWithPassword",V(e,t))}async function Fe(e,t){return U(e,"POST","/v1/accounts:sendOobCode",V(e,t))}async function Ve(e,t){return Fe(e,t)}async function Ue(e,t){return Fe(e,t)}class Be extends Pe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Be(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Be(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await Ce(e,n,"signInWithPassword");return Me(e,t)}return Me(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await Ce(e,n,"signInWithPassword");return Me(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return q(e,"POST","/v1/accounts:signInWithEmailLink",V(e,t))}(e,{email:this._email,oobCode:this._password});default:I(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Le(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return q(e,"POST","/v1/accounts:signInWithEmailLink",V(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:I(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function qe(e,t){return q(e,"POST","/v1/accounts:signInWithIdp",V(e,t))}class je extends Pe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new je(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):I("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=o(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new je(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return qe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,qe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,qe(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const ze={USER_NOT_FOUND:"user-not-found"};class Ge extends Pe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ge({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ge({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return q(e,"POST","/v1/accounts:signInWithPhoneNumber",V(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await q(e,"POST","/v1/accounts:signInWithPhoneNumber",V(e,t));if(n.temporaryProof)throw G(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return q(e,"POST","/v1/accounts:signInWithPhoneNumber",V(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ze)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Ge({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class $e{constructor(e){var t,n,r,s,o,a;const c=(0,i.zd)((0,i.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);k(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new $e(t)}catch(e){return null}}}class Ke{constructor(){this.providerId=Ke.PROVIDER_ID}static credential(e,t){return Be._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=$e.parseLink(t);return k(n,"argument-error"),Be._fromEmailAndCode(e,n.code,n.tenantId)}}Ke.PROVIDER_ID="password",Ke.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ke.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class He{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class We extends He{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Qe extends We{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return k("providerId"in t&&"signInMethod"in t,"argument-error"),je._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return k(e.idToken||e.accessToken,"argument-error"),je._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Qe.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Qe.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new Qe(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Ye extends We{constructor(){super("facebook.com")}static credential(e){return je._fromParams({providerId:Ye.PROVIDER_ID,signInMethod:Ye.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ye.credentialFromTaggedObject(e)}static credentialFromError(e){return Ye.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ye.credential(e.oauthAccessToken)}catch(e){return null}}}Ye.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ye.PROVIDER_ID="facebook.com";class Je extends We{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return je._fromParams({providerId:Je.PROVIDER_ID,signInMethod:Je.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Je.credentialFromTaggedObject(e)}static credentialFromError(e){return Je.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Je.credential(t,n)}catch(e){return null}}}Je.GOOGLE_SIGN_IN_METHOD="google.com",Je.PROVIDER_ID="google.com";class Xe extends We{constructor(){super("github.com")}static credential(e){return je._fromParams({providerId:Xe.PROVIDER_ID,signInMethod:Xe.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xe.credentialFromTaggedObject(e)}static credentialFromError(e){return Xe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Xe.credential(e.oauthAccessToken)}catch(e){return null}}}Xe.GITHUB_SIGN_IN_METHOD="github.com",Xe.PROVIDER_ID="github.com";class Ze extends Pe{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return qe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,qe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,qe(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Ze(n,i):null}static _create(e,t){return new Ze(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class et extends He{constructor(e){k(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return et.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return et.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ze.fromJSON(e);return k(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Ze._create(n,t)}catch(e){return null}}}class tt extends We{constructor(){super("twitter.com")}static credential(e,t){return je._fromParams({providerId:tt.PROVIDER_ID,signInMethod:tt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return tt.credentialFromTaggedObject(e)}static credentialFromError(e){return tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return tt.credential(t,n)}catch(e){return null}}}async function nt(e,t){return q(e,"POST","/v1/accounts:signUp",V(e,t))}tt.TWITTER_SIGN_IN_METHOD="twitter.com",tt.PROVIDER_ID="twitter.com";class rt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await ee._fromIdTokenResponse(e,n,r),s=it(n);return new rt({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=it(n);return new rt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function it(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class st extends i.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,st.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new st(e,t,n,r)}}function ot(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw st._fromErrorAndOperation(e,n,t,r);throw n}))}function at(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function ct(e,t){const n=(0,i.m9)(e);await lt(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return U(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=at(r||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function ut(e,t,n=!1){const r=await W(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return rt._forOperation(e,"link",r)}async function lt(e,t,n){await J(t);const r=!1===e?"provider-already-linked":"no-such-provider";k(at(t.providerData).has(n)===e,t.auth,r)}async function ht(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await W(e,ot(r,i,t,e),n);k(s.idToken,r,"internal-error");const o=H(s.idToken);k(o,r,"internal-error");const{sub:a}=o;return k(e.uid===a,r,"user-mismatch"),rt._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&I(r,"user-mismatch"),e}}async function dt(e,t,n=!1){const r="signIn",i=await ot(e,r,t),s=await rt._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function ft(e,t){return dt(Ae(e),t)}async function pt(e,t){const n=(0,i.m9)(e);return await lt(!1,n,t.providerId),ut(n,t)}async function mt(e,t){return ht((0,i.m9)(e),t)}async function gt(e,t){const n=Ae(e),r=await async function(e,t){return q(e,"POST","/v1/accounts:signInWithCustomToken",V(e,t))}(n,{token:t,returnSecureToken:!0}),i=await rt._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class yt{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?vt._fromServerResponse(e,t):"totpInfo"in t?wt._fromServerResponse(e,t):I(e,"internal-error")}}class vt extends yt{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new vt(t)}}class wt extends yt{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new wt(t)}}function bt(e,t,n){var r;k((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),k(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(k(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(k(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function _t(e,t){await async function(e,t){return U(e,"POST","/v1/accounts:update",V(e,t))}((0,i.m9)(e),{oobCode:t})}async function It(e,t){const n=(0,i.m9)(e),r=await Oe(n,{oobCode:t}),s=r.requestType;switch(k(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":k(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":k(r.mfaInfo,n,"internal-error");default:k(r.email,n,"internal-error")}let o=null;return r.mfaInfo&&(o=yt._fromServerResponse(Ae(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function Tt(e,t){const n={identifier:t,continueUri:x()?D():"http://localhost"},{signinMethods:r}=await async function(e,t){return U(e,"POST","/v1/accounts:createAuthUri",V(e,t))}((0,i.m9)(e),n);return r||[]}async function Et(e,t){const n=(0,i.m9)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&bt(n.auth,r,t);const{email:s}=await async function(e,t){return Fe(e,t)}(n.auth,r);s!==e.email&&await e.reload()}async function Ct(e,t,n){const r=(0,i.m9)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&bt(r.auth,s,n);const{email:o}=await async function(e,t){return Fe(e,t)}(r.auth,s);o!==e.email&&await e.reload()}async function St(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=(0,i.m9)(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await W(r,async function(e,t){return U(e,"POST","/v1/accounts:update",t)}(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find((({providerId:e})=>"password"===e));a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}async function kt(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await W(e,Le(r,i));await e._updateTokensIfNecessary(s,!0)}class At{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Nt extends At{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Dt extends At{constructor(e,t){super(e,"facebook.com",t)}}class xt extends Nt{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Rt extends At{constructor(e,t){super(e,"google.com",t)}}class Pt extends Nt{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Ot(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=H(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new At(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Dt(s,i);case"github.com":return new xt(s,i);case"google.com":return new Rt(s,i);case"twitter.com":return new Pt(s,i,e.screenName||null);case"custom":case"anonymous":return new At(s,null);default:return new At(s,r,i)}}(n)}class Lt{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Lt("enroll",e,t)}static _fromMfaPendingCredential(e){return new Lt("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Lt._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Lt._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Mt{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Ae(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>yt._fromServerResponse(n,e)));k(r.mfaPendingCredential,n,"internal-error");const s=Lt._fromMfaPendingCredential(r.mfaPendingCredential);return new Mt(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await rt._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return k(t.user,n,"internal-error"),rt._forOperation(t.user,t.operationType,o);default:I(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Ft{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>yt._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Ft(e)}async getSession(){return Lt._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await W(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await W(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},U(r,"POST","/v2/accounts/mfaEnrollment:withdraw",V(r,i))));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}var r,i}}const Vt=new WeakMap;const Ut="__sak";class Bt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ut,"1"),this.storage.removeItem(Ut),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class qt extends Bt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return ue(e)||me(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ge(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}qt.type="LOCAL";const jt=qt;class zt extends Bt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}zt.type="SESSION";const Gt=zt;class $t{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new $t(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Kt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}$t.receivers=[];class Ht{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Kt("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Wt(){return window}function Qt(){return void 0!==Wt().WorkerGlobalScope&&"function"==typeof Wt().importScripts}const Yt="firebaseLocalStorageDb",Jt="firebaseLocalStorage",Xt="fbase_key";class Zt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function en(e,t){return e.transaction([Jt],t?"readwrite":"readonly").objectStore(Jt)}function tn(){const e=indexedDB.open(Yt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Jt,{keyPath:Xt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Jt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Yt);return new Zt(e).toPromise()}(),t(await tn()))}))}))}async function nn(e,t,n){const r=en(e,!0).put({[Xt]:t,value:n});return new Zt(r).toPromise()}function rn(e,t){const n=en(e,!0).delete(t);return new Zt(n).toPromise()}class sn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await tn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$t._getInstance(Qt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Ht(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await tn();return await nn(e,Ut,"1"),await rn(e,Ut),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>nn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=en(e,!1).get(t),r=await new Zt(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>rn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=en(e,!1).getAll();return new Zt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}sn.type="LOCAL";const on=sn;const an=1e12;class cn{constructor(e){this.auth=e,this.counter=an,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new un(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||an;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||an;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||an;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class un{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;k(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const ln=Te("rcb"),hn=new P(3e4,6e4);class dn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=Wt().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return k(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&we(Wt().grecaptcha)?Promise.resolve(Wt().grecaptcha):new Promise(((n,r)=>{const s=Wt().setTimeout((()=>{r(T(e,"network-request-failed"))}),hn.get());Wt()[ln]=()=>{Wt().clearTimeout(s),delete Wt()[ln];const i=Wt().grecaptcha;if(!i||!we(i))return void r(T(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)};Ie(`https://www.google.com/recaptcha/api.js??${(0,i.xO)({onload:ln,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(s),r(T(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=Wt().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class fn{async load(e){return new cn(e)}clearedOneInstance(){}}const pn="recaptcha",mn={theme:"light",type:"image"};class gn{constructor(e,t=Object.assign({},mn),n){this.parameters=t,this.type=pn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ae(n),this.isInvisible="invisible"===this.parameters.size,k("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;k(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new fn:new dn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){k(!this.parameters.sitekey,this.auth,"argument-error"),k(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),k("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=Wt()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){k(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){k(x()&&!Qt(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await U(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);k(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return k(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class yn{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ge._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function vn(e,t,n){var r;const i=await n.verify();try{let s;if(k("string"==typeof i,e,"argument-error"),k(n.type===pn,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){k("enroll"===t.type,e,"internal-error");const n=await function(e,t){return U(e,"POST","/v2/accounts/mfaEnrollment:start",V(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{k("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;k(n,e,"missing-multi-factor-info");const o=await function(e,t){return U(e,"POST","/v2/accounts/mfaSignIn:start",V(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return U(e,"POST","/v1/accounts:sendVerificationCode",V(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class wn{constructor(e){this.providerId=wn.PROVIDER_ID,this.auth=Ae(e)}verifyPhoneNumber(e,t){return vn(this.auth,e,(0,i.m9)(t))}static credential(e,t){return Ge._fromVerification(e,t)}static credentialFromResult(e){const t=e;return wn.credentialFromTaggedObject(t)}static credentialFromError(e){return wn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ge._fromTokenResponse(t,n):null}}function bn(e,t){return t?ne(t):(k(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}wn.PROVIDER_ID="phone",wn.PHONE_SIGN_IN_METHOD="phone";class _n extends Pe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return qe(e,this._buildIdpRequest())}_linkToIdToken(e,t){return qe(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return qe(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function In(e){return dt(e.auth,new _n(e),e.bypassAuthState)}function Tn(e){const{auth:t,user:n}=e;return k(n,t,"internal-error"),ht(n,new _n(e),e.bypassAuthState)}async function En(e){const{auth:t,user:n}=e;return k(n,t,"internal-error"),ut(n,new _n(e),e.bypassAuthState)}class Cn{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return In;case"linkViaPopup":case"linkViaRedirect":return En;case"reauthViaPopup":case"reauthViaRedirect":return Tn;default:I(this.auth,"internal-error")}}resolve(e){N(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){N(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Sn=new P(2e3,1e4);class kn extends Cn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,kn.currentPopupAction&&kn.currentPopupAction.cancel(),kn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return k(e,this.auth,"internal-error"),e}async onExecution(){N(1===this.filter.length,"Popup operations only handle one event");const e=Kt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(T(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(T(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,kn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(T(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Sn.get())};e()}}kn.currentPopupAction=null;const An="pendingRedirect",Nn=new Map;class Dn extends Cn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Nn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=On(t),r=Pn(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Nn.set(this.auth._key(),e)}return this.bypassAuthState||Nn.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function xn(e,t){return Pn(e)._set(On(t),"true")}function Rn(e,t){Nn.set(e._key(),t)}function Pn(e){return ne(e._redirectPersistence)}function On(e){return se(An,e.config.apiKey,e.name)}function Ln(e,t,n){return async function(e,t,n){const r=Ae(e);C(e,t,He),await r._initializationPromise;const i=bn(r,n);return await xn(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Mn(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);C(r.auth,t,He),await r.auth._initializationPromise;const s=bn(r.auth,n);await xn(s,r.auth);const o=await Un(r);return s._openRedirect(r.auth,t,"reauthViaRedirect",o)}(e,t,n)}function Fn(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);C(r.auth,t,He),await r.auth._initializationPromise;const s=bn(r.auth,n);await lt(!1,r,t.providerId),await xn(s,r.auth);const o=await Un(r);return s._openRedirect(r.auth,t,"linkViaRedirect",o)}(e,t,n)}async function Vn(e,t,n=!1){const r=Ae(e),i=bn(r,t),s=new Dn(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Un(e){const t=Kt(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Bn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!jn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(T(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(qn(e))}saveEventToCache(e){this.cachedEventUids.add(qn(e)),this.lastProcessedEventTime=Date.now()}}function qn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function jn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function zn(e,t={}){return U(e,"GET","/v1/projects",t)}const Gn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$n=/^https?/;function Kn(e){const t=D(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!$n.test(n))return!1;if(Gn.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Hn=new P(3e4,6e4);function Wn(){const e=Wt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Qn=null;function Yn(e){return Qn=Qn||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){Wn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Wn(),n(T(e,"network-request-failed"))},timeout:Hn.get()})}if(null===(i=null===(r=Wt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Wt().gapi)||void 0===s?void 0:s.load)){const t=Te("iframefcb");return Wt()[t]=()=>{gapi.load?o():n(T(e,"network-request-failed"))},Ie(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Qn=null,e}))}(e),Qn}const Jn=new P(5e3,15e3),Xn="__/auth/iframe",Zn="emulator/auth/iframe",er={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function nr(e){const t=e.config;k(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?O(t,Zn):`https://${e.config.authDomain}/${Xn}`,r={apiKey:t.apiKey,appName:e.name,v:s.SDK_VERSION},o=tr.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,i.xO)(r).slice(1)}`}const rr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ir{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function sr(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},rr),{width:r.toString(),height:s.toString(),top:o,left:a}),l=(0,i.z$)().toLowerCase();n&&(c=le(l)?"_blank":n),ce(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.z$)()){var t;return me(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new ir(null);const d=window.open(t||"",c,h);k(d,e,"popup-blocked");try{d.focus()}catch(e){}return new ir(d)}const or="__/auth/handler",ar="emulator/auth/handler",cr=encodeURIComponent("fac");async function ur(e,t,n,r,o,a){k(e.config.authDomain,e,"auth-domain-config-required"),k(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.SDK_VERSION,eventId:o};if(t instanceof He){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof We){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];const l=await e._getAppCheckToken(),h=l?`#${cr}=${encodeURIComponent(l)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${or}`;return O(e,ar)}(e)}?${(0,i.xO)(u).slice(1)}${h}`}const lr="webStorageSupport";const hr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Gt,this._completeRedirectFn=Vn,this._overrideRedirectResult=Rn}async _openPopup(e,t,n,r){var i;N(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return sr(e,await ur(e,t,n,D(),r),Kt())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Wt().location.href=e}(await ur(e,t,n,D(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(N(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Yn(e),n=Wt().gapi;return k(n,e,"internal-error"),t.open({where:document.body,url:nr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:er,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=T(e,"network-request-failed"),s=Wt().setTimeout((()=>{r(i)}),Jn.get());function o(){Wt().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Bn(e);return t.register("authEvent",(t=>{k(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(lr,{type:lr},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[lr];void 0!==i&&t(!!i),I(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await zn(e);for(const e of t)try{if(Kn(e))return}catch(e){}I(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ge()||ue()||me()}};class dr{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return A("unexpected MultiFactorSessionType")}}}class fr extends dr{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new fr(e)}_finalizeEnroll(e,t,n){return function(e,t){return U(e,"POST","/v2/accounts/mfaEnrollment:finalize",V(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return U(e,"POST","/v2/accounts/mfaSignIn:finalize",V(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class pr{constructor(){}static assertion(e){return fr._fromCredential(e)}}pr.FACTOR_ID="phone";var mr="@firebase/auth",gr="0.23.2";class yr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){k(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(0,i.Pz)("authIdTokenMaxAge");var vr;function wr(){return window}vr="Browser",(0,s._registerComponent)(new c.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;k(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:vr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ye(vr)},c=new ke(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ne);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,s._registerComponent)(new c.wA("auth-internal",(e=>(e=>new yr(e))(Ae(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.registerVersion)(mr,gr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(vr)),(0,s.registerVersion)(mr,gr,"esm2017");async function br(e,t,n){var r;const{BuildInfo:i}=wr();N(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(N(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return me()?o.ibi=i.packageName:de()?o.apn=i.packageName:I(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,ur(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}function _r(e){const{cordova:t}=wr();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=(0,i.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)}))}))}const Ir=20;class Tr extends Bn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function Er(e){const t=await kr()._get(Ar(e));return t&&await kr()._remove(Ar(e)),t}function Cr(e,t){var n,r;const i=function(e){const t=Nr(e),n=t.link?decodeURIComponent(t.link):void 0,r=Nr(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Nr(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Nr(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?T(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function Sr(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<Ir;n++){const n=Math.floor(62*Math.random());e.push(t.charAt(n))}return e.join("")}function kr(){return ne(jt)}function Ar(e){return se("authEvent",e.config.apiKey,e.name)}function Nr(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,i.zd)(n.join("?"))}const Dr=class{constructor(){this._redirectPersistence=Gt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Vn,this._overrideRedirectResult=Rn}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Tr(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){I(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=wr();k("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),k(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),k("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),k("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),k("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Nn.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Sr(),postBody:null,tenantId:e.tenantId,error:T(e,"no-auth-event")}}(e,n,r);await function(e,t){return kr()._set(Ar(e),t)}(e,s);const o=await br(e,s,t);return async function(e,t,n){const{cordova:r}=wr();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(T(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),de()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await _r(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=wr(),n={};me()?n.iosBundleId=t.packageName:de()?n.androidPackageName=t.packageName:I(e,"operation-not-supported-in-this-environment"),await zn(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=wr(),s=setTimeout((async()=>{await Er(e),t.onEvent(xr())}),500),o=async n=>{clearTimeout(s);const r=await Er(e);let i=null;r&&(null==n?void 0:n.url)&&(i=Cr(r,n.url)),t.onEvent(i||xr())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;wr().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function xr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:T("no-auth-event")}}function Rr(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Pr(e=(0,i.z$)()){return!("file:"!==Rr()&&"ionic:"!==Rr()&&"capacitor:"!==Rr()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Or(e=(0,i.z$)()){return(0,i.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,i.z$)()){return/Edge\/\d+/.test(e)}(e)}function Lr(){try{const e=self.localStorage,t=Kt();if(e)return e.setItem(t,"1"),e.removeItem(t),!Or()||(0,i.hl)()}catch(e){return Mr()&&(0,i.hl)()}return!1}function Mr(){return void 0!==n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function Fr(){return("http:"===Rr()||"https:"===Rr()||(0,i.ru)()||Pr())&&!((0,i.b$)()||(0,i.UG)())&&Lr()&&!Mr()}function Vr(){return Pr()&&"undefined"!=typeof document}const Ur={LOCAL:"local",NONE:"none",SESSION:"session"},Br=k,qr="persistence";async function jr(e){await e._initializationPromise;const t=zr(),n=se(qr,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function zr(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const Gr=k;class $r{constructor(){this.browserResolver=ne(hr),this.cordovaResolver=ne(Dr),this.underlyingResolver=null,this._redirectPersistence=Gt,this._completeRedirectFn=Vn,this._overrideRedirectResult=Rn}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Vr()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Gr(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Vr()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Kr(e){return e.unwrap()}function Hr(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){t.resolver=new Jr(e,function(e,t){var n;const r=(0,i.m9)(e),s=t;return k(t.customData.operationType,r,"argument-error"),k(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Mt._fromError(r,s)}(e,t))}else if(r){const e=Wr(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function Wr(e){const{_tokenResponse:t}=e instanceof i.ZR?e.customData:e;if(!t)return null;if(!(e instanceof i.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return wn.credentialFromResult(e);const n=t.providerId;if(!n||n===u.PASSWORD)return null;let r;switch(n){case u.GOOGLE:r=Je;break;case u.FACEBOOK:r=Ye;break;case u.GITHUB:r=Xe;break;case u.TWITTER:r=tt;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Ze._create(n,o):je._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new Qe(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof i.ZR?r.credentialFromError(e):r.credentialFromResult(e)}function Qr(e,t){return t.catch((t=>{throw t instanceof i.ZR&&Hr(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,Wr(r)),additionalUserInfo:Ot(e),user:Xr.getOrCreate(n)};var r}))}async function Yr(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Qr(e,n.confirm(t))}}class Jr{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Qr(Kr(this.auth),this.resolver.resolveSignIn(e))}}class Xr{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,i.m9)(e);return Vt.has(t)||Vt.set(t,Ft._fromUser(t)),Vt.get(t)}(e)}static getOrCreate(e){return Xr.USER_MAP.has(e)||Xr.USER_MAP.set(e,new Xr(e)),Xr.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Qr(this.auth,pt(this._delegate,e))}async linkWithPhoneNumber(e,t){return Yr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);await lt(!1,r,"phone");const s=await vn(r.auth,t,(0,i.m9)(n));return new yn(s,(e=>pt(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return Qr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);C(r.auth,t,He);const s=bn(r.auth,n);return new kn(r.auth,"linkViaPopup",t,s,r).executeNotNull()}(this._delegate,e,$r))}async linkWithRedirect(e){return await jr(Ae(this.auth)),Fn(this._delegate,e,$r)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Qr(this.auth,mt(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Yr(this.auth,async function(e,t,n){const r=(0,i.m9)(e),s=await vn(r.auth,t,(0,i.m9)(n));return new yn(s,(e=>mt(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Qr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);C(r.auth,t,He);const s=bn(r.auth,n);return new kn(r.auth,"reauthViaPopup",t,s,r).executeNotNull()}(this._delegate,e,$r))}async reauthenticateWithRedirect(e){return await jr(Ae(this.auth)),Mn(this._delegate,e,$r)}sendEmailVerification(e){return Et(this._delegate,e)}async unlink(e){return await ct(this._delegate,e),this}updateEmail(e){return function(e,t){return kt((0,i.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return kt((0,i.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await ut((0,i.m9)(e),t)}(this._delegate,e)}updateProfile(e){return St(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Ct(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Xr.USER_MAP=new WeakMap;const Zr=k;class ei{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;Zr(n,"invalid-api-key",{appName:e.name}),Zr(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?$r:void 0;this._delegate=t.initialize({options:{persistence:ni(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(y),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Xr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){De(this._delegate,e,t)}applyActionCode(e){return _t(this._delegate,e)}checkActionCode(e){return It(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Oe((0,i.m9)(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Qr(this._delegate,async function(e,t,n){var r;const i=Ae(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await Ce(i,s,"signUpPassword");o=nt(i,e)}else o=nt(i,s).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await Ce(i,s,"signUpPassword");return nt(i,e)}return Promise.reject(e)}));const a=await o.catch((e=>Promise.reject(e))),c=await rt._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(c.user),c}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Tt(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=$e.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){Zr(Fr(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await Ae(e)._initializationPromise,Vn(e,t,!1)}(this._delegate,$r);return e?Qr(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){Ae(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=ti(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=ti(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){var r;const i=Ae(e),s={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};function o(e,t){k(t.handleCodeInApp,i,"argument-error"),t&&bt(i,e,t)}if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await Ce(i,s,"getOobCode",!0);o(e,n),await Ue(i,e)}else o(s,n),await Ue(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await Ce(i,s,"getOobCode",!0);o(e,n),await Ue(i,e)}}))}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){var r;const i=Ae(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await Ce(i,s,"getOobCode",!0);n&&bt(i,e,n),await Ve(i,e)}else n&&bt(i,s,n),await Ve(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await Ce(i,s,"getOobCode",!0);n&&bt(i,e,n),await Ve(i,e)}}))}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Br(Object.values(Ur).includes(t),e,"invalid-persistence-type"),(0,i.b$)()?Br(t!==Ur.SESSION,e,"unsupported-persistence-type"):(0,i.UG)()?Br(t===Ur.NONE,e,"unsupported-persistence-type"):Mr()?Br(t===Ur.NONE||t===Ur.LOCAL&&(0,i.hl)(),e,"unsupported-persistence-type"):Br(t===Ur.NONE||Lr(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Ur.SESSION:t=Gt;break;case Ur.LOCAL:t=await ne(on)._isAvailable()?on:jt;break;case Ur.NONE:t=ie;break;default:return I("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Qr(this._delegate,async function(e){var t;const n=Ae(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new rt({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await nt(n,{returnSecureToken:!0}),i=await rt._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Qr(this._delegate,ft(this._delegate,e))}signInWithCustomToken(e){return Qr(this._delegate,gt(this._delegate,e))}signInWithEmailAndPassword(e,t){return Qr(this._delegate,function(e,t,n){return ft((0,i.m9)(e),Ke.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Qr(this._delegate,async function(e,t,n){const r=(0,i.m9)(e),s=Ke.credentialWithLink(t,n||D());return k(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),ft(r,s)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Yr(this._delegate,async function(e,t,n){const r=Ae(e),s=await vn(r,t,(0,i.m9)(n));return new yn(s,(e=>ft(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return Zr(Fr(),this._delegate,"operation-not-supported-in-this-environment"),Qr(this._delegate,async function(e,t,n){const r=Ae(e);C(e,t,He);const i=bn(r,n);return new kn(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,$r))}async signInWithRedirect(e){return Zr(Fr(),this._delegate,"operation-not-supported-in-this-environment"),await jr(this._delegate),Ln(this._delegate,e,$r)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await It((0,i.m9)(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function ti(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Xr.getOrCreate(e)),error:t,complete:n}}function ni(e,t){const n=function(e,t){const n=zr();if(!n)return[];const r=se(qr,e,t);switch(n.getItem(r)){case Ur.NONE:return[ie];case Ur.LOCAL:return[on,Gt];case Ur.SESSION:return[Gt];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(on)||n.push(on),"undefined"!=typeof window)for(const e of[jt,Gt])n.includes(e)||n.push(e);return n.includes(ie)||n.push(ie),n}ei.Persistence=Ur;class ri{constructor(){this.providerId="phone",this._delegate=new wn(Kr(r.Z.auth()))}static credential(e,t){return wn.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}ri.PHONE_SIGN_IN_METHOD=wn.PHONE_SIGN_IN_METHOD,ri.PROVIDER_ID=wn.PROVIDER_ID;const ii=k;class si{constructor(e,t,n=r.Z.app()){var i;ii(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new gn(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var oi;(oi=r.Z).INTERNAL.registerComponent(new c.wA("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new ei(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:l,PASSWORD_RESET:h,RECOVER_EMAIL:d,REVERT_SECOND_FACTOR_ADDITION:f,VERIFY_AND_CHANGE_EMAIL:p,VERIFY_EMAIL:m}},EmailAuthProvider:Ke,FacebookAuthProvider:Ye,GithubAuthProvider:Xe,GoogleAuthProvider:Je,OAuthProvider:Qe,SAMLAuthProvider:et,PhoneAuthProvider:ri,PhoneMultiFactorGenerator:pr,RecaptchaVerifier:si,TwitterAuthProvider:tt,Auth:ei,AuthCredential:Pe,Error:i.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),oi.registerVersion("@firebase/auth-compat","0.4.2")},4673:(e,t,n)=>{var r,i=n(8180),s=n(5816),o=n(8463),a=n(3333),c=n(4444),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l={},h=h||{},d=u||self;function f(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function p(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var m="closure_uid_"+(1e9*Math.random()>>>0),g=0;function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function _(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function I(){this.s=this.s,this.o=this.o}I.prototype.s=!1,I.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,m)&&e[m]||(e[m]=++g))},I.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const T=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function E(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function C(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(f(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function S(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}S.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{d.addEventListener("test",(()=>{}),t),d.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function A(e){return/^[\s\xa0]*$/.test(e)}function N(){var e=d.navigator;return e&&(e=e.userAgent)?e:""}function D(e){return-1!=N().indexOf(e)}function x(e){return x[" "](e),e}x[" "]=function(){};var R,P,O,L=D("Opera"),M=D("Trident")||D("MSIE"),F=D("Edge"),V=F||M,U=D("Gecko")&&!(-1!=N().toLowerCase().indexOf("webkit")&&!D("Edge"))&&!(D("Trident")||D("MSIE"))&&!D("Edge"),B=-1!=N().toLowerCase().indexOf("webkit")&&!D("Edge");function q(){var e=d.document;return e?e.documentMode:void 0}e:{var j="",z=(P=N(),U?/rv:([^\);]+)(\)|;)/.exec(P):F?/Edge\/([\d\.]+)/.exec(P):M?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(P):B?/WebKit\/(\S+)/.exec(P):L?/(?:Version)[ \/]?(\S+)/.exec(P):void 0);if(z&&(j=z?z[1]:""),M){var G=q();if(null!=G&&G>parseFloat(j)){R=String(G);break e}}R=j}if(d.document&&M){var $=q();O=$||(parseInt(R,10)||void 0)}else O=void 0;var K=O;function H(e,t){if(S.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(U){e:{try{x(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:W[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&H.$.h.call(this)}}_(H,S);var W={2:"touch",3:"pen",4:"mouse"};H.prototype.h=function(){H.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),Y=0;function J(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Y,this.fa=this.ia=!1}function X(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Z(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function ee(e){const t={};for(const n in e)t[n]=e[n];return t}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<te.length;t++)n=te[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function re(e){this.src=e,this.g={},this.h=0}function ie(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=T(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(X(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function se(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}re.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=se(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new J(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var oe="closure_lm_"+(1e6*Math.random()|0),ae={};function ce(e,t,n,r,i){if(r&&r.once)return le(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ce(e,t[s],n,r,i);return null}return n=ye(n),e&&e[Q]?e.O(t,n,p(r)?!!r.capture:!!r,i):ue(e,t,n,!1,r,i)}function ue(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=p(i)?!!i.capture:!!i,a=me(e);if(a||(e[oe]=a=new re(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=pe;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)k||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(fe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function le(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)le(e,t[s],n,r,i);return null}return n=ye(n),e&&e[Q]?e.P(t,n,p(r)?!!r.capture:!!r,i):ue(e,t,n,!0,r,i)}function he(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)he(e,t[s],n,r,i);else r=p(r)?!!r.capture:!!r,n=ye(n),e&&e[Q]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=se(s=e.g[t],n,r,i))&&(X(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=me(e))&&(t=e.g[t.toString()],e=-1,t&&(e=se(t,n,r,i)),(n=-1<e?t[e]:null)&&de(n))}function de(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[Q])ie(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(fe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=me(t))?(ie(n,e),0==n.h&&(n.src=null,t[oe]=null)):X(e)}}}function fe(e){return e in ae?ae[e]:ae[e]="on"+e}function pe(e,t){if(e.fa)e=!0;else{t=new H(t,this);var n=e.listener,r=e.la||e.src;e.ia&&de(e),e=n.call(r,t)}return e}function me(e){return(e=e[oe])instanceof re?e:null}var ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function ye(e){return"function"==typeof e?e:(e[ge]||(e[ge]=function(t){return e.handleEvent(t)}),e[ge])}function ve(){I.call(this),this.i=new re(this),this.S=this,this.J=null}function we(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new S(t,e);else if(t instanceof S)t.target=t.target||e;else{var i=t;ne(t=new S(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=be(o,r,!0,t)&&i}if(i=be(o=t.g=e,r,!0,t)&&i,i=be(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=be(o=t.g=n[s],r,!1,t)&&i}function be(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&ie(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}_(ve,I),ve.prototype[Q]=!0,ve.prototype.removeEventListener=function(e,t,n,r){he(this,e,t,n,r)},ve.prototype.N=function(){if(ve.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)X(n[r]);delete t.g[e],t.h--}}this.J=null},ve.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ve.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var _e=d.JSON.stringify;function Ie(){var e=Ne;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Te=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Ee),(e=>e.reset()));class Ee{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ce(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Se(e){d.setTimeout((()=>{throw e}),0)}let ke,Ae=!1,Ne=new class{constructor(){this.h=this.g=null}add(e,t){const n=Te.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},De=()=>{const e=d.Promise.resolve(void 0);ke=()=>{e.then(xe)}};var xe=()=>{for(var e;e=Ie();){try{e.h.call(e.g)}catch(e){Se(e)}var t=Te;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ae=!1};function Re(e,t){ve.call(this),this.h=e||1,this.g=t||d,this.j=w(this.qb,this),this.l=Date.now()}function Pe(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Oe(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=w(e.handleEvent,e)}return 2147483647<Number(t)?-1:d.setTimeout(e,t||0)}function Le(e){e.g=Oe((()=>{e.g=null,e.i&&(e.i=!1,Le(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}_(Re,ve),(r=Re.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),we(this,"tick"),this.ga&&(Pe(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Re.$.N.call(this),Pe(this),delete this.g};class Me extends I{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Le(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fe(e){I.call(this),this.h=e,this.g={}}_(Fe,I);var Ve=[];function Ue(e,t,n,r){Array.isArray(n)||(n&&(Ve[0]=n.toString()),n=Ve);for(var i=0;i<n.length;i++){var s=ce(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Be(e){Z(e.g,(function(e,t){this.g.hasOwnProperty(t)&&de(e)}),e),e.g={}}function qe(){this.g=!0}function je(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return _e(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Fe.prototype.N=function(){Fe.$.N.call(this),Be(this)},Fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qe.prototype.Ea=function(){this.g=!1},qe.prototype.info=function(){};var ze={},Ge=null;function $e(){return Ge=Ge||new ve}function Ke(e){S.call(this,ze.Ta,e)}function He(e){const t=$e();we(t,new Ke(t))}function We(e,t){S.call(this,ze.STAT_EVENT,e),this.stat=t}function Qe(e){const t=$e();we(t,new We(t,e))}function Ye(e,t){S.call(this,ze.Ua,e),this.size=t}function Je(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){e()}),t)}ze.Ta="serverreachability",_(Ke,S),ze.STAT_EVENT="statevent",_(We,S),ze.Ua="timingevent",_(Ye,S);var Xe={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ze={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function et(){}function tt(e){return e.h||(e.h=e.i())}function nt(){}et.prototype.h=null;var rt,it={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function st(){S.call(this,"d")}function ot(){S.call(this,"c")}function at(){}function ct(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Fe(this),this.P=lt,e=V?125:void 0,this.V=new Re(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ut}function ut(){this.i=null,this.g="",this.h=!1}_(st,S),_(ot,S),_(at,et),at.prototype.g=function(){return new XMLHttpRequest},at.prototype.i=function(){return{}},rt=new at;var lt=45e3,ht={},dt={};function ft(e,t,n){e.L=1,e.v=Rt(kt(t)),e.s=n,e.S=!0,pt(e,null)}function pt(e,t){e.G=Date.now(),vt(e),e.A=kt(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),$t(n.i,"t",r),e.C=0,n=e.l.J,e.h=new ut,e.g=$n(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Me(w(e.Pa,e,e.g),e.O)),Ue(e.U,e.g,"readystatechange",e.nb),t=e.I?ee(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),He(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function mt(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function gt(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=yt(e,n),r==dt){4==t&&(e.o=4,Qe(14),i=!1),je(e.j,e.m,null,"[Incomplete Response]");break}if(r==ht){e.o=4,Qe(15),je(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}je(e.j,e.m,r,null),Tt(e,r)}mt(e)&&r!=dt&&r!=ht&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Qe(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Fn(t),t.M=!0,Qe(11))):(je(e.j,e.m,n,"[Invalid Chunked Response]"),It(e),_t(e))}function yt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?dt:(n=Number(t.substring(n,r)),isNaN(n)?ht:(r+=1)+n>t.length?dt:(t=t.slice(r,r+n),e.C=r+n,t))}function vt(e){e.Y=Date.now()+e.P,wt(e,e.P)}function wt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Je(w(e.lb,e),t)}function bt(e){e.B&&(d.clearTimeout(e.B),e.B=null)}function _t(e){0==e.l.H||e.J||Bn(e.l,e)}function It(e){bt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Pe(e.V),Be(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Tt(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Jt(n.i,e)))if(!e.K&&Jt(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Un(n),Nn(n)}Mn(n),Qe(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Je(w(n.ib,n),6e3));if(1>=Yt(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else jn(n,11)}else if((e.K||n.g==e)&&Un(n),!A(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Xt(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,xt(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Gn(r,r.J?r.pa:null,r.Y),o.K){Zt(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(bt(a),vt(a)),r.g=o}else Ln(r);0<n.j.length&&xn(n)}else"stop"!=u[0]&&"close"!=u[0]||jn(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?jn(n,7):An(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}He()}catch(e){}}function Et(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(f(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(r=ct.prototype).setTimeout=function(e){this.P=e},r.nb=function(e){e=e.target;const t=this.M;t&&3==In(e)?t.l():this.Pa(e)},r.Pa=function(e){try{if(e==this.g)e:{const l=In(this.g);var t=this.g.Ia();this.g.da();if(!(3>l)&&(3!=l||V||this.g&&(this.h.h||this.g.ja()||Tn(this.g)))){this.J||4!=l||7==t||He(),bt(this);var n=this.g.da();this.ca=n;t:if(mt(this)){var r=Tn(this.g);e="";var i=r.length,s=4==In(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){It(this),_t(this);var o="";break t}this.h.i=new d.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,Qe(12),It(this),_t(this);break e}je(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Tt(this,n)}this.S?(gt(this,l,o),V&&this.i&&3==l&&(Ue(this.U,this.V,"tick",this.mb),this.V.start())):(je(this.j,this.m,o,null),Tt(this,o)),4==l&&It(this),this.i&&!this.J&&(4==l?Bn(this.l,this):(this.i=!1,vt(this)))}else(function(e){const t={};e=(e.g&&2<=In(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(A(e[r]))continue;var n=Ce(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Qe(12)):(this.o=0,Qe(13)),It(this),_t(this)}}}catch(e){}},r.mb=function(){if(this.g){var e=In(this.g),t=this.g.ja();this.C<t.length&&(bt(this),gt(this,e,t),this.i&&4!=e&&vt(this))}},r.cancel=function(){this.J=!0,It(this)},r.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(He(),Qe(17)),It(this),this.o=2,_t(this)):wt(this,this.Y-e)};var Ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function St(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof St){this.h=e.h,At(this,e.j),this.s=e.s,this.g=e.g,Nt(this,e.m),this.l=e.l;var t=e.i,n=new qt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Dt(this,n),this.o=e.o}else e&&(t=String(e).match(Ct))?(this.h=!1,At(this,t[1]||"",!0),this.s=Pt(t[2]||""),this.g=Pt(t[3]||"",!0),Nt(this,t[4]),this.l=Pt(t[5]||"",!0),Dt(this,t[6]||"",!0),this.o=Pt(t[7]||"")):(this.h=!1,this.i=new qt(null,this.h))}function kt(e){return new St(e)}function At(e,t,n){e.j=n?Pt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Nt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Dt(e,t,n){t instanceof qt?(e.i=t,function(e,t){t&&!e.j&&(jt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(zt(this,t),$t(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Ot(t,Ut)),e.i=new qt(t,e.h))}function xt(e,t,n){e.i.set(t,n)}function Rt(e){return xt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Pt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ot(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Lt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Lt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}St.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ot(t,Mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ot(t,Mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ot(n,"/"==n.charAt(0)?Vt:Ft,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ot(n,Bt)),e.join("")};var Mt=/[#\/\?@]/g,Ft=/[#\?:]/g,Vt=/[#\?]/g,Ut=/[#\?@]/g,Bt=/#/g;function qt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function jt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function zt(e,t){jt(e),t=Kt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Gt(e,t){return jt(e),t=Kt(e,t),e.g.has(t)}function $t(e,t,n){zt(e,t),0<n.length&&(e.i=null,e.g.set(Kt(e,t),E(n)),e.h+=n.length)}function Kt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=qt.prototype).add=function(e,t){jt(this),this.i=null,e=Kt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){jt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.ta=function(){jt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},r.Z=function(e){jt(this);let t=[];if("string"==typeof e)Gt(this,e)&&(t=t.concat(this.g.get(Kt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return jt(this),this.i=null,Gt(this,e=Kt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};function Ht(e){this.l=e||Wt,d.PerformanceNavigationTiming?e=0<(e=d.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(d.g&&d.g.Ka&&d.g.Ka()&&d.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Wt=10;function Qt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Yt(e){return e.h?1:e.g?e.g.size:0}function Jt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Xt(e,t){e.g?e.g.add(t):e.h=t}function Zt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function en(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return E(e.i)}Ht.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var tn=class{stringify(e){return d.JSON.stringify(e,void 0)}parse(e){return d.JSON.parse(e,void 0)}};function nn(){this.g=new tn}function rn(e,t,n){const r=n||"";try{Et(e,(function(e,n){let i=e;p(e)&&(i=_e(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function sn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function on(e){this.l=e.fc||null,this.j=e.ob||!1}function an(e,t){ve.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=cn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_(on,et),on.prototype.g=function(){return new an(this.l,this.j)},on.prototype.i=function(e){return function(){return e}}({}),_(an,ve);var cn=0;function un(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function ln(e){e.readyState=4,e.l=null,e.j=null,e.A=null,hn(e)}function hn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=an.prototype).open=function(e,t){if(this.readyState!=cn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,hn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||d).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ln(this)),this.readyState=cn},r.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,hn(this)),this.g&&(this.readyState=3,hn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==d.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;un(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ln(this):hn(this),3==this.readyState&&un(this)}},r.Za=function(e){this.g&&(this.response=this.responseText=e,ln(this))},r.Ya=function(e){this.g&&(this.response=e,ln(this))},r.ka=function(){this.g&&ln(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(an.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var dn=d.JSON.parse;function fn(e){ve.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=pn,this.L=this.M=!1}_(fn,ve);var pn="",mn=/^https?$/i,gn=["POST","PUT"];function yn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,vn(e),bn(e)}function vn(e){e.F||(e.F=!0,we(e,"complete"),we(e,"error"))}function wn(e){if(e.h&&void 0!==h&&(!e.C[1]||4!=In(e)||2!=e.da()))if(e.v&&4==In(e))Oe(e.La,0,e);else if(we(e,"readystatechange"),4==In(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(Ct)[1]||null;!i&&d.self&&d.self.location&&(i=d.self.location.protocol.slice(0,-1)),r=!mn.test(i?i.toLowerCase():"")}n=r}if(n)we(e,"complete"),we(e,"success");else{e.m=6;try{var s=2<In(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",vn(e)}}finally{bn(e)}}}function bn(e,t){if(e.g){_n(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||we(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function _n(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(d.clearTimeout(e.A),e.A=null)}function In(e){return e.g?e.g.readyState:0}function Tn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case pn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function En(e){let t="";return Z(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Cn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=En(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):xt(e,t,n))}function Sn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function kn(e){this.Ga=0,this.j=[],this.l=new qe,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Sn("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Sn("baseRetryDelayMs",5e3,e),this.hb=Sn("retryDelaySeedMs",1e4,e),this.eb=Sn("forwardChannelMaxRetries",2,e),this.xa=Sn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Ht(e&&e.concurrentRequestLimit),this.Ja=new nn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function An(e){if(Dn(e),3==e.H){var t=e.W++,n=kt(e.I);if(xt(n,"SID",e.K),xt(n,"RID",t),xt(n,"TYPE","terminate"),Pn(e,n),(t=new ct(e,e.l,t)).L=2,t.v=Rt(kt(n)),n=!1,d.navigator&&d.navigator.sendBeacon)try{n=d.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&d.Image&&((new Image).src=t.v,n=!0),n||(t.g=$n(t.l,null),t.g.ha(t.v)),t.G=Date.now(),vt(t)}zn(e)}function Nn(e){e.g&&(Fn(e),e.g.cancel(),e.g=null)}function Dn(e){Nn(e),e.u&&(d.clearTimeout(e.u),e.u=null),Un(e),e.i.cancel(),e.m&&("number"==typeof e.m&&d.clearTimeout(e.m),e.m=null)}function xn(e){if(!Qt(e.i)&&!e.m){e.m=!0;var t=e.Na;ke||De(),Ae||(ke(),Ae=!0),Ne.add(t,e),e.C=0}}function Rn(e,t){var n;n=t?t.m:e.W++;const r=kt(e.I);xt(r,"SID",e.K),xt(r,"RID",n),xt(r,"AID",e.V),Pn(e,r),e.o&&e.s&&Cn(r,e.o,e.s),n=new ct(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=On(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Xt(e.i,n),ft(n,r,t)}function Pn(e,t){e.na&&Z(e.na,(function(e,n){xt(t,n,e)})),e.h&&Et({},(function(e,n){xt(t,n,e)}))}function On(e,t,n){n=Math.min(e.j.length,n);var r=e.h?w(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{rn(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Ln(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;ke||De(),Ae||(ke(),Ae=!0),Ne.add(t,e),e.A=0}}function Mn(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=Je(w(e.Ma,e),qn(e,e.A)),e.A++,!0)}function Fn(e){null!=e.B&&(d.clearTimeout(e.B),e.B=null)}function Vn(e){e.g=new ct(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=kt(e.wa);xt(t,"RID","rpc"),xt(t,"SID",e.K),xt(t,"AID",e.V),xt(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&xt(t,"TO",e.qa),xt(t,"TYPE","xmlhttp"),Pn(e,t),e.o&&e.s&&Cn(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Rt(kt(t)),n.s=null,n.S=!0,pt(n,e)}function Un(e){null!=e.v&&(d.clearTimeout(e.v),e.v=null)}function Bn(e,t){var n=null;if(e.g==t){Un(e),Fn(e),e.g=null;var r=2}else{if(!Jt(e.i,t))return;n=t.F,Zt(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;we(r=$e(),new Ye(r,n)),xn(e)}else Ln(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(Yt(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Je(w(e.Na,e,t),qn(e,e.C)),e.C++,0)))}(e,t)||2==r&&Mn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:jn(e,5);break;case 4:jn(e,10);break;case 3:jn(e,6);break;default:jn(e,2)}}function qn(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function jn(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=w(e.pb,e);n||(n=new St("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||At(n,"https"),Rt(n)),function(e,t){const n=new qe;if(d.Image){const r=new Image;r.onload=b(sn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=b(sn,n,r,"TestLoadImage: error",!1,t),r.onabort=b(sn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=b(sn,n,r,"TestLoadImage: timeout",!1,t),d.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Qe(2);e.H=0,e.h&&e.h.za(t),zn(e),Dn(e)}function zn(e){if(e.H=0,e.ma=[],e.h){const t=en(e.i);0==t.length&&0==e.j.length||(C(e.ma,t),C(e.ma,e.j),e.i.i.length=0,E(e.j),e.j.length=0),e.h.ya()}}function Gn(e,t,n){var r=n instanceof St?kt(n):new St(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Nt(r,r.m);else{var i=d.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new St(null);r&&At(s,r),t&&(s.g=t),i&&Nt(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&xt(r,n,t),xt(r,"VER",e.ra),Pn(e,r),r}function $n(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new fn(new on({ob:!0})):new fn(e.va)).Oa(e.J),t}function Kn(){}function Hn(){if(M&&!(10<=Number(K)))throw Error("Environmental error: no available transport.")}function Wn(e,t){ve.call(this),this.g=new kn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!A(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!A(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Jn(this)}function Qn(e){st.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Yn(){ot.call(this),this.status=1}function Jn(e){this.g=e}function Xn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Zn(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function er(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(r=fn.prototype).Oa=function(e){this.M=e},r.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():rt.g(),this.C=this.u?tt(this.u):tt(rt),this.g.onreadystatechange=w(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void yn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=d.FormData&&e instanceof d.FormData,!(0<=T(gn,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{_n(this),0<this.B&&((this.L=function(e){return M&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=w(this.ua,this)):this.A=Oe(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){yn(this,e)}},r.ua=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,we(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,we(this,"complete"),we(this,"abort"),bn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),bn(this,!0)),fn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?wn(this):this.kb())},r.kb=function(){wn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<In(this)?this.g.status:-1}catch(e){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),dn(t)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=kn.prototype).ra=8,r.H=1,r.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new ct(this,this.l,e);let s=this.s;if(this.U&&(s?(s=ee(s),ne(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=On(this,i,t),xt(n=kt(this.I),"RID",e),xt(n,"CVER",22),this.F&&xt(n,"X-HTTP-Session-Id",this.F),Pn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(En(s)))+"&"+t:this.o&&Cn(n,this.o,s)),Xt(this.i,i),this.bb&&xt(n,"TYPE","init"),this.P?(xt(n,"$req",t),xt(n,"SID","null"),i.aa=!0,ft(i,n,null)):ft(i,n,t),this.H=2}}else 3==this.H&&(e?Rn(this,e):0==this.j.length||Qt(this.i)||Rn(this))},r.Ma=function(){if(this.u=null,Vn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Je(w(this.jb,this),e)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qe(10),Nn(this),Vn(this))},r.ib=function(){null!=this.v&&(this.v=null,Nn(this),Mn(this),Qe(19))},r.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Qe(2)):(this.l.info("Failed to ping google.com"),Qe(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Kn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Hn.prototype.g=function(e,t){return new Wn(e,t)},_(Wn,ve),Wn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Qe(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Gn(e,null,e.Y),xn(e)},Wn.prototype.close=function(){An(this.g)},Wn.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=_e(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&xn(t)},Wn.prototype.N=function(){this.g.h=null,delete this.j,An(this.g),delete this.g,Wn.$.N.call(this)},_(Qn,st),_(Yn,ot),_(Jn,Kn),Jn.prototype.Ba=function(){we(this.g,"a")},Jn.prototype.Aa=function(e){we(this.g,new Qn(e))},Jn.prototype.za=function(e){we(this.g,new Yn)},Jn.prototype.ya=function(){we(this.g,"b")},_(Xn,(function(){this.blockSize=-1})),Xn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Xn.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Zn(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Zn(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Zn(this,r),i=0;break}}this.h=i,this.i+=t},Xn.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var tr={};function nr(e){return-128<=e&&128>e?function(e,t){var n=tr;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new er([0|e],0>e?-1:0)})):new er([0|e],0>e?-1:0)}function rr(e){if(isNaN(e)||!isFinite(e))return sr;if(0>e)return lr(rr(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=ir;return new er(t,0)}var ir=4294967296,sr=nr(0),or=nr(1),ar=nr(16777216);function cr(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function ur(e){return-1==e.h}function lr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new er(n,~e.h).add(or)}function hr(e,t){return e.add(lr(t))}function dr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function fr(e,t){this.g=e,this.h=t}function pr(e,t){if(cr(t))throw Error("division by zero");if(cr(e))return new fr(sr,sr);if(ur(e))return t=pr(lr(e),t),new fr(lr(t.g),lr(t.h));if(ur(t))return t=pr(e,lr(t)),new fr(lr(t.g),t.h);if(30<e.g.length){if(ur(e)||ur(t))throw Error("slowDivide_ only works with positive integers.");for(var n=or,r=t;0>=r.X(e);)n=mr(n),r=mr(r);var i=gr(n,1),s=gr(r,1);for(r=gr(r,2),n=gr(n,2);!cr(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=gr(r,1),n=gr(n,1)}return t=hr(e,i.R(t)),new fr(i,t)}for(i=sr;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=rr(n)).R(t);ur(o)||0<o.X(e);)o=(s=rr(n-=r)).R(t);cr(s)&&(s=or),i=i.add(s),e=hr(e,o)}return new fr(i,e)}function mr(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new er(n,e.h)}function gr(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new er(i,e.h)}(r=er.prototype).ea=function(){if(ur(this))return-lr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:ir+r)*t,t*=ir}return e},r.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(cr(this))return"0";if(ur(this))return"-"+lr(this).toString(e);for(var t=rr(Math.pow(e,6)),n=this,r="";;){var i=pr(n,t).g,s=((0<(n=hr(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(cr(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},r.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},r.X=function(e){return ur(e=hr(this,e))?-1:cr(e)?0:1},r.abs=function(){return ur(this)?lr(this):this},r.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new er(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(e){if(cr(this)||cr(e))return sr;if(ur(this))return ur(e)?lr(this).R(lr(e)):lr(lr(this).R(e));if(ur(e))return lr(this.R(lr(e)));if(0>this.X(ar)&&0>e.X(ar))return rr(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,dr(n,2*r+2*i),n[2*r+2*i+1]+=s*c,dr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,dr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,dr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new er(n,0)},r.gb=function(e){return pr(this,e).h},r.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new er(n,this.h&e.h)},r.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new er(n,this.h|e.h)},r.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new er(n,this.h^e.h)},Hn.prototype.createWebChannel=Hn.prototype.g,Wn.prototype.send=Wn.prototype.u,Wn.prototype.open=Wn.prototype.m,Wn.prototype.close=Wn.prototype.close,Xe.NO_ERROR=0,Xe.TIMEOUT=8,Xe.HTTP_ERROR=6,Ze.COMPLETE="complete",nt.EventType=it,it.OPEN="a",it.CLOSE="b",it.ERROR="c",it.MESSAGE="d",ve.prototype.listen=ve.prototype.O,fn.prototype.listenOnce=fn.prototype.P,fn.prototype.getLastError=fn.prototype.Sa,fn.prototype.getLastErrorCode=fn.prototype.Ia,fn.prototype.getStatus=fn.prototype.da,fn.prototype.getResponseJson=fn.prototype.Wa,fn.prototype.getResponseText=fn.prototype.ja,fn.prototype.send=fn.prototype.ha,fn.prototype.setWithCredentials=fn.prototype.Oa,Xn.prototype.digest=Xn.prototype.l,Xn.prototype.reset=Xn.prototype.reset,Xn.prototype.update=Xn.prototype.j,er.prototype.add=er.prototype.add,er.prototype.multiply=er.prototype.R,er.prototype.modulo=er.prototype.gb,er.prototype.compare=er.prototype.X,er.prototype.toNumber=er.prototype.ea,er.prototype.toString=er.prototype.toString,er.prototype.getBits=er.prototype.D,er.fromNumber=rr,er.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return lr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=rr(Math.pow(n,8)),i=sr,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=rr(Math.pow(n,o)),i=i.R(o).add(rr(a))):i=(i=i.R(r)).add(rr(a))}return i};var yr=l.createWebChannelTransport=function(){return new Hn},vr=l.getStatEventTarget=function(){return $e()},wr=l.ErrorCode=Xe,br=l.EventType=Ze,_r=l.Event=ze,Ir=l.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Tr=l.FetchXmlHttpFactory=on,Er=l.WebChannel=nt,Cr=l.XhrIo=fn,Sr=l.Md5=Xn,kr=l.Integer=er,Ar=n(4155);const Nr="@firebase/firestore";class Dr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Dr.UNAUTHENTICATED=new Dr(null),Dr.GOOGLE_CREDENTIALS=new Dr("google-credentials-uid"),Dr.FIRST_PARTY=new Dr("first-party-uid"),Dr.MOCK_USER=new Dr("mock-user");let xr="9.22.2";const Rr=new a.Yd("@firebase/firestore");function Pr(){return Rr.logLevel}function Or(e,...t){if(Rr.logLevel<=a.in.DEBUG){const n=t.map(Fr);Rr.debug(`Firestore (${xr}): ${e}`,...n)}}function Lr(e,...t){if(Rr.logLevel<=a.in.ERROR){const n=t.map(Fr);Rr.error(`Firestore (${xr}): ${e}`,...n)}}function Mr(e,...t){if(Rr.logLevel<=a.in.WARN){const n=t.map(Fr);Rr.warn(`Firestore (${xr}): ${e}`,...n)}}function Fr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Vr(e="Unexpected state"){const t=`FIRESTORE (${xr}) INTERNAL ASSERTION FAILED: `+e;throw Lr(t),new Error(t)}function Ur(e,t){e||Vr()}function Br(e,t){return e}const qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class jr extends c.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class zr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Gr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $r{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Dr.UNAUTHENTICATED)))}shutdown(){}}class Kr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Hr{constructor(e){this.t=e,this.currentUser=Dr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new zr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new zr,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Or("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Or("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new zr)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Or("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ur("string"==typeof t.accessToken),new Gr(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ur(null===e||"string"==typeof e),new Dr(e)}}class Wr{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Dr.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Qr{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Wr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(Dr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Yr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Jr{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&Or("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,Or("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Or("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?r(e):Or("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Ur("string"==typeof e.token),this.T=e.token,new Yr(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Xr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Zr{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Xr(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function ei(e,t){return e<t?-1:e>t?1:0}function ti(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function ni(e){return e+"\0"}class ri{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new jr(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new jr(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new jr(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new jr(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ri.fromMillis(Date.now())}static fromDate(e){return ri.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ri(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ei(this.nanoseconds,e.nanoseconds):ei(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ii{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ii(e)}static min(){return new ii(new ri(0,0))}static max(){return new ii(new ri(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class si{constructor(e,t,n){void 0===t?t=0:t>e.length&&Vr(),void 0===n?n=e.length-t:n>e.length-t&&Vr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===si.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof si?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class oi extends si{construct(e,t,n){return new oi(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new jr(qr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new oi(t)}static emptyPath(){return new oi([])}}const ai=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ci extends si{construct(e,t,n){return new ci(e,t,n)}static isValidIdentifier(e){return ai.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ci.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ci(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new jr(qr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new jr(qr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new jr(qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new jr(qr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ci(t)}static emptyPath(){return new ci([])}}class ui{constructor(e){this.path=e}static fromPath(e){return new ui(oi.fromString(e))}static fromName(e){return new ui(oi.fromString(e).popFirst(5))}static empty(){return new ui(oi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oi.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ui(new oi(e.slice()))}}class li{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function hi(e){return e.fields.find((e=>2===e.kind))}function di(e){return e.fields.filter((e=>2!==e.kind))}li.UNKNOWN_ID=-1;class fi{constructor(e,t){this.fieldPath=e,this.kind=t}}class pi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new pi(0,yi.min())}}function mi(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ii.fromTimestamp(1e9===r?new ri(n+1,0):new ri(n,r));return new yi(i,ui.empty(),t)}function gi(e){return new yi(e.readTime,e.key,-1)}class yi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new yi(ii.min(),ui.empty(),-1)}static max(){return new yi(ii.max(),ui.empty(),-1)}}function vi(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ui.comparator(e.documentKey,t.documentKey),0!==n?n:ei(e.largestBatchId,t.largestBatchId))}const wi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function _i(e){if(e.code!==qr.FAILED_PRECONDITION||e.message!==wi)throw e;Or("LocalStore","Unexpectedly lost primary lease")}class Ii{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Vr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ii(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ii?t:Ii.resolve(t)}catch(e){return Ii.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ii.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ii.reject(t)}static resolve(e){return new Ii(((t,n)=>{t(e)}))}static reject(e){return new Ii(((t,n)=>{n(e)}))}static waitFor(e){return new Ii(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Ii.resolve(!1);for(const n of e)t=t.next((e=>e?Ii.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Ii(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Ii(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class Ti{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new zr,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new Si(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=xi(t.target.error);this.v.reject(new Si(e,n))}}static open(e,t,n,r){try{return new Ti(t,e.transaction(r,n))}catch(e){throw new Si(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(Or("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ai(t)}}class Ei{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===Ei.S((0,c.z$)())&&Lr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Or("SimpleDb","Removing database:",e),Ni(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,c.hl)())return!1;if(Ei.C())return!0;const e=(0,c.z$)(),t=Ei.S(e),n=0<t&&t<10,r=Ei.N(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return void 0!==Ar&&"YES"===(null===(e=Ar.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(Or("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Si(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new jr(qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new jr(qr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Si(e,r))},r.onupgradeneeded=e=>{Or("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next((()=>{Or("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=Ti.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),Ii.reject(e)))).toPromise();return s.catch((()=>{})),await t.R,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(Or("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ci{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return Ni(this.L.delete())}}class Si extends jr{constructor(e,t){super(qr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ki(e){return"IndexedDbTransactionError"===e.name}class Ai{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Or("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Or("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ni(n)}add(e){return Or("SimpleDb","ADD",this.store.name,e,e),Ni(this.store.add(e))}get(e){return Ni(this.store.get(e)).next((t=>(void 0===t&&(t=null),Or("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Or("SimpleDb","DELETE",this.store.name,e),Ni(this.store.delete(e))}count(){return Or("SimpleDb","COUNT",this.store.name),Ni(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new Ii(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Ii(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){Or("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Z(e){const t=this.cursor({});return new Ii(((n,r)=>{t.onerror=e=>{const t=xi(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new Ii(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Ci(i),o=t(i.primaryKey,i.value,s);if(o instanceof Ii){const e=o.catch((e=>(s.done(),Ii.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>Ii.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ni(e){return new Ii(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=xi(e.target.error);n(t)}}))}let Di=!1;function xi(e){const t=Ei.S((0,c.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new jr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Di||(Di=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Ri{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){Or("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{Or("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){ki(e)?Or("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await _i(e)}await this.et(6e4)}))}}class Pi{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let r=t,i=!0;return Ii.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return Or("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(r,n))).next((n=>(Or("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=gi(t);vi(r,n)>0&&(n=r)})),new yi(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Oi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function Li(e){return null==e}function Mi(e){return 0===e&&1/e==-1/0}function Fi(e){return"number"==typeof e&&Number.isInteger(e)&&!Mi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Vi(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Bi(t)),t=Ui(e.get(n),t);return Bi(t)}function Ui(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Bi(e){return e+""}function qi(e){const t=e.length;if(Ur(t>=2),2===t)return Ur(""===e.charAt(0)&&""===e.charAt(1)),oi.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Vr(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Vr()}s=t+2}return new oi(r)}Oi.ct=-1;const ji=["userId","batchId"];function zi(e,t){return[e,Vi(t)]}function Gi(e,t,n){return[e,Vi(t),n]}const $i={},Ki=["prefixPath","collectionGroup","readTime","documentId"],Hi=["prefixPath","collectionGroup","documentId"],Wi=["collectionGroup","readTime","prefixPath","documentId"],Qi=["canonicalId","targetId"],Yi=["targetId","path"],Ji=["path","targetId"],Xi=["collectionId","parent"],Zi=["indexId","uid"],es=["uid","sequenceNumber"],ts=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ns=["indexId","uid","orderedDocumentKey"],rs=["userId","collectionPath","documentId"],is=["userId","collectionPath","largestBatchId"],ss=["userId","collectionGroup","largestBatchId"],os=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],as=[...os,"documentOverlays"],cs=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],us=cs,ls=[...us,"indexConfiguration","indexState","indexEntries"];class hs extends bi{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function ds(e,t){const n=Br(e);return Ei.M(n.ht,t)}function fs(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ps(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ms(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class gs{constructor(e,t){this.comparator=e,this.root=t||vs.EMPTY}insert(e,t){return new gs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,vs.BLACK,null,null))}remove(e){return new gs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,vs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ys(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ys(this.root,e,this.comparator,!1)}getReverseIterator(){return new ys(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ys(this.root,e,this.comparator,!0)}}class ys{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class vs{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:vs.RED,this.left=null!=r?r:vs.EMPTY,this.right=null!=i?i:vs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new vs(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return vs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return vs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Vr();if(this.right.isRed())throw Vr();const e=this.left.check();if(e!==this.right.check())throw Vr();return e+(this.isRed()?0:1)}}vs.EMPTY=null,vs.RED=!0,vs.BLACK=!1,vs.EMPTY=new class{constructor(){this.size=0}get key(){throw Vr()}get value(){throw Vr()}get color(){throw Vr()}get left(){throw Vr()}get right(){throw Vr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new vs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ws{constructor(e){this.comparator=e,this.data=new gs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new bs(this.data.getIterator())}getIteratorFrom(e){return new bs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof ws))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ws(this.comparator);return t.data=e,t}}class bs{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function _s(e){return e.hasNext()?e.getNext():void 0}class Is{constructor(e){this.fields=e,e.sort(ci.comparator)}static empty(){return new Is([])}unionWith(e){let t=new ws(ci.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Is(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ti(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ts extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Es{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ts("Invalid base64 string: "+e):e}}(e);return new Es(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Es(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ei(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Es.EMPTY_BYTE_STRING=new Es("");const Cs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ss(e){if(Ur(!!e),"string"==typeof e){let t=0;const n=Cs.exec(e);if(Ur(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ks(e.seconds),nanos:ks(e.nanos)}}function ks(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function As(e){return"string"==typeof e?Es.fromBase64String(e):Es.fromUint8Array(e)}function Ns(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ds(e){const t=e.mapValue.fields.__previous_value__;return Ns(t)?Ds(t):t}function xs(e){const t=Ss(e.mapValue.fields.__local_write_time__.timestampValue);return new ri(t.seconds,t.nanos)}class Rs{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Ps{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ps("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ps&&e.projectId===this.projectId&&e.database===this.database}}const Os={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ls={nullValue:"NULL_VALUE"};function Ms(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ns(e)?4:Ys(e)?9007199254740991:10:Vr()}function Fs(e,t){if(e===t)return!0;const n=Ms(e);if(n!==Ms(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return xs(e).isEqual(xs(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ss(e.timestampValue),r=Ss(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return As(e.bytesValue).isEqual(As(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ks(e.geoPointValue.latitude)===ks(t.geoPointValue.latitude)&&ks(e.geoPointValue.longitude)===ks(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ks(e.integerValue)===ks(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ks(e.doubleValue),r=ks(t.doubleValue);return n===r?Mi(n)===Mi(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ti(e.arrayValue.values||[],t.arrayValue.values||[],Fs);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(fs(n)!==fs(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Fs(n[e],r[e])))return!1;return!0}(e,t);default:return Vr()}}function Vs(e,t){return void 0!==(e.values||[]).find((e=>Fs(e,t)))}function Us(e,t){if(e===t)return 0;const n=Ms(e),r=Ms(t);if(n!==r)return ei(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ei(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ks(e.integerValue||e.doubleValue),r=ks(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Bs(e.timestampValue,t.timestampValue);case 4:return Bs(xs(e),xs(t));case 5:return ei(e.stringValue,t.stringValue);case 6:return function(e,t){const n=As(e),r=As(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=ei(n[e],r[e]);if(0!==t)return t}return ei(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ei(ks(e.latitude),ks(t.latitude));return 0!==n?n:ei(ks(e.longitude),ks(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Us(n[e],r[e]);if(t)return t}return ei(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Os.mapValue&&t===Os.mapValue)return 0;if(e===Os.mapValue)return 1;if(t===Os.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=ei(r[e],s[e]);if(0!==t)return t;const o=Us(n[r[e]],i[s[e]]);if(0!==o)return o}return ei(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Vr()}}function Bs(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ei(e,t);const n=Ss(e),r=Ss(t),i=ei(n.seconds,r.seconds);return 0!==i?i:ei(n.nanos,r.nanos)}function qs(e){return js(e)}function js(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ss(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?As(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ui.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=js(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${js(e.fields[i])}`;return n+"}"}(e.mapValue):Vr();var t,n}function zs(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Gs(e){return!!e&&"integerValue"in e}function $s(e){return!!e&&"arrayValue"in e}function Ks(e){return!!e&&"nullValue"in e}function Hs(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ws(e){return!!e&&"mapValue"in e}function Qs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ps(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Qs(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Qs(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ys(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Js(e){return"nullValue"in e?Ls:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?zs(Ps.empty(),ui.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Vr()}function Xs(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?zs(Ps.empty(),ui.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Os:Vr()}function Zs(e,t){const n=Us(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function eo(e,t){const n=Us(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class to{constructor(e){this.value=e}static empty(){return new to({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qs(t)}setAll(e){let t=ci.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Qs(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ws(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ps(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new to(Qs(this.value))}}function no(e){const t=[];return ps(e.fields,((e,n)=>{const r=new ci([e]);if(Ws(n)){const e=no(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Is(t)}class ro{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ro(e,0,ii.min(),ii.min(),ii.min(),to.empty(),0)}static newFoundDocument(e,t,n,r){return new ro(e,1,t,ii.min(),n,r,0)}static newNoDocument(e,t){return new ro(e,2,t,ii.min(),ii.min(),to.empty(),0)}static newUnknownDocument(e,t){return new ro(e,3,t,ii.min(),ii.min(),to.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ii.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=to.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=to.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ii.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ro&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ro(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class io{constructor(e,t){this.position=e,this.inclusive=t}}function so(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ui.comparator(ui.fromName(o.referenceValue),n.key):Us(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function oo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Fs(e.position[n],t.position[n]))return!1;return!0}class ao{constructor(e,t="asc"){this.field=e,this.dir=t}}function co(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class uo{}class lo extends uo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new _o(e,t,n):"array-contains"===t?new Co(e,n):"in"===t?new So(e,n):"not-in"===t?new ko(e,n):"array-contains-any"===t?new Ao(e,n):new lo(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Io(e,n):new To(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Us(t,this.value)):null!==t&&Ms(this.value)===Ms(t)&&this.matchesComparison(Us(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Vr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ho extends uo{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new ho(e,t)}matches(e){return fo(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function fo(e){return"and"===e.op}function po(e){return"or"===e.op}function mo(e){return go(e)&&fo(e)}function go(e){for(const t of e.filters)if(t instanceof ho)return!1;return!0}function yo(e){if(e instanceof lo)return e.field.canonicalString()+e.op.toString()+qs(e.value);if(mo(e))return e.filters.map((e=>yo(e))).join(",");{const t=e.filters.map((e=>yo(e))).join(",");return`${e.op}(${t})`}}function vo(e,t){return e instanceof lo?function(e,t){return t instanceof lo&&e.op===t.op&&e.field.isEqual(t.field)&&Fs(e.value,t.value)}(e,t):e instanceof ho?function(e,t){return t instanceof ho&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&vo(n,t.filters[r])),!0)}(e,t):void Vr()}function wo(e,t){const n=e.filters.concat(t);return ho.create(n,e.op)}function bo(e){return e instanceof lo?function(e){return`${e.field.canonicalString()} ${e.op} ${qs(e.value)}`}(e):e instanceof ho?function(e){return e.op.toString()+" {"+e.getFilters().map(bo).join(" ,")+"}"}(e):"Filter"}class _o extends lo{constructor(e,t,n){super(e,t,n),this.key=ui.fromName(n.referenceValue)}matches(e){const t=ui.comparator(e.key,this.key);return this.matchesComparison(t)}}class Io extends lo{constructor(e,t){super(e,"in",t),this.keys=Eo("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class To extends lo{constructor(e,t){super(e,"not-in",t),this.keys=Eo("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Eo(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ui.fromName(e.referenceValue)))}class Co extends lo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $s(t)&&Vs(t.arrayValue,this.value)}}class So extends lo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Vs(this.value.arrayValue,t)}}class ko extends lo{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Vs(this.value.arrayValue,t)}}class Ao extends lo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$s(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Vs(this.value.arrayValue,e)))}}class No{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function Do(e,t=null,n=[],r=[],i=null,s=null,o=null){return new No(e,t,n,r,i,s,o)}function xo(e){const t=Br(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>yo(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Li(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>qs(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>qs(e))).join(",")),t.dt=e}return t.dt}function Ro(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!co(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!vo(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!oo(e.startAt,t.startAt)&&oo(e.endAt,t.endAt)}function Po(e){return ui.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Oo(e,t){return e.filters.filter((e=>e instanceof lo&&e.field.isEqual(t)))}function Lo(e,t,n){let r=Ls,i=!0;for(const n of Oo(e,t)){let e=Ls,t=!0;switch(n.op){case"<":case"<=":e=Js(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Ls}Zs({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Zs({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Mo(e,t,n){let r=Os,i=!0;for(const n of Oo(e,t)){let e=Os,t=!0;switch(n.op){case">=":case">":e=Xs(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Os}eo({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];eo({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Fo{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Vo(e,t,n,r,i,s,o,a){return new Fo(e,t,n,r,i,s,o,a)}function Uo(e){return new Fo(e)}function Bo(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function qo(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function jo(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function zo(e){return null!==e.collectionGroup}function Go(e){const t=Br(e);if(null===t.wt){t.wt=[];const e=jo(t),n=qo(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new ao(e)),t.wt.push(new ao(ci.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new ao(ci.keyField(),e))}}}return t.wt}function $o(e){const t=Br(e);if(!t._t)if("F"===t.limitType)t._t=Do(t.path,t.collectionGroup,Go(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Go(t)){const t="desc"===n.dir?"asc":"desc";e.push(new ao(n.field,t))}const n=t.endAt?new io(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new io(t.startAt.position,t.startAt.inclusive):null;t._t=Do(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Ko(e,t){t.getFirstInequalityField(),jo(e);const n=e.filters.concat([t]);return new Fo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ho(e,t,n){return new Fo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Wo(e,t){return Ro($o(e),$o(t))&&e.limitType===t.limitType}function Qo(e){return`${xo($o(e))}|lt:${e.limitType}`}function Yo(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>bo(e))).join(", ")}]`),Li(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>qs(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>qs(e))).join(",")),`Target(${t})`}($o(e))}; limitType=${e.limitType})`}function Jo(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ui.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Go(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=so(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Go(e),t))&&!(e.endAt&&!function(e,t,n){const r=so(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Go(e),t))}(e,t)}function Xo(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Zo(e){return(t,n)=>{let r=!1;for(const i of Go(e)){const e=ea(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function ea(e,t,n){const r=e.field.isKeyField()?ui.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Us(r,i):Vr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Vr()}}class ta{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ps(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return ms(this.inner)}size(){return this.innerSize}}const na=new gs(ui.comparator);function ra(){return na}const ia=new gs(ui.comparator);function sa(...e){let t=ia;for(const n of e)t=t.insert(n.key,n);return t}function oa(e){let t=ia;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function aa(){return ua()}function ca(){return ua()}function ua(){return new ta((e=>e.toString()),((e,t)=>e.isEqual(t)))}const la=new gs(ui.comparator),ha=new ws(ui.comparator);function da(...e){let t=ha;for(const n of e)t=t.add(n);return t}const fa=new ws(ei);function pa(){return fa}function ma(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mi(t)?"-0":t}}function ga(e){return{integerValue:""+e}}function ya(e,t){return Fi(t)?ga(t):ma(e,t)}class va{constructor(){this._=void 0}}function wa(e,t,n){return e instanceof Ia?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ns(t)&&(t=Ds(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Ta?Ea(e,t):e instanceof Ca?Sa(e,t):function(e,t){const n=_a(e,t),r=Aa(n)+Aa(e.gt);return Gs(n)&&Gs(e.gt)?ga(r):ma(e.serializer,r)}(e,t)}function ba(e,t,n){return e instanceof Ta?Ea(e,t):e instanceof Ca?Sa(e,t):n}function _a(e,t){return e instanceof ka?Gs(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Ia extends va{}class Ta extends va{constructor(e){super(),this.elements=e}}function Ea(e,t){const n=Na(t);for(const t of e.elements)n.some((e=>Fs(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Ca extends va{constructor(e){super(),this.elements=e}}function Sa(e,t){let n=Na(t);for(const t of e.elements)n=n.filter((e=>!Fs(e,t)));return{arrayValue:{values:n}}}class ka extends va{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Aa(e){return ks(e.integerValue||e.doubleValue)}function Na(e){return $s(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Da{constructor(e,t){this.field=e,this.transform=t}}class xa{constructor(e,t){this.version=e,this.transformResults=t}}class Ra{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ra}static exists(e){return new Ra(void 0,e)}static updateTime(e){return new Ra(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Pa(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Oa{}function La(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new $a(e.key,Ra.none()):new Ba(e.key,e.data,Ra.none());{const n=e.data,r=to.empty();let i=new ws(ci.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new qa(e.key,r,new Is(i.toArray()),Ra.none())}}function Ma(e,t,n){e instanceof Ba?function(e,t,n){const r=e.value.clone(),i=za(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof qa?function(e,t,n){if(!Pa(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=za(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ja(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Fa(e,t,n,r){return e instanceof Ba?function(e,t,n,r){if(!Pa(e.precondition,t))return n;const i=e.value.clone(),s=Ga(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof qa?function(e,t,n,r){if(!Pa(e.precondition,t))return n;const i=Ga(e.fieldTransforms,r,t),s=t.data;return s.setAll(ja(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Pa(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Va(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=_a(r.transform,e||null);null!=i&&(null===n&&(n=to.empty()),n.set(r.field,i))}return n||null}function Ua(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ti(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ta&&t instanceof Ta||e instanceof Ca&&t instanceof Ca?ti(e.elements,t.elements,Fs):e instanceof ka&&t instanceof ka?Fs(e.gt,t.gt):e instanceof Ia&&t instanceof Ia}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ba extends Oa{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class qa extends Oa{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ja(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function za(e,t,n){const r=new Map;Ur(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,ba(o,a,n[i]))}return r}function Ga(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,wa(e,s,t))}return r}class $a extends Oa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ka extends Oa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ha{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Ma(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Fa(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Fa(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ca();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=La(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ii.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),da())}isEqual(e){return this.batchId===e.batchId&&ti(this.mutations,e.mutations,((e,t)=>Ua(e,t)))&&ti(this.baseMutations,e.baseMutations,((e,t)=>Ua(e,t)))}}class Wa{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Ur(e.mutations.length===n.length);let r=la;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Wa(e,t,n,r)}}class Qa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ya{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ja,Xa;function Za(e){switch(e){default:return Vr();case qr.CANCELLED:case qr.UNKNOWN:case qr.DEADLINE_EXCEEDED:case qr.RESOURCE_EXHAUSTED:case qr.INTERNAL:case qr.UNAVAILABLE:case qr.UNAUTHENTICATED:return!1;case qr.INVALID_ARGUMENT:case qr.NOT_FOUND:case qr.ALREADY_EXISTS:case qr.PERMISSION_DENIED:case qr.FAILED_PRECONDITION:case qr.ABORTED:case qr.OUT_OF_RANGE:case qr.UNIMPLEMENTED:case qr.DATA_LOSS:return!0}}function ec(e){if(void 0===e)return Lr("GRPC error has no .code"),qr.UNKNOWN;switch(e){case Ja.OK:return qr.OK;case Ja.CANCELLED:return qr.CANCELLED;case Ja.UNKNOWN:return qr.UNKNOWN;case Ja.DEADLINE_EXCEEDED:return qr.DEADLINE_EXCEEDED;case Ja.RESOURCE_EXHAUSTED:return qr.RESOURCE_EXHAUSTED;case Ja.INTERNAL:return qr.INTERNAL;case Ja.UNAVAILABLE:return qr.UNAVAILABLE;case Ja.UNAUTHENTICATED:return qr.UNAUTHENTICATED;case Ja.INVALID_ARGUMENT:return qr.INVALID_ARGUMENT;case Ja.NOT_FOUND:return qr.NOT_FOUND;case Ja.ALREADY_EXISTS:return qr.ALREADY_EXISTS;case Ja.PERMISSION_DENIED:return qr.PERMISSION_DENIED;case Ja.FAILED_PRECONDITION:return qr.FAILED_PRECONDITION;case Ja.ABORTED:return qr.ABORTED;case Ja.OUT_OF_RANGE:return qr.OUT_OF_RANGE;case Ja.UNIMPLEMENTED:return qr.UNIMPLEMENTED;case Ja.DATA_LOSS:return qr.DATA_LOSS;default:return Vr()}}(Xa=Ja||(Ja={}))[Xa.OK=0]="OK",Xa[Xa.CANCELLED=1]="CANCELLED",Xa[Xa.UNKNOWN=2]="UNKNOWN",Xa[Xa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xa[Xa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xa[Xa.NOT_FOUND=5]="NOT_FOUND",Xa[Xa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xa[Xa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xa[Xa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xa[Xa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xa[Xa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xa[Xa.ABORTED=10]="ABORTED",Xa[Xa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xa[Xa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xa[Xa.INTERNAL=13]="INTERNAL",Xa[Xa.UNAVAILABLE=14]="UNAVAILABLE",Xa[Xa.DATA_LOSS=15]="DATA_LOSS";class tc{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return nc}static getOrCreateInstance(){return null===nc&&(nc=new tc),nc}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let nc=null;function rc(){return new TextEncoder}const ic=new kr([4294967295,4294967295],0);function sc(e){const t=rc().encode(e),n=new Sr;return n.update(t),new Uint8Array(n.digest())}function oc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new kr([n,r],0),new kr([i,s],0)]}class ac{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new cc(`Invalid padding: ${t}`);if(n<0)throw new cc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new cc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new cc(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=kr.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(kr.fromNumber(n)));return 1===r.compare(ic)&&(r=new kr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=sc(e),[n,r]=oc(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new ac(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=sc(e),[n,r]=oc(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class cc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class uc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,lc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new uc(ii.min(),r,new gs(ei),ra(),da())}}class lc{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new lc(n,t,da(),da(),da())}}class hc{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class dc{constructor(e,t){this.targetId=e,this.Vt=t}}class fc{constructor(e,t,n=Es.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class pc{constructor(){this.St=0,this.Dt=yc(),this.Ct=Es.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=da(),t=da(),n=da();return this.Dt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Vr()}})),new lc(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=yc()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class mc{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=ra(),this.zt=gc(),this.Wt=new gs(ei)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:Vr()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){const s=i.target;if(Po(s))if(0===r){const e=new ui(s.path);this.Yt(n,e,ro.newNoDocument(e,ii.min()))}else Ur(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(e,i);if(0!==r){this.ee(n);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=tc.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:r}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=As(i).toUint8Array()}catch(e){if(e instanceof Ts)return Mr("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new ac(a,s,o)}catch(e){return Mr(e instanceof cc?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)})),r}ce(e){const t=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&Po(i.target)){const t=new ui(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,ro.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}}));let n=da();this.zt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const r=new uc(e,t,this.Wt,this.jt,n);return this.jt=ra(),this.zt=gc(),this.Wt=new gs(ei),r}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new pc,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new ws(ei),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||Or("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new pc),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function gc(){return new gs(ui.comparator)}function yc(){return new gs(ui.comparator)}const vc={asc:"ASCENDING",desc:"DESCENDING"},wc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bc={and:"AND",or:"OR"};class _c{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ic(e,t){return e.useProto3Json||Li(t)?t:{value:t}}function Tc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ec(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Cc(e,t){return Tc(e,t.toTimestamp())}function Sc(e){return Ur(!!e),ii.fromTimestamp(function(e){const t=Ss(e);return new ri(t.seconds,t.nanos)}(e))}function kc(e,t){return function(e){return new oi(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Ac(e){const t=oi.fromString(e);return Ur(Yc(t)),t}function Nc(e,t){return kc(e.databaseId,t.path)}function Dc(e,t){const n=Ac(t);if(n.get(1)!==e.databaseId.projectId)throw new jr(qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new jr(qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ui(Oc(n))}function xc(e,t){return kc(e.databaseId,t)}function Rc(e){const t=Ac(e);return 4===t.length?oi.emptyPath():Oc(t)}function Pc(e){return new oi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Oc(e){return Ur(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Lc(e,t,n){return{name:Nc(e,t),fields:n.value.mapValue.fields}}function Mc(e,t,n){const r=Dc(e,t.name),i=Sc(t.updateTime),s=t.createTime?Sc(t.createTime):ii.min(),o=new to({mapValue:{fields:t.fields}}),a=ro.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Fc(e,t){let n;if(t instanceof Ba)n={update:Lc(e,t.key,t.value)};else if(t instanceof $a)n={delete:Nc(e,t.key)};else if(t instanceof qa)n={update:Lc(e,t.key,t.data),updateMask:Qc(t.fieldMask)};else{if(!(t instanceof Ka))return Vr();n={verify:Nc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Ia)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ta)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ca)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ka)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Vr()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Cc(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Vr()}(e,t.precondition)),n}function Vc(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Ra.updateTime(Sc(e.updateTime)):void 0!==e.exists?Ra.exists(e.exists):Ra.none()}(t.currentDocument):Ra.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Ur("REQUEST_TIME"===t.setToServerValue),n=new Ia;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Ta(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ca(e)}else"increment"in t?n=new ka(e,t.increment):Vr();const r=ci.fromServerFormat(t.fieldPath);return new Da(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Dc(e,t.update.name),s=new to({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Is(t.map((e=>ci.fromServerFormat(e))))}(t.updateMask);return new qa(i,s,e,n,r)}return new Ba(i,s,n,r)}if(t.delete){const r=Dc(e,t.delete);return new $a(r,n)}if(t.verify){const r=Dc(e,t.verify);return new Ka(r,n)}return Vr()}function Uc(e,t){return{documents:[xc(e,t.path)]}}function Bc(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=xc(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=xc(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Wc(ho.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Kc(e.field),direction:zc(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Ic(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function qc(e){let t=Rc(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Ur(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=jc(e);return t instanceof ho&&mo(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new ao(Hc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Li(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new io(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new io(n,t)}(n.endAt)),Vo(t,i,o,s,a,"F",c,u)}function jc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Hc(e.unaryFilter.field);return lo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Hc(e.unaryFilter.field);return lo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Hc(e.unaryFilter.field);return lo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Hc(e.unaryFilter.field);return lo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Vr()}}(e):void 0!==e.fieldFilter?function(e){return lo.create(Hc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ho.create(e.compositeFilter.filters.map((e=>jc(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Vr()}}(e.compositeFilter.op))}(e):Vr()}function zc(e){return vc[e]}function Gc(e){return wc[e]}function $c(e){return bc[e]}function Kc(e){return{fieldPath:e.canonicalString()}}function Hc(e){return ci.fromServerFormat(e.fieldPath)}function Wc(e){return e instanceof lo?function(e){if("=="===e.op){if(Hs(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NAN"}};if(Ks(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Hs(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NOT_NAN"}};if(Ks(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Kc(e.field),op:Gc(e.op),value:e.value}}}(e):e instanceof ho?function(e){const t=e.getFilters().map((e=>Wc(e)));return 1===t.length?t[0]:{compositeFilter:{op:$c(e.op),filters:t}}}(e):Vr()}function Qc(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Yc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Jc{constructor(e,t,n,r,i=ii.min(),s=ii.min(),o=Es.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Jc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Jc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Jc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Jc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Xc{constructor(e){this.fe=e}}function Zc(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:eu(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Nc(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Tc(e,t.version.toTimestamp()),createTime:Tc(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:tu(t.version)};else{if(!t.isUnknownDocument())return Vr();r.unknownDocument={path:n.path.toArray(),version:tu(t.version)}}return r}function eu(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function tu(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function nu(e){const t=new ri(e.seconds,e.nanoseconds);return ii.fromTimestamp(t)}function ru(e,t){const n=(t.baseMutations||[]).map((t=>Vc(e.fe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Vc(e.fe,t))),i=ri.fromMillis(t.localWriteTimeMs);return new Ha(t.batchId,i,n,r)}function iu(e){const t=nu(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?nu(e.lastLimboFreeSnapshotVersion):ii.min();let r;var i;return void 0!==e.query.documents?(Ur(1===(i=e.query).documents.length),r=$o(Uo(Rc(i.documents[0])))):r=function(e){return $o(qc(e))}(e.query),new Jc(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Es.fromBase64String(e.resumeToken))}function su(e,t){const n=tu(t.snapshotVersion),r=tu(t.lastLimboFreeSnapshotVersion);let i;i=Po(t.target)?Uc(e.fe,t.target):Bc(e.fe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:xo(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ou(e){const t=qc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ho(t,t.limit,"L"):t}function au(e,t){return new Qa(t.largestBatchId,Vc(e.fe,t.overlayMutation))}function cu(e,t){const n=t.path.lastSegment();return[e,Vi(t.path.popLast()),n]}function uu(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:tu(r.readTime),documentKey:Vi(r.documentKey.path),largestBatchId:r.largestBatchId}}class lu{getBundleMetadata(e,t){return hu(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:nu(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return hu(e).put({bundleId:(n=t).id,createTime:tu(Sc(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return du(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:ou(t.bundledQuery),readTime:nu(t.readTime)};var t}))}saveNamedQuery(e,t){return du(e).put(function(e){return{name:e.name,readTime:tu(Sc(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function hu(e){return ds(e,"bundles")}function du(e){return ds(e,"namedQueries")}class fu{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){const n=t.uid||"";return new fu(e,n)}getOverlay(e,t){return pu(e).get(cu(this.userId,t)).next((e=>e?au(this.serializer,e):null))}getOverlays(e,t){const n=aa();return Ii.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new Qa(t,i);r.push(this.we(e,s))})),Ii.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Vi(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(pu(e).J("collectionPathOverlayIndex",r))})),Ii.waitFor(i)}getOverlaysForCollection(e,t,n){const r=aa(),i=Vi(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return pu(e).j("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=au(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=aa();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return pu(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=au(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}we(e,t){return pu(e).put(function(e,t,n){const[r,i,s]=cu(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Fc(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function pu(e){return ds(e,"documentOverlays")}class mu{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(ks(e.integerValue));else if("doubleValue"in e){const n=ks(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Mi(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(As(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?Ys(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):Vr()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),ui.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function gu(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function yu(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=gu(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}mu.Ve=new mu;class vu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{const e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{const e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){const t=this.Fe(e),n=yu(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){const t=this.Fe(e),n=yu(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class wu{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class bu{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class _u{constructor(){this.je=new vu,this.ze=new wu(this.je),this.We=new bu(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Iu{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Iu(this.indexId,this.documentKey,this.arrayValue,n)}}function Tu(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Eu(e.arrayValue,t.arrayValue),0!==n?n:(n=Eu(e.directionalValue,t.directionalValue),0!==n?n:ui.comparator(e.documentKey,t.documentKey)))}function Eu(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Cu{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ze=e:this.Xe.push(e)}}tn(e){Ur(e.collectionGroup===this.collectionId);const t=hi(e);if(void 0!==t&&!this.en(t))return!1;const n=di(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Su(e){var t,n;if(Ur(e instanceof lo||e instanceof ho),e instanceof lo){if(e instanceof So){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>lo.create(e.field,"==",t))))||[];return ho.create(r,"or")}return e}const r=e.filters.map((e=>Su(e)));return ho.create(r,e.op)}function ku(e){if(0===e.getFilters().length)return[];const t=xu(Su(e));return Ur(Du(t)),Au(t)||Nu(t)?[t]:t.getFilters()}function Au(e){return e instanceof lo}function Nu(e){return e instanceof ho&&mo(e)}function Du(e){return Au(e)||Nu(e)||function(e){if(e instanceof ho&&po(e)){for(const t of e.getFilters())if(!Au(t)&&!Nu(t))return!1;return!0}return!1}(e)}function xu(e){if(Ur(e instanceof lo||e instanceof ho),e instanceof lo)return e;if(1===e.filters.length)return xu(e.filters[0]);const t=e.filters.map((e=>xu(e)));let n=ho.create(t,e.op);return n=Ou(n),Du(n)?n:(Ur(n instanceof ho),Ur(fo(n)),Ur(n.filters.length>1),n.filters.reduce(((e,t)=>Ru(e,t))))}function Ru(e,t){let n;return Ur(e instanceof lo||e instanceof ho),Ur(t instanceof lo||t instanceof ho),n=e instanceof lo?t instanceof lo?function(e,t){return ho.create([e,t],"and")}(e,t):Pu(e,t):t instanceof lo?Pu(t,e):function(e,t){if(Ur(e.filters.length>0&&t.filters.length>0),fo(e)&&fo(t))return wo(e,t.getFilters());const n=po(e)?e:t,r=po(e)?t:e,i=n.filters.map((e=>Ru(e,r)));return ho.create(i,"or")}(e,t),Ou(n)}function Pu(e,t){if(fo(t))return wo(t,e.getFilters());{const n=t.filters.map((t=>Ru(e,t)));return ho.create(n,"or")}}function Ou(e){if(Ur(e instanceof lo||e instanceof ho),e instanceof lo)return e;const t=e.getFilters();if(1===t.length)return Ou(t[0]);if(go(e))return e;const n=t.map((e=>Ou(e))),r=[];return n.forEach((t=>{t instanceof lo?r.push(t):t instanceof ho&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:ho.create(r,e.op)}class Lu{constructor(){this.rn=new Mu}addToCollectionParentIndex(e,t){return this.rn.add(t),Ii.resolve()}getCollectionParents(e,t){return Ii.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return Ii.resolve()}deleteFieldIndex(e,t){return Ii.resolve()}getDocumentsMatchingTarget(e,t){return Ii.resolve(null)}getIndexType(e,t){return Ii.resolve(0)}getFieldIndexes(e,t){return Ii.resolve([])}getNextCollectionGroupToUpdate(e){return Ii.resolve(null)}getMinOffset(e,t){return Ii.resolve(yi.min())}getMinOffsetFromCollectionGroup(e,t){return Ii.resolve(yi.min())}updateCollectionGroup(e,t,n){return Ii.resolve()}updateIndexEntries(e,t){return Ii.resolve()}}class Mu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ws(oi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ws(oi.comparator)).toArray()}}const Fu=new Uint8Array(0);class Vu{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Mu,this.un=new ta((e=>xo(e)),((e,t)=>Ro(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.on.add(t)}));const i={collectionId:n,parent:Vi(r)};return Uu(e).put(i)}return Ii.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[ni(t),""],!1,!0);return Uu(e).j(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(qi(r.parent))}return n}))}addFieldIndex(e,t){const n=qu(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=ju(e);return i.next((e=>{n.put(uu(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=qu(e),r=ju(e),i=Bu(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Bu(e);let r=!0;const i=new Map;return Ii.forEach(this.cn(t),(t=>this.an(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=da();const r=[];return Ii.forEach(i,((i,s)=>{var o;Or("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${xo(t)}`);const a=function(e,t){const n=hi(t);if(void 0===n)return null;for(const t of Oo(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of di(t))for(const t of Oo(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of di(t)){const t=0===i.kind?Lo(e,i.fieldPath,e.startAt):Mo(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new io(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of di(t)){const t=0===i.kind?Mo(e,i.fieldPath,e.endAt):Lo(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new io(n,r)}(s,i),h=this.hn(i,s,u),d=this.hn(i,s,l),f=this.ln(i,s,c),p=this.fn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return Ii.forEach(p,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=ui.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Ii.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:ku(ho.create(e.filters,"and")).map((t=>Do(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/c]):Fu,h=this.wn(e,a,n[l%c],r),d=this._n(e,a,i[l%c],s),f=o.map((t=>this.wn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}wn(e,t,n,r){const i=new Iu(e,ui.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){const i=new Iu(e,ui.empty(),t,n);return r?i.Je():i}an(e,t){const n=new Cu(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return Ii.forEach(r,(t=>this.an(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new ws(ci.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}mn(e,t){const n=new _u;for(const r of di(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.He(r.kind);mu.Ve._e(e,i)}return n.Qe()}dn(e){const t=new _u;return mu.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const n=new _u;return mu.Ve._e(zs(this.databaseId,t),n.He(function(e){const t=di(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new _u);let i=0;for(const s of di(e)){const e=n[i++];for(const n of r)if(this.yn(t,s.fieldPath)&&$s(e))r=this.pn(r,s,e);else{const t=n.He(s.kind);mu.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new _u;r.seed(n.Qe()),mu.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find((e=>e instanceof lo&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=qu(e),r=ju(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return Ii.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new pi(t.sequenceNumber,new yi(nu(t.readTime),new ui(qi(t.documentKey)),t.largestBatchId)):pi.empty(),r=e.fields.map((([e,t])=>new fi(ci.fromServerFormat(e),t)));return new li(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:ei(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=qu(e),i=ju(e);return this.Tn(e).next((e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Ii.forEach(t,(t=>i.put(uu(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Ii.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?Ii.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Ii.forEach(i,(n=>this.En(e,t,n).next((t=>{const i=this.An(r,n);return t.isEqual(i)?Ii.resolve():this.vn(e,r,n,t,i)})))))))}))}Rn(e,t,n,r){return Bu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return Bu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){const r=Bu(e);let i=new ws(Tu);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},((e,r)=>{i=i.add(new Iu(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}An(e,t){let n=new ws(Tu);const r=this.mn(t,e);if(null==r)return n;const i=hi(t);if(null!=i){const s=e.data.field(i.fieldPath);if($s(s))for(const i of s.arrayValue.values||[])n=n.add(new Iu(t.indexId,e.key,this.dn(i),r))}else n=n.add(new Iu(t.indexId,e.key,Fu,r));return n}vn(e,t,n,r,i){Or("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=_s(s),c=_s(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=_s(o)):t?(i(a),a=_s(s)):(a=_s(s),c=_s(o))}}(r,i,Tu,(r=>{s.push(this.Rn(e,t,n,r))}),(r=>{s.push(this.Pn(e,t,n,r))})),Ii.waitFor(s)}Tn(e){let t=1;return ju(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Tu(e,t))).filter(((e,t,n)=>!t||0!==Tu(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Tu(i,e),s=Tu(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,Fu,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,Fu,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return Tu(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(zu)}getMinOffset(e,t){return Ii.mapArray(this.cn(t),(t=>this.an(e,t).next((e=>e||Vr())))).next(zu)}}function Uu(e){return ds(e,"collectionParents")}function Bu(e){return ds(e,"indexEntries")}function qu(e){return ds(e,"indexConfiguration")}function ju(e){return ds(e,"indexState")}function zu(e){Ur(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;vi(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new yi(t.readTime,t.documentKey,n)}const Gu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $u{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new $u(e,$u.DEFAULT_COLLECTION_PERCENTILE,$u.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ku(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Ur(1===a)})));const u=[];for(const e of n.mutations){const r=Gi(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return Ii.waitFor(s).next((()=>u))}function Hu(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Vr();t=e.noDocument}return JSON.stringify(t).length}$u.DEFAULT_COLLECTION_PERCENTILE=10,$u.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$u.DEFAULT=new $u(41943040,$u.DEFAULT_COLLECTION_PERCENTILE,$u.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$u.DISABLED=new $u(-1,0,0);class Wu{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){Ur(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Wu(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Yu(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Ju(e),s=Yu(e);return s.add({}).next((o=>{Ur("number"==typeof o);const a=new Ha(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Fc(e.fe,t))),i=n.mutations.map((t=>Fc(e.fe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new ws(((e,t)=>ei(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Gi(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,$i))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),Ii.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Yu(e).get(t).next((e=>e?(Ur(e.userId===this.userId),ru(this.serializer,e)):null))}Sn(e,t){return this.Vn[t]?Ii.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Yu(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Ur(t.batchId>=n),i=ru(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Yu(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Yu(e).j("userMutationsIndex",t).next((e=>e.map((e=>ru(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=zi(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Ju(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=qi(a);if(o===this.userId&&t.path.isEqual(u))return Yu(e).get(c).next((e=>{if(!e)throw Vr();Ur(e.userId===this.userId),i.push(ru(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ws(ei);const r=[];return t.forEach((t=>{const i=zi(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Ju(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=qi(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Ii.waitFor(r).next((()=>this.Dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=zi(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new ws(ei);return Ju(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=qi(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Dn(e,o)))}Dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Yu(e).get(t).next((e=>{if(null===e)throw Vr();Ur(e.userId===this.userId),n.push(ru(this.serializer,e))})))})),Ii.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Ku(e.ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Cn(t.batchId)})),Ii.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Ii.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return Ju(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=qi(e[1]);r.push(t)}else n.done()})).next((()=>{Ur(0===r.length)}))}))}containsKey(e,t){return Qu(e,this.userId,t)}xn(e){return Xu(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Qu(e,t,n){const r=zi(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Ju(e).X({range:s,Y:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Yu(e){return ds(e,"mutations")}function Ju(e){return ds(e,"documentMutations")}function Xu(e){return ds(e,"mutationQueues")}class Zu{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Zu(0)}static Mn(){return new Zu(-1)}}class el{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next((t=>{const n=new Zu(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.$n(e).next((e=>ii.fromTimestamp(new ri(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.$n(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.$n(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r))))}addTargetData(e,t){return this.Fn(e,t).next((()=>this.$n(e).next((n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>tl(e).delete(t.targetId))).next((()=>this.$n(e))).next((t=>(Ur(t.targetCount>0),t.targetCount-=1,this.On(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return tl(e).X(((s,o)=>{const a=iu(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Ii.waitFor(i))).next((()=>r))}forEachTarget(e,t){return tl(e).X(((e,n)=>{const r=iu(n);t(r)}))}$n(e){return nl(e).get("targetGlobalKey").next((e=>(Ur(null!==e),e)))}On(e,t){return nl(e).put("targetGlobalKey",t)}Fn(e,t){return tl(e).put(su(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next((e=>e.targetCount))}getTargetData(e,t){const n=xo(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return tl(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=iu(n);Ro(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=rl(e);return t.forEach((t=>{const s=Vi(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),Ii.waitFor(r)}removeMatchingKeys(e,t,n){const r=rl(e);return Ii.forEach(t,(t=>{const i=Vi(t.path);return Ii.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=rl(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=rl(e);let i=da();return r.X({range:n,Y:!0},((e,t,n)=>{const r=qi(e[1]),s=new ui(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Vi(t.path),r=IDBKeyRange.bound([n],[ni(n)],!1,!0);let i=0;return rl(e).X({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}le(e,t){return tl(e).get(t).next((e=>e?iu(e):null))}}function tl(e){return ds(e,"targets")}function nl(e){return ds(e,"targetGlobal")}function rl(e){return ds(e,"targetDocuments")}function il([e,t],[n,r]){const i=ei(e,n);return 0===i?ei(t,r):i}class sl{constructor(e){this.Ln=e,this.buffer=new ws(il),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();il(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ol{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){Or("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ki(e)?Or("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await _i(e)}await this.Qn(3e5)}))}}class al{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Ii.resolve(Oi.ct);const n=new sl(t);return this.jn.forEachTarget(e,(e=>n.Kn(e.sequenceNumber))).next((()=>this.jn.Wn(e,(e=>n.Kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Or("LruGarbageCollector","Garbage collection skipped; disabled"),Ii.resolve(Gu)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Or("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Gu):this.Hn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,o,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Or("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),Pr()<=a.in.DEBUG&&Or("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),Ii.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function cl(e,t){return new al(e,t)}class ul{constructor(e,t){this.db=e,this.garbageCollector=cl(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Jn(e){let t=0;return this.Wn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,((e,n)=>t(n)))}addReference(e,t,n){return ll(e,n)}removeReference(e,t,n){return ll(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ll(e,t)}Xn(e,t){return function(e,t){let n=!1;return Xu(e).Z((r=>Qu(e,r,t).next((e=>(e&&(n=!0),Ii.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Yn(e,((s,o)=>{if(o<=t){const t=this.Xn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,ii.min()),rl(e).delete([0,Vi(s.path)]))))}));r.push(t)}})).next((()=>Ii.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ll(e,t)}Yn(e,t){const n=rl(e);let r,i=Oi.ct;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Oi.ct&&t(new ui(qi(r)),i),i=o,r=s):i=Oi.ct})).next((()=>{i!==Oi.ct&&t(new ui(qi(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ll(e,t){return rl(e).put(function(e,t){return{targetId:0,path:Vi(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class hl{constructor(){this.changes=new ta((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ro.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ii.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class dl{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return gl(e).put(n)}removeEntry(e,t,n){return gl(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],eu(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Zn(e,n))))}getEntry(e,t){let n=ro.newInvalidDocument(t);return gl(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(yl(t))},((e,r)=>{n=this.ts(t,r)})).next((()=>n))}es(e,t){let n={size:0,document:ro.newInvalidDocument(t)};return gl(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(yl(t))},((e,r)=>{n={document:this.ts(t,r),size:Hu(r)}})).next((()=>n))}getEntries(e,t){let n=ra();return this.ns(e,t,((e,t)=>{const r=this.ts(e,t);n=n.insert(e,r)})).next((()=>n))}ss(e,t){let n=ra(),r=new gs(ui.comparator);return this.ns(e,t,((e,t)=>{const i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,Hu(t))})).next((()=>({documents:n,rs:r})))}ns(e,t,n){if(t.isEmpty())return Ii.resolve();let r=new ws(wl);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(yl(r.first()),yl(r.last())),s=r.getIterator();let o=s.getNext();return gl(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=ui.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&wl(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(yl(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),eu(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gl(e).j(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=ra();for(const i of e){const e=this.ts(ui.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Jo(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=ra();const s=vl(t,n),o=vl(t,yi.max());return gl(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.ts(ui.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new pl(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return ml(e).get("remoteDocumentGlobalKey").next((e=>(Ur(!!e),e)))}Zn(e,t){return ml(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Mc(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ui.fromSegments(t.noDocument.path),r=nu(t.noDocument.readTime);n=ro.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Vr();{const e=ui.fromSegments(t.unknownDocument.path),r=nu(t.unknownDocument.version);n=ro.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new ri(e[0],e[1]);return ii.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(ii.min()))return e}return ro.newInvalidDocument(e)}}function fl(e){return new dl(e)}class pl extends hl{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new ta((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new ws(((e,t)=>ei(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Zc(this.os.serializer,s);r=r.add(i.path.popLast());const c=Hu(a);n+=c-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Zc(this.os.serializer,s.convertToNoDocument(ii.min()));t.push(this.os.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.os.updateMetadata(e,n)),Ii.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next((e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.os.ss(e,t).next((({documents:e,rs:t})=>(t.forEach(((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function ml(e){return ds(e,"remoteDocumentGlobal")}function gl(e){return ds(e,"remoteDocumentsV14")}function yl(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function vl(e,t){const n=t.documentKey.path.toArray();return[e,eu(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function wl(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=ei(n[e],r[e]),i)return i;return i=ei(n.length,r.length),i||(i=ei(n[n.length-2],r[r.length-2]),i||ei(n[n.length-1],r[r.length-1]))}class bl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class _l{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Fa(n.mutation,e,Is.empty(),ri.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,da()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=da()){const r=aa();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=sa();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=aa();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,da())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=ra();const s=ua(),o=ua();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof qa)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Fa(o.mutation,t,o.mutation.getFieldMask(),ri.now())):s.set(t.key,Is.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new bl(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=ua();let r=new gs(((e,t)=>e-t)),i=da();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Is.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||da()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ca();c.forEach((e=>{if(!i.has(e)){const r=La(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Ii.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return ui.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):zo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Ii.resolve(aa());let o=-1,a=i;return s.next((t=>Ii.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Ii.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,da()))).next((e=>({batchId:o,changes:oa(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ui(t)).next((e=>{let t=sa();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=sa();return this.indexManager.getCollectionParents(e,r).next((s=>Ii.forEach(s,(s=>{const o=function(e,t){return new Fo(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ro.newInvalidDocument(r)))}));let n=sa();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&Fa(s.mutation,i,Is.empty(),ri.now()),Jo(t,i)&&(n=n.insert(e,i))})),n}))}}class Il{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return Ii.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Sc(n.createTime)}),Ii.resolve()}getNamedQuery(e,t){return Ii.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:ou(e.bundledQuery),readTime:Sc(e.readTime)}}(t)),Ii.resolve()}}class Tl{constructor(){this.overlays=new gs(ui.comparator),this.ls=new Map}getOverlay(e,t){return Ii.resolve(this.overlays.get(t))}getOverlays(e,t){const n=aa();return Ii.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.we(e,t,r)})),Ii.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),Ii.resolve()}getOverlaysForCollection(e,t,n){const r=aa(),i=t.length+1,s=new ui(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ii.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new gs(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=aa(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=aa(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Ii.resolve(o)}we(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Qa(t,n));let i=this.ls.get(t);void 0===i&&(i=da(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class El{constructor(){this.fs=new ws(Cl.ds),this.ws=new ws(Cl._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new Cl(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new Cl(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new ui(new oi([])),n=new Cl(t,e),r=new Cl(t,e+1),i=[];return this.ws.forEachInRange([n,r],(e=>{this.ys(e),i.push(e.key)})),i}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new ui(new oi([])),n=new Cl(t,e),r=new Cl(t,e+1);let i=da();return this.ws.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Cl(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Cl{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return ui.comparator(e.key,t.key)||ei(e.As,t.As)}static _s(e,t){return ei(e.As,t.As)||ui.comparator(e.key,t.key)}}class Sl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new ws(Cl.ds)}checkEmpty(e){return Ii.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ha(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new Cl(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ii.resolve(s)}lookupMutationBatch(e,t){return Ii.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.bs(n),i=r<0?0:r;return Ii.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ii.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return Ii.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Cl(t,0),r=new Cl(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(e=>{const t=this.Ps(e.As);i.push(t)})),Ii.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ws(ei);return t.forEach((e=>{const t=new Cl(e,0),r=new Cl(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],(e=>{n=n.add(e.As)}))})),Ii.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ui.isDocumentKey(i)||(i=i.child(""));const s=new Cl(new ui(i),0);let o=new ws(ei);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)}),s),Ii.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Ur(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return Ii.forEach(t.mutations,(r=>{const i=new Cl(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new Cl(t,0),r=this.Rs.firstAfterOrEqual(n);return Ii.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ii.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class kl{constructor(e){this.Ds=e,this.docs=new gs(ui.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ii.resolve(n?n.document.mutableCopy():ro.newInvalidDocument(t))}getEntries(e,t){let n=ra();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ro.newInvalidDocument(e))})),Ii.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ra();const s=t.path,o=new ui(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||vi(gi(o),n)<=0||(r.has(o.key)||Jo(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Ii.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Vr()}Cs(e,t){return Ii.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Al(this)}getSize(e){return Ii.resolve(this.size)}}class Al extends hl{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)})),Ii.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class Nl{constructor(e){this.persistence=e,this.xs=new ta((e=>xo(e)),Ro),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.Ns=0,this.ks=new El,this.targetCount=0,this.Ms=Zu.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),Ii.resolve()}getLastRemoteSnapshotVersion(e){return Ii.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ii.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),Ii.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),Ii.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Zu(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,Ii.resolve()}updateTargetData(e,t){return this.Fn(t),Ii.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,Ii.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Ii.waitFor(i).next((()=>r))}getTargetCount(e){return Ii.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return Ii.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),Ii.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ii.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),Ii.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return Ii.resolve(n)}containsKey(e,t){return Ii.resolve(this.ks.containsKey(t))}}class Dl{constructor(e,t){this.$s={},this.overlays={},this.Os=new Oi(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new Nl(this),this.indexManager=new Lu,this.remoteDocumentCache=function(e){return new kl(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Xc(t),this.qs=new Il(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Tl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new Sl(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){Or("MemoryPersistence","Starting transaction:",e);const r=new xl(this.Os.next());return this.referenceDelegate.Us(),n(r).next((e=>this.referenceDelegate.Ks(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gs(e,t){return Ii.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class xl extends bi{constructor(e){super(),this.currentSequenceNumber=e}}class Rl{constructor(e){this.persistence=e,this.Qs=new El,this.js=null}static zs(e){return new Rl(e)}get Ws(){if(this.js)return this.js;throw Vr()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),Ii.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),Ii.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),Ii.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ii.forEach(this.Ws,(n=>{const r=ui.fromPath(n);return this.Hs(e,r).next((e=>{e||t.removeEntry(r,ii.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return Ii.or([()=>Ii.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class Pl{constructor(e){this.serializer=e}O(e,t,n,r){const i=new Ti("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ji,{unique:!0}),e.createObjectStore("documentMutations")}(e),Ol(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=Ii.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Ol(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ii.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ji,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return Ii.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ys(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i))))),n<7&&r>=7&&(s=s.next((()=>this.Zs(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ei(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:rs});t.createIndex("collectionPathOverlayIndex",is,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",ss,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Ki});t.createIndex("documentKeyIndex",Hi),t.createIndex("collectionGroupIndex",Wi)}(e))).next((()=>this.ni(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Zi}).createIndex("sequenceNumberIndex",es,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ts}).createIndex("documentKeyIndex",ns,{unique:!1})}(e)))),s}Xs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=Hu(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>Ii.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>Ii.forEach(n,(n=>{Ur(n.userId===t.userId);const r=ru(this.serializer,n);return Ku(e,t.userId,r).next((()=>{}))}))))}))))}Zs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new oi(n),o=function(e){return[0,Vi(e)]}(s);r.push(t.get(o).next((n=>n?Ii.resolve():(n=>t.put({targetId:0,path:Vi(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>Ii.waitFor(r)))}))}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Xi});const n=t.store("collectionParents"),r=new Mu,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Vi(r)})}};return t.store("remoteDocuments").X({Y:!0},((e,t)=>{const n=new oi(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Y:!0},(([e,t,n],r)=>{const s=qi(t);return i(s.popLast())}))))}ei(e){const t=e.store("targets");return t.X(((e,n)=>{const r=iu(n),i=su(this.serializer,r);return t.put(i)}))}ni(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new ui(oi.fromString(o.document.name).popFirst(5)):o.noDocument?ui.fromSegments(o.noDocument.path):o.unknownDocument?ui.fromSegments(o.unknownDocument.path):Vr()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>Ii.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=fl(this.serializer),i=new Dl(Rl.zs,this.serializer.fe);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:da();ru(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Ii.forEach(n,((e,n)=>{const s=new Dr(n),o=fu.de(this.serializer,s),a=i.getIndexManager(s),c=Wu.de(s,this.serializer,a,i.referenceDelegate);return new _l(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new hs(t,Oi.ct),e).next()}))}))}}function Ol(e){e.createObjectStore("targetDocuments",{keyPath:Yi}).createIndex("documentTargetsIndex",Ji,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Qi,{unique:!0}),e.createObjectStore("targetGlobal")}const Ll="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ml{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=c,this.oi=u,this.ui=l,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!Ml.D())throw new jr(qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ul(this,r),this.di=t+"main",this.serializer=new Xc(a),this.wi=new Ei(this.di,this.ui,new Pl(this.serializer)),this.Bs=new el(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fl(this.serializer),this.qs=new lu,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&Lr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new jr(qr.FAILED_PRECONDITION,Ll);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Bs.getHighestSequenceNumber(e)))})).then((e=>{this.Os=new Oi(e,this.ri)})).then((()=>{this.Fs=!0})).catch((e=>(this.wi&&this.wi.close(),Promise.reject(e))))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Vl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(e).next((e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(e))).next((t=>this.isPrimary&&!t?this.Ai(e).next((()=>!1)):!!t&&this.vi(e).next((()=>!0)))))).catch((e=>{if(ki(e))return Or("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Or("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ii.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Ti(e){return Fl(e).get("owner").next((e=>Ii.resolve(this.Ri(e))))}Pi(e){return Vl(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=ds(e,"clientMetadata");return t.j().next((e=>{const n=this.Si(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Ii.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?Ii.resolve(!0):Fl(e).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new jr(qr.FAILED_PRECONDITION,Ll);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vl(e).j().next((e=>void 0===this.Si(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&Or("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new hs(e,Oi.ct);return this.Ai(t).next((()=>this.Pi(t)))})),this.wi.close(),this.Mi()}Si(e,t){return e.filter((e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(e=>Vl(e).j().next((e=>this.Si(e,18e5).map((e=>e.clientId))))))}get started(){return this.Fs}getMutationQueue(e,t){return Wu.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Vu(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return fu.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){Or("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ui)?ls:14===s?us:13===s?cs:12===s?as:11===s?os:void Vr();var s;let o;return this.wi.runTransaction(e,r,i,(r=>(o=new hs(r,this.Os?this.Os.next():Oi.ct),"readwrite-primary"===t?this.Ti(o).next((e=>!!e||this.Ei(o))).next((t=>{if(!t)throw Lr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new jr(qr.FAILED_PRECONDITION,wi);return n(o)})).next((e=>this.vi(o).next((()=>e)))):this.Oi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Oi(e){return Fl(e).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new jr(qr.FAILED_PRECONDITION,Ll)}))}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Fl(e).put("owner",t)}static D(){return Ei.D()}Ai(e){const t=Fl(e);return t.get("owner").next((e=>this.Ri(e)?(Or("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Ii.resolve()))}Vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(Lr(`Detected an update time that is in the future: ${e} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;(0,c.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return Or("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Lr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){Lr("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Fl(e){return ds(e,"owner")}function Vl(e){return ds(e,"clientMetadata")}function Ul(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Bl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=da(),r=da();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Bl(e,t.fromCache,n,r)}}class ql{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next((i=>i||this.Gi(e,t,r,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Bo(t))return Ii.resolve(null);let n=$o(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Ho(t,null,"F"),n=$o(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=da(...r);return this.Ui.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,Ho(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,r){return Bo(t)||r.isEqual(ii.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((i=>{const s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(Pr()<=a.in.DEBUG&&Or("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Yo(t)),this.Wi(e,s,t,mi(r,-1)))}))}ji(e,t){let n=new ws(Zo(e));return t.forEach(((t,r)=>{Jo(e,r)&&(n=n.add(r))})),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return Pr()<=a.in.DEBUG&&Or("QueryEngine","Using full collection scan to execute query:",Yo(t)),this.Ui.getDocumentsMatchingQuery(e,t,yi.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class jl{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new gs(ei),this.Yi=new ta((e=>xo(e)),Ro),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _l(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function zl(e,t,n,r){return new jl(e,t,n,r)}async function Gl(e,t){const n=Br(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=da();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function $l(e){const t=Br(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function Kl(e,t,n){let r=da(),i=da();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=ra();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ii.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Or("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}function Hl(e,t){const n=Br(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Wl(e,t){const n=Br(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Bs.getTargetData(e,t).next((i=>i?(r=i,Ii.resolve(r)):n.Bs.allocateTargetId(e).next((i=>(r=new Jc(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}async function Ql(e,t,n){const r=Br(e),i=r.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ki(e))throw e;Or("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ji=r.Ji.remove(t),r.Yi.delete(i.target)}function Yl(e,t,n){const r=Br(e);let i=ii.min(),s=da();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Br(e),i=r.Yi.get(n);return void 0!==i?Ii.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,$o(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Hi.getDocumentsMatchingQuery(e,t,n?i:ii.min(),n?s:da()))).next((e=>(Zl(r,Xo(t),e),{documents:e,ir:s})))))}function Jl(e,t){const n=Br(e),r=Br(n.Bs),i=n.Ji.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.le(e,t).next((e=>e?e.target:null))))}function Xl(e,t){const n=Br(e),r=n.Xi.get(t)||ii.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Zi.getAllFromCollectionGroup(e,t,mi(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Zl(n,t,e),e)))}function Zl(e,t,n){let r=e.Xi.get(t)||ii.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Xi.set(t,r)}async function eh(e,t,n=da()){const r=await Wl(e,$o(ou(t.bundledQuery))),i=Br(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Sc(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.qs.saveNamedQuery(e,t);const o=r.withResumeToken(Es.EMPTY_BYTE_STRING,s);return i.Ji=i.Ji.insert(o.targetId,o),i.Bs.updateTargetData(e,o).next((()=>i.Bs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Bs.addMatchingKeys(e,n,r.targetId))).next((()=>i.qs.saveNamedQuery(e,t)))}))}function th(e,t){return`firestore_clients_${e}_${t}`}function nh(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function rh(e,t){return`firestore_targets_${e}_${t}`}class ih{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static ar(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new jr(r.error.code,r.error.message))),s?new ih(e,t,r.state,i):(Lr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class sh{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static ar(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new jr(n.error.code,n.error.message))),i?new sh(e,n.state,r):(Lr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class oh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=pa();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Fi(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new oh(e,i):(Lr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ah{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ah(t.clientId,t.onlineState):(Lr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ch{constructor(){this.activeTargetIds=pa()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uh{constructor(e,t,n,r,i){this.window=e,this.ii=t,this.persistenceKey=n,this.wr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new gs(ei),this.started=!1,this.yr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pr=th(this.persistenceKey,this.wr),this.Ir=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.gr=this.gr.insert(this.wr,new ch),this.Tr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Rr=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.$i();for(const t of e){if(t===this.wr)continue;const e=this.getItem(th(this.persistenceKey,t));if(e){const n=oh.ar(t,e);n&&(this.gr=this.gr.insert(n.clientId,n))}}this.Pr();const t=this.storage.getItem(this.vr);if(t){const e=this.br(t);e&&this.Vr(e)}for(const e of this.yr)this.mr(e);this.yr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,n){this.Dr(e,t,n),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(rh(this.persistenceKey,e));if(n){const r=sh.ar(e,n);r&&(t=r.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(rh(this.persistenceKey,e))}updateQueryState(e,t,n){this.kr(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Cr(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Or("SharedClientState","READ",e,t),t}setItem(e,t){Or("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Or("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){const t=e;if(t.storageArea===this.storage){if(Or("SharedClientState","EVENT",t.key,t.newValue),t.key===this.pr)return void Lr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Tr.test(t.key)){if(null==t.newValue){const e=this.Or(t.key);return this.Fr(e,null)}{const e=this.Br(t.key,t.newValue);if(e)return this.Fr(e.clientId,e)}}else if(this.Er.test(t.key)){if(null!==t.newValue){const e=this.Lr(t.key,t.newValue);if(e)return this.qr(e)}}else if(this.Ar.test(t.key)){if(null!==t.newValue){const e=this.Ur(t.key,t.newValue);if(e)return this.Kr(e)}}else if(t.key===this.vr){if(null!==t.newValue){const e=this.br(t.newValue);if(e)return this.Vr(e)}}else if(t.key===this.Ir){const e=function(e){let t=Oi.ct;if(null!=e)try{const n=JSON.parse(e);Ur("number"==typeof n),t=n}catch(e){Lr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Oi.ct&&this.sequenceNumberHandler(e)}else if(t.key===this.Rr){const e=this.Gr(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Qr(e))))}}else this.yr.push(t)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,n){const r=new ih(this.currentUser,e,t,n),i=nh(this.persistenceKey,this.currentUser,e);this.setItem(i,r.hr())}Cr(e){const t=nh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){const t={clientId:this.wr,onlineState:e};this.storage.setItem(this.vr,JSON.stringify(t))}kr(e,t,n){const r=rh(this.persistenceKey,e),i=new sh(e,t,n);this.setItem(r,i.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const n=this.Or(e);return oh.ar(n,t)}Lr(e,t){const n=this.Er.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ih.ar(new Dr(i),r,t)}Ur(e,t){const n=this.Ar.exec(e),r=Number(n[1]);return sh.ar(r,t)}br(e){return ah.ar(e)}Gr(e){return JSON.parse(e)}async qr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.jr(e.batchId,e.state,e.error);Or("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const n=t?this.gr.insert(e,t):this.gr.remove(e),r=this.Sr(this.gr),i=this.Sr(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Wr(s,o).then((()=>{this.gr=n}))}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=pa();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class lh{constructor(){this.Hr=new ch,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new ch,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hh{Yr(e){}shutdown(){}}class dh{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Or("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){Or("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fh=null;function ph(){return null===fh?fh=268435456+Math.round(2147483648*Math.random()):fh++,"0x"+fh.toString(16)}const mh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class gh{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const yh="WebChannelConnection";class vh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){const s=ph(),o=this.To(e,t);Or("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then((t=>(Or("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Mr("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+xr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=mh[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){const i=ph();return new Promise(((s,o)=>{const a=new Cr;a.setWithCredentials(!0),a.listenOnce(br.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case wr.NO_ERROR:const t=a.getResponseJson();Or(yh,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case wr.TIMEOUT:Or(yh,`RPC '${e}' ${i} timed out`),o(new jr(qr.DEADLINE_EXCEEDED,"Request time out"));break;case wr.HTTP_ERROR:const n=a.getStatus();if(Or(yh,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(qr).indexOf(t)>=0?t:qr.UNKNOWN}(t.status);o(new jr(e,t.message))}else o(new jr(qr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new jr(qr.UNAVAILABLE,"Connection failed."));break;default:Vr()}}finally{Or(yh,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);Or(yh,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const r=ph(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=yr(),o=vr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Tr({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Or(yh,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new gh({ro:t=>{d?Or(yh,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Or(yh,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Or(yh,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},oo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,Er.EventType.OPEN,(()=>{d||Or(yh,`RPC '${e}' stream ${r} transport opened.`)})),p(l,Er.EventType.CLOSE,(()=>{d||(d=!0,Or(yh,`RPC '${e}' stream ${r} transport closed`),f.wo())})),p(l,Er.EventType.ERROR,(t=>{d||(d=!0,Mr(yh,`RPC '${e}' stream ${r} transport errored:`,t),f.wo(new jr(qr.UNAVAILABLE,"The operation could not be completed")))})),p(l,Er.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Ur(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Or(yh,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Ja[e];if(void 0!==t)return ec(t)}(t),i=o.message;void 0===n&&(n=qr.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.wo(new jr(n,i)),l.close()}else Or(yh,`RPC '${e}' stream ${r} received:`,i),f._o(i)}})),p(o,_r.STAT_EVENT,(t=>{t.stat===Ir.PROXY?Or(yh,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Ir.NOPROXY&&Or(yh,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function wh(){return"undefined"!=typeof window?window:null}function bh(){return"undefined"!=typeof document?document:null}function _h(e){return new _c(e,!0)}class Ih{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&Or("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Th{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Ih(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===qr.RESOURCE_EXHAUSTED?(Lr(t.toString()),Lr("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===qr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new jr(qr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return Or("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(Or("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Eh extends Th{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Vr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Ur(void 0===t||"string"==typeof t),Es.fromBase64String(t||"")):(Ur(void 0===t||t instanceof Uint8Array),Es.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?qr.UNKNOWN:ec(e.code);return new jr(t,e.message||"")}(o);n=new fc(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Dc(e,r.document.name),s=Sc(r.document.updateTime),o=r.document.createTime?Sc(r.document.createTime):ii.min(),a=new to({mapValue:{fields:r.document.fields}}),c=ro.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new hc(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Dc(e,r.document),s=r.readTime?Sc(r.readTime):ii.min(),o=ro.newNoDocument(i,s),a=r.removedTargetIds||[];n=new hc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Dc(e,r.document),s=r.removedTargetIds||[];n=new hc([],s,i,null)}else{if(!("filter"in t))return Vr();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Ya(r,i),o=e.targetId;n=new dc(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ii.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ii.min():t.readTime?Sc(t.readTime):ii.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=Pc(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Po(r)?{documents:Uc(e,r)}:{query:Bc(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ec(e,t.resumeToken);const r=Ic(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ii.min())>0){n.readTime=Tc(e,t.snapshotVersion.toTimestamp());const r=Ic(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vr()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=Pc(this.serializer),t.removeTarget=e,this.Wo(t)}}class Ch extends Th{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Ur(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(Ur(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Sc(e.updateTime):Sc(t);return n.isEqual(ii.min())&&(n=Sc(t)),new xa(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Sc(e.commitTime);return this.listener.cu(n,t)}return Ur(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Pc(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Fc(this.serializer,e)))};this.Wo(t)}}class Sh extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new jr(qr.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===qr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new jr(qr.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===qr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new jr(qr.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class kh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Lr(t),this.mu=!1):Or("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Ah{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{Fh(this)&&(Or("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Br(e);t.vu.add(4),await Dh(t),t.bu.set("Unknown"),t.vu.delete(4),await Nh(t)}(this))}))})),this.bu=new kh(n,r)}}async function Nh(e){if(Fh(e))for(const t of e.Ru)await t(!0)}async function Dh(e){for(const t of e.Ru)await t(!1)}function xh(e,t){const n=Br(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),Mh(n)?Lh(n):td(n).Ko()&&Ph(n,t))}function Rh(e,t){const n=Br(e),r=td(n);n.Au.delete(t),r.Ko()&&Oh(n,t),0===n.Au.size&&(r.Ko()?r.jo():Fh(n)&&n.bu.set("Unknown"))}function Ph(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ii.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}td(e).su(t)}function Oh(e,t){e.Vu.qt(t),td(e).iu(t)}function Lh(e){e.Vu=new mc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),td(e).start(),e.bu.gu()}function Mh(e){return Fh(e)&&!td(e).Uo()&&e.Au.size>0}function Fh(e){return 0===Br(e).vu.size}function Vh(e){e.Vu=void 0}async function Uh(e){e.Au.forEach(((t,n)=>{Ph(e,t)}))}async function Bh(e,t){Vh(e),Mh(e)?(e.bu.Iu(t),Lh(e)):e.bu.set("Unknown")}async function qh(e,t,n){if(e.bu.set("Online"),t instanceof fc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){Or("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await jh(e,n)}else if(t instanceof hc?e.Vu.Ht(t):t instanceof dc?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(ii.min()))try{const t=await $l(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(Es.EMPTY_BYTE_STRING,r.snapshotVersion)),Oh(e,t);const i=new Jc(r.target,t,n,r.sequenceNumber);Ph(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Or("RemoteStore","Failed to raise snapshot:",t),await jh(e,t)}}async function jh(e,t,n){if(!ki(t))throw t;e.vu.add(1),await Dh(e),e.bu.set("Offline"),n||(n=()=>$l(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Or("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await Nh(e)}))}function zh(e,t){return t().catch((n=>jh(e,n,t)))}async function Gh(e){const t=Br(e),n=nd(t);let r=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;$h(t);)try{const e=await Hl(t.localStore,r);if(null===e){0===t.Eu.length&&n.jo();break}r=e.batchId,Kh(t,e)}catch(e){await jh(t,e)}Hh(t)&&Wh(t)}function $h(e){return Fh(e)&&e.Eu.length<10}function Kh(e,t){e.Eu.push(t);const n=nd(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function Hh(e){return Fh(e)&&!nd(e).Uo()&&e.Eu.length>0}function Wh(e){nd(e).start()}async function Qh(e){nd(e).hu()}async function Yh(e){const t=nd(e);for(const n of e.Eu)t.uu(n.mutations)}async function Jh(e,t,n){const r=e.Eu.shift(),i=Wa.from(r,t,n);await zh(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Gh(e)}async function Xh(e,t){t&&nd(e).ou&&await async function(e,t){if(Za(n=t.code)&&n!==qr.ABORTED){const n=e.Eu.shift();nd(e).Qo(),await zh(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Gh(e)}var n}(e,t),Hh(e)&&Wh(e)}async function Zh(e,t){const n=Br(e);n.asyncQueue.verifyOperationInProgress(),Or("RemoteStore","RemoteStore received new credentials");const r=Fh(n);n.vu.add(3),await Dh(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await Nh(n)}async function ed(e,t){const n=Br(e);t?(n.vu.delete(2),await Nh(n)):t||(n.vu.add(2),await Dh(n),n.bu.set("Unknown"))}function td(e){return e.Su||(e.Su=function(e,t,n){const r=Br(e);return r.fu(),new Eh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Uh.bind(null,e),ao:Bh.bind(null,e),nu:qh.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),Mh(e)?Lh(e):e.bu.set("Unknown")):(await e.Su.stop(),Vh(e))}))),e.Su}function nd(e){return e.Du||(e.Du=function(e,t,n){const r=Br(e);return r.fu(),new Ch(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Qh.bind(null,e),ao:Xh.bind(null,e),au:Yh.bind(null,e),cu:Jh.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await Gh(e)):(await e.Du.stop(),e.Eu.length>0&&(Or("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class rd{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new zr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new rd(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(qr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function id(e,t){if(Lr("AsyncQueue",`${t}: ${e}`),ki(e))return new jr(qr.UNAVAILABLE,`${t}: ${e}`);throw e}class sd{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ui.comparator(t.key,n.key):(e,t)=>ui.comparator(e.key,t.key),this.keyedMap=sa(),this.sortedSet=new gs(this.comparator)}static emptySet(e){return new sd(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sd))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new sd;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class od{constructor(){this.Cu=new gs(ui.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):Vr():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ad{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new ad(e,t,sd.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class cd{constructor(){this.Nu=void 0,this.listeners=[]}}class ud{constructor(){this.queries=new ta((e=>Qo(e)),Wo),this.onlineState="Unknown",this.ku=new Set}}async function ld(e,t){const n=Br(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new cd),i)try{s.Nu=await n.onListen(r)}catch(e){const n=id(e,`Initialization of query '${Yo(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&pd(n)}async function hd(e,t){const n=Br(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function dd(e,t){const n=Br(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.$u(e)&&(r=!0);i.Nu=e}}r&&pd(n)}function fd(e,t,n){const r=Br(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function pd(e){e.ku.forEach((e=>{e.next()}))}class md{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ad(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=ad.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class gd{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class yd{constructor(e){this.serializer=e}rr(e){return Dc(this.serializer,e)}ur(e){return e.metadata.exists?Mc(this.serializer,e.document,!1):ro.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return Sc(e)}}class vd{constructor(e,t,n){this.ju=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=wd(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const n=oi.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,n=new yd(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.rr(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||da()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Br(e);let s=da(),o=ra();for(const e of n){const n=t.rr(e.metadata.name);e.document&&(s=s.add(n));const r=t.ur(e);r.setReadTime(t.cr(e.metadata.readTime)),o=o.insert(n,r)}const a=i.Zi.newChangeBuffer({trackRemovals:!0}),c=await Wl(i,function(e){return $o(Uo(oi.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Kl(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Bs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Bs.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.nr,t.sr))).next((()=>t.nr))))))}(this.localStore,new yd(this.serializer),this.documents,this.ju.id),t=this.Wu(this.documents);for(const e of this.queries)await eh(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Hu:this.collectionGroups,Ju:e}}}function wd(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class bd{constructor(e){this.key=e}}class _d{constructor(e){this.key=e}}class Id{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=da(),this.mutatedKeys=da(),this.tc=Zo(e),this.ec=new sd(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new od,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Jo(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vr()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new ad(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new od,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=da(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new _d(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new bd(n))})),t}hc(e){this.Yu=e.ir,this.Zu=da();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return ad.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Td{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ed{constructor(e){this.key=e,this.fc=!1}}class Cd{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new ta((e=>Qo(e)),Wo),this._c=new Map,this.mc=new Set,this.gc=new gs(ui.comparator),this.yc=new Map,this.Ic=new El,this.Tc={},this.Ec=new Map,this.Ac=Zu.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Sd(e,t){const n=Xd(e);let r,i;const s=n.wc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const e=await Wl(n.localStore,$o(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await kd(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&xh(n.remoteStore,e)}return i}async function kd(e,t,n,r,i){e.Rc=(t,n,r)=>async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await Yl(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Vd(e,t.targetId,o.cc),o.snapshot}(e,t,n,r);const s=await Yl(e.localStore,t,!0),o=new Id(t,s.ir),a=o.sc(s.documents),c=lc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Vd(e,n,u.cc);const l=new Td(t,n,o);return e.wc.set(t,l),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}async function Ad(e,t){const n=Br(e),r=n.wc.get(t),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((e=>!Wo(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Ql(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Rh(n.remoteStore,r.targetId),Md(n,r.targetId)})).catch(_i)):(Md(n,r.targetId),await Ql(n.localStore,r.targetId,!0))}async function Nd(e,t){const n=Br(e);try{const e=await function(e,t){const n=Br(e),r=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Es.EMPTY_BYTE_STRING,ii.min()).withLastLimboFreeSnapshotVersion(ii.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=ra(),c=da();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Kl(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!r.isEqual(ii.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Ii.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.yc.get(t);r&&(Ur(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.fc=!0:e.modifiedDocuments.size>0?Ur(r.fc):e.removedDocuments.size>0&&(Ur(r.fc),r.fc=!1))})),await qd(n,e,t)}catch(e){await _i(e)}}function Dd(e,t,n){const r=Br(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Br(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(r=!0)})),r&&pd(n)}(r.eventManager,t),e.length&&r.dc.nu(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function xd(e,t,n){const r=Br(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.yc.get(t),s=i&&i.key;if(s){let e=new gs(ui.comparator);e=e.insert(s,ro.newNoDocument(s,ii.min()));const n=da().add(s),i=new uc(ii.min(),new Map,new gs(ei),e,n);await Nd(r,i),r.gc=r.gc.remove(s),r.yc.delete(t),Bd(r)}else await Ql(r.localStore,t,!1).then((()=>Md(r,t,n))).catch(_i)}async function Rd(e,t){const n=Br(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Br(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Ii.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Ur(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=da();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Ld(n,r,null),Od(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await qd(n,e)}catch(e){await _i(e)}}async function Pd(e,t,n){const r=Br(e);try{const e=await function(e,t){const n=Br(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Ur(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Ld(r,t,n),Od(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await qd(r,e)}catch(n){await _i(n)}}function Od(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function Ld(e,t,n){const r=Br(e);let i=r.Tc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function Md(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e._c.get(t))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||Fd(e,t)}))}function Fd(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(Rh(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),Bd(e))}function Vd(e,t,n){for(const r of n)r instanceof bd?(e.Ic.addReference(r.key,t),Ud(e,r)):r instanceof _d?(Or("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||Fd(e,r.key)):Vr()}function Ud(e,t){const n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(Or("SyncEngine","New document in limbo: "+n),e.mc.add(r),Bd(e))}function Bd(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new ui(oi.fromString(t)),r=e.Ac.next();e.yc.set(r,new Ed(n)),e.gc=e.gc.insert(n,r),xh(e.remoteStore,new Jc($o(Uo(n.path)),r,"TargetPurposeLimboResolution",Oi.ct))}}async function qd(e,t,n){const r=Br(e),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((e,a)=>{o.push(r.Rc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Bl.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.dc.nu(i),await async function(e,t){const n=Br(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ii.forEach(t,(t=>Ii.forEach(t.Fi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ii.forEach(t.Bi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ki(e))throw e;Or("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(t,i)}}}(r.localStore,s))}async function jd(e,t){const n=Br(e);if(!n.currentUser.isEqual(t)){Or("SyncEngine","User change. New user:",t.toKey());const e=await Gl(n.localStore,t);n.currentUser=t,function(e,t){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new jr(qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await qd(n,e.er)}}function zd(e,t){const n=Br(e),r=n.yc.get(t);if(r&&r.fc)return da().add(r.key);{let e=da();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.wc.get(t);e=e.unionWith(r.view.nc)}return e}}async function Gd(e,t){const n=Br(e),r=await Yl(n.localStore,t.query,!0),i=t.view.hc(r);return n.isPrimaryClient&&Vd(n,t.targetId,i.cc),i}async function $d(e,t){const n=Br(e);return Xl(n.localStore,t).then((e=>qd(n,e)))}async function Kd(e,t,n,r){const i=Br(e),s=await function(e,t){const n=Br(e),r=Br(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Sn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Ii.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Gh(i.remoteStore):"acknowledged"===n||"rejected"===n?(Ld(i,t,r||null),Od(i,t),function(e,t){Br(Br(e).mutationQueue).Cn(t)}(i.localStore,t)):Vr(),await qd(i,s)):Or("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Hd(e,t,n){const r=Br(e),i=[],s=[];for(const e of t){let t;const n=r._c.get(e);if(n&&0!==n.length){t=await Wl(r.localStore,$o(n[0]));for(const e of n){const t=r.wc.get(e),n=await Gd(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Jl(r.localStore,e);t=await Wl(r.localStore,n),await kd(r,Wd(n),e,!1,t.resumeToken)}i.push(t)}return r.dc.nu(s),i}function Wd(e){return Vo(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Qd(e){const t=Br(e);return Br(Br(t.localStore).persistence).$i()}async function Yd(e,t,n,r){const i=Br(e);if(i.vc)return void Or("SyncEngine","Ignoring unexpected query state notification.");const s=i._c.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await Xl(i.localStore,Xo(s[0])),r=uc.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Es.EMPTY_BYTE_STRING);await qd(i,e,r);break}case"rejected":await Ql(i.localStore,t,!0),Md(i,t,r);break;default:Vr()}}async function Jd(e,t,n){const r=Xd(e);if(r.vc){for(const e of t){if(r._c.has(e)){Or("SyncEngine","Adding an already active target "+e);continue}const t=await Jl(r.localStore,e),n=await Wl(r.localStore,t);await kd(r,Wd(t),n.targetId,!1,n.resumeToken),xh(r.remoteStore,n)}for(const e of n)r._c.has(e)&&await Ql(r.localStore,e,!1).then((()=>{Rh(r.remoteStore,e),Md(r,e)})).catch(_i)}}function Xd(e){const t=Br(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nd.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=zd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=xd.bind(null,t),t.dc.nu=dd.bind(null,t.eventManager),t.dc.Pc=fd.bind(null,t.eventManager),t}function Zd(e){const t=Br(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Rd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Pd.bind(null,t),t}class ef{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=_h(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return zl(this.persistence,new ql,e.initialUser,this.serializer)}createPersistence(e){return new Dl(Rl.zs,this.serializer)}createSharedClientState(e){return new lh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class tf extends ef{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await Zd(this.Vc.syncEngine),await Gh(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return zl(this.persistence,new ql,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new ol(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new Pi(t,this.persistence);return new Ri(e.asyncQueue,n)}createPersistence(e){const t=Ul(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?$u.withCacheSize(this.cacheSizeBytes):$u.DEFAULT;return new Ml(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,wh(),bh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lh}}class nf extends tf{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Vc.syncEngine;this.sharedClientState instanceof uh&&(this.sharedClientState.syncEngine={jr:Kd.bind(null,t),zr:Yd.bind(null,t),Wr:Jd.bind(null,t),$i:Qd.bind(null,t),Qr:$d.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ii((async e=>{await async function(e,t){const n=Br(e);if(Xd(n),Zd(n),!0===t&&!0!==n.vc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Hd(n,e.toArray());n.vc=!0,await ed(n.remoteStore,!0);for(const e of t)xh(n.remoteStore,e)}else if(!1===t&&!1!==n.vc){const e=[];let t=Promise.resolve();n._c.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Md(n,i),Ql(n.localStore,i,!0)))),Rh(n.remoteStore,i)})),await t,await Hd(n,e),function(e){const t=Br(e);t.yc.forEach(((e,n)=>{Rh(t.remoteStore,n)})),t.Ic.Ts(),t.yc=new Map,t.gc=new gs(ui.comparator)}(n),n.vc=!1,await ed(n.remoteStore,!1)}}(this.Vc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=wh();if(!uh.D(t))throw new jr(qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ul(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class rf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Dd(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jd.bind(null,this.syncEngine),await ed(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ud}createDatastore(e){const t=_h(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new vh(r));var r;return function(e,t,n,r){return new Sh(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Dd(this.syncEngine,e,0),s=dh.D()?new dh:new hh,new Ah(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Cd(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Br(e);Or("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await Dh(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}function sf(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class of{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Lr("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class af{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new zr,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then((e=>{e&&e.Qu()?this.metadata.resolve(e.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Gu)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Cc.cancel()}async getMetadata(){return this.metadata.promise}async bc(){return await this.getMetadata(),this.Nc()}async Nc(){const e=await this.kc();if(null===e)return null;const t=this.xc.decode(e),n=Number(t);isNaN(n)&&this.Mc(`length string (${t}) is not valid number`);const r=await this.$c(n);return new gd(JSON.parse(r),e.length+n)}Oc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async kc(){for(;this.Oc()<0&&!await this.Fc(););if(0===this.buffer.length)return null;const e=this.Oc();e<0&&this.Mc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $c(e){for(;this.buffer.length<e;)await this.Fc()&&this.Mc("Reached the end of bundle when more is expected.");const t=this.xc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Fc(){const e=await this.Cc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class cf{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new jr(qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Br(e),r=Pc(n.serializer)+"/documents",i={documents:t.map((e=>Nc(n.serializer,e)))},s=await n.vo("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Ur(!!t.found),t.found.name,t.found.updateTime;const n=Dc(e,t.found.name),r=Sc(t.found.updateTime),i=t.found.createTime?Sc(t.found.createTime):ii.min(),s=new to({mapValue:{fields:t.found.fields}});return ro.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){Ur(!!t.missing),Ur(!!t.readTime);const n=Dc(e,t.missing),r=Sc(t.readTime);return ro.newNoDocument(n,r)}(e,t):Vr()}(n.serializer,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Ur(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new $a(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=ui.fromPath(t);this.mutations.push(new Ka(n,this.precondition(n)))})),await async function(e,t){const n=Br(e),r=Pc(n.serializer)+"/documents",i={writes:t.map((e=>Fc(n.serializer,e)))};await n.Io("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Vr();t=ii.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new jr(qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ii.min())?Ra.exists(!1):Ra.updateTime(t):Ra.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ii.min()))throw new jr(qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ra.updateTime(t)}return Ra.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class uf{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Bc=n.maxAttempts,this.qo=new Ih(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No((async()=>{const e=new cf(this.datastore),t=this.qc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Uc(e)}))))})).catch((e=>{this.Uc(e)}))}))}qc(e){try{const t=this.updateFunction(e);return!Li(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Lc(),Promise.resolve())))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Za(t)}return!1}}class lf{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Dr.UNAUTHENTICATED,this.clientId=Zr.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Or("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Or("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new jr(qr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=id(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function hf(e,t){e.asyncQueue.verifyOperationInProgress(),Or("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Gl(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function df(e,t){e.asyncQueue.verifyOperationInProgress();const n=await pf(e);Or("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Zh(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Zh(t.remoteStore,n))),e._onlineComponents=t}function ff(e){return"FirebaseError"===e.name?e.code===qr.FAILED_PRECONDITION||e.code===qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function pf(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Or("FirestoreClient","Using user provided OfflineComponentProvider");try{await hf(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!ff(n))throw n;Mr("Error using user provided cache. Falling back to memory cache: "+n),await hf(e,new ef)}}else Or("FirestoreClient","Using default OfflineComponentProvider"),await hf(e,new ef);return e._offlineComponents}async function mf(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Or("FirestoreClient","Using user provided OnlineComponentProvider"),await df(e,e._uninitializedComponentsProvider._online)):(Or("FirestoreClient","Using default OnlineComponentProvider"),await df(e,new rf))),e._onlineComponents}function gf(e){return pf(e).then((e=>e.persistence))}function yf(e){return pf(e).then((e=>e.localStore))}function vf(e){return mf(e).then((e=>e.remoteStore))}function wf(e){return mf(e).then((e=>e.syncEngine))}function bf(e){return mf(e).then((e=>e.datastore))}async function _f(e){const t=await mf(e),n=t.eventManager;return n.onListen=Sd.bind(null,t.syncEngine),n.onUnlisten=Ad.bind(null,t.syncEngine),n}function If(e,t,n={}){const r=new zr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new of({next:s=>{t.enqueueAndForget((()=>hd(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new jr(qr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new jr(qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new md(Uo(n.path),s,{includeMetadataChanges:!0,Ku:!0});return ld(e,o)}(await _f(e),e.asyncQueue,t,n,r))),r.promise}function Tf(e,t,n={}){const r=new zr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new of({next:n=>{t.enqueueAndForget((()=>hd(e,o))),n.fromCache&&"server"===r.source?i.reject(new jr(qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new md(n,s,{includeMetadataChanges:!0,Ku:!0});return ld(e,o)}(await _f(e),e.asyncQueue,t,n,r))),r.promise}function Ef(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?rc().encode(e):e,function(e,t){return new af(e,t)}(function(e,t){if(e instanceof Uint8Array)return sf(e,t);if(e instanceof ArrayBuffer)return sf(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,_h(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Br(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Br(e),r=Sc(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.qs.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(wd(r));const i=new vd(r,e.localStore,t.serializer);let s=await t.bc();for(;s;){const e=await i.zu(s);e&&n._updateProgress(e),s=await t.bc()}const o=await i.complete();return await qd(e,o.Ju,void 0),await function(e,t){const n=Br(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.qs.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Hu)}catch(e){return Mr("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await wf(e),i,r)}))}function Cf(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Sf=new Map;function kf(e,t,n){if(!n)throw new jr(qr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Af(e,t,n,r){if(!0===t&&!0===r)throw new jr(qr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Nf(e){if(!ui.isDocumentKey(e))throw new jr(qr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Df(e){if(ui.isDocumentKey(e))throw new jr(qr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function xf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Vr()}function Rf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new jr(qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xf(e);throw new jr(qr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Pf(e,t){if(t<=0)throw new jr(qr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Of{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new jr(qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new jr(qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Af("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cf(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new jr(qr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new jr(qr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new jr(qr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Lf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Of({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new jr(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new jr(qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Of(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new $r;switch(e.type){case"firstParty":return new Qr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new jr(qr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sf.get(e);t&&(Or("ComponentProvider","Removing Datastore"),Sf.delete(e),t.terminate())}(this),Promise.resolve()}}function Mf(e,t,n,r={}){var i;const s=(e=Rf(e,Lf))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Mr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Dr.MOCK_USER;else{t=(0,c.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new jr(qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Dr(s)}e._authCredentials=new Kr(new Gr(t,n))}}class Ff{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Uf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ff(this.firestore,e,this._key)}}class Vf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Vf(this.firestore,e,this._query)}}class Uf extends Vf{constructor(e,t,n){super(e,t,Uo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ff(this.firestore,null,new ui(e))}withConverter(e){return new Uf(this.firestore,e,this._path)}}function Bf(e,t,...n){if(e=(0,c.m9)(e),kf("collection","path",t),e instanceof Lf){const r=oi.fromString(t,...n);return Df(r),new Uf(e,null,r)}{if(!(e instanceof Ff||e instanceof Uf))throw new jr(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(oi.fromString(t,...n));return Df(r),new Uf(e.firestore,null,r)}}function qf(e,t,...n){if(e=(0,c.m9)(e),1===arguments.length&&(t=Zr.A()),kf("doc","path",t),e instanceof Lf){const r=oi.fromString(t,...n);return Nf(r),new Ff(e,null,new ui(r))}{if(!(e instanceof Ff||e instanceof Uf))throw new jr(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(oi.fromString(t,...n));return Nf(r),new Ff(e.firestore,e instanceof Uf?e.converter:null,new ui(r))}}function jf(e,t){return e=(0,c.m9)(e),t=(0,c.m9)(t),(e instanceof Ff||e instanceof Uf)&&(t instanceof Ff||t instanceof Uf)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function zf(e,t){return e=(0,c.m9)(e),t=(0,c.m9)(t),e instanceof Vf&&t instanceof Vf&&e.firestore===t.firestore&&Wo(e._query,t._query)&&e.converter===t.converter}class Gf{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Ih(this,"async_queue_retry"),this.Xc=()=>{const e=bh();e&&Or("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=bh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=bh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new zr;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!ki(e))throw e;Or("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Lr("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=rd.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(r),r}Zc(){this.Wc&&Vr()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function $f(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Kf{constructor(){this._progressObserver={},this._taskCompletionResolver=new zr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Hf extends Lf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Gf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Qf(this),this._firestoreClient.terminate()}}function Wf(e){return e._firestoreClient||Qf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Qf(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Rs(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Cf(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new lf(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function Yf(e,t,n){const r=new zr;return e.asyncQueue.enqueue((async()=>{try{await hf(e,n),await df(e,t),r.resolve()}catch(e){const t=e;if(!ff(t))throw t;Mr("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function Jf(e){return function(e){const t=new zr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Br(e);Fh(n.remoteStore)||Or("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Br(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Ec.get(e)||[];r.push(t),n.Ec.set(e,r)}catch(e){const n=id(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await wf(e),t))),t.promise}(Wf(e=Rf(e,Hf)))}function Xf(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await gf(e),n=await vf(e);return t.setNetworkEnabled(!0),function(e){const t=Br(e);return t.vu.delete(0),Nh(t)}(n)}))}(Wf(e=Rf(e,Hf)))}function Zf(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await gf(e),n=await vf(e);return t.setNetworkEnabled(!1),async function(e){const t=Br(e);t.vu.add(0),await Dh(t),t.bu.set("Offline")}(n)}))}(Wf(e=Rf(e,Hf)))}function ep(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Br(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.qs.getNamedQuery(e,t)))}(await yf(e),t)))}(Wf(e=Rf(e,Hf)),t).then((t=>t?new Vf(e,null,t.query):null))}function tp(e){if(e._initialized||e._terminated)throw new jr(qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class np{constructor(e){this._byteString=e}static fromBase64String(e){try{return new np(Es.fromBase64String(e))}catch(e){throw new jr(qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new np(Es.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class rp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new jr(qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ci(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ip{constructor(e){this._methodName=e}}class sp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new jr(qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new jr(qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ei(this._lat,e._lat)||ei(this._long,e._long)}}const op=/^__.*__$/;class ap{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new qa(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ba(e,this.data,t,this.fieldTransforms)}}class cp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new qa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function up(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vr()}}class lp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new lp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return Dp(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(up(this.ca)&&op.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class hp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_h(e)}ya(e,t,n,r=!1){return new lp({ca:e,methodName:t,ga:n,path:ci.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dp(e){const t=e._freezeSettings(),n=_h(e._databaseId);return new hp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function fp(e,t,n,r,i,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,i);Sp("Data must be an object, but it was:",o,r);const a=Ep(r,o);let c,u;if(s.merge)c=new Is(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=kp(t,r,n);if(!o.contains(i))throw new jr(qr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);xp(e,i)||e.push(i)}c=new Is(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new ap(new to(a),c,u)}class pp extends ip{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof pp}}function mp(e,t,n){return new lp({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class gp extends ip{_toFieldTransform(e){return new Da(e.path,new Ia)}isEqual(e){return e instanceof gp}}class yp extends ip{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=mp(this,e,!0),n=this.pa.map((e=>Tp(e,t))),r=new Ta(n);return new Da(e.path,r)}isEqual(e){return this===e}}class vp extends ip{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=mp(this,e,!0),n=this.pa.map((e=>Tp(e,t))),r=new Ca(n);return new Da(e.path,r)}isEqual(e){return this===e}}class wp extends ip{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new ka(e.serializer,ya(e.serializer,this.Ia));return new Da(e.path,t)}isEqual(e){return this===e}}function bp(e,t,n,r){const i=e.ya(1,t,n);Sp("Data must be an object, but it was:",i,r);const s=[],o=to.empty();ps(r,((e,r)=>{const a=Np(t,e,n);r=(0,c.m9)(r);const u=i.da(a);if(r instanceof pp)s.push(a);else{const e=Tp(r,u);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Is(s);return new cp(o,a,i.fieldTransforms)}function _p(e,t,n,r,i,s){const o=e.ya(1,t,n),a=[kp(t,r,n)],u=[i];if(s.length%2!=0)throw new jr(qr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(kp(t,s[e])),u.push(s[e+1]);const l=[],h=to.empty();for(let e=a.length-1;e>=0;--e)if(!xp(l,a[e])){const t=a[e];let n=u[e];n=(0,c.m9)(n);const r=o.da(t);if(n instanceof pp)l.push(t);else{const e=Tp(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new Is(l);return new cp(h,d,o.fieldTransforms)}function Ip(e,t,n,r=!1){return Tp(n,e.ya(r?4:3,t))}function Tp(e,t){if(Cp(e=(0,c.m9)(e)))return Sp("Unsupported field value:",t,e),Ep(e,t);if(e instanceof ip)return function(e,t){if(!up(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Tp(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ya(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ri.fromDate(e);return{timestampValue:Tc(t.serializer,n)}}if(e instanceof ri){const n=new ri(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Tc(t.serializer,n)}}if(e instanceof sp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof np)return{bytesValue:Ec(t.serializer,e._byteString)};if(e instanceof Ff){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:kc(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${xf(e)}`)}(e,t)}function Ep(e,t){const n={};return ms(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ps(e,((e,r)=>{const i=Tp(r,t.ha(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Cp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ri||e instanceof sp||e instanceof np||e instanceof Ff||e instanceof ip)}function Sp(e,t,n){if(!Cp(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=xf(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function kp(e,t,n){if((t=(0,c.m9)(t))instanceof rp)return t._internalPath;if("string"==typeof t)return Np(e,t);throw Dp("Field path arguments must be of type string or ",e,!1,void 0,n)}const Ap=new RegExp("[~\\*/\\[\\]]");function Np(e,t,n){if(t.search(Ap)>=0)throw Dp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new rp(...t.split("."))._internalPath}catch(r){throw Dp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Dp(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new jr(qr.INVALID_ARGUMENT,a+e+c)}function xp(e,t){return e.some((e=>e.isEqual(t)))}class Rp{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ff(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Pp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Op("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Pp extends Rp{data(){return super.data()}}function Op(e,t){return"string"==typeof t?Np(e,t):t instanceof rp?t._internalPath:t._delegate._internalPath}function Lp(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new jr(qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mp{}class Fp extends Mp{}function Vp(e,t,...n){let r=[];t instanceof Mp&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Bp)).length,n=e.filter((e=>e instanceof Up)).length;if(t>1||t>0&&n>0)throw new jr(qr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Up extends Fp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Up(e,t,n)}_apply(e){const t=this._parse(e);return Wp(e._query,t),new Vf(e.firestore,e.converter,Ko(e._query,t))}_parse(e){const t=dp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new jr(qr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Hp(o,s);const t=[];for(const n of o)t.push(Kp(r,e,n));a={arrayValue:{values:t}}}else a=Kp(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Hp(o,s),a=Ip(n,"where",o,"in"===s||"not-in"===s);return lo.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class Bp extends Mp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Bp(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:ho.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)Wp(n,e),n=Ko(n,e)}(e._query,t),new Vf(e.firestore,e.converter,Ko(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class qp extends Fp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new qp(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ao(t,n);return function(e,t){if(null===qo(e)){const n=jo(e);null!==n&&Qp(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Vf(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Fo(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class jp extends Fp{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new jp(e,t,n)}_apply(e){return new Vf(e.firestore,e.converter,Ho(e._query,this._limit,this._limitType))}}class zp extends Fp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new zp(e,t,n)}_apply(e){const t=$p(e,this.type,this._docOrFields,this._inclusive);return new Vf(e.firestore,e.converter,function(e,t){return new Fo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Gp extends Fp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Gp(e,t,n)}_apply(e){const t=$p(e,this.type,this._docOrFields,this._inclusive);return new Vf(e.firestore,e.converter,function(e,t){return new Fo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function $p(e,t,n,r){if(n[0]=(0,c.m9)(n[0]),n[0]instanceof Rp)return function(e,t,n,r,i){if(!r)throw new jr(qr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Go(e))if(n.field.isKeyField())s.push(zs(t,r.key));else{const e=r.data.field(n.field);if(Ns(e))throw new jr(qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new jr(qr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new io(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=dp(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new jr(qr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new jr(qr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!zo(e)&&-1!==c.indexOf("/"))throw new jr(qr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(oi.fromString(c));if(!ui.isDocumentKey(n))throw new jr(qr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new ui(n);a.push(zs(t,i))}else{const e=Ip(n,r,c);a.push(e)}}return new io(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Kp(e,t,n){if("string"==typeof(n=(0,c.m9)(n))){if(""===n)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zo(t)&&-1!==n.indexOf("/"))throw new jr(qr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(oi.fromString(n));if(!ui.isDocumentKey(r))throw new jr(qr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return zs(e,new ui(r))}if(n instanceof Ff)return zs(e,n._key);throw new jr(qr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xf(n)}.`)}function Hp(e,t){if(!Array.isArray(e)||0===e.length)throw new jr(qr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Wp(e,t){if(t.isInequality()){const n=jo(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new jr(qr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=qo(e);null!==i&&Qp(e,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new jr(qr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new jr(qr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function Qp(e,t,n){if(!n.isEqual(t))throw new jr(qr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Yp{convertValue(e,t="none"){switch(Ms(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ks(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(As(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Vr()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ps(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new sp(ks(e.latitude),ks(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ds(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(xs(e));default:return null}}convertTimestamp(e){const t=Ss(e);return new ri(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=oi.fromString(e);Ur(Yc(n));const r=new Ps(n.get(1),n.get(3)),i=new ui(n.popFirst(5));return r.isEqual(t)||Lr(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Jp(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Xp extends Yp{constructor(e){super(),this.firestore=e}convertBytes(e){return new np(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ff(this.firestore,null,t)}}class Zp{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class em extends Rp{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new tm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Op("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class tm extends em{data(e={}){return super.data(e)}}class nm{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Zp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new tm(this._firestore,this._userDataWriter,n.key,n,new Zp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new jr(qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new tm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Zp(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new tm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Zp(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:rm(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function rm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vr()}}function im(e,t){return e instanceof em&&t instanceof em?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof nm&&t instanceof nm&&e._firestore===t._firestore&&zf(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class sm extends Yp{constructor(e){super(),this.firestore=e}convertBytes(e){return new np(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ff(this.firestore,null,t)}}function om(e){e=Rf(e,Ff);const t=Rf(e.firestore,Hf),n=Wf(t),r=new sm(t);return function(e,t){const n=new zr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Br(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new jr(qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=id(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await yf(e),t,n))),n.promise}(n,e._key).then((n=>new em(t,r,e._key,n,new Zp(null!==n&&n.hasLocalMutations,!0),e.converter)))}function am(e){e=Rf(e,Vf);const t=Rf(e.firestore,Hf),n=Wf(t),r=new sm(t);return function(e,t){const n=new zr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Yl(e,t,!0),i=new Id(t,r.ir),s=i.sc(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=id(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await yf(e),t,n))),n.promise}(n,e._query).then((n=>new nm(t,r,e,n)))}function cm(e,t,n){e=Rf(e,Ff);const r=Rf(e.firestore,Hf),i=Jp(e.converter,t,n);return dm(r,[fp(dp(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Ra.none())])}function um(e,t,n,...r){e=Rf(e,Ff);const i=Rf(e.firestore,Hf),s=dp(i);let o;return o="string"==typeof(t=(0,c.m9)(t))||t instanceof rp?_p(s,"updateDoc",e._key,t,n,r):bp(s,"updateDoc",e._key,t),dm(i,[o.toMutation(e._key,Ra.exists(!0))])}function lm(e,...t){var n,r,i;e=(0,c.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||$f(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if($f(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,l,h;if(e instanceof Ff)l=Rf(e.firestore,Hf),h=Uo(e._key.path),u={next:n=>{t[o]&&t[o](fm(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Rf(e,Vf);l=Rf(n.firestore,Hf),h=n._query;const r=new sm(l);u={next:e=>{t[o]&&t[o](new nm(l,r,n,e))},error:t[o+1],complete:t[o+2]},Lp(e._query)}return function(e,t,n,r){const i=new of(r),s=new md(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>ld(await _f(e),s))),()=>{i.Dc(),e.asyncQueue.enqueueAndForget((async()=>hd(await _f(e),s)))}}(Wf(l),h,a,u)}function hm(e,t){return function(e,t){const n=new of(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Br(e).ku.add(t),t.next()}(await _f(e),n))),()=>{n.Dc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Br(e).ku.delete(t)}(await _f(e),n)))}}(Wf(e=Rf(e,Hf)),$f(t)?t:{next:t})}function dm(e,t){return function(e,t){const n=new zr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Zd(e);try{const e=await function(e,t){const n=Br(e),r=ri.now(),i=t.reduce(((e,t)=>e.add(t.key)),da());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=ra(),c=da();return n.Zi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Va(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new qa(e.key,t,no(t.value.mapValue),Ra.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:oa(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Tc[e.currentUser.toKey()];r||(r=new gs(ei)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(r,e.batchId,n),await qd(r,e.changes),await Gh(r.remoteStore)}catch(e){const t=id(e,"Failed to persist write");n.reject(t)}}(await wf(e),t,n))),n.promise}(Wf(e),t)}function fm(e,t,n){const r=n.docs.get(t._key),i=new sm(e);return new em(e,i,t._key,r,new Zp(n.hasPendingWrites,n.fromCache),t.converter)}const pm={maxAttempts:5};class mm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=dp(e)}set(e,t,n){this._verifyNotCommitted();const r=gm(e,this._firestore),i=Jp(r.converter,t,n),s=fp(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Ra.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=gm(e,this._firestore);let s;return s="string"==typeof(t=(0,c.m9)(t))||t instanceof rp?_p(this._dataReader,"WriteBatch.update",i._key,t,n,r):bp(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Ra.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=gm(e,this._firestore);return this._mutations=this._mutations.concat(new $a(t._key,Ra.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new jr(qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function gm(e,t){if((e=(0,c.m9)(e)).firestore!==t)throw new jr(qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class ym extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=dp(e)}get(e){const t=gm(e,this._firestore),n=new Xp(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Vr();const r=e[0];if(r.isFoundDocument())return new Rp(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Rp(this._firestore,n,t._key,null,t.converter);throw Vr()}))}set(e,t,n){const r=gm(e,this._firestore),i=Jp(r.converter,t,n),s=fp(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=gm(e,this._firestore);let s;return s="string"==typeof(t=(0,c.m9)(t))||t instanceof rp?_p(this._dataReader,"Transaction.update",i._key,t,n,r):bp(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=gm(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=gm(e,this._firestore),n=new sm(this._firestore);return super.get(e).then((e=>new em(this._firestore,n,t._key,e._document,new Zp(!1,!1),t.converter)))}}!function(e,t=!0){!function(e){xr=e}(s.SDK_VERSION),(0,s._registerComponent)(new o.wA("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Hf(new Hr(e.getProvider("auth-internal")),new Jr(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new jr(qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ps(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),(0,s.registerVersion)(Nr,"3.12.2",e),(0,s.registerVersion)(Nr,"3.12.2","esm2017")}();function vm(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new jr("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function wm(){if("undefined"==typeof Uint8Array)throw new jr("unimplemented","Uint8Arrays are not available in this environment.")}function bm(){if("undefined"==typeof atob)throw new jr("unimplemented","Blobs are unavailable in Firestore in this environment.")}class _m{constructor(e){this._delegate=e}static fromBase64String(e){return bm(),new _m(np.fromBase64String(e))}static fromUint8Array(e){return wm(),new _m(np.fromUint8Array(e))}toBase64(){return bm(),this._delegate.toBase64()}toUint8Array(){return wm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Im(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class Tm{enableIndexedDbPersistence(e,t){return function(e,t){tp(e=Rf(e,Hf));const n=Wf(e);if(n._uninitializedComponentsProvider)throw new jr(qr.FAILED_PRECONDITION,"SDK cache is already specified.");Mr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new rf;return Yf(n,i,new tf(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){tp(e=Rf(e,Hf));const t=Wf(e);if(t._uninitializedComponentsProvider)throw new jr(qr.FAILED_PRECONDITION,"SDK cache is already specified.");Mr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new rf;return Yf(t,r,new nf(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new jr(qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new zr;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Ei.D())return Promise.resolve();const t=e+"main";await Ei.delete(t)}(Ul(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class Em{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ps||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Mr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Mf(this._delegate,e,t,n)}enableNetwork(){return Xf(this._delegate)}disableNetwork(){return Zf(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Af("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Jf(this._delegate)}onSnapshotsInSync(e){return hm(this._delegate,e)}get app(){if(!this._appCompat)throw new jr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Vm(this,Bf(this._delegate,e))}catch(e){throw Dm(e,"collection()","Firestore.collection()")}}doc(e){try{return new Nm(this,qf(this._delegate,e))}catch(e){throw Dm(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Lm(this,function(e,t){if(e=Rf(e,Lf),kf("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new jr(qr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Vf(e,null,function(e){return new Fo(oi.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw Dm(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Rf(e,Hf);const r=Object.assign(Object.assign({},pm),n);return function(e){if(e.maxAttempts<1)throw new jr(qr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new zr;return e.asyncQueue.enqueueAndForget((async()=>{const i=await bf(e);new uf(e.asyncQueue,i,n,t,r).run()})),r.promise}(Wf(e),(n=>t(new ym(e,n))),r)}(this._delegate,(t=>e(new Sm(this,t))))}batch(){return Wf(this._delegate),new km(new mm(this._delegate,(e=>dm(this._delegate,e))))}loadBundle(e){return function(e,t){const n=Wf(e=Rf(e,Hf)),r=new Kf;return Ef(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return ep(this._delegate,e).then((e=>e?new Lm(this,e):null))}}class Cm extends Yp{constructor(e){super(),this.firestore=e}convertBytes(e){return new _m(new np(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Nm.forKey(t,this.firestore,null)}}class Sm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Cm(e)}get(e){const t=Um(e);return this._delegate.get(t).then((e=>new Pm(this._firestore,new em(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=Um(e);return n?(vm("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Um(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Um(e);return this._delegate.delete(t),this}}class km{constructor(e){this._delegate=e}set(e,t,n){const r=Um(e);return n?(vm("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Um(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Um(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Am{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new tm(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Om(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Am.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Am(e,new Cm(e),t),r.set(t,i)),i}}Am.INSTANCES=new WeakMap;class Nm{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Cm(e)}static forPath(e,t,n){if(e.length%2!=0)throw new jr("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Nm(t,new Ff(t._delegate,n,new ui(e)))}static forKey(e,t,n){return new Nm(t,new Ff(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Vm(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Vm(this.firestore,Bf(this._delegate,e))}catch(e){throw Dm(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,c.m9)(e))instanceof Ff&&jf(this._delegate,e)}set(e,t){t=vm("DocumentReference.set",t);try{return t?cm(this._delegate,e,t):cm(this._delegate,e)}catch(e){throw Dm(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?um(this._delegate,e):um(this._delegate,e,t,...n)}catch(e){throw Dm(e,"updateDoc()","DocumentReference.update()")}}delete(){return dm(Rf((e=this._delegate).firestore,Hf),[new $a(e._key,Ra.none())]);var e}onSnapshot(...e){const t=xm(e),n=Rm(e,(e=>new Pm(this.firestore,new em(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return lm(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?om(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Rf(e,Ff);const t=Rf(e.firestore,Hf);return If(Wf(t),e._key,{source:"server"}).then((n=>fm(t,e,n)))}(this._delegate):function(e){e=Rf(e,Ff);const t=Rf(e.firestore,Hf);return If(Wf(t),e._key).then((n=>fm(t,e,n)))}(this._delegate),t.then((e=>new Pm(this.firestore,new em(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new Nm(this.firestore,e?this._delegate.withConverter(Am.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Dm(e,t,n){return e.message=e.message.replace(t,n),e}function xm(e){for(const t of e)if("object"==typeof t&&!Im(t))return t;return{}}function Rm(e,t){var n,r;let i;return i=Im(e[0])?e[0]:Im(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Pm{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Nm(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return im(this._delegate,e._delegate)}}class Om extends Pm{data(e){const t=this._delegate.data(e);return void 0!==t||Vr(),t}}class Lm{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Cm(e)}where(e,t,n){try{return new Lm(this.firestore,Vp(this._delegate,function(e,t,n){const r=t,i=Op("where",e);return Up._create(i,r,n)}(e,t,n)))}catch(e){throw Dm(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Lm(this.firestore,Vp(this._delegate,function(e,t="asc"){const n=t,r=Op("orderBy",e);return qp._create(r,n)}(e,t)))}catch(e){throw Dm(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Lm(this.firestore,Vp(this._delegate,(Pf("limit",t=e),jp._create("limit",t,"F"))))}catch(e){throw Dm(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Lm(this.firestore,Vp(this._delegate,(Pf("limitToLast",t=e),jp._create("limitToLast",t,"L"))))}catch(e){throw Dm(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Lm(this.firestore,Vp(this._delegate,function(...e){return zp._create("startAt",e,!0)}(...e)))}catch(e){throw Dm(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Lm(this.firestore,Vp(this._delegate,function(...e){return zp._create("startAfter",e,!1)}(...e)))}catch(e){throw Dm(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Lm(this.firestore,Vp(this._delegate,function(...e){return Gp._create("endBefore",e,!1)}(...e)))}catch(e){throw Dm(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Lm(this.firestore,Vp(this._delegate,function(...e){return Gp._create("endAt",e,!0)}(...e)))}catch(e){throw Dm(e,"endAt()","Query.endAt()")}}isEqual(e){return zf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?am(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Rf(e,Vf);const t=Rf(e.firestore,Hf),n=Wf(t),r=new sm(t);return Tf(n,e._query,{source:"server"}).then((n=>new nm(t,r,e,n)))}(this._delegate):function(e){e=Rf(e,Vf);const t=Rf(e.firestore,Hf),n=Wf(t),r=new sm(t);return Lp(e._query),Tf(n,e._query).then((n=>new nm(t,r,e,n)))}(this._delegate),t.then((e=>new Fm(this.firestore,new nm(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=xm(e),n=Rm(e,(e=>new Fm(this.firestore,new nm(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return lm(this._delegate,t,n)}withConverter(e){return new Lm(this.firestore,e?this._delegate.withConverter(Am.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Mm{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Om(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Fm{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Lm(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new Om(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new Mm(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new Om(this._firestore,n))}))}isEqual(e){return im(this._delegate,e._delegate)}}class Vm extends Lm{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Nm(this.firestore,e):null}doc(e){try{return new Nm(this.firestore,void 0===e?qf(this._delegate):qf(this._delegate,e))}catch(e){throw Dm(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Rf(e.firestore,Hf),r=qf(e),i=Jp(e.converter,t);return dm(n,[fp(dp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Ra.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new Nm(this.firestore,e)))}isEqual(e){return jf(this._delegate,e._delegate)}withConverter(e){return new Vm(this.firestore,e?this._delegate.withConverter(Am.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Um(e){return Rf(e,Ff)}class Bm{constructor(...e){this._delegate=new rp(...e)}static documentId(){return new Bm(ci.keyField().canonicalString())}isEqual(e){return(e=(0,c.m9)(e))instanceof rp&&this._delegate._internalPath.isEqual(e._internalPath)}}class qm{constructor(e){this._delegate=e}static serverTimestamp(){const e=new gp("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new qm(e)}static delete(){const e=new pp("deleteField");return e._methodName="FieldValue.delete",new qm(e)}static arrayUnion(...e){const t=function(...e){return new yp("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new qm(t)}static arrayRemove(...e){const t=function(...e){return new vp("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new qm(t)}static increment(e){const t=new wp("increment",e);return t._methodName="FieldValue.increment",new qm(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const jm={Firestore:Em,GeoPoint:sp,Timestamp:ri,Blob:_m,Transaction:Sm,WriteBatch:km,DocumentReference:Nm,DocumentSnapshot:Pm,Query:Lm,QueryDocumentSnapshot:Om,QuerySnapshot:Fm,CollectionReference:Vm,FieldPath:Bm,FieldValue:qm,setLogLevel:function(e){var t;t=e,Rr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};var zm,Gm;zm=i.Z,Gm=(e,t)=>new Em(e,t,new Tm),zm.INTERNAL.registerComponent(new o.wA("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return Gm(t,n)}),"PUBLIC").setServiceProps(Object.assign({},jm))),zm.registerVersion("@firebase/firestore-compat","0.3.11")},397:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(821);const i=(0,r.aZ)({props:{value:{default:""},chars:{default:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"},count:{default:5},hideLines:{type:Boolean,default:!1},customTextColor:{default:""},textColors:{default:()=>[]},isDirty:{type:Boolean,default:!0},width:{default:function(e){return 30*e.count}},height:{default:50},canvasClass:{default:""},icon:{default:"refresh"},captchaFont:{default:"bold 28px sans-serif"}},emits:["isValid","getCode"],setup(e,{emit:t}){const n=e,i=(0,r.Rr)(),s=(0,r.iH)();let o=(0,r.iH)(""),a=n.width,c=n.height;(0,r.bv)((()=>{u()}));const u=()=>{s.value.width=a,s.value.height=c;let e=s.value.getContext("2d");for(let t=0;t<n.count;t++){let r=Math.floor(Math.random()*n.chars.length),i=30*Math.random()*Math.PI/180,s=n.chars[r];o.value+=s;let a=10+25*t,c=30+8*Math.random();e.font=n.captchaFont,e.translate(a,c),n.customTextColor?e.fillStyle=n.customTextColor:n.textColors.length?e.fillStyle=n.textColors[Math.floor(Math.random()*n.textColors.length)]:e.fillStyle=d(),e.rotate(i),e.fillText(s,0,0),e.rotate(-i),e.translate(-a,-c)}n.hideLines||l(),h()},l=()=>{let e=s.value.getContext("2d");for(let t=0;t<n.count;t++)e.strokeStyle=d(),e.beginPath(),e.moveTo(Math.random()*a,Math.random()*c),e.lineTo(Math.random()*a,Math.random()*c),e.stroke()},h=()=>{t("getCode",o.value)};(0,r.m0)((()=>{o.value&&o.value===n.value?t("isValid",!0):t("isValid",!1)}));const d=()=>"rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")",f=()=>(0,r.h)("div",{class:"vue_client_recaptcha"},[(0,r.h)("div",{class:"vue_client_recaptcha_icon",onClick:()=>(s.value.getContext("2d").clearRect(0,0,a,c),o.value="",void u())},[(0,r.h)(i.icon?i.icon:"svg",{class:"vue_client_recaptcha_icon_svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,r.h)("path",{d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.706 6.706 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95C10.46 2.64 18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0Z",fill:"#333333"})])]),(0,r.h)("canvas",{id:"captcha_canvas",class:`captcha_canvas ${n.canvasClass}`,ref:s},o.value)]);return(e,t)=>((0,r.wg)(),(0,r.j4)(f))}})}}]);